<!DOCTYPE html>
<html lang="en">
<head>
    <title>Gem::Package</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["Gem", "Package"]'>


    <meta property="og:title" value="Gem::Package">

  

    <meta name="keywords" content="Gem::Package class, build, new, raw_spec, initialize, copy_to, add_checksums, build, contents, extract_files, gzip_to, normalize_path, mkdir_p_safe, read_checksums, setup_signer, spec, verify, verify_entry, verify_files">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            Gem::Package
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../files/ruby/lib/rubygems/package_rb.html">ruby/lib/rubygems/package.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/digest_io_rb.html">ruby/lib/rubygems/package/digest_io.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/file_source_rb.html">ruby/lib/rubygems/package/file_source.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/io_source_rb.html">ruby/lib/rubygems/package/io_source.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/old_rb.html">ruby/lib/rubygems/package/old.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/source_rb.html">ruby/lib/rubygems/package/source.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/tar_header_rb.html">ruby/lib/rubygems/package/tar_header.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/tar_reader_rb.html">ruby/lib/rubygems/package/tar_reader.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/tar_reader/entry_rb.html">ruby/lib/rubygems/package/tar_reader/entry.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/tar_test_case_rb.html">ruby/lib/rubygems/package/tar_test_case.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/package/tar_writer_rb.html">ruby/lib/rubygems/package/tar_writer.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/DigestIO.html">Gem::Package::DigestIO</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/Error.html">Gem::Package::Error</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/FormatError.html">Gem::Package::FormatError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/NonSeekableIO.html">Gem::Package::NonSeekableIO</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/Old.html">Gem::Package::Old</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/PathError.html">Gem::Package::PathError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TarHeader.html">Gem::Package::TarHeader</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TarInvalidError.html">Gem::Package::TarInvalidError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TarReader.html">Gem::Package::TarReader</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TarTestCase.html">Gem::Package::TarTestCase</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TarWriter.html">Gem::Package::TarWriter</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Package/TooLongFileName.html">Gem::Package::TooLongFileName</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-add_checksums">add_checksums</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-build">build</a>,
              </li>
            
              
              <li>
                <a href="#method-c-build">build</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-contents">contents</a>,
              </li>
            
              
              <li>
                <a href="#method-i-copy_to">copy_to</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-extract_files">extract_files</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-gzip_to">gzip_to</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-initialize">initialize</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-mkdir_p_safe">mkdir_p_safe</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>,
              </li>
            
              
              <li>
                <a href="#method-i-normalize_path">normalize_path</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-raw_spec">raw_spec</a>,
              </li>
            
              
              <li>
                <a href="#method-i-read_checksums">read_checksums</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-setup_signer">setup_signer</a>,
              </li>
            
              
              <li>
                <a href="#method-i-spec">spec</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-verify">verify</a>,
              </li>
            
              
              <li>
                <a href="#method-i-verify_entry">verify_entry</a>,
              </li>
            
              
              <li>
                <a href="#method-i-verify_files">verify_files</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="UserInteraction.html">
              Gem::UserInteraction
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    
      <!-- Section attributes -->
      <h2 class="sectiontitle">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>checksums</td>
            <td class='attr-desc'><p>Checksums for the contents of the package</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>data_mode</td>
            <td class='attr-desc'><p>Permission for other files</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>dir_mode</td>
            <td class='attr-desc'><p>Permission for directories</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>files</td>
            <td class='attr-desc'><p>The files in this package.  This is not the contents of the gem, just the files in the top-level container.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>gem</td>
            <td class='attr-desc'><p>Reference to the gem being packaged.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>prog_mode</td>
            <td class='attr-desc'><p>Permission for program files</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>security_policy</td>
            <td class='attr-desc'><p>The security policy used for verifying the contents of this package.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [W]
            </td>
            <td class='attr-name'>spec</td>
            <td class='attr-desc'><p>Sets the <a href="Specification.html"><code>Gem::Specification</code></a> to use to build this package.</p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-build">
            
              <b>build</b>(spec, skip_validation = false, strict_validation = false, file_name = nil)
            
            <a href="../../classes/Gem/Package.html#method-c-build" name="method-c-build" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-build_source')" id="l_method-c-build_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L128" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-build_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">skip_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">strict_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">file_name</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">gem_file</span> = <span class="ruby-identifier">file_name</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">file_name</span>

  <span class="ruby-identifier">package</span> = <span class="ruby-identifier">new</span> <span class="ruby-identifier">gem_file</span>
  <span class="ruby-identifier">package</span>.<span class="ruby-identifier">spec</span> = <span class="ruby-identifier">spec</span>
  <span class="ruby-identifier">package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">skip_validation</span>, <span class="ruby-identifier">strict_validation</span>

  <span class="ruby-identifier">gem_file</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>new</b>(gem, security_policy = nil)
            
            <a href="../../classes/Gem/Package.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new Gem::Package for the file at <code>gem</code>. <code>gem</code> can also be provided as an <a href="../IO.html"><code>IO</code></a> object.</p>

<p>If <code>gem</code> is an existing file in the old format a <a href="Package/Old.html"><code>Gem::Package::Old</code></a> will be returned.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L145" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">new</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">security_policy</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">gem</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span>)
          <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:read</span>
          <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">IOSource</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FileSource</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">present?</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">start</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">super</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">start</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;MD5SUM =&#39;</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">Old</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-raw_spec">
            
              <b>raw_spec</b>(path, security_policy = nil)
            
            <a href="../../classes/Gem/Package.html#method-c-raw_spec" name="method-c-raw_spec" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Extracts the <a href="Specification.html"><code>Gem::Specification</code></a> and raw metadata from the .gem file at <code>path</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-raw_spec_source')" id="l_method-c-raw_spec_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L168" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-raw_spec_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">raw_spec</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">security_policy</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">format</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">security_policy</span>)
  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">format</span>.<span class="ruby-identifier">spec</span>

  <span class="ruby-identifier">metadata</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>, <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">binary_mode</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">tar</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>
    <span class="ruby-identifier">tar</span>.<span class="ruby-identifier">each_entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;metadata&#39;</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">metadata</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;metadata.gz&#39;</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">gunzip</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>, <span class="ruby-identifier">metadata</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-add_checksums">
            
              <b>add_checksums</b>(tar)
            
            <a href="../../classes/Gem/Package.html#method-i-add_checksums" name="method-i-add_checksums" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Adds a checksum for each entry in the gem to checksums.yaml.gz.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-add_checksums_source')" id="l_method-i-add_checksums_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L216" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-add_checksums_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_checksums</span>(<span class="ruby-identifier">tar</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

  <span class="ruby-identifier">checksums_by_algorithm</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">algorithm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">algorithm</span>] = {} }

  <span class="ruby-ivar">@checksums</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">digests</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">digests</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">algorithm</span>, <span class="ruby-identifier">digest</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">checksums_by_algorithm</span>[<span class="ruby-identifier">algorithm</span>][<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">digest</span>.<span class="ruby-identifier">hexdigest</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">tar</span>.<span class="ruby-identifier">add_file_signed</span> <span class="ruby-string">&#39;checksums.yaml.gz&#39;</span>, <span class="ruby-value">0444</span>, <span class="ruby-ivar">@signer</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">gzip_to</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gz_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">checksums_by_algorithm</span>, <span class="ruby-identifier">gz_io</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-build">
            
              <b>build</b>(skip_validation = false, strict_validation = false)
            
            <a href="../../classes/Gem/Package.html#method-i-build" name="method-i-build" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Builds this package based on the specification set by <a href="Package.html#attribute-i-spec"><code>spec=</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-build_source')" id="l_method-i-build_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L294" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-build_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 294</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">skip_validation</span> = <span class="ruby-keyword">false</span>, <span class="ruby-identifier">strict_validation</span> = <span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;skip_validation = true and strict_validation = true are incompatible&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_validation</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">strict_validation</span>

    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">mark_version</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">validate</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">strict_validation</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">skip_validation</span>

    <span class="ruby-identifier">setup_signer</span>(
      <span class="ruby-value">signer_options:</span> {
        <span class="ruby-value">expiration_length_days:</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">cert_expiration_length_days</span>
      }
    )

    <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_write_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarWriter</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">gem_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">add_metadata</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-identifier">add_contents</span> <span class="ruby-identifier">gem</span>
        <span class="ruby-identifier">add_checksums</span> <span class="ruby-identifier">gem</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">say</span> <span class="ruby-identifier">&lt;&lt;-EOM</span>
<span class="ruby-value">  Successfully built RubyGem
  Name: #{@spec.name}
  Version: #{@spec.version}
  File: #{File.basename @gem.path}
</span><span class="ruby-identifier">EOM</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-ivar">@signer</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-contents">
            
              <b>contents</b>()
            
            <a href="../../classes/Gem/Package.html#method-i-contents" name="method-i-contents" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>A list of file names contained in this gem</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-contents_source')" id="l_method-i-contents_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L329" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-contents_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 329</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">contents</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@contents</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contents</span>

  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-ivar">@contents</span> = []

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">gem_tar</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>

    <span class="ruby-identifier">gem_tar</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>

      <span class="ruby-identifier">open_tar_gz</span> <span class="ruby-identifier">entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pkg_tar</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">pkg_tar</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">contents_entry</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@contents</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">contents_entry</span>.<span class="ruby-identifier">full_name</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@contents</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-copy_to">
            
              <b>copy_to</b>(path)
            
            <a href="../../classes/Gem/Package.html#method-i-copy_to" name="method-i-copy_to" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Copies this package to <code>path</code> (if possible)</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-copy_to_source')" id="l_method-i-copy_to_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L209" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-copy_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">copy_to</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span> <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-extract_files">
            
              <b>extract_files</b>(destination_dir, pattern = &quot;*&quot;)
            
            <a href="../../classes/Gem/Package.html#method-i-extract_files" name="method-i-extract_files" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Extracts the files in this package into <code>destination_dir</code></p>

<p>If <code>pattern</code> is specified, only entries matching that glob will be extracted.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-extract_files_source')" id="l_method-i-extract_files_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L388" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-extract_files_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 388</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">extract_files</span>(<span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">pattern</span> = <span class="ruby-string">&quot;*&quot;</span>)
  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">destination_dir</span>, <span class="ruby-value">:mode</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">dir_mode</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">0755</span>

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">reader</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>

    <span class="ruby-identifier">reader</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>

      <span class="ruby-identifier">extract_tar_gz</span> <span class="ruby-identifier">entry</span>, <span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">pattern</span>

      <span class="ruby-keyword">return</span> <span class="ruby-comment"># ignore further entries</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-gzip_to">
            
              <b>gzip_to</b>(io)
            
            <a href="../../classes/Gem/Package.html#method-i-gzip_to" name="method-i-gzip_to" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Gzips content written to <code>gz_io</code> to <code>io</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-gzip_to_source')" id="l_method-i-gzip_to_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L466" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-gzip_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 466</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">gzip_to</span>(<span class="ruby-identifier">io</span>) <span class="ruby-comment"># :yields: gz_io</span>
  <span class="ruby-identifier">gz_io</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span>, <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_COMPRESSION</span>
  <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">mtime</span> = <span class="ruby-ivar">@build_time</span>

  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">gz_io</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">close</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-mkdir_p_safe">
            
              <b>mkdir_p_safe</b>(mkdir, mkdir_options, destination_dir, file_name)
            
            <a href="../../classes/Gem/Package.html#method-i-mkdir_p_safe" name="method-i-mkdir_p_safe" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-mkdir_p_safe_source')" id="l_method-i-mkdir_p_safe_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L512" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-mkdir_p_safe_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mkdir_p_safe</span>(<span class="ruby-identifier">mkdir</span>, <span class="ruby-identifier">mkdir_options</span>, <span class="ruby-identifier">destination_dir</span>, <span class="ruby-identifier">file_name</span>)
  <span class="ruby-identifier">destination_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">realpath</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">destination_dir</span>))
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">mkdir</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>)
  <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">reduce</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">basename</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">realpath</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">basename</span>)
    <span class="ruby-identifier">lstat</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">lstat</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lstat</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lstat</span>.<span class="ruby-identifier">directory?</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">normalize_path</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">start_with?</span> <span class="ruby-identifier">normalize_path</span>(<span class="ruby-identifier">destination_dir</span>) <span class="ruby-keyword">and</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-identifier">path</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">mkdir_options</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">false</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">PathError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file_name</span>, <span class="ruby-identifier">destination_dir</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-normalize_path">
            
              <b>normalize_path</b>(pathname)
            
            <a href="../../classes/Gem/Package.html#method-i-normalize_path" name="method-i-normalize_path" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-normalize_path_source')" id="l_method-i-normalize_path_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L504" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-normalize_path_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 504</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">normalize_path</span>(<span class="ruby-identifier">pathname</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
    <span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">pathname</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-read_checksums">
            
              <b>read_checksums</b>(gem)
            
            <a href="../../classes/Gem/Package.html#method-i-read_checksums" name="method-i-read_checksums" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Reads and loads checksums.yaml.gz from the tar file <code>gem</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-read_checksums_source')" id="l_method-i-read_checksums_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L556" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-read_checksums_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 556</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_checksums</span>(<span class="ruby-identifier">gem</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">load_yaml</span>

  <span class="ruby-ivar">@checksums</span> = <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">seek</span> <span class="ruby-string">&#39;checksums.yaml.gz&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipReader</span>.<span class="ruby-identifier">wrap</span> <span class="ruby-identifier">entry</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gz_io</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeYAML</span>.<span class="ruby-identifier">safe_load</span> <span class="ruby-identifier">gz_io</span>.<span class="ruby-identifier">read</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-setup_signer">
            
              <b>setup_signer</b>(signer_options: {})
            
            <a href="../../classes/Gem/Package.html#method-i-setup_signer" name="method-i-setup_signer" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Prepares the gem for signing and checksum generation.  If a signing certificate and key are not present only checksum generation is set up.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-setup_signer_source')" id="l_method-i-setup_signer_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L570" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-setup_signer_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 570</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">setup_signer</span>(<span class="ruby-value">signer_options:</span> {})
  <span class="ruby-identifier">passphrase</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span>
    <span class="ruby-ivar">@signer</span> =
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Signer</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span>,
        <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span>,
        <span class="ruby-identifier">passphrase</span>,
        <span class="ruby-identifier">signer_options</span>
      )

    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">signing_key</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cert</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">to_s</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@signer</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Signer</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">passphrase</span>
    <span class="ruby-ivar">@spec</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cert</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cert</span>.<span class="ruby-identifier">to_pem</span> } <span class="ruby-keyword">if</span>
      <span class="ruby-ivar">@signer</span>.<span class="ruby-identifier">cert_chain</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-spec">
            
              <b>spec</b>()
            
            <a href="../../classes/Gem/Package.html#method-i-spec" name="method-i-spec" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>The spec for this gem.</p>

<p>If this is a package for a built gem the spec is loaded from the gem and returned.  If this is a package for a gem being built the provided spec is returned.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-spec_source')" id="l_method-i-spec_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L597" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-spec_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 597</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">spec</span>
  <span class="ruby-identifier">verify</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>

  <span class="ruby-ivar">@spec</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-verify">
            
              <b>verify</b>()
            
            <a href="../../classes/Gem/Package.html#method-i-verify" name="method-i-verify" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Verifies that this gem:</p>
<ul><li>
<p>Contains a valid gem specification</p>
</li><li>
<p>Contains a contents archive</p>
</li><li>
<p>The contents archive is not corrupt</p>
</li></ul>

<p>After verification the gem specification from the gem is available from <a href="Package.html#method-i-spec"><code>spec</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-verify_source')" id="l_method-i-verify_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L613" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-verify_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 613</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify</span>
  <span class="ruby-ivar">@files</span>     = []
  <span class="ruby-ivar">@spec</span>      = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@gem</span>.<span class="ruby-identifier">with_read_io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarReader</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reader</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">read_checksums</span> <span class="ruby-identifier">reader</span>

      <span class="ruby-identifier">verify_files</span> <span class="ruby-identifier">reader</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">verify_checksums</span> <span class="ruby-ivar">@digests</span>, <span class="ruby-ivar">@checksums</span>

  <span class="ruby-ivar">@security_policy</span>.<span class="ruby-identifier">verify_signatures</span> <span class="ruby-ivar">@spec</span>, <span class="ruby-ivar">@digests</span>, <span class="ruby-ivar">@signatures</span> <span class="ruby-keyword">if</span>
    <span class="ruby-ivar">@security_policy</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>
  <span class="ruby-ivar">@spec</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@files</span> = []
  <span class="ruby-identifier">raise</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">TarInvalidError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>, <span class="ruby-ivar">@gem</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-verify_entry">
            
              <b>verify_entry</b>(entry)
            
            <a href="../../classes/Gem/Package.html#method-i-verify_entry" name="method-i-verify_entry" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Verifies <code>entry</code> in a .gem file.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-verify_entry_source')" id="l_method-i-verify_entry_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L663" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-verify_entry_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 663</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify_entry</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-identifier">file_name</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">full_name</span>
  <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file_name</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">file_name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/\.sig$/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@signatures</span>[<span class="ruby-node">$`</span>] = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">read</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@security_policy</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">digest</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">file_name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;metadata&quot;</span>, <span class="ruby-string">&quot;metadata.gz&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">load_spec</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">verify_gz</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-string">&quot;package is corrupt, exception while verifying: &quot;</span> <span class="ruby-operator">+</span>
            <span class="ruby-node">&quot;#{e.message} (#{e.class})&quot;</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">message</span>, <span class="ruby-ivar">@gem</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-verify_files">
            
              <b>verify_files</b>(gem)
            
            <a href="../../classes/Gem/Package.html#method-i-verify_files" name="method-i-verify_files" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Verifies the files of the <code>gem</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-verify_files_source')" id="l_method-i-verify_files_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L690" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-verify_files_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 690</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify_files</span>(<span class="ruby-identifier">gem</span>)
  <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">verify_entry</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@spec</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> <span class="ruby-string">&#39;package metadata is missing&#39;</span>, <span class="ruby-ivar">@gem</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;data.tar.gz&#39;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span><span class="ruby-operator">::</span><span class="ruby-constant">FormatError</span>.<span class="ruby-identifier">new</span> \
            <span class="ruby-string">&#39;package content (data.tar.gz) is missing&#39;</span>, <span class="ruby-ivar">@gem</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">duplicates</span> = <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">group_by</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span> }.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">duplicates</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;duplicate files in the package: (#{duplicates.map(&amp;:inspect).join(&#39;, &#39;)})&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
      <h2 class="sectiontitle">Instance Protected methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-initialize">
            
              <b>initialize</b>(gem, security_policy)
            
            <a href="../../classes/Gem/Package.html#method-i-initialize" name="method-i-initialize" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new package that will read or write to the file <code>gem</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-initialize_source')" id="l_method-i-initialize_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7ebc380bb431cce87a1b436d026cc8540008abf4/lib/rubygems/package.rb#L192" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-initialize_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/package.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">security_policy</span>) <span class="ruby-comment"># :notnew:</span>
  <span class="ruby-ivar">@gem</span> = <span class="ruby-identifier">gem</span>

  <span class="ruby-ivar">@build_time</span>      = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">source_date_epoch</span>
  <span class="ruby-ivar">@checksums</span>       = {}
  <span class="ruby-ivar">@contents</span>        = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@digests</span>         = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">algorithm</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">algorithm</span>] = {} }
  <span class="ruby-ivar">@files</span>           = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@security_policy</span> = <span class="ruby-identifier">security_policy</span>
  <span class="ruby-ivar">@signatures</span>      = {}
  <span class="ruby-ivar">@signer</span>          = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@spec</span>            = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
