<!DOCTYPE html>
<html lang="en">
<head>
    <title>Gem::TestCase</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script type="text/javascript" charset="utf-8">
document.addEventListener("turbolinks:load", function() {
  // Only initialize panel if not yet initialized
  if(!$('#panel .tree ul li').length) {
    $('#links').hide();
    var panel = new Searchdoc.Panel($('#panel'), search_data, tree, '/');
    $('#search').focus();
    var s = window.location.search.match(/\?q=([^&]+)/);
    if (s) {
      s = decodeURIComponent(s[1]).replace(/\+/g, ' ');
      if (s.length > 0) {
        $('#search').val(s);
        panel.search(s, true);
      }
    }
    panel.toggle(["Gem", "TestCase"]);
  }
})
</script>



    <meta property="og:title" value="Gem::TestCase">

  
    
    <meta name="description" content="RubyGemTestCase provides a variety of methods for testing rubygems and gem-related behavior in a sandbox.">
    <meta property="og:description" content="RubyGemTestCase provides a variety of methods for testing rubygems and gem-related behavior in a sandbox.">
  

    <meta name="keywords" content="Gem::TestCase class, assert_activate, assert_path_exists, enable_shared, refute_path_exists, scan_make_command_lines, parse_make_command_line, assert_contains_make_command, setup, teardown, common_installer_setup, common_installer_teardown, git_gem, have_git?, install_gem, install_gem_user, uninstall_gem, ask_if_ok, create_tmpdir, mu_pp, read_cache, read_binary, write_file, all_spec_names, quick_gem, util_build_gem, util_remove_gem, util_clear_gems, install_specs, install_default_gems, install_default_specs, loaded_spec_names, unresolved_names, save_loaded_features, new_default_spec, util_spec, util_gem, util_gzip, util_make_gems, util_set_arch, util_setup_fake_fetcher, add_to_fetcher, util_setup_spec_fetcher, util_zip, util_set_RUBY_VERSION, util_restore_RUBY_VERSION, util_clear_RUBY_VERSION, win_platform?, win_platform?, vc_windows?, vc_windows?, make_command, make_command, nmake_found?, wait_for_child_process_to_exit, process_based_port, process_based_port, build_rake_in, rubybin">
</head>

<body>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<div class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</div>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            Gem::TestCase
            
                <span class="parent">&lt;
                    
                    (defined?(Minitest::Test) ? Minitest::Test : MiniTest::Unit::TestCase)
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../files/ruby/lib/rubygems/test_case_rb.html">ruby/lib/rubygems/test_case.rb</a></li>
            
            <li><a href="../../files/ruby/lib/rubygems/test_utilities_rb.html">ruby/lib/rubygems/test_utilities.rb</a></li>
            
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>RubyGemTestCase provides a variety of methods for testing rubygems and gem-related behavior in a sandbox.  Through RubyGemTestCase you can install and uninstall gems, fetch remote gems through a stub fetcher and be assured your normal set of gems is not affected.</p>

<p>Tests are always run at a safe level of 1.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="TestCase/SpecFetcherSetup.html">Gem::TestCase::SpecFetcherSetup</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="TestCase/StaticSet.html">Gem::TestCase::StaticSet</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-add_to_fetcher">add_to_fetcher</a>,
              </li>
            
              
              <li>
                <a href="#method-i-all_spec_names">all_spec_names</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ask_if_ok">ask_if_ok</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_activate">assert_activate</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_contains_make_command">assert_contains_make_command</a>,
              </li>
            
              
              <li>
                <a href="#method-i-assert_path_exists">assert_path_exists</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-build_rake_in">build_rake_in</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-common_installer_setup">common_installer_setup</a>,
              </li>
            
              
              <li>
                <a href="#method-i-common_installer_teardown">common_installer_teardown</a>,
              </li>
            
              
              <li>
                <a href="#method-i-create_tmpdir">create_tmpdir</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-enable_shared">enable_shared</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-git_gem">git_gem</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-have_git-3F">have_git?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-install_default_gems">install_default_gems</a>,
              </li>
            
              
              <li>
                <a href="#method-i-install_default_specs">install_default_specs</a>,
              </li>
            
              
              <li>
                <a href="#method-i-install_gem">install_gem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-install_gem_user">install_gem_user</a>,
              </li>
            
              
              <li>
                <a href="#method-i-install_specs">install_specs</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-loaded_spec_names">loaded_spec_names</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-make_command">make_command</a>,
              </li>
            
              
              <li>
                <a href="#method-i-make_command">make_command</a>,
              </li>
            
              
              <li>
                <a href="#method-i-mu_pp">mu_pp</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-new_default_spec">new_default_spec</a>,
              </li>
            
              
              <li>
                <a href="#method-i-nmake_found-3F">nmake_found?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-parse_make_command_line">parse_make_command_line</a>,
              </li>
            
              
              <li>
                <a href="#method-c-process_based_port">process_based_port</a>,
              </li>
            
              
              <li>
                <a href="#method-i-process_based_port">process_based_port</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>Q</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-quick_gem">quick_gem</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-read_binary">read_binary</a>,
              </li>
            
              
              <li>
                <a href="#method-i-read_cache">read_cache</a>,
              </li>
            
              
              <li>
                <a href="#method-i-refute_path_exists">refute_path_exists</a>,
              </li>
            
              
              <li>
                <a href="#method-c-rubybin">rubybin</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-save_loaded_features">save_loaded_features</a>,
              </li>
            
              
              <li>
                <a href="#method-i-scan_make_command_lines">scan_make_command_lines</a>,
              </li>
            
              
              <li>
                <a href="#method-i-setup">setup</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-teardown">teardown</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-uninstall_gem">uninstall_gem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-unresolved_names">unresolved_names</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_build_gem">util_build_gem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_clear_RUBY_VERSION">util_clear_RUBY_VERSION</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_clear_gems">util_clear_gems</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_gem">util_gem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_gzip">util_gzip</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_make_gems">util_make_gems</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_remove_gem">util_remove_gem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_restore_RUBY_VERSION">util_restore_RUBY_VERSION</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_set_RUBY_VERSION">util_set_RUBY_VERSION</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_set_arch">util_set_arch</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_setup_fake_fetcher">util_setup_fake_fetcher</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_setup_spec_fetcher">util_setup_spec_fetcher</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_spec">util_spec</a>,
              </li>
            
              
              <li>
                <a href="#method-i-util_zip">util_zip</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-vc_windows-3F">vc_windows?</a>,
              </li>
            
              
              <li>
                <a href="#method-c-vc_windows-3F">vc_windows?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>W</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-wait_for_child_process_to_exit">wait_for_child_process_to_exit</a>,
              </li>
            
              
              <li>
                <a href="#method-i-win_platform-3F">win_platform?</a>,
              </li>
            
              
              <li>
                <a href="#method-c-win_platform-3F">win_platform?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-write_file">write_file</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="DefaultUserInteraction.html">
              Gem::DefaultUserInteraction
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-make_command">
            
              <b>make_command</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-c-make_command" name="method-c-make_command" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the make command for the current platform. For versions of Ruby built on MS Windows with VC++ or Borland it will return &#39;nmake&#39;. On all other platforms, including Cygwin, it will return &#39;make&#39;.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-make_command_source')" id="l_method-c-make_command_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1247" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-make_command_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1247</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">make_command</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;make&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;MAKE&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;nmake&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;make&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-process_based_port">
            
              <b>process_based_port</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-c-process_based_port" name="method-c-process_based_port" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Allows tests to use a random (but controlled) port number instead of a hardcoded one. This helps CI tools when running parallels builds on the same builder slave.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-process_based_port_source')" id="l_method-c-process_based_port_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1280" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-process_based_port_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1280</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">process_based_port</span>
  <span class="ruby-identifier">@@process_based_port</span> <span class="ruby-operator">||=</span> <span class="ruby-value">8000</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$$</span> <span class="ruby-operator">%</span> <span class="ruby-value">1000</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-rubybin">
            
              <b>rubybin</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-c-rubybin" name="method-c-rubybin" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Finds the path to the Ruby executable</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-rubybin_source')" id="l_method-c-rubybin_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1313" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-rubybin_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1313</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">rubybin</span>
  <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;RUBY&quot;</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby</span>
  <span class="ruby-identifier">ruby</span> = <span class="ruby-string">&quot;ruby&quot;</span>
  <span class="ruby-identifier">rubyexe</span> = <span class="ruby-node">&quot;#{ruby}.exe&quot;</span>

  <span class="ruby-value">3</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">ruby</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">ruby</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">rubyexe</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">rubyexe</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">rubyexe</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;..&quot;</span>, <span class="ruby-identifier">ruby</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;rbconfig&quot;</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;bindir&quot;</span>],
              <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;ruby_install_name&quot;</span>] <span class="ruby-operator">+</span>
              <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;EXEEXT&quot;</span>])
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span>
    <span class="ruby-string">&quot;ruby&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-vc_windows-3F">
            
              <b>vc_windows?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-c-vc_windows-3F" name="method-c-vc_windows-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns whether or not we&#39;re on a version of Ruby built with VC++ (or Borland) versus Cygwin, Mingw, etc.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-vc_windows-3F_source')" id="l_method-c-vc_windows-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1230" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-vc_windows-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1230</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">vc_windows?</span>
  <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&#39;mswin&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-win_platform-3F">
            
              <b>win_platform?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-c-win_platform-3F" name="method-c-win_platform-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Is this test being run on a Windows platform?</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-win_platform-3F_source')" id="l_method-c-win_platform-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1215" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-win_platform-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1215</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">win_platform?</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-add_to_fetcher">
            
              <b>add_to_fetcher</b>(spec, path=nil, repo=@gem_repo)
            
            <a href="../../classes/Gem/TestCase.html#method-i-add_to_fetcher" name="method-i-add_to_fetcher" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Add <code>spec</code> to +@fetcher+ serving the data in the file <code>path</code>. <code>repo</code> indicates which repo to make <code>spec</code> appear to be in.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-add_to_fetcher_source')" id="l_method-i-add_to_fetcher_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1092" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-add_to_fetcher_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_to_fetcher</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">path</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">repo</span>=<span class="ruby-ivar">@gem_repo</span>)
  <span class="ruby-identifier">path</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
  <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}gems/#{spec.file_name}&quot;</span>] = <span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-all_spec_names">
            
              <b>all_spec_names</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-all_spec_names" name="method-i-all_spec_names" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-all_spec_names_source')" id="l_method-i-all_spec_names_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L662" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-all_spec_names_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 662</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">all_spec_names</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-ask_if_ok">
            
              <b>ask_if_ok</b>(spec)
            
            <a href="../../classes/Gem/TestCase.html#method-i-ask_if_ok" name="method-i-ask_if_ok" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-ask_if_ok_source')" id="l_method-i-ask_if_ok_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L603" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-ask_if_ok_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 603</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ask_if_ok</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-assert_activate">
            
              <b>assert_activate</b>(expected, *specs)
            
            <a href="../../classes/Gem/TestCase.html#method-i-assert_activate" name="method-i-assert_activate" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_activate_source')" id="l_method-i-assert_activate_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L118" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-assert_activate_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_activate</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">then</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">activate</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">activate</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flunk</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">inspect</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">loaded</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>)

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">loaded</span>.<span class="ruby-identifier">sort</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">expected</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-assert_contains_make_command">
            
              <b>assert_contains_make_command</b>(target, output, msg = nil)
            
            <a href="../../classes/Gem/TestCase.html#method-i-assert_contains_make_command" name="method-i-assert_contains_make_command" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_contains_make_command_source')" id="l_method-i-assert_contains_make_command_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L192" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-assert_contains_make_command_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_contains_make_command</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">output</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\n/</span>)
    <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) {
      <span class="ruby-string">&#39;Expected output containing make command &quot;%s&quot;: %s&#39;</span> <span class="ruby-operator">%</span> [
        (<span class="ruby-string">&#39;%s %s&#39;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">make_command</span>, <span class="ruby-identifier">target</span>]).<span class="ruby-identifier">rstrip</span>,
        <span class="ruby-identifier">output</span>.<span class="ruby-identifier">inspect</span>
      ]
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) {
      <span class="ruby-string">&#39;Expected make command &quot;%s&quot;: %s&#39;</span> <span class="ruby-operator">%</span> [
        (<span class="ruby-string">&#39;%s %s&#39;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">make_command</span>, <span class="ruby-identifier">target</span>]).<span class="ruby-identifier">rstrip</span>,
        <span class="ruby-identifier">output</span>.<span class="ruby-identifier">inspect</span>
      ]
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scan_make_command_lines</span>(<span class="ruby-identifier">output</span>).<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">make</span> = <span class="ruby-identifier">parse_make_command_line</span>(<span class="ruby-identifier">line</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">make</span>[<span class="ruby-value">:targets</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">target</span>)
      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">make</span>, <span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  }, <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-assert_path_exists">
            
              <b>assert_path_exists</b>(path, msg = nil)
            
            <a href="../../classes/Gem/TestCase.html#method-i-assert_path_exists" name="method-i-assert_path_exists" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>TODO: move to minitest</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-assert_path_exists_source')" id="l_method-i-assert_path_exists_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L136" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-assert_path_exists_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_path_exists</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path &#39;#{path}&#39; to exist&quot;</span> }
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-build_rake_in">
            
              <b>build_rake_in</b>(good=true)
            
            <a href="../../classes/Gem/TestCase.html#method-i-build_rake_in" name="method-i-build_rake_in" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Allows the proper version of <code>rake</code> to be used for the test.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-build_rake_in_source')" id="l_method-i-build_rake_in_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1294" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-build_rake_in_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1294</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_rake_in</span>(<span class="ruby-identifier">good</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">gem_ruby</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-identifier">@@ruby</span>
  <span class="ruby-identifier">env_rake</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>]
  <span class="ruby-identifier">rake</span> = (<span class="ruby-identifier">good</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">@@good_rake</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">@@bad_rake</span>)
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>] = <span class="ruby-identifier">rake</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">rake</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-identifier">gem_ruby</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">env_rake</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>] = <span class="ruby-identifier">env_rake</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;rake&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-common_installer_setup">
            
              <b>common_installer_setup</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-common_installer_setup" name="method-i-common_installer_setup" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-common_installer_setup_source')" id="l_method-i-common_installer_setup_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L474" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-common_installer_setup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 474</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">common_installer_setup</span>
  <span class="ruby-identifier">common_installer_teardown</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_build_hook_arg</span> = <span class="ruby-identifier">installer</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@pre_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@pre_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-common_installer_teardown">
            
              <b>common_installer_teardown</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-common_installer_teardown" name="method-i-common_installer_teardown" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-common_installer_teardown_source')" id="l_method-i-common_installer_teardown_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L500" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-common_installer_teardown_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 500</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">common_installer_teardown</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">done_installing_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_reset_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_reset_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-create_tmpdir">
            
              <b>create_tmpdir</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-create_tmpdir" name="method-i-create_tmpdir" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>creates a temporary directory with hax TODO: deprecate and remove</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-create_tmpdir_source')" id="l_method-i-create_tmpdir_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L613" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-create_tmpdir_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 613</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_tmpdir</span>
  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span> <span class="ruby-keyword">do</span> <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-keyword">end</span> <span class="ruby-comment"># HACK OSX /private/tmp</span>
  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">tmpdir</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">tmpdir</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-enable_shared">
            
              <b>enable_shared</b>(value)
            
            <a href="../../classes/Gem/TestCase.html#method-i-enable_shared" name="method-i-enable_shared" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the ENABLE_SHARED entry in RbConfig::CONFIG to <code>value</code> and restores the original value when the block ends</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-enable_shared_source')" id="l_method-i-enable_shared_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L145" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-enable_shared_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">enable_shared</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">enable_shared</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ENABLE_SHARED&#39;</span>]
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ENABLE_SHARED&#39;</span>] = <span class="ruby-identifier">value</span>

  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">enable_shared</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;enable_shared&#39;</span>] = <span class="ruby-identifier">enable_shared</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;enable_shared&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-git_gem">
            
              <b>git_gem</b>(name = &#39;a&#39;, version = 1)
            
            <a href="../../classes/Gem/TestCase.html#method-i-git_gem" name="method-i-git_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>A <a href="TestCase.html#method-i-git_gem"><code>git_gem</code></a> is used with a gem dependencies file.  The gem created here has no files, just a gem specification for the given <code>name</code> and <code>version</code>.</p>

<p>Yields the <code>specification</code> to the block, if given</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-git_gem_source')" id="l_method-i-git_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L517" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-git_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">git_gem</span>(<span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>)
  <span class="ruby-identifier">have_git?</span>

  <span class="ruby-identifier">directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-identifier">directory</span>

  <span class="ruby-identifier">git_spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">specification</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">specification</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">directory</span>

  <span class="ruby-identifier">gemspec</span> = <span class="ruby-node">&quot;#{name}.gemspec&quot;</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-identifier">gemspec</span>), <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">git_spec</span>.<span class="ruby-identifier">to_ruby</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">head</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">directory</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-string">&#39;.git&#39;</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;init&#39;</span>, <span class="ruby-string">&#39;--quiet&#39;</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;config&#39;</span>, <span class="ruby-string">&#39;user.name&#39;</span>,  <span class="ruby-string">&#39;RubyGems Tests&#39;</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;config&#39;</span>, <span class="ruby-string">&#39;user.email&#39;</span>, <span class="ruby-string">&#39;rubygems@example&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;add&#39;</span>, <span class="ruby-identifier">gemspec</span>
    <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-string">&#39;-a&#39;</span>, <span class="ruby-string">&#39;-m&#39;</span>, <span class="ruby-string">&#39;a non-empty commit message&#39;</span>, <span class="ruby-string">&#39;--quiet&#39;</span>
    <span class="ruby-identifier">head</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;rev-parse&#39;</span>, <span class="ruby-string">&#39;master&#39;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">git_spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">directory</span>, <span class="ruby-identifier">head</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-have_git-3F">
            
              <b>have_git?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-have_git-3F" name="method-i-have_git-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Skips this test unless you have a git executable</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-have_git-3F_source')" id="l_method-i-have_git-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L555" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-have_git-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">have_git?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_path?</span> <span class="ruby-ivar">@git</span>

  <span class="ruby-identifier">skip</span> <span class="ruby-string">&#39;cannot find git executable, use GIT environment variable to set&#39;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-install_default_gems">
            
              <b>install_default_gems</b>(*specs)
            
            <a href="../../classes/Gem/TestCase.html#method-i-install_default_gems" name="method-i-install_default_gems" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Installs the provided default specs including writing the spec file</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-install_default_gems_source')" id="l_method-i-install_default_gems_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L768" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-install_default_gems_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 768</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install_default_gems</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">install_default_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)

  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span>, <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-install_default_specs">
            
              <b>install_default_specs</b>(*specs)
            
            <a href="../../classes/Gem/TestCase.html#method-i-install_default_specs" name="method-i-install_default_specs" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Install the provided default specs</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-install_default_specs_source')" id="l_method-i-install_default_specs_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L781" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-install_default_specs_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 781</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install_default_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">installer</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">for_spec</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-value">:install_as_default</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">installer</span>.<span class="ruby-identifier">install</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">register_default_spec</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-install_gem">
            
              <b>install_gem</b>(spec, options = {})
            
            <a href="../../classes/Gem/TestCase.html#method-i-install_gem" name="method-i-install_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Builds and installs the <a href="Specification.html"><code>Gem::Specification</code></a> <code>spec</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-install_gem_source')" id="l_method-i-install_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L572" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-install_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 572</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install_gem</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/installer&#39;</span>

  <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&quot;gems&quot;</span>, <span class="ruby-node">&quot;#{spec.full_name}.gem&quot;</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">gem</span>
    <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">do</span>
        <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">spec</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>)).<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({<span class="ruby-value">:wrappers</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>})).<span class="ruby-identifier">install</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-install_gem_user">
            
              <b>install_gem_user</b>(spec)
            
            <a href="../../classes/Gem/TestCase.html#method-i-install_gem_user" name="method-i-install_gem_user" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Builds and installs the <a href="Specification.html"><code>Gem::Specification</code></a> <code>spec</code> into the user dir</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-install_gem_user_source')" id="l_method-i-install_gem_user_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L593" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-install_gem_user_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 593</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install_gem_user</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">install_gem</span> <span class="ruby-identifier">spec</span>, <span class="ruby-value">:user_install</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-install_specs">
            
              <b>install_specs</b>(*specs)
            
            <a href="../../classes/Gem/TestCase.html#method-i-install_specs" name="method-i-install_specs" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Install the provided specs</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-install_specs_source')" id="l_method-i-install_specs_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L757" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-install_specs_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 757</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">for_spec</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">install</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-loaded_spec_names">
            
              <b>loaded_spec_names</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-loaded_spec_names" name="method-i-loaded_spec_names" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-loaded_spec_names_source')" id="l_method-i-loaded_spec_names_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L789" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-loaded_spec_names_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 789</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">loaded_spec_names</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>).<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-make_command">
            
              <b>make_command</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-make_command" name="method-i-make_command" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the make command for the current platform. For versions of Ruby built on MS Windows with VC++ or Borland it will return &#39;nmake&#39;. On all other platforms, including Cygwin, it will return &#39;make&#39;.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-make_command_source')" id="l_method-i-make_command_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1256" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-make_command_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">make_command</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;make&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;MAKE&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;nmake&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;make&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-mu_pp">
            
              <b>mu_pp</b>(obj)
            
            <a href="../../classes/Gem/TestCase.html#method-i-mu_pp" name="method-i-mu_pp" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Enables pretty-print for all tests</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-mu_pp_source')" id="l_method-i-mu_pp_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L624" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-mu_pp_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 624</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mu_pp</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-identifier">s</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-constant">PP</span>.<span class="ruby-identifier">pp</span> <span class="ruby-identifier">obj</span>, <span class="ruby-identifier">s</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>)
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-new_default_spec">
            
              <b>new_default_spec</b>(name, version, deps = nil, *files)
            
            <a href="../../classes/Gem/TestCase.html#method-i-new_default_spec" name="method-i-new_default_spec" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-new_default_spec_source')" id="l_method-i-new_default_spec_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L853" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-new_default_spec_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 853</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_default_spec</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">util_spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@default_spec_dir</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_name</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>

  <span class="ruby-identifier">lib_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&quot;default_gems&quot;</span>, <span class="ruby-string">&quot;lib&quot;</span>)
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">lib_dir</span>)
  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">rb_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">lib_dir</span>, <span class="ruby-identifier">file</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">rb_path</span>))
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">rb_path</span>, <span class="ruby-string">&quot;w&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rb</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">rb</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;# #{file}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-nmake_found-3F">
            
              <b>nmake_found?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-nmake_found-3F" name="method-i-nmake_found-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns whether or not the nmake command could be found.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-nmake_found-3F_source')" id="l_method-i-nmake_found-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1263" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-nmake_found-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">nmake_found?</span>
  <span class="ruby-identifier">system</span>(<span class="ruby-string">&#39;nmake /? 1&gt;NUL 2&gt;&amp;1&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-parse_make_command_line">
            
              <b>parse_make_command_line</b>(line)
            
            <a href="../../classes/Gem/TestCase.html#method-i-parse_make_command_line" name="method-i-parse_make_command_line" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-parse_make_command_line_source')" id="l_method-i-parse_make_command_line_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L168" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-parse_make_command_line_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_make_command_line</span>(<span class="ruby-identifier">line</span>)
  <span class="ruby-identifier">command</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">shellsplit</span>

  <span class="ruby-identifier">targets</span> = []
  <span class="ruby-identifier">macros</span> = {}

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/\A(\w+)=/</span>
      <span class="ruby-identifier">macros</span>[<span class="ruby-node">$1</span>] = <span class="ruby-node">$&#39;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">targets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">targets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">empty?</span>

  {
    <span class="ruby-value">:command</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">command</span>,
    <span class="ruby-value">:targets</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">targets</span>,
    <span class="ruby-value">:macros</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">macros</span>,
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-process_based_port">
            
              <b>process_based_port</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-process_based_port" name="method-i-process_based_port" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>See <a href="TestCase.html#method-c-process_based_port"><code>::process_based_port</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-process_based_port_source')" id="l_method-i-process_based_port_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1287" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-process_based_port_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1287</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_based_port</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">process_based_port</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-quick_gem">
            
              <b>quick_gem</b>(name, version=&#39;2&#39;)
            
            <a href="../../classes/Gem/TestCase.html#method-i-quick_gem" name="method-i-quick_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a <a href="Specification.html"><code>Gem::Specification</code></a> with a minimum of extra work.  <code>name</code> and <code>version</code> are the gem&#39;s name and version,  platform, author, email, homepage, summary and description are defaulted.  The specification is yielded for customization.</p>

<p>The gem is added to the installed gems in +@gemhome+ and the runtime.</p>

<p>Use this with <a href="TestCase.html#method-i-write_file"><code>write_file</code></a> to build an installed gem.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-quick_gem_source')" id="l_method-i-quick_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L676" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-quick_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 676</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>=<span class="ruby-string">&#39;2&#39;</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/specification&#39;</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-string">&#39;A User&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-string">&#39;example@example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-string">&#39;http://example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-string">&quot;this is a summary&quot;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;This is a test description&quot;</span>

    <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">s</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span> <span class="ruby-comment"># HACK: force specs to (re-)load before we write</span>

  <span class="ruby-identifier">written_path</span> = <span class="ruby-identifier">write_file</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">written_path</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-read_binary">
            
              <b>read_binary</b>(path)
            
            <a href="../../classes/Gem/TestCase.html#method-i-read_binary" name="method-i-read_binary" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Reads a binary file at <code>path</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-read_binary_source')" id="l_method-i-read_binary_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L643" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-read_binary_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 643</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_binary</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-read_cache">
            
              <b>read_cache</b>(path)
            
            <a href="../../classes/Gem/TestCase.html#method-i-read_cache" name="method-i-read_cache" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Reads a <a href="../Marshal.html"><code>Marshal</code></a> file at <code>path</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-read_cache_source')" id="l_method-i-read_cache_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L634" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-read_cache_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 634</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_cache</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">untaint</span>, <span class="ruby-string">&#39;rb&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-refute_path_exists">
            
              <b>refute_path_exists</b>(path, msg = nil)
            
            <a href="../../classes/Gem/TestCase.html#method-i-refute_path_exists" name="method-i-refute_path_exists" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>TODO: move to minitest</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-refute_path_exists_source')" id="l_method-i-refute_path_exists_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L159" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-refute_path_exists_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">refute_path_exists</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path &#39;#{path}&#39; to not exist&quot;</span> }
  <span class="ruby-identifier">refute</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-save_loaded_features">
            
              <b>save_loaded_features</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-save_loaded_features" name="method-i-save_loaded_features" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-save_loaded_features_source')" id="l_method-i-save_loaded_features_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L797" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-save_loaded_features_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 797</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">save_loaded_features</span>
  <span class="ruby-identifier">old_loaded_features</span> = <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">prefix</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span>
  <span class="ruby-identifier">new_features</span> = (<span class="ruby-identifier">$LOADED_FEATURES</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">old_loaded_features</span>)
  <span class="ruby-identifier">old_loaded_features</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">new_features</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">rindex</span>(<span class="ruby-identifier">prefix</span>, <span class="ruby-value">0</span>)})
  <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">replace</span> <span class="ruby-identifier">old_loaded_features</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-scan_make_command_lines">
            
              <b>scan_make_command_lines</b>(output)
            
            <a href="../../classes/Gem/TestCase.html#method-i-scan_make_command_lines" name="method-i-scan_make_command_lines" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-scan_make_command_lines_source')" id="l_method-i-scan_make_command_lines_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L164" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-scan_make_command_lines_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan_make_command_lines</span>(<span class="ruby-identifier">output</span>)
  <span class="ruby-identifier">output</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^#{Regexp.escape make_command}(?:[[:blank:]].*)?$/</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-setup">
            
              <b>setup</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-setup" name="method-i-setup" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p><a href="TestCase.html#method-i-setup"><code>setup</code></a> prepares a sandboxed location to install gems.  All installs are directed to a temporary directory.  All install plugins are removed.</p>

<p>If the <code>RUBY</code> environment variable is set the given path is used for <a href="../Gem.html#method-c-ruby"><code>Gem::ruby</code></a>.  The local platform is set to <code>i386-mswin32</code> for Windows or <code>i686-darwin8.10.1</code> otherwise.</p>

<p>If the <code>KEEP_FILES</code> environment variable is set the files will not be removed from <code>/tmp/test_rubygems_#{$$}.#{Time.now.to_i}</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L241" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">setup</span>
  <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@orig_gem_home</span>   = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_HOME&#39;</span>]
  <span class="ruby-ivar">@orig_gem_path</span>   = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PATH&#39;</span>]
  <span class="ruby-ivar">@orig_gem_vendor</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>]
  <span class="ruby-ivar">@orig_gem_spec_cache</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_SPEC_CACHE&#39;</span>]
  <span class="ruby-ivar">@orig_rubygems_gemdeps</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_GEMDEPS&#39;</span>]
  <span class="ruby-ivar">@orig_bundle_gemfile</span>   = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;BUNDLE_GEMFILE&#39;</span>]
  <span class="ruby-ivar">@orig_rubygems_host</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_HOST&#39;</span>]
  <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;GEM_REQUIREMENT_&#39;</span>) }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">k</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@orig_gem_env_requirements</span> = <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">to_hash</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;SOURCE_DATE_EPOCH&#39;</span>] = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@current_dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
  <span class="ruby-ivar">@fetcher</span>     = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">USE_BUNDLER_FOR_GEMDEPS</span>
    <span class="ruby-constant">Bundler</span>.<span class="ruby-identifier">ui</span>                     = <span class="ruby-constant">Bundler</span><span class="ruby-operator">::</span><span class="ruby-constant">UI</span><span class="ruby-operator">::</span><span class="ruby-constant">Silent</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@back_ui</span>                       = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultUserInteraction</span>.<span class="ruby-identifier">ui</span>
  <span class="ruby-ivar">@ui</span>                            = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-comment"># This needs to be a new instance since we call use_ui(@ui) when we want to</span>
  <span class="ruby-comment"># capture output</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">DefaultUserInteraction</span>.<span class="ruby-identifier">ui</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>
  <span class="ruby-identifier">tmpdir</span>.<span class="ruby-identifier">untaint</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;KEEP_FILES&#39;</span>]
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}.#{Time.now.to_i}&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@tempdir</span>

  <span class="ruby-comment"># This makes the tempdir consistent on OS X.</span>
  <span class="ruby-comment"># File.expand_path Dir.tmpdir                      #=&gt; &quot;/var/...&quot;</span>
  <span class="ruby-comment"># Dir.chdir Dir.tmpdir do File.expand_path &#39;.&#39; end #=&gt; &quot;/private/var/...&quot;</span>
  <span class="ruby-comment"># TODO use File#realpath above instead of #expand_path once 1.8 support is</span>
  <span class="ruby-comment"># dropped.</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-string">&#39;.&#39;</span>
    <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># This makes the tempdir consistent on Windows.</span>
  <span class="ruby-comment"># Dir.tmpdir may return short path name, but Dir[Dir.tmpdir] returns long</span>
  <span class="ruby-comment"># path name. https://bugs.ruby-lang.org/issues/10819</span>
  <span class="ruby-comment"># File.expand_path or File.realpath doesn&#39;t convert path name to long path</span>
  <span class="ruby-comment"># name. Only Dir[] (= Dir.glob) works.</span>
  <span class="ruby-comment"># Short and long path name is specific to Windows filesystem.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">win_platform?</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-ivar">@tempdir</span>][<span class="ruby-value">0</span>]
    <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@gemhome</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;gemhome&#39;</span>
  <span class="ruby-ivar">@userhome</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;userhome&#39;</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;GEM_SPEC_CACHE&quot;</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;spec_cache&#39;</span>

  <span class="ruby-ivar">@orig_ruby</span> = <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBY&#39;</span>]
                 <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>
                 <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBY&#39;</span>]
                 <span class="ruby-identifier">ruby</span>
               <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@git</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GIT&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;git&#39;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ensure_gem_subdirectories</span> <span class="ruby-ivar">@gemhome</span>

  <span class="ruby-ivar">@orig_LOAD_PATH</span> = <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">expand_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">s</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">expand_path</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">s</span>
      <span class="ruby-identifier">expand_path</span>.<span class="ruby-identifier">untaint</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_variable_defined?</span>(<span class="ruby-value">:@gem_prelude_index</span>)
        <span class="ruby-identifier">expand_path</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@gem_prelude_index</span>, <span class="ruby-identifier">expand_path</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">expand_path</span>.<span class="ruby-identifier">freeze</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">frozen?</span>
      <span class="ruby-identifier">s</span> = <span class="ruby-identifier">expand_path</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">s</span>
  }

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span>

  <span class="ruby-ivar">@orig_ENV_HOME</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>] = <span class="ruby-ivar">@userhome</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@user_home</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@gemdeps</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@env_requirements_by_name</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_instance_variable</span>, <span class="ruby-value">:@ruby_version</span> <span class="ruby-keyword">if</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value">:@ruby_version</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@gemhome</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@userhome</span>

  <span class="ruby-ivar">@orig_gem_private_key_passphrase</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>] = <span class="ruby-constant">PRIVATE_KEY_PASSPHRASE</span>

  <span class="ruby-ivar">@default_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;default&#39;</span>
  <span class="ruby-ivar">@default_spec_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@default_dir</span>, <span class="ruby-string">&quot;specifications&quot;</span>, <span class="ruby-string">&quot;default&quot;</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@default_dir</span>, <span class="ruby-ivar">@default_dir</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@default_spec_dir</span>

  <span class="ruby-comment"># We use Gem::Specification.reset the first time only so that if there</span>
  <span class="ruby-comment"># are unresolved deps that leak into the whole test suite, they&#39;re at least</span>
  <span class="ruby-comment"># reported once.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@initial_reset</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span> <span class="ruby-comment"># done to avoid cross-test warnings</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">@@initial_reset</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">use_paths</span>(<span class="ruby-ivar">@gemhome</span>)

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">clear_default_specs</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">USE_BUNDLER_FOR_GEMDEPS</span>
    <span class="ruby-constant">Bundler</span>.<span class="ruby-identifier">reset!</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">update_sources</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">FakeFetcher</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-ivar">@gem_repo</span> = <span class="ruby-string">&quot;http://gems.example.com/&quot;</span>
  <span class="ruby-ivar">@uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span> <span class="ruby-ivar">@gem_repo</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">replace</span> [<span class="ruby-ivar">@gem_repo</span>]

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@orig_BASERUBY</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>]
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>] = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ruby_install_name&#39;</span>]

  <span class="ruby-ivar">@orig_arch</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">win_platform?</span>
    <span class="ruby-identifier">util_set_arch</span> <span class="ruby-string">&#39;i386-mswin32&#39;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">util_set_arch</span> <span class="ruby-string">&#39;i686-darwin8.10.1&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@orig_hooks</span> = {}
  <span class="ruby-node">%w[post_install_hooks done_installing_hooks post_uninstall_hooks pre_uninstall_hooks pre_install_hooks pre_reset_hooks post_reset_hooks post_build_hooks]</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@orig_hooks</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@marshal_version</span> = <span class="ruby-node">&quot;#{Marshal::MAJOR_VERSION}.#{Marshal::MINOR_VERSION}&quot;</span>
  <span class="ruby-ivar">@orig_LOADED_FEATURES</span> = <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-teardown">
            
              <b>teardown</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-teardown" name="method-i-teardown" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p><a href="TestCase.html#method-i-teardown"><code>teardown</code></a> restores the process to its original state and removes the tempdir unless the <code>KEEP_FILES</code> environment variable was set.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-teardown_source')" id="l_method-i-teardown_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L408" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-teardown_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 408</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">teardown</span>
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">replace</span> <span class="ruby-ivar">@orig_LOAD_PATH</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOAD_PATH</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOAD_PATH</span>
      <span class="ruby-identifier">paths</span> = <span class="ruby-ivar">@orig_LOAD_PATH</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>), <span class="ruby-string">&quot;/&quot;</span>)}
      (<span class="ruby-identifier">$LOADED_FEATURES</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">feat</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">feat</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-identifier">path</span>)}
          <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">feat</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">replace</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_BASERUBY</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>] = <span class="ruby-ivar">@orig_BASERUBY</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;BASERUBY&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>] = <span class="ruby-ivar">@orig_arch</span>

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@current_dir</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;KEEP_FILES&#39;</span>]

  <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-ivar">@orig_gem_env_requirements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_HOME&#39;</span>]   = <span class="ruby-ivar">@orig_gem_home</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PATH&#39;</span>]   = <span class="ruby-ivar">@orig_gem_path</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>] = <span class="ruby-ivar">@orig_gem_vendor</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_SPEC_CACHE&#39;</span>] = <span class="ruby-ivar">@orig_gem_spec_cache</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_GEMDEPS&#39;</span>] = <span class="ruby-ivar">@orig_rubygems_gemdeps</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;BUNDLE_GEMFILE&#39;</span>]   = <span class="ruby-ivar">@orig_bundle_gemfile</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_HOST&#39;</span>] = <span class="ruby-ivar">@orig_rubygems_host</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-ivar">@orig_ruby</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_ruby</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_ENV_HOME</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>] = <span class="ruby-ivar">@orig_ENV_HOME</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;HOME&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@default_dir</span>, <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>] = <span class="ruby-ivar">@orig_gem_private_key_passphrase</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_clear_load_cache</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-identifier">refresh</span>

  <span class="ruby-ivar">@orig_hooks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">hooks</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">replace</span> <span class="ruby-identifier">hooks</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@back_ui</span>.<span class="ruby-identifier">close</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-uninstall_gem">
            
              <b>uninstall_gem</b>(spec)
            
            <a href="../../classes/Gem/TestCase.html#method-i-uninstall_gem" name="method-i-uninstall_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Uninstalls the <a href="Specification.html"><code>Gem::Specification</code></a> <code>spec</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-uninstall_gem_source')" id="l_method-i-uninstall_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L599" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-uninstall_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 599</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">uninstall_gem</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/uninstaller&#39;</span>

  <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Uninstaller</span>) {
    <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ask_if_ok</span>(<span class="ruby-identifier">spec</span>)
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">:executables</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:user_install</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">uninstall</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-unresolved_names">
            
              <b>unresolved_names</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-unresolved_names" name="method-i-unresolved_names" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-unresolved_names_source')" id="l_method-i-unresolved_names_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L793" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-unresolved_names_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 793</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unresolved_names</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>).<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_build_gem">
            
              <b>util_build_gem</b>(spec)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_build_gem" name="method-i-util_build_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Builds a gem from <code>spec</code> and places it in <code>File.join @gemhome, &#39;cache&#39;</code>.  Automatically creates files based on <code>spec.files</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_build_gem_source')" id="l_method-i-util_build_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L718" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_build_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 718</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_build_gem</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">gem_dir</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">file</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fp</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# #{file}&quot;</span> <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">cache</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">cache</span>), <span class="ruby-identifier">cache</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_clear_RUBY_VERSION">
            
              <b>util_clear_RUBY_VERSION</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_clear_RUBY_VERSION" name="method-i-util_clear_RUBY_VERSION" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_clear_RUBY_VERSION_source')" id="l_method-i-util_clear_RUBY_VERSION_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1203" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_clear_RUBY_VERSION_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_clear_RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_PATCHLEVEL</span>     <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_PATCHLEVEL</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_REVISION</span>       <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_REVISION</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_DESCRIPTION</span>    <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_DESCRIPTION</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_ENGINE</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_ENGINE_VERSION</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_ENGINE_VERSION</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_clear_gems">
            
              <b>util_clear_gems</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_clear_gems" name="method-i-util_clear_gems" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Removes all installed gems from +@gemhome+.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_clear_gems_source')" id="l_method-i-util_clear_gems_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L746" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_clear_gems_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 746</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_clear_gems</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>) <span class="ruby-comment"># TODO: use Gem::Dirs</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;specifications&quot;</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;specifications&quot;</span>)
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_gem">
            
              <b>util_gem</b>(name, version, deps = nil, &amp;block)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_gem" name="method-i-util_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a gem with <code>name</code>, <code>version</code> and <code>deps</code>.  The specification will be yielded before gem creation for customization.  The gem will be placed in <code>File.join @tempdir, &#39;gems&#39;</code>.  The specification and .gem file location are returned.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_gem_source')" id="l_method-i-util_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L926" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 926</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># TODO: deprecate</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">block</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span>
    <span class="ruby-identifier">block</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># Since Hash#each is unordered in 1.8, sort</span>
      <span class="ruby-comment"># the keys and iterate that way so the tests are</span>
      <span class="ruby-comment"># deterministic on all implementations.</span>
      <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">deps</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&gt;= 0&#39;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

  <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>

  <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;gems&#39;</span>, <span class="ruby-node">&quot;#{spec.original_name}.gem&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>, <span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-keyword">nil</span>

  [<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">cache_file</span>]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_gzip">
            
              <b>util_gzip</b>(data)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_gzip" name="method-i-util_gzip" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Gzips <code>data</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_gzip_source')" id="l_method-i-util_gzip_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L958" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_gzip_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 958</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_gzip</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">out</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">wrap</span> <span class="ruby-identifier">out</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">data</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">string</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_make_gems">
            
              <b>util_make_gems</b>(prerelease = false)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_make_gems" name="method-i-util_make_gems" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates several default gems which all have a lib/code.rb file.  The gems are not installed but are available in the cache dir.</p>
<dl class="rdoc-list note-list"><dt>+@a1+
<dd>
<p>gem a version 1, this is the best-described gem.</p>
</dd><dt>+@a2+
<dd>
<p>gem a version 2</p>
</dd><dt>+@a3a
<dd>
<p>gem a version 3.a</p>
</dd><dt>+@a_evil9+
<dd>
<p>gem a_evil version 9, use this to ensure similarly-named gems don&#39;t collide with a.</p>
</dd><dt>+@b2+
<dd>
<p>gem b version 2</p>
</dd><dt>+@c1_2+
<dd>
<p>gem c version 1.2</p>
</dd><dt>+@pl1+
<dd>
<p>gem pl version 1, this gem has a legacy platform of i386-linux.</p>
</dd></dl>

<p>Additional <code>prerelease</code> gems may also be created:</p>
<dl class="rdoc-list note-list"><dt>+@a2_pre+
<dd>
<p>gem a version 2.a</p>
</dd></dl>

<p>TODO: nuke this and fix tests. this should speed up a lot</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_make_gems_source')" id="l_method-i-util_make_gems_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L986" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_make_gems_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 986</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_make_gems</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword">false</span>)
    <span class="ruby-ivar">@a1</span> = <span class="ruby-identifier">quick_gem</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">date</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">TODAY</span> <span class="ruby-operator">-</span> <span class="ruby-value">86400</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span> = <span class="ruby-string">&#39;http://a.example.com&#39;</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span> = <span class="ruby-node">%w[example@example.com example2@example.com]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">authors</span> = <span class="ruby-node">%w[Example Example2]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">&lt;&lt;-DESC</span>
<span class="ruby-value">This line is really, really long.  So long, in fact, that it is more than eighty characters long!  The purpose of this line is for testing wrapping behavior because sometimes people don&#39;t wrap their text to eighty characters.  Without the wrapping, the text might not look good in the RSS feed.

Also, a list:
  * An entry that\&#39;s actually kind of sort
  * an entry that\&#39;s really long, which will probably get wrapped funny.  That&#39;s ok, somebody wasn&#39;t thinking straight when they made it more than eighty characters.
</span><span class="ruby-identifier">      DESC</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">init</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@a2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;2&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@a3a</span>     = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;3.a&#39;</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@a_evil9</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a_evil&#39;</span>, <span class="ruby-string">&#39;9&#39;</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@b2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-string">&#39;2&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@c1_2</span>    = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;c&#39;</span>, <span class="ruby-string">&#39;1.2&#39;</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@x</span>       = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;x&#39;</span>, <span class="ruby-string">&#39;1&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@dep_x</span>   = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;dep_x&#39;</span>, <span class="ruby-string">&#39;1&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-string">&#39;x&#39;</span>, <span class="ruby-string">&#39;&gt;= 1&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@pl1</span>     = <span class="ruby-identifier">quick_gem</span> <span class="ruby-string">&#39;pl&#39;</span>, <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-comment"># l for legacy</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-string">&#39;i386-linux&#39;</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@original_platform</span>, <span class="ruby-string">&#39;i386-linux&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">prerelease</span>
      <span class="ruby-ivar">@a2_pre</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;2.a&#39;</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
      <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a2_pre.original_name} lib code.rb]</span>)
      <span class="ruby-identifier">util_build_gem</span> <span class="ruby-ivar">@a2_pre</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a1.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a2.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a3a.original_name}     lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a_evil9.original_name} lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@b2.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@c1_2.original_name}    lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@pl1.original_name}     lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@x.original_name}       lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@dep_x.original_name}   lib code.rb]</span>)

    [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>, <span class="ruby-ivar">@pl1</span>, <span class="ruby-ivar">@x</span>, <span class="ruby-ivar">@dep_x</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>, <span class="ruby-ivar">@pl1</span>.<span class="ruby-identifier">original_name</span>)
  <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_remove_gem">
            
              <b>util_remove_gem</b>(spec)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_remove_gem" name="method-i-util_remove_gem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_remove_gem_source')" id="l_method-i-util_remove_gem_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L738" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_remove_gem_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 738</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_remove_gem</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_restore_RUBY_VERSION">
            
              <b>util_restore_RUBY_VERSION</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_restore_RUBY_VERSION" name="method-i-util_restore_RUBY_VERSION" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_restore_RUBY_VERSION_source')" id="l_method-i-util_restore_RUBY_VERSION_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1188" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_restore_RUBY_VERSION_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1188</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_restore_RUBY_VERSION</span>
  <span class="ruby-identifier">util_clear_RUBY_VERSION</span>

  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_VERSION</span>,        <span class="ruby-ivar">@RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_PATCHLEVEL</span>,     <span class="ruby-ivar">@RUBY_PATCHLEVEL</span>  <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_PATCHLEVEL</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_REVISION</span>,       <span class="ruby-ivar">@RUBY_REVISION</span>    <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_REVISION</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_DESCRIPTION</span>,    <span class="ruby-ivar">@RUBY_DESCRIPTION</span> <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_DESCRIPTION</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_ENGINE</span>,         <span class="ruby-ivar">@RUBY_ENGINE</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_ENGINE_VERSION</span>, <span class="ruby-ivar">@RUBY_ENGINE_VERSION</span> <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_ENGINE_VERSION</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_set_RUBY_VERSION">
            
              <b>util_set_RUBY_VERSION</b>(version, patchlevel = nil, revision = nil, description = nil, engine = &quot;ruby&quot;, engine_version = nil)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_set_RUBY_VERSION" name="method-i-util_set_RUBY_VERSION" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_set_RUBY_VERSION_source')" id="l_method-i-util_set_RUBY_VERSION_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1165" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_set_RUBY_VERSION_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_set_RUBY_VERSION</span>(<span class="ruby-identifier">version</span>, <span class="ruby-identifier">patchlevel</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">description</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">engine</span> = <span class="ruby-string">&quot;ruby&quot;</span>, <span class="ruby-identifier">engine_version</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value">:@ruby_version</span> <span class="ruby-keyword">or</span>
     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;@ruby_version&#39;</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_instance_variable</span>, <span class="ruby-value">:@ruby_version</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@RUBY_VERSION</span>        = <span class="ruby-constant">RUBY_VERSION</span>
  <span class="ruby-ivar">@RUBY_PATCHLEVEL</span>     = <span class="ruby-constant">RUBY_PATCHLEVEL</span>     <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_PATCHLEVEL</span>)
  <span class="ruby-ivar">@RUBY_REVISION</span>       = <span class="ruby-constant">RUBY_REVISION</span>       <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_REVISION</span>)
  <span class="ruby-ivar">@RUBY_DESCRIPTION</span>    = <span class="ruby-constant">RUBY_DESCRIPTION</span>    <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_DESCRIPTION</span>)
  <span class="ruby-ivar">@RUBY_ENGINE</span>         = <span class="ruby-constant">RUBY_ENGINE</span>
  <span class="ruby-ivar">@RUBY_ENGINE_VERSION</span> = <span class="ruby-constant">RUBY_ENGINE_VERSION</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_ENGINE_VERSION</span>)

  <span class="ruby-identifier">util_clear_RUBY_VERSION</span>

  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_VERSION</span>,        <span class="ruby-identifier">version</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_PATCHLEVEL</span>,     <span class="ruby-identifier">patchlevel</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">patchlevel</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_REVISION</span>,       <span class="ruby-identifier">revision</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_DESCRIPTION</span>,    <span class="ruby-identifier">description</span>    <span class="ruby-keyword">if</span> <span class="ruby-identifier">description</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_ENGINE</span>,         <span class="ruby-identifier">engine</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_ENGINE_VERSION</span>, <span class="ruby-identifier">engine_version</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">engine_version</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_set_arch">
            
              <b>util_set_arch</b>(arch)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_set_arch" name="method-i-util_set_arch" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p><a href="../Set.html"><code>Set</code></a> the platform to <code>arch</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_set_arch_source')" id="l_method-i-util_set_arch_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1053" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_set_arch_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1053</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_set_arch</span>(<span class="ruby-identifier">arch</span>)
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>] = <span class="ruby-identifier">arch</span>
  <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">arch</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@platforms</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@local</span>, <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">platform</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_setup_fake_fetcher">
            
              <b>util_setup_fake_fetcher</b>(prerelease = false)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_setup_fake_fetcher" name="method-i-util_setup_fake_fetcher" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets up a fake fetcher using the gems from <a href="TestCase.html#method-i-util_make_gems"><code>util_make_gems</code></a>.  Optionally additional <code>prerelease</code> gems may be included.</p>

<p>Gems created by this method may be fetched using <a href="RemoteFetcher.html"><code>Gem::RemoteFetcher</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_setup_fake_fetcher_source')" id="l_method-i-util_setup_fake_fetcher_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1069" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_setup_fake_fetcher_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1069</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_setup_fake_fetcher</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;zlib&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;socket&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/remote_fetcher&#39;</span>

  <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">FakeFetcher</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">util_make_gems</span>(<span class="ruby-identifier">prerelease</span>)
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-ivar">@all_gems</span> = [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>].<span class="ruby-identifier">sort</span>
  <span class="ruby-ivar">@all_gem_names</span> = <span class="ruby-ivar">@all_gems</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">full_name</span> }

  <span class="ruby-identifier">gem_names</span> = [<span class="ruby-ivar">@a1</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a2</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a3a</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@b2</span>.<span class="ruby-identifier">full_name</span>]
  <span class="ruby-ivar">@gem_names</span> = <span class="ruby-identifier">gem_names</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-ivar">@fetcher</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_setup_spec_fetcher">
            
              <b>util_setup_spec_fetcher</b>(*specs)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_setup_spec_fetcher" name="method-i-util_setup_spec_fetcher" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets up <a href="SpecFetcher.html"><code>Gem::SpecFetcher</code></a> to return information from the gems in <code>specs</code>. Best used with +@all_gems+ from <a href="TestCase.html#method-i-util_setup_fake_fetcher"><code>util_setup_fake_fetcher</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_setup_spec_fetcher_source')" id="l_method-i-util_setup_spec_fetcher_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1101" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_setup_spec_fetcher_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_setup_spec_fetcher</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">all_specs</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">specs</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_resort!</span> <span class="ruby-identifier">all_specs</span>

  <span class="ruby-identifier">spec_fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span>

  <span class="ruby-identifier">prerelease</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">all_specs</span>.<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">prerelease?</span>  }
  <span class="ruby-identifier">latest</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_latest_specs</span> <span class="ruby-identifier">all_specs</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">prerelease</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># HACK for test_download_to_cache</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span> <span class="ruby-operator">===</span> <span class="ruby-ivar">@fetcher</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">marshal_version</span>

    <span class="ruby-identifier">specs</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span> }
    <span class="ruby-identifier">s_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">specs</span>

    <span class="ruby-identifier">latest_specs</span> = <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">l_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">latest_specs</span>

    <span class="ruby-identifier">prerelease_specs</span> = <span class="ruby-identifier">prerelease</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span> }
    <span class="ruby-identifier">p_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">prerelease_specs</span>

    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}specs.#{v}.gz&quot;</span>]            = <span class="ruby-identifier">s_zip</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}latest_specs.#{v}.gz&quot;</span>]     = <span class="ruby-identifier">l_zip</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}prerelease_specs.#{v}.gz&quot;</span>] = <span class="ruby-identifier">p_zip</span>

    <span class="ruby-identifier">v</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">marshal_version</span>

    <span class="ruby-identifier">all_specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;#{@gem_repo}quick/Marshal.#{v}/#{spec.original_name}.gemspec.rz&quot;</span>
      <span class="ruby-identifier">data</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">spec</span>
      <span class="ruby-identifier">data_deflate</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
      <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">data_deflate</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">nil</span> <span class="ruby-comment"># force errors</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_spec">
            
              <b>util_spec</b>(name, version = 2, deps = nil, *files)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_spec" name="method-i-util_spec" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a spec with <code>name</code>, <code>version</code>.  <code>deps</code> can specify the dependency or a <code>block</code> can be given for full customization of the specification.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_spec_source')" id="l_method-i-util_spec_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L876" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_spec_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 876</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_spec</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">2</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>) <span class="ruby-comment"># :yields: specification</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-string">&#39;A User&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-string">&#39;example@example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-string">&#39;http://example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-string">&quot;this is a summary&quot;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;This is a test description&quot;</span>

    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">files</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span>
    <span class="ruby-comment"># Since Hash#each is unordered in 1.8, sort the keys and iterate that</span>
    <span class="ruby-comment"># way so the tests are deterministic on all implementations.</span>
    <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">deps</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&gt;= 0&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">write_file</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>

    <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;gems&#39;</span>, <span class="ruby-node">&quot;#{spec.full_name}.gem&quot;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">cache_file</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>, <span class="ruby-identifier">cache_file</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-util_zip">
            
              <b>util_zip</b>(data)
            
            <a href="../../classes/Gem/TestCase.html#method-i-util_zip" name="method-i-util_zip" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Deflates <code>data</code></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-util_zip_source')" id="l_method-i-util_zip_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1161" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-util_zip_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">util_zip</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-vc_windows-3F">
            
              <b>vc_windows?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-vc_windows-3F" name="method-i-vc_windows-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns whether or not we&#39;re on a version of Ruby built with VC++ (or Borland) versus Cygwin, Mingw, etc.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-vc_windows-3F_source')" id="l_method-i-vc_windows-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1238" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-vc_windows-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1238</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">vc_windows?</span>
  <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&#39;mswin&#39;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-wait_for_child_process_to_exit">
            
              <b>wait_for_child_process_to_exit</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-wait_for_child_process_to_exit" name="method-i-wait_for_child_process_to_exit" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>In case we&#39;re building docs in a background process, this method waits for that process to exit (or if it&#39;s already been reaped, or never happened, swallows the Errno::ECHILD error).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-wait_for_child_process_to_exit_source')" id="l_method-i-wait_for_child_process_to_exit_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1270" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-wait_for_child_process_to_exit_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">wait_for_child_process_to_exit</span>
  <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fork</span>)
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECHILD</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-win_platform-3F">
            
              <b>win_platform?</b>()
            
            <a href="../../classes/Gem/TestCase.html#method-i-win_platform-3F" name="method-i-win_platform-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Is this test being run on a Windows platform?</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-win_platform-3F_source')" id="l_method-i-win_platform-3F_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L1222" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-win_platform-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 1222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">win_platform?</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-write_file">
            
              <b>write_file</b>(path)
            
            <a href="../../classes/Gem/TestCase.html#method-i-write_file" name="method-i-write_file" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Writes a binary file to <code>path</code> which is relative to +@gemhome+</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-write_file_source')" id="l_method-i-write_file_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/4b170e7654bf3d0e3d3fcfa05176afad60592826/lib/rubygems/test_case.rb#L650" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-write_file_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/rubygems/test_case.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@gemhome</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">absolute?</span>
  <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">path</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dir</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;wb&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
