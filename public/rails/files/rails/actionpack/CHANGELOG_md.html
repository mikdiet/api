<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='[]'>

</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            CHANGELOG.md
        </h2>
        <ul class="files">
            
            <li>
                rails/actionpack/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/9650d254d4539ed8201394bc9f639e78bac24b20/actionpack/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2022-09-06 00:52:05 +0300</li>
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+6.1.6.1+-28July+12-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.6.1 (July 12, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.1.5.1+-28April+26-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.5.1 (April 26, 2022)</h2>
<ul><li>
<p>Allow Content Security Policy DSL to generate for API responses.</p>

<p><em>Tim Wade</em></p>
</li></ul>

<h2 id="label-Rails+6.1.5+-28March+09-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.5 (March 09, 2022)</h2>
<ul><li>
<p>Fix <code>content_security_policy</code> returning invalid directives.</p>

<p>Directives such as <code>self</code>, <code>unsafe-eval</code> and few others were not single quoted when the directive was the result of calling a lambda returning an array.</p>

<pre><code>content_security_policy do |policy|
  policy.frame_ancestors lambda { [:self, &quot;https://example.com&quot;] }
end
</code></pre>

<p>With this fix the policy generated from above will now be valid.</p>

<p><em>Edouard Chin</em></p>
</li><li>
<p>Update <code>HostAuthorization</code> middleware to render debug info only when <code>config.consider_all_requests_local</code> is set to true.</p>

<p>Also, blocked host info is always logged with level <code>error</code>.</p>

<p>Fixes #42813.</p>

<p><em>Nikita Vyrko</em></p>
</li><li>
<p>Dup arrays that get "converted".</p>

<p>Fixes #43681.</p>

<p><em>Aaron Patterson</em></p>
</li><li>
<p>Don't show deprecation warning for equal paths.</p>

<p><em>Anton Rieder</em></p>
</li><li>
<p>Fix crash in <code>ActionController::Instrumentation</code> with invalid HTTP formats.</p>

<p>Fixes #43094.</p>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Add fallback host for SystemTestCase driven by RackTest.</p>

<p>Fixes #42780.</p>

<p><em>Petrik de Heus</em></p>
</li><li>
<p>Add more detail about what hosts are allowed.</p>

<p><em>Alex Ghiculescu</em></p>
</li></ul>

<h2 id="label-Rails+6.1.4.7+-28March+08-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.7 (March 08, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.1.4.6+-28February+11-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.6 (February 11, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.1.4.5+-28February+11-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.5 (February 11, 2022)</h2>
<ul><li>
<p>Under certain circumstances, the middleware isn't informed that the response body has been fully closed which result in request state not being fully reset before the next request</p>

<p>[CVE-2022-23633]</p>
</li></ul>

<h2 id="label-Rails+6.1.4.4+-28December+15-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.4 (December 15, 2021)</h2>
<ul><li>
<p>Fix issue with host protection not allowing host with port in development.</p>
</li></ul>

<h2 id="label-Rails+6.1.4.3+-28December+14-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.3 (December 14, 2021)</h2>
<ul><li>
<p>Fix issue with host protection not allowing localhost in development.</p>
</li></ul>

<h2 id="label-Rails+6.1.4.2+-28December+14-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.2 (December 14, 2021)</h2>
<ul><li>
<p>Fix X_FORWARDED_HOST protection. [CVE-2021-44528]</p>
</li></ul>

<h2 id="label-Rails+6.1.4.1+-28August+19-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4.1 (August 19, 2021)</h2>
<ul><li>
<p>[CVE-2021-22942] Fix possible open redirect in Host Authorization middleware.</p>

<p>Specially crafted "X-Forwarded-Host" headers in combination with certain "allowed host" formats can cause the Host Authorization middleware in Action Pack to redirect users to a malicious website.</p>
</li></ul>

<h2 id="label-Rails+6.1.4+-28June+24-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.4 (June 24, 2021)</h2>
<ul><li>
<p>Ignore file fixtures on <code>db:fixtures:load</code></p>

<p><em>Kevin Sj√∂berg</em></p>
</li><li>
<p>Fix <a href="../../../classes/ActionController/Live.html"><code>ActionController::Live</code></a> controller test deadlocks by removing the body buffer size limit for tests.</p>

<p><em>Dylan Thacker-Smith</em></p>
</li><li>
<p>Correctly place optional path parameter booleans.</p>

<p>Previously, if you specify a url parameter that is part of the path as false it would include that part of the path as parameter for example:</p>

<pre><code>get &quot;(/optional/:optional_id)/things&quot; =&gt; &quot;foo#foo&quot;, as: :things
things_path(optional_id: false) # =&gt; /things?optional_id=false
</code></pre>

<p>After this change, true and false will be treated the same when used as optional path parameters. Meaning now:</p>

<pre><code>get &#39;(this/:my_bool)/that&#39; as: :that

that_path(my_bool: true) # =&gt; `/this/true/that`
that_path(my_bool: false) # =&gt; `/this/false/that`
</code></pre>

<p><em>Adam Hess</em></p>
</li><li>
<p>Add support for 'private, no-store' Cache-Control headers.</p>

<p>Previously, 'no-store' was exclusive; no other directives could be specified.</p>

<p><em>Alex Smith</em></p>
</li></ul>

<h2 id="label-Rails+6.1.3.2+-28May+05-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.3.2 (May 05, 2021)</h2>
<ul><li>
<p>Prevent open redirects by correctly escaping the host allow list CVE-2021-22903</p>
</li><li>
<p>Prevent catastrophic backtracking during mime parsing CVE-2021-22902</p>
</li><li>
<p>Prevent regex DoS in HTTP token authentication CVE-2021-22904</p>
</li><li>
<p>Prevent string polymorphic route arguments.</p>

<p><code>url_for</code> supports building polymorphic URLs via an array of arguments (usually symbols and records). If a developer passes a user input array, strings can result in unwanted route helper calls.</p>

<p>CVE-2021-22885</p>

<p><em>Gannon McGibbon</em></p>
</li></ul>

<h2 id="label-Rails+6.1.3.1+-28March+26-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.3.1 (March 26, 2021)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+6.1.3+-28February+17-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.3 (February 17, 2021)</h2>
<ul><li>
<p>Re-define routes when not set correctly via inheritance.</p>

<p><em>John Hawthorn</em></p>
</li></ul>

<h2 id="label-Rails+6.1.2.1+-28February+10-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.2.1 (February 10, 2021)</h2>
<ul><li>
<p>Prevent open redirect when allowed host starts with a dot</p>

<p>[CVE-2021-22881]</p>

<p>Thanks to @tktech (<a href="https://hackerone.com/tktech">hackerone.com/tktech</a>) for reporting this issue and the patch!</p>

<p><em>Aaron Patterson</em></p>
</li></ul>

<h2 id="label-Rails+6.1.2+-28February+09-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.2 (February 09, 2021)</h2>
<ul><li>
<p>Fix error in <code>ActionController::LogSubscriber</code> that would happen when throwing inside a controller action.</p>

<p><em>Janko Marohniƒá</em></p>
</li><li>
<p>Fix <code>fixture_file_upload</code> deprecation when <code>file_fixture_path</code> is a relative path.</p>

<p><em>Eugene Kenny</em></p>
</li></ul>

<h2 id="label-Rails+6.1.1+-28January+07-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.1 (January 07, 2021)</h2>
<ul><li>
<p>Fix nil translation key lookup in controllers/</p>

<p><em>Jan Klimo</em></p>
</li><li>
<p>Quietly handle unknown HTTP methods in Action Dispatch SSL middleware.</p>

<p><em>Alex Robbin</em></p>
</li><li>
<p>Change the request method to a <code>GET</code> when passing failed requests down to <code>config.exceptions_app</code>.</p>

<p><em>Alex Robbin</em></p>
</li></ul>

<h2 id="label-Rails+6.1.0+-28December+09-2C+2020-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 6.1.0 (December 09, 2020)</h2>
<ul><li>
<p>Support for the HTTP header <code>Feature-Policy</code> has been revised to reflect its <a href="https://github.com/w3c/webappsec-permissions-policy/pull/379">rename</a> to {<code>Permissions-Policy</code><a href="https://w3c.github.io/webappsec-permissions-policy/#permissions-policy-http-header-field">}</a>.</p>

<pre><code>Rails.application.config.permissions_policy do |p|
  p.camera     :none
  p.gyroscope  :none
  p.microphone :none
  p.usb        :none
  p.fullscreen :self
  p.payment    :self, &quot;https://secure-example.com&quot;
end
</code></pre>

<p><em>Julien Grillot</em></p>
</li><li>
<p>Allow <code>ActionDispatch::HostAuthorization</code> to exclude specific requests.</p>

<p>Host Authorization checks can be skipped for specific requests. This allows for health check requests to be permitted for requests with missing or non-matching host headers.</p>

<p><em>Chris Bisnett</em></p>
</li><li>
<p>Add <code>config.action_dispatch.request_id_header</code> to allow changing the name of the unique X-Request-Id header</p>

<p><em>Arlston Fernandes</em></p>
</li><li>
<p>Deprecate <code>config.action_dispatch.return_only_media_type_on_content_type</code>.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>Change <code>ActionDispatch::Response#content_type</code> to return the full Content-Type header.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>Remove deprecated <code>ActionDispatch::Http::ParameterFilter</code>.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>Added support for exclusive no-store Cache-Control header.</p>

<p>If <code>no-store</code> is set on Cache-Control header it is exclusive (all other cache directives are dropped).</p>

<p><em>Chris Kruger</em></p>
</li><li>
<p>Catch invalid UTF-8 parameters for POST requests and respond with BadRequest.</p>

<p>Additionally, perform <code>#set_binary_encoding</code> in <code>ActionDispatch::Http::Request#GET</code> and <code>ActionDispatch::Http::Request#POST</code> prior to validating encoding.</p>

<p><em>Adrianna Chang</em></p>
</li><li>
<p>Allow <code>assert_recognizes</code> routing assertions to work on mounted root routes.</p>

<p><em>Gannon McGibbon</em></p>
</li><li>
<p>Change default redirection status code for non-GET/HEAD requests to 308 Permanent Redirect for <code>ActionDispatch::SSL</code>.</p>

<p><em>Alan Tan</em>, <em>Oz Ben-David</em></p>
</li><li>
<p>Fix <code>follow_redirect!</code> to follow redirection with same HTTP verb when following a 308 redirection.</p>

<p><em>Alan Tan</em></p>
</li><li>
<p>When multiple domains are specified for a cookie, a domain will now be chosen only if it is equal to or is a superdomain of the request host.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p><code>ActionDispatch::Static</code> handles precompiled Brotli (.br) files.</p>

<p>Adds to existing support for precompiled gzip (.gz) files. Brotli files are preferred due to much better compression.</p>

<p>When the browser requests /some.js with <code>Accept-Encoding: br</code>, we check for public/some.js.br and serve that file, if present, with <code>Content-Encoding: br</code> and <code>Vary: Accept-Encoding</code> headers.</p>

<p><em>Ryan Edward Hall</em>, <em>Jeremy Daer</em></p>
</li><li>
<p>Add raise_on_missing_translations support for controllers.</p>

<p>This configuration determines whether an error should be raised for missing translations. It can be enabled through <code>config.i18n.raise_on_missing_translations</code>. Note that described configuration also affects raising error for missing translations in views.</p>

<p><em>fatkodima</em></p>
</li><li>
<p>Added <code>compact</code> and <code>compact!</code> to <code>ActionController::Parameters</code>.</p>

<p><em>Eugene Kenny</em></p>
</li><li>
<p>Calling <code>each_pair</code> or <code>each_value</code> on an <code>ActionController::Parameters</code> without passing a block now returns an enumerator.</p>

<p><em>Eugene Kenny</em></p>
</li><li>
<p><code>fixture_file_upload</code> now uses path relative to <code>file_fixture_path</code></p>

<p>Previously the path had to be relative to <code>fixture_path</code>. You can change your existing code as follow:</p>

<pre><code># Before
fixture_file_upload(&#39;files/dog.png&#39;)

# After
fixture_file_upload(&#39;dog.png&#39;)
</code></pre>

<p><em>Edouard Chin</em></p>
</li><li>
<p>Remove deprecated <code>force_ssl</code> at the controller level.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>The <code>helper</code> class method for controllers loads helper modules specified as strings/symbols with <code>String#constantize</code> instead of <code>require_dependency</code>.</p>

<p>Remember that support for strings/symbols is only a convenient API. You can always pass a module object:</p>

<pre><code>helper UtilsHelper
</code></pre>

<p>which is recommended because it is simple and direct. When a string/symbol is received, <code>helper</code> just manipulates and inflects the argument to obtain that same module object.</p>

<p><em>Xavier Noria</em>, <em>Jean Boussier</em></p>
</li><li>
<p>Correctly identify the entire localhost IPv4 range as trusted proxy.</p>

<p><em>Nick Soracco</em></p>
</li><li>
<p><code>url_for</code> will now use ‚Äúhttps://‚Äù as the default protocol when <code>Rails.application.config.force_ssl</code> is set to true.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Accept and default to base64_urlsafe CSRF tokens.</p>

<p>Base64 strict-encoded CSRF tokens are not inherently websafe, which makes them difficult to deal with. For example, the common practice of sending the CSRF token to a browser in a client-readable cookie does not work properly out of the box: the value has to be url-encoded and decoded to survive transport.</p>

<p>Now, we generate Base64 urlsafe-encoded CSRF tokens, which are inherently safe to transport. Validation accepts both urlsafe tokens, and strict-encoded tokens for backwards compatibility.</p>

<p><em>Scott Blum</em></p>
</li><li>
<p>Support rolling deploys for cookie serialization/encryption changes.</p>

<p>In a distributed configuration like rolling update, users may observe both old and new instances during deployment. Users may be served by a new instance and then by an old instance.</p>

<p>That means when the server changes <code>cookies_serializer</code> from <code>:marshal</code> to <code>:hybrid</code> or the server changes <code>use_authenticated_cookie_encryption</code> from <code>false</code> to <code>true</code>, users may lose their sessions if they access the server during deployment.</p>

<p>We added fallbacks to downgrade the cookie format when necessary during deployment, ensuring compatibility on both old and new instances.</p>

<p><em>Masaki Hara</em></p>
</li><li>
<p><code>ActionDispatch::Request.remote_ip</code> has ip address even when all sites are trusted.</p>

<p>Before, if all <code>X-Forwarded-For</code> sites were trusted, the <code>remote_ip</code> would default to <code>127.0.0.1</code>. Now, the furthest proxy site is used. e.g.: It now gives an ip address when using curl from the load balancer.</p>

<p><em>Keenan Brock</em></p>
</li><li>
<p>Fix possible information leak / session hijacking vulnerability.</p>

<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the gem dalli to be updated as well.</p>

<p>CVE-2019-16782.</p>
</li><li>
<p>Include child session assertion count in ActionDispatch::IntegrationTest.</p>

<p><code>IntegrationTest#open_session</code> uses <code>dup</code> to create the new session, which meant it had its own copy of <code>@assertions</code>. This prevented the assertions from being correctly counted and reported.</p>

<p>Child sessions now have their <code>attr_accessor</code> overridden to delegate to the root session.</p>

<p>Fixes #32142.</p>

<p><em>Sam Bostock</em></p>
</li><li>
<p>Add SameSite protection to every written cookie.</p>

<p>Enabling <code>SameSite</code> cookie protection is an addition to CSRF protection, where cookies won‚Äôt be sent by browsers in cross-site POST requests when set to <code>:lax</code>.</p>

<p><code>:strict</code> disables cookies being sent in cross-site GET or POST requests.</p>

<p>Passing <code>:none</code> disables this protection and is the same as previous versions albeit a <code>; SameSite=None</code> is appended to the cookie.</p>

<p>See upgrade instructions in config/initializers/new_framework_defaults_6_1.rb.</p>

<p>More info <a href="https://tools.ietf.org/html/draft-west-first-party-cookies-07">here</a></p>

<p><em>NB: Technically already possible as Rack supports SameSite protection, this is to ensure it‚Äôs applied to all cookies</em></p>

<p><em>C√©dric Fabianski</em></p>
</li><li>
<p>Bring back the feature that allows loading external route files from the router.</p>

<p>This feature existed back in 2012 but got reverted with the incentive that <a href="https://github.com/rails/routing_concerns">github.com/rails/routing_concerns</a> was a better approach. Turned out that this wasn't fully the case and loading external route files from the router can be helpful for applications with a really large set of routes. Without this feature, application needs to implement routes reloading themselves and it's not straightforward.</p>

<pre><code># config/routes.rb

Rails.application.routes.draw do
  draw(:admin)
end

# config/routes/admin.rb

get :foo, to: &#39;foo#bar&#39;
</code></pre>

<p><em>Yehuda Katz</em>, <em>Edouard Chin</em></p>
</li><li>
<p>Fix system test driver option initialization for non-headless browsers.</p>

<p><em>glaszig</em></p>
</li><li>
<p><code>redirect_to.action_controller</code> notifications now include the <code>ActionDispatch::Request</code> in their payloads as <code>:request</code>.</p>

<p><em>Austin Story</em></p>
</li><li>
<p><code>respond_to#any</code> no longer returns a response‚Äôs Content-Type based on the request format but based on the block given.</p>

<p>Example:</p>

<pre><code>def my_action
    respond_to do |format|
      format.any { render(json: { foo: &#39;bar&#39; }) }
    end
  end

  get(&#39;my_action.csv&#39;)
</code></pre>

<p>The previous behaviour was to respond with a <code>text/csv</code> Content-Type which is inaccurate since a JSON response is being rendered.</p>

<p>Now it correctly returns a <code>application/json</code> Content-Type.</p>

<p><em>Edouard Chin</em></p>
</li><li>
<p>Replaces (back)slashes in failure screenshot image paths with dashes.</p>

<p>If a failed test case contained a slash or a backslash, a screenshot would be created in a nested directory, causing issues with <code>tmp:clear</code>.</p>

<p><em>Damir Zekic</em></p>
</li><li>
<p>Add <code>params.member?</code> to mimic <a href="../../../classes/Hash.html"><code>Hash</code></a> behavior.</p>

<p><em>Younes Serraj</em></p>
</li><li>
<p><code>process_action.action_controller</code> notifications now include the following in their payloads:</p>
<ul><li>
<p><code>:request</code> - the <code>ActionDispatch::Request</code></p>
</li><li>
<p><code>:response</code> - the <code>ActionDispatch::Response</code></p>
</li></ul>

<p><em>George Claghorn</em></p>
</li><li>
<p>Updated <code>ActionDispatch::Request.remote_ip</code> setter to clear set the instance <code>remote_ip</code> to <code>nil</code> before setting the header that the value is derived from.</p>

<p>Fixes #37383.</p>

<p><em>Norm Provost</em></p>
</li><li>
<p><code>ActionController::Base.log_at</code> allows setting a different log level per request.</p>

<pre><code># Use the debug level if a particular cookie is set.
class ApplicationController &lt; ActionController::Base
  log_at :debug, if: -&gt; { cookies[:debug] }
end
</code></pre>

<p><em>George Claghorn</em></p>
</li><li>
<p>Allow system test screen shots to be taken more than once in a test by prefixing the file name with an incrementing counter.</p>

<p>Add an environment variable <code>RAILS_SYSTEM_TESTING_SCREENSHOT_HTML</code> to enable saving of HTML during a screenshot in addition to the image. This uses the same image name, with the extension replaced with <code>.html</code></p>

<p><em>Tom Fakes</em></p>
</li><li>
<p>Add <code>Vary: Accept</code> header when using <code>Accept</code> header for response.</p>

<p>For some requests like <code>/users/1</code>, <a href="../../../classes/Rails.html"><code>Rails</code></a> uses requests' <code>Accept</code> header to determine what to return. And if we don't add <code>Vary</code> in the response header, browsers might accidentally cache different types of content, which would cause issues: e.g. javascript got displayed instead of html content. This PR fixes these issues by adding <code>Vary: Accept</code> in these types of requests. For more detailed problem description, please read:</p>

<p><a href="https://github.com/rails/rails/pull/36213">github.com/rails/rails/pull/36213</a></p>

<p>Fixes #25842.</p>

<p><em>Stan Lo</em></p>
</li><li>
<p>Fix IntegrationTest <code>follow_redirect!</code> to follow redirection using the same HTTP verb when following a 307 redirection.</p>

<p><em>Edouard Chin</em></p>
</li><li>
<p>System tests require Capybara 3.26 or newer.</p>

<p><em>George Claghorn</em></p>
</li><li>
<p>Reduced log noise handling ActionController::RoutingErrors.</p>

<p><em>Alberto Fern√°ndez-Capel</em></p>
</li><li>
<p>Add DSL for configuring HTTP Feature Policy.</p>

<p>This new DSL provides a way to configure an HTTP Feature Policy at a global or per-controller level. Full details of HTTP Feature Policy specification and guidelines can be found at MDN:</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</a></p>

<p>Example global policy:</p>

<pre><code>Rails.application.config.feature_policy do |f|
  f.camera      :none
  f.gyroscope   :none
  f.microphone  :none
  f.usb         :none
  f.fullscreen  :self
  f.payment     :self, &quot;https://secure.example.com&quot;
end
</code></pre>

<p>Example controller level policy:</p>

<pre><code>class PagesController &lt; ApplicationController
  feature_policy do |p|
    p.geolocation &quot;https://example.com&quot;
  end
end
</code></pre>

<p><em>Jacob Bednarz</em></p>
</li><li>
<p>Add the ability to set the CSP nonce only to the specified directives.</p>

<p>Fixes #35137.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Keep part when scope option has value.</p>

<p>When a route was defined within an optional scope, if that route didn't take parameters the scope was lost when using path helpers. This commit ensures scope is kept both when the route takes parameters or when it doesn't.</p>

<p>Fixes #33219.</p>

<p><em>Alberto Almagro</em></p>
</li><li>
<p>Added <code>deep_transform_keys</code> and <code>deep_transform_keys!</code> methods to <a href="../../../classes/ActionController/Parameters.html"><code>ActionController::Parameters</code></a>.</p>

<p><em>Gustavo Gutierrez</em></p>
</li><li>
<p>Calling <code>ActionController::Parameters#transform_keys</code>/<code>!</code> without a block now returns an enumerator for the parameters instead of the underlying hash.</p>

<p><em>Eugene Kenny</em></p>
</li><li>
<p>Fix strong parameters blocks all attributes even when only some keys are invalid (non-numerical). It should only block invalid key's values instead.</p>

<p><em>Stan Lo</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/6-0-stable/actionpack/CHANGELOG.md">6-0-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </main>
  </body>
</html>
