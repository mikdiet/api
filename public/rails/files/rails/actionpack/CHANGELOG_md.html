<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            CHANGELOG.md
        </h1>
        <ul class="files">
            
            <li>
                rails/actionpack/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/45b6b7f57f1a2eb757eb612fcc94e42d5908ec21/actionpack/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2019-08-09 23:12:34 +0300</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+5.2.3+-28March+27-2C+2019-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.3 (March 27, 2019)</h2>
<ul><li>
<p>Allow using combine the Cache Control <code>public</code> and <code>no-cache</code> headers.</p>

<p>Before this change, even if <code>public</code> was specified for Cache Control header, it was excluded when <code>no-cache</code> was included. This fixed to keep <code>public</code> header as is.</p>

<p>Fixes #34780.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Allow <code>nil</code> params for <code>ActionController::TestCase</code>.</p>

<p><em>Ryo Nakamura</em></p>
</li></ul>

<h2 id="label-Rails+5.2.2.1+-28March+11-2C+2019-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.2.1 (March 11, 2019)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+5.2.2+-28December+04-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.2 (December 04, 2018)</h2>
<ul><li>
<p>Reset Capybara sessions if failed system test screenshot raising an exception.</p>

<p>Reset Capybara sessions if <code>take_failed_screenshot</code> raise exception in system test <code>after_teardown</code>.</p>

<p><em>Maxim Perepelitsa</em></p>
</li><li>
<p>Use request object for context if there&#39;s no controller</p>

<p>There is no controller instance when using a redirect route or a mounted rack application so pass the request object as the context when resolving dynamic CSP sources in this scenario.</p>

<p>Fixes #34200.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Apply mapping to symbols returned from dynamic CSP sources</p>

<p>Previously if a dynamic source returned a symbol such as :self it would be converted to a string implicity, e.g:</p>

<pre><code>policy.default_src -&gt; { :self }
</code></pre>

<p>would generate the header:</p>

<pre><code>Content-Security-Policy: default-src self
</code></pre>

<p>and now it generates:</p>

<pre><code>Content-Security-Policy: default-src &#39;self&#39;
</code></pre>

<p><em>Andrew White</em></p>
</li><li>
<p>Fix <code>rails routes -c</code> for controller name consists of multiple word.</p>

<p><em>Yoshiyuki Kinjo</em></p>
</li><li>
<p>Call the <code>#redirect_to</code> block in controller context.</p>

<p><em>Steven Peckins</em></p>
</li></ul>

<h2 id="label-Rails+5.2.1.1+-28November+27-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.1.1 (November 27, 2018)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+5.2.1+-28August+07-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.1 (August 07, 2018)</h2>
<ul><li>
<p>Prevent <code>?null=</code> being passed on JSON encoded test requests.</p>

<p><code>RequestEncoder#encode_params</code> won&#39;t attempt to parse params if there are none.</p>

<p>So call like this will no longer append a <code>?null=</code> query param.</p>

<pre><code>get foos_url, as: :json
</code></pre>

<p><em>Alireza Bashiri</em></p>
</li><li>
<p>Ensure <code>ActionController::Parameters#transform_values</code> and <code>ActionController::Parameters#transform_values!</code> converts hashes into parameters.</p>

<p><em>Kevin Sjöberg</em></p>
</li><li>
<p>Fix strong parameters <code>permit!</code> with nested arrays.</p>

<p>Given: <code> params = ActionController::Parameters.new(nested_arrays: [[{ x: 2, y: 3 }, { x: 21, y: 42 }]]) params.permit! </code></p>

<p><code>params[:nested_arrays][0][0].permitted?</code> will now return <code>true</code> instead of <code>false</code>.</p>

<p><em>Steve Hull</em></p>
</li><li>
<p>Reset <code>RAW_POST_DATA</code> and <code>CONTENT_LENGTH</code> request environment between test requests in <code>ActionController::TestCase</code> subclasses.</p>

<p><em>Eugene Kenny</em></p>
</li><li>
<p>Output only one Content-Security-Policy nonce header value per request.</p>

<p>Fixes #32597.</p>

<p><em>Andrey Novikov</em>, <em>Andrew White</em></p>
</li><li>
<p>Only disable GPUs for headless Chrome on Windows.</p>

<p>It is not necessary anymore for Linux and macOS machines.</p>

<p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=737678#c1">bugs.chromium.org/p/chromium/issues/detail?id=737678#c1</a></p>

<p><em>Stefan Wrobel</em></p>
</li><li>
<p>Fix system tests transactions not closed between examples.</p>

<p><em>Sergey Tarasov</em></p>
</li></ul>

<h2 id="label-Rails+5.2.0+-28April+09-2C+2018-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.0 (April 09, 2018)</h2>
<ul><li>
<p>Check exclude before flagging cookies as secure.</p>

<p><em>Catherine Khuu</em></p>
</li><li>
<p>Always yield a CSP policy instance from <code>content_security_policy</code></p>

<p>This allows a controller action to enable the policy individually for a controller and/or specific actions.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add the ability to disable the global CSP in a controller, e.g:</p>

<pre><code>class LegacyPagesController &lt; ApplicationController
  content_security_policy false, only: :index
end
</code></pre>

<p><em>Andrew White</em></p>
</li><li>
<p>Add alias method <code>to_hash</code> to <code>to_h</code> for <code>cookies</code>. Add alias method <code>to_h</code> to <code>to_hash</code> for <code>session</code>.</p>

<p><em>Igor Kasyanchuk</em></p>
</li><li>
<p>Update the default HSTS max-age value to 31536000 seconds (1 year) to meet the minimum max-age requirement for <a href="https://hstspreload.org">hstspreload.org</a>/.</p>

<p><em>Grant Bourque</em></p>
</li><li>
<p>Add support for automatic nonce generation for <a href="../../../classes/Rails.html"><code>Rails</code></a> UJS.</p>

<p>Because the UJS library creates a script tag to process responses it normally requires the script-src attribute of the content security policy to include &#39;unsafe-inline&#39;.</p>

<p>To work around this we generate a per-request nonce value that is embedded in a meta tag in a similar fashion to how CSRF protection embeds its token in a meta tag. The UJS library can then read the nonce value and set it on the dynamically generated script tag to enable it to execute without needing &#39;unsafe-inline&#39; enabled.</p>

<p>Nonce generation isn&#39;t 100% safe - if your script tag is including user generated content in someway then it may be possible to exploit an XSS vulnerability which can take advantage of the nonce. It is however an improvement on a blanket permission for inline scripts.</p>

<p>It is also possible to use the nonce within your own script tags by using <code>nonce: true</code> to set the nonce value on the tag, e.g</p>

<pre><code>&lt;%= javascript_tag nonce: true do %&gt;
  alert(&#39;Hello, World!&#39;);
&lt;% end %&gt;
</code></pre>

<p>Fixes #31689.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Matches behavior of <code>Hash#each</code> in <code>ActionController::Parameters#each</code>.</p>

<p><em>Dominic Cleal</em></p>
</li><li>
<p>Add <code>Referrer-Policy</code> header to default headers set.</p>

<p><em>Guillermo Iguaran</em></p>
</li><li>
<p>Changed the system tests to set Puma as default server only when the user haven&#39;t specified manually another server.</p>

<p><em>Guillermo Iguaran</em></p>
</li><li>
<p>Add secure <code>X-Download-Options</code> and <code>X-Permitted-Cross-Domain-Policies</code> to default headers set.</p>

<p><em>Guillermo Iguaran</em></p>
</li><li>
<p>Add headless firefox support to System Tests.</p>

<p><em>bogdanvlviv</em></p>
</li><li>
<p>Changed the default system test screenshot output from <code>inline</code> to <code>simple</code>.</p>

<p><code>inline</code> works well for iTerm2 but not everyone uses iTerm2. Some terminals like Terminal.app ignore the <code>inline</code> and output the path to the file since it can&#39;t render the image. Other terminals, like those on Ubuntu, cannot handle the image inline, but also don&#39;t handle it gracefully and instead of outputting the file path, it dumps binary into the terminal.</p>

<p>Commit 9d6e28 fixes this by changing the default for screenshot to be <code>simple</code>.</p>

<p><em>Eileen M. Uchitelle</em></p>
</li><li>
<p>Register most popular audio/video/font mime types supported by modern browsers.</p>

<p><em>Guillermo Iguaran</em></p>
</li><li>
<p>Fix optimized url helpers when using relative url root.</p>

<p>Fixes #31220.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add DSL for configuring Content-Security-Policy header.</p>

<p>The DSL allows you to configure a global Content-Security-Policy header and then override within a controller. For more information about the Content-Security-Policy header see MDN:</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></p>

<p>Example global policy:</p>

<pre><code># config/initializers/content_security_policy.rb
Rails.application.config.content_security_policy do |p|
  p.default_src :self, :https
  p.font_src    :self, :https, :data
  p.img_src     :self, :https, :data
  p.object_src  :none
  p.script_src  :self, :https
  p.style_src   :self, :https, :unsafe_inline
end
</code></pre>

<p>Example controller overrides:</p>

<pre><code># Override policy inline
class PostsController &lt; ApplicationController
  content_security_policy do |p|
    p.upgrade_insecure_requests true
  end
end

# Using literal values
class PostsController &lt; ApplicationController
  content_security_policy do |p|
    p.base_uri &quot;https://www.example.com&quot;
  end
end

# Using mixed static and dynamic values
class PostsController &lt; ApplicationController
  content_security_policy do |p|
    p.base_uri :self, -&gt; { &quot;https://#{current_user.domain}.example.com&quot; }
  end
end
</code></pre>

<p>Allows you to also only report content violations for migrating legacy content using the <code>content_security_policy_report_only</code> configuration attribute, e.g;</p>

<pre><code># config/initializers/content_security_policy.rb
Rails.application.config.content_security_policy_report_only = true

# controller override
class PostsController &lt; ApplicationController
  content_security_policy_report_only only: :index
end
</code></pre>

<p>Note that this feature does not validate the header for performance reasons since the header is calculated at runtime.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Make <code>assert_recognizes</code> to traverse mounted engines.</p>

<p><em>Yuichiro Kaneko</em></p>
</li><li>
<p>Remove deprecated <code>ActionController::ParamsParser::ParseError</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Add <code>:allow_other_host</code> option to <code>redirect_back</code> method.</p>

<p>When <code>allow_other_host</code> is set to <code>false</code>, the <code>redirect_back</code> will not allow redirecting from a different host. <code>allow_other_host</code> is <code>true</code> by default.</p>

<p><em>Tim Masliuchenko</em></p>
</li><li>
<p>Add headless chrome support to System Tests.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Add ability to enable Early Hints for HTTP/2</p>

<p>If supported by the server, and enabled in Puma this allows H2 Early Hints to be used.</p>

<p>The <code>javascript_include_tag</code> and the <code>stylesheet_link_tag</code> automatically add Early Hints if requested.</p>

<p><em>Eileen M. Uchitelle</em>, <em>Aaron Patterson</em></p>
</li><li>
<p>Simplify cookies middleware with key rotation support</p>

<p>Use the <code>rotate</code> method for both <code>MessageEncryptor</code> and <code>MessageVerifier</code> to add key rotation support for encrypted and signed cookies. This also helps simplify support for legacy cookie security.</p>

<p><em>Michael J Coyne</em></p>
</li><li>
<p>Use Capybara registered <code>:puma</code> server config.</p>

<p>The Capybara registered <code>:puma</code> server ensures the puma server is run in process so connection sharing and open request detection work correctly by default.</p>

<p><em>Thomas Walpole</em></p>
</li><li>
<p>Cookies <code>:expires</code> option supports <code>ActiveSupport::Duration</code> object.</p>

<pre><code>cookies[:user_name] = { value: &quot;assain&quot;, expires: 1.hour }
cookies[:key] = { value: &quot;a yummy cookie&quot;, expires: 6.months }
</code></pre>

<p>Pull Request: #30121</p>

<p><em>Assain Jaleel</em></p>
</li><li>
<p>Enforce signed/encrypted cookie expiry server side.</p>

<p><a href="../../../classes/Rails.html"><code>Rails</code></a> can thwart attacks by malicious clients that don&#39;t honor a cookie&#39;s expiry.</p>

<p>It does so by stashing the expiry within the written cookie and relying on the signing/encrypting to vouch that it hasn&#39;t been tampered with. Then on a server-side read, the expiry is verified and any expired cookie is discarded.</p>

<p>Pull Request: #30121</p>

<p><em>Assain Jaleel</em></p>
</li><li>
<p>Make <code>take_failed_screenshot</code> work within engine.</p>

<p>Fixes #30405.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Deprecate <code>ActionDispatch::TestResponse</code> response aliases.</p>

<p><code>#success?</code>, <code>#missing?</code> &amp; <code>#error?</code> are not supported by the actual <code>ActionDispatch::Response</code> object and can produce false-positives. Instead, use the response helpers provided by <code>Rack::Response</code>.</p>

<p><em>Trevor Wistaff</em></p>
</li><li>
<p>Protect from forgery by default</p>

<p>Rather than protecting from forgery in the generated <code>ApplicationController</code>, add it to <code>ActionController::Base</code> depending on <code>config.action_controller.default_protect_from_forgery</code>. This configuration defaults to false to support older versions which have removed it from their <code>ApplicationController</code>, but is set to true for <a href="../../../classes/Rails.html"><code>Rails</code></a> 5.2.</p>

<p><em>Lisa Ugray</em></p>
</li><li>
<p>Fallback <code>ActionController::Parameters#to_s</code> to <code>Hash#to_s</code>.</p>

<p><em>Kir Shatrov</em></p>
</li><li>
<p><code>driven_by</code> now registers poltergeist and capybara-webkit.</p>

<p>If poltergeist or capybara-webkit are set as drivers is set for System Tests, <code>driven_by</code> will register the driver and set additional options passed via the <code>:options</code> parameter.</p>

<p>Refer to the respective driver&#39;s documentation to see what options can be passed.</p>

<p><em>Mario Chavez</em></p>
</li><li>
<p>AEAD encrypted cookies and sessions with GCM.</p>

<p>Encrypted cookies now use AES-GCM which couples authentication and encryption in one faster step and produces shorter ciphertexts. Cookies encrypted using AES in CBC HMAC mode will be seamlessly upgraded when this new mode is enabled via the <code>action_dispatch.use_authenticated_cookie_encryption</code> configuration value.</p>

<p><em>Michael J Coyne</em></p>
</li><li>
<p>Change the cache key format for fragments to make it easier to debug key churn. The new format is:</p>

<pre><code>views/template/action.html.erb:7a1156131a6928cb0026877f8b749ac9/projects/123
      ^template path           ^template tree digest            ^class   ^id
</code></pre>

<p><em>DHH</em></p>
</li><li>
<p>Add support for recyclable cache keys with fragment caching. This uses the new versioned entries in the <code>ActiveSupport::Cache</code> stores and relies on the fact that Active Record has split <code>#cache_key</code> and <code>#cache_version</code> to support it.</p>

<p><em>DHH</em></p>
</li><li>
<p>Add <code>action_controller_api</code> and <code>action_controller_base</code> load hooks to be called in <code>ActiveSupport.on_load</code></p>

<p><code>ActionController::Base</code> and <code>ActionController::API</code> have differing implementations. This means that the one umbrella hook <code>action_controller</code> is not able to address certain situations where a method may not exist in a certain implementation.</p>

<p>This is fixed by adding two new hooks so you can target <code>ActionController::Base</code> vs <code>ActionController::API</code></p>

<p>Fixes #27013.</p>

<p><em>Julian Nadeau</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/5-1-stable/actionpack/CHANGELOG.md">5-1-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </div>
  </body>
</html>
