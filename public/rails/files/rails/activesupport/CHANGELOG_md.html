<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>
    <div class="banner">
        
        <h1>
            CHANGELOG.md
        </h1>
        <ul class="files">
            
            <li>
                rails/activesupport/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/ce93740a5e4437dfc1cf9b0b13da1bad06a2a598/activesupport/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2017-06-18 10:15:05 +0300</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+5.1.0+-28April+27-2C+2017-29"><a href="../../../classes/Rails.html">Rails</a> 5.1.0 (April 27, 2017)</h2>
<ul><li>
<p><code>ActiveSupport::EventedFileUpdateChecker</code> no longer listens to
directories outside of the application directory.</p>

<p><em>radiospiel</em></p>
</li><li>
<p>Return unmapped timezones from <code>country_zones</code></p>

<p>If a country doesn&#39;t exist in the MAPPINGS hash then create a new
<code>ActiveSupport::Timezone</code> instance using the supplied timezone
id.</p>

<p>Fixes #28431.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <a
href="../../../classes/ActiveSupport/Deprecation/DeprecatedConstantAccessor.html">ActiveSupport::Deprecation::DeprecatedConstantAccessor</a></p>

<p>Provides transparent deprecation of constants, compatible with exceptions.
Example usage:</p>

<pre><code>module Example
  include ActiveSupport::Deprecation::DeprecatedConstantAccessor
  deprecate_constant &#39;OldException&#39;, &#39;Elsewhere::NewException&#39;
end
</code></pre>

<p><em>Dominic Cleal</em></p>
</li><li>
<p>Fixed bug in <code>DateAndTime::Compatibility#to_time</code> that caused it
to raise <code>RuntimeError: can&#39;t modify frozen Time</code> when
called on any frozen <code>Time</code>. Properly pass through the frozen
<code>Time</code> or <code>ActiveSupport::TimeWithZone</code> object when
calling <code>#to_time</code>.</p>

<p><em>Kevin McPhillips</em> &amp; <em>Andrew White</em></p>
</li><li>
<p>Remove implicit coercion deprecation of durations</p>

<p>In #28204 we deprecated implicit conversion of durations to a numeric which
represented the number of seconds in the duration because of unwanted side
effects with calculations on durations and dates. This unfortunately had
the side effect of forcing a explicit cast when configuring third-party
libraries like expiration in Redis, e.g:</p>

<pre><code>redis.expire(&quot;foo&quot;, 5.minutes)
</code></pre>

<p>To work around this we&#39;ve removed the deprecation and added a private
class that wraps the numeric and can perform calculation involving
durations and ensure that they remain a duration irrespective of the order
of operations.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Update <code>titleize</code> regex to allow apostrophes</p>

<p>In 4b685aa the regex in <code>titleize</code> was updated to not match
apostrophes to better reflect the nature of the transformation.
Unfortunately, this had the side effect of breaking capitalization on the
first word of a sub-string, e.g:</p>

<pre><code>&gt;&gt; &quot;This was &#39;fake news&#39;&quot;.titleize
=&gt; &quot;This Was &#39;fake News&#39;&quot;</code></pre>

<p>This is fixed by extending the look-behind to also check for a word
character on the other side of the apostrophe.</p>

<p>Fixes #28312.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>rfc3339</code> aliases to <code>xmlschema</code> for
<code>Time</code> and <code>ActiveSupport::TimeWithZone</code></p>

<p>For naming consistency when using the RFC 3339 profile of ISO 8601 in
applications.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>Time.rfc3339</code> parsing method</p>

<p><code>Time.xmlschema</code> and consequently its alias <code>iso8601</code>
accepts timestamps without a offset in contravention of the RFC 3339
standard. This method enforces that constraint and raises an
<code>ArgumentError</code> if it doesn&#39;t.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>ActiveSupport::TimeZone.rfc3339</code> parsing method</p>

<p>Previously, there was no way to get a RFC 3339 timestamp into a specific
timezone without either using <code>parse</code> or chaining methods. The
new method allows parsing directly into the timezone, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.rfc3339(&quot;1999-12-31T14:00:00Z&quot;)
=&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</code></pre>

<p>This new method has stricter semantics than the current <code>parse</code>
method, and will raise an <code>ArgumentError</code> instead of returning
nil, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.rfc3339(&quot;foobar&quot;)
ArgumentError: invalid date
&gt;&gt; Time.zone.parse(&quot;foobar&quot;)
=&gt; nil</code></pre>

<p>It will also raise an <code>ArgumentError</code> when either the time or
offset components are missing, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.rfc3339(&quot;1999-12-31&quot;)
ArgumentError: invalid date
&gt;&gt; Time.zone.rfc3339(&quot;1999-12-31T14:00:00&quot;)
ArgumentError: invalid date</code></pre>

<p><em>Andrew White</em></p>
</li><li>
<p>Add <code>ActiveSupport::TimeZone.iso8601</code> parsing method</p>

<p>Previously, there was no way to get a ISO 8601 timestamp into a specific
timezone without either using <code>parse</code> or chaining methods. The
new method allows parsing directly into the timezone, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.iso8601(&quot;1999-12-31T14:00:00Z&quot;)
=&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</code></pre>

<p>If the timestamp is a ISO 8601 date (YYYY-MM-DD), then the time is set to
midnight, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.iso8601(&quot;1999-12-31&quot;)
=&gt; Fri, 31 Dec 1999 00:00:00 HST -10:00</code></pre>

<p>This new method has stricter semantics than the current <code>parse</code>
method, and will raise an <code>ArgumentError</code> instead of returning
nil, e.g:</p>

<pre><code>&gt;&gt; Time.zone = &quot;Hawaii&quot;
=&gt; &quot;Hawaii&quot;
&gt;&gt; Time.zone.iso8601(&quot;foobar&quot;)
ArgumentError: invalid date
&gt;&gt; Time.zone.parse(&quot;foobar&quot;)
=&gt; nil</code></pre>

<p><em>Andrew White</em></p>
</li><li>
<p>Deprecate implicit coercion of <code>ActiveSupport::Duration</code></p>

<p>Currently <code>ActiveSupport::Duration</code> implicitly converts to a
seconds value when used in a calculation except for the explicit examples
of addition and subtraction where the duration is the receiver, e.g:</p>

<pre><code>&gt;&gt; 2 * 1.day
=&gt; 172800</code></pre>

<p>This results in lots of confusion especially when using durations with
dates because adding/subtracting a value from a date treats integers as a
day and not a second, e.g:</p>

<pre><code>&gt;&gt; Date.today
=&gt; Wed, 01 Mar 2017
&gt;&gt; Date.today + 2 * 1.day
=&gt; Mon, 10 Apr 2490</code></pre>

<p>To fix this we&#39;re implementing <code>coerce</code> so that we can
provide a deprecation warning with the intent of removing the implicit
coercion in <a href="../../../classes/Rails.html">Rails</a> 5.2, e.g:</p>

<pre><code>&gt;&gt; 2 * 1.day
DEPRECATION WARNING: Implicit coercion of ActiveSupport::Duration
to a Numeric is deprecated and will raise a TypeError in Rails 5.2.
=&gt; 172800</code></pre>

<p>In <a href="../../../classes/Rails.html">Rails</a> 5.2 it will raise
<code>TypeError</code>, e.g:</p>

<pre><code>&gt;&gt; 2 * 1.day
TypeError: ActiveSupport::Duration can&#39;t be coerced into Integer</code></pre>

<p>This is the same behavior as with other types in Ruby, e.g:</p>

<pre><code>&gt;&gt; 2 * &quot;foo&quot;
TypeError: String can&#39;t be coerced into Integer
&gt;&gt; &quot;foo&quot; * 2
=&gt; &quot;foofoo&quot;</code></pre>

<p>As part of this deprecation add <code>*</code> and <code>/</code> methods
to <code>AS::Duration</code> so that calculations that keep the duration as
the receiver work correctly whether the final receiver is a
<code>Date</code> or <code>Time</code>, e.g:</p>

<pre><code>&gt;&gt; Date.today
=&gt; Wed, 01 Mar 2017
&gt;&gt; Date.today + 1.day * 2
=&gt; Fri, 03 Mar 2017</code></pre>

<p>Fixes #27457.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Update <code>DateTime#change</code> to support <code>:usec</code> and
<code>:nsec</code> options.</p>

<p>Adding support for these options now allows us to update the
<code>DateTime#end_of</code> methods to match the equivalent
<code>Time#end_of</code> methods, e.g:</p>

<pre><code>datetime = DateTime.now.end_of_day
datetime.nsec == 999999999 # =&gt; true
</code></pre>

<p>Fixes #21424.</p>

<p><em>Dan Moore</em>, <em>Andrew White</em></p>
</li><li>
<p>Add <code>ActiveSupport::Duration#before</code> and <code>#after</code> as
aliases for <code>#until</code> and <code>#since</code></p>

<p>These read more like English and require less mental gymnastics to read and
write.</p>

<p>Before:</p>

<pre><code>2.weeks.since(customer_start_date)
5.days.until(today)
</code></pre>

<p>After:</p>

<pre><code>2.weeks.after(customer_start_date)
5.days.before(today)
</code></pre>

<p><em>Nick Johnstone</em></p>
</li><li>
<p>Soft-deprecated the top-level <code>HashWithIndifferentAccess</code>
constant. <code>ActiveSupport::HashWithIndifferentAccess</code> should be
used instead.</p>

<p>Fixes #28157.</p>

<p><em>Robin Dupret</em></p>
</li><li>
<p>In Core Extensions, make <code>MarshalWithAutoloading#load</code> pass
through the second, optional argument for <code>Marshal#load( source [,
proc] )</code>. This way we don&#39;t have to do
<code>Marshal.method(:load).super_method.call(source, proc)</code> just to
be able to pass a proc.</p>

<p><em>Jeff Latz</em></p>
</li><li>
<p><code>ActiveSupport::Gzip.decompress</code> now checks checksum and length
in footer.</p>

<p><em>Dylan Thacker-Smith</em></p>
</li><li>
<p>Cache <code>ActiveSupport::TimeWithZone#to_datetime</code> before freezing.</p>

<p><em>Adam Rice</em></p>
</li><li>
<p>Deprecate <code>ActiveSupport.halt_callback_chains_on_return_false</code>.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>Remove deprecated behavior that halts callbacks when the return is false.</p>

<p><em>Rafael Mendon√ßa Fran√ßa</em></p>
</li><li>
<p>Deprecate passing string to <code>:if</code> and <code>:unless</code>
conditional options on <code>set_callback</code> and
<code>skip_callback</code>.</p>

<p><em>Ryuta Kamizono</em></p>
</li><li>
<p>Raise <code>ArgumentError</code> when passing string to define callback.</p>

<p><em>Ryuta Kamizono</em></p>
</li><li>
<p>Updated Unicode version to 9.0.0</p>

<p>Now we can handle new emojis such like ‚Äúüë©‚Äçüë©‚Äçüëß‚Äçüë¶‚Äù
(‚Äúu{1F469}u{200D}u{1F469}u{200D}u{1F467}u{200D}u{1F466}‚Äù).</p>

<p>version 8.0.0</p>

<pre><code>&quot;üë©‚Äçüë©‚Äçüëß‚Äçüë¶&quot;.mb_chars.grapheme_length # =&gt; 4
&quot;üë©‚Äçüë©‚Äçüëß‚Äçüë¶&quot;.mb_chars.reverse # =&gt; &quot;üë¶üëß‚Äçüë©‚Äçüë©‚Äç&quot;
</code></pre>

<p>version 9.0.0</p>

<pre><code>&quot;üë©‚Äçüë©‚Äçüëß‚Äçüë¶&quot;.mb_chars.grapheme_length # =&gt; 1
&quot;üë©‚Äçüë©‚Äçüëß‚Äçüë¶&quot;.mb_chars.reverse # =&gt; &quot;üë©‚Äçüë©‚Äçüëß‚Äçüë¶&quot;
</code></pre>

<p><em>Fumiaki MATSUSHIMA</em></p>
</li><li>
<p>Changed <code>ActiveSupport::Inflector#transliterate</code> to raise
<code>ArgumentError</code> when it receives anything except a string.</p>

<p><em>Kevin McPhillips</em></p>
</li><li>
<p>Fixed bugs that <code>StringInquirer#respond_to_missing?</code> and
<code>ArrayInquirer#respond_to_missing?</code> do not fallback to
<code>super</code>.</p>

<p><em>Akira Matsuda</em></p>
</li><li>
<p>Fix inconsistent results when parsing large durations and constructing
durations from code</p>

<pre><code>ActiveSupport::Duration.parse(&#39;P3Y&#39;) == 3.years # It should be true
</code></pre>

<p>Duration parsing made independent from any moment of time: Fixed length in
seconds is assigned to each duration part during parsing.</p>

<p>Changed duration of months and years in seconds to more accurate and
logical:</p>
<ol><li>
<p>The value of 365.2425 days in Gregorian year is more accurate as it
accounts for every 400th non-leap year.</p>
</li><li>
<p>Month&#39;s length is bound to year&#39;s duration, which makes sensible
comparisons like <code>12.months == 1.year</code> to be <code>true</code>
and nonsensical ones like <code>30.days == 1.month</code> to be
<code>false</code>.</p>
</li></ol>

<p>Calculations on times and dates with durations shouldn&#39;t be affected as
duration&#39;s numeric value isn&#39;t used in calculations, only parts are
used.</p>

<p>Methods on <code>Numeric</code> like <code>2.days</code> now use these
predefined durations to avoid duplication of duration constants through the
codebase and eliminate creation of intermediate durations.</p>

<p><em>Andrey Novikov</em>, <em>Andrew White</em></p>
</li><li>
<p>Change return value of <code>Rational#duplicable?</code>,
<code>ComplexClass#duplicable?</code> to false.</p>

<p><em>utilum</em></p>
</li><li>
<p>Change return value of <code>NilClass#duplicable?</code>,
<code>FalseClass#duplicable?</code>, <code>TrueClass#duplicable?</code>,
<code>Symbol#duplicable?</code> and <code>Numeric#duplicable?</code> to
true with Ruby 2.4+. These classes can dup with Ruby 2.4+.</p>

<p><em>Yuji Yaginuma</em></p>
</li><li>
<p>Remove deprecated class <code>ActiveSupport::Concurrency::Latch</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated separator argument from <code>parameterize</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method <code>Numeric#to_formatted_s</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method <code>alias_method_chain</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated constant <code>MissingSourceFile</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated methods <code>Module.qualified_const_defined?</code>,
<code>Module.qualified_const_get</code> and
<code>Module.qualified_const_set</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated <code>:prefix</code> option from
<code>number_to_human_size</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method
<code>ActiveSupport::HashWithIndifferentAccess.new_from_hash_copying_default</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated file
<code>active_support/core_ext/time/marshal.rb</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated file <code>active_support/core_ext/struct.rb</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated file
<code>active_support/core_ext/module/method_transplanting.rb</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method <code>Module.local_constants</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated file
<code>active_support/core_ext/kernel/debugger.rb</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method
<code>ActiveSupport::Cache::Store#namespaced_key</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method
<code>ActiveSupport::Cache::Strategy::LocalCache::LocalStore#set_cache_value</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method
<code>ActiveSupport::Cache::MemCacheStore#escape_key</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Remove deprecated method
<code>ActiveSupport::Cache::FileStore#key_file_path</code>.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Ensure duration parsing is consistent across DST changes.</p>

<p>Previously <code>ActiveSupport::Duration.parse</code> used
<code>Time.current</code> and <code>Time#advance</code> to calculate the
number of seconds in the duration from an arbitrary collection of parts.
However as <code>advance</code> tries to be consistent across DST
boundaries this meant that either the duration was shorter or longer
depending on the time of year.</p>

<p>This was fixed by using an absolute reference point in UTC which isn&#39;t
subject to DST transitions. An arbitrary date of Jan 1st, 2000 was chosen
for no other reason that it seemed appropriate.</p>

<p>Additionally, duration parsing should now be marginally faster as we are no
longer creating instances of <code>ActiveSupport::TimeWithZone</code> every
time we parse a duration string.</p>

<p>Fixes #26941.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Use <code>Hash#compact</code> and <code>Hash#compact!</code> from Ruby 2.4.
Old Ruby versions will continue to get these methods from Active Support as
before.</p>

<p><em>Prathamesh Sonpatki</em></p>
</li><li>
<p>Fix <code>ActiveSupport::TimeZone#strptime</code>. Support for timestamps
in format of seconds (%s) and milliseconds (%Q).</p>

<p>Fixes #26840.</p>

<p><em>Lev Denisov</em></p>
</li><li>
<p>Fix <code>DateAndTime::Calculations#copy_time_to</code>. Copy
<code>nsec</code> instead of <code>usec</code>.</p>

<p>Jumping forward or backward between weeks now preserves nanosecond digits.</p>

<p><em>Josua Schmid</em></p>
</li><li>
<p>Fix <code>ActiveSupport::TimeWithZone#in</code> across DST boundaries.</p>

<p>Previously calls to <code>in</code> were being sent to the non-DST aware
method <code>Time#since</code> via <code>method_missing</code>. It is now
aliased to the DST aware <code>ActiveSupport::TimeWithZone#+</code> which
handles transitions across DST boundaries, e.g:</p>

<pre><code>Time.zone = &quot;US/Eastern&quot;

t = Time.zone.local(2016,11,6,1)
# =&gt; Sun, 06 Nov 2016 01:00:00 EDT -05:00

t.in(1.hour)
# =&gt; Sun, 06 Nov 2016 01:00:00 EST -05:00
</code></pre>

<p>Fixes #26580.</p>

<p><em>Thomas Balthazar</em></p>
</li><li>
<p>Remove unused parameter <code>options = nil</code> for <code>#clear</code>
of <code>ActiveSupport::Cache::Strategy::LocalCache::LocalStore</code> and
<code>ActiveSupport::Cache::Strategy::LocalCache</code>.</p>

<p><em>Yosuke Kabuto</em></p>
</li><li>
<p>Fix <code>thread_mattr_accessor</code> subclass no longer overwrites
parent.</p>

<p>Assigning a value to a subclass using <code>thread_mattr_accessor</code> no
longer changes the value of the parent class. This brings the behavior
inline with the documentation.</p>

<p>Given:</p>

<pre><code>class Account
  thread_mattr_accessor :user
end

class Customer &lt; Account
end

Account.user = &quot;DHH&quot;
Customer.user = &quot;Rafael&quot;
</code></pre>

<p>Before:</p>

<pre><code>Account.user  # =&gt; &quot;Rafael&quot;
</code></pre>

<p>After:</p>

<pre><code>Account.user  # =&gt; &quot;DHH&quot;
</code></pre>

<p><em>Shinichi Maeshima</em></p>
</li><li>
<p>Since weeks are no longer converted to days, add <code>:weeks</code> to the
list of parts that <code>ActiveSupport::TimeWithZone</code> will recognize
as possibly being of variable duration to take account of DST transitions.</p>

<p>Fixes #26039.</p>

<p><em>Andrew White</em></p>
</li><li>
<p>Defines <code>Regexp.match?</code> for Ruby versions prior to 2.4. The
predicate has the same interface, but it does not have the performance
boost. Its purpose is to be able to write 2.4 compatible code.</p>

<p><em>Xavier Noria</em></p>
</li><li>
<p>Allow <code>MessageEncryptor</code> to take advantage of authenticated
encryption modes.</p>

<p>AEAD modes like <code>aes-256-gcm</code> provide both confidentiality and
data authenticity, eliminating the need to use <code>MessageVerifier</code>
to check if the encrypted data has been tampered with. This speeds up
encryption/decryption and results in shorter cipher text.</p>

<p><em>Bart de Water</em></p>
</li><li>
<p>Introduce <code>assert_changes</code> and <code>assert_no_changes</code>.</p>

<p><code>assert_changes</code> is a more general
<code>assert_difference</code> that works with any value.</p>

<pre><code>assert_changes &#39;Error.current&#39;, from: nil, to: &#39;ERR&#39; do
  expected_bad_operation
end
</code></pre>

<p>Can be called with strings, to be evaluated in the binding (context) of the
block given to the assertion, or a lambda.</p>

<pre><code>assert_changes -&gt; { Error.current }, from: nil, to: &#39;ERR&#39; do
  expected_bad_operation
end
</code></pre>

<p>The <code>from</code> and <code>to</code> arguments are compared with the
case operator (<code>===</code>).</p>

<pre><code>assert_changes &#39;Error.current&#39;, from: nil, to: Error do
  expected_bad_operation
end
</code></pre>

<p>This is pretty useful, if you need to loosely compare a value. For example,
you need to test a token has been generated and it has that many random
characters.</p>

<pre><code>user = User.start_registration
assert_changes &#39;user.token&#39;, to: /\w{32}/ do
  user.finish_registration
end
</code></pre>

<p><em>Genadi Samokovarov</em></p>
</li><li>
<p>Fix <code>ActiveSupport::TimeZone#strptime</code>. Now raises
<code>ArgumentError</code> when the given time doesn&#39;t match the
format. The error is the same as the one given by Ruby&#39;s
<code>Date.strptime</code>. Previously it raised <code>NoMethodError:
undefined method empty? for nil:NilClass.</code> due to a bug.</p>

<p>Fixes #25701.</p>

<p><em>John Gesimondo</em></p>
</li><li>
<p><code>travel/travel_to</code> travel time helpers, now raise on nested
calls, as this can lead to confusing time stubbing.</p>

<p>Instead of:</p>

<pre><code>travel_to 2.days.from_now do
  # 2 days from today
  travel_to 3.days.from_now do
    # 5 days from today
  end
end
</code></pre>

<p>preferred way to achieve above is:</p>

<pre><code>travel 2.days do
  # 2 days from today
end

travel 5.days do
  # 5 days from today
end
</code></pre>

<p><em>Vipul A M</em></p>
</li><li>
<p>Support parsing JSON time in ISO8601 local time strings in
<code>ActiveSupport::JSON.decode</code> when <code>parse_json_times</code>
is enabled. Strings in the format of <code>YYYY-MM-DD hh:mm:ss</code>
(without a <code>Z</code> at the end) will be parsed in the local timezone
(<code>Time.zone</code>). In addition, date strings
(<code>YYYY-MM-DD</code>) are now parsed into <code>Date</code> objects.</p>

<p><em>Grzegorz Witek</em></p>
</li><li>
<p>Fixed <code>ActiveSupport::Logger.broadcast</code> so that calls to
<code>#silence</code> now properly delegate to all loggers. Silencing now
properly suppresses logging to both the log and the console.</p>

<p><em>Kevin McPhillips</em></p>
</li><li>
<p>Remove deprecated arguments in <code>assert_nothing_raised</code>.</p>

<p><em>Rafel Mendon√ßa Fran√ßa</em></p>
</li><li>
<p><code>Date.to_s</code> doesn&#39;t produce too many spaces. For example,
<code>to_s(:short)</code> will now produce <code>01 Feb</code> instead of
<code>1 Feb</code>.</p>

<p>Fixes #25251.</p>

<p><em>Sean Griffin</em></p>
</li><li>
<p>Introduce <code>Module#delegate_missing_to</code>.</p>

<p>When building a decorator, a common pattern emerges:</p>

<pre><code>class Partition
  def initialize(first_event)
    @events = [ first_event ]
  end

  def people
    if @events.first.detail.people.any?
      @events.collect { |e| Array(e.detail.people) }.flatten.uniq
    else
      @events.collect(&amp;:creator).uniq
    end
  end

  private
    def respond_to_missing?(name, include_private = false)
      @events.respond_to?(name, include_private)
    end

    def method_missing(method, *args, &amp;block)
      @events.send(method, *args, &amp;block)
    end
end
</code></pre>

<p>With <code>Module#delegate_missing_to</code>, the above is condensed to:</p>

<pre><code>class Partition
  delegate_missing_to :@events

  def initialize(first_event)
    @events = [ first_event ]
  end

  def people
    if @events.first.detail.people.any?
      @events.collect { |e| Array(e.detail.people) }.flatten.uniq
    else
      @events.collect(&amp;:creator).uniq
    end
  end
end
</code></pre>

<p><em>Genadi Samokovarov</em>, <em>DHH</em></p>
</li><li>
<p>Rescuable: If a handler doesn&#39;t match the exception, check for handlers
matching the exception&#39;s cause.</p>

<p><em>Jeremy Daer</em></p>
</li></ul>

<p>Please check <a
href="https://github.com/rails/rails/blob/5-0-stable/activesupport/CHANGELOG.md">5-0-stable</a>
for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>

    </div>
  </body>
</html>
