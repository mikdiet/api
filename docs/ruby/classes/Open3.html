<!DOCTYPE html>
<html lang="en">
<head>
    <title>Open3</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["Open3"]'>


    <meta property="og:title" value="Open3">

  
    
    <meta name="description" content="Module Open3 supports creating child processes with access to their $stdin, $stdout, and $stderr streams.">
    <meta property="og:description" content="Module Open3 supports creating child processes with access to their $stdin, $stdout, and $stderr streams.">
  

    <meta name="keywords" content="Open3 class, popen3, popen2, popen2e, capture3, capture2, capture2e, pipeline_rw, pipeline_r, pipeline_w, pipeline_start, pipeline">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Module</span>
            Open3
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/ruby/lib/open3_rb.html">ruby/lib/open3.rb</a></li>
            
            <li><a href="../files/ruby/lib/open3/version_rb.html">ruby/lib/open3/version.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Module Open3 supports creating child processes with access to their $stdin, $stdout, and $stderr streams.</p>

<h2 id="module-Open3-label-What-27s+Here">What’s Here</h2>

<p>Each of these methods executes a given command in a new process or subshell, or multiple commands in new processes and/or subshells:</p>
<ul><li>
<p>Each of these methods executes a single command in a process or subshell, accepts a string for input to $stdin, and returns string output from $stdout, $stderr, or both:</p>
<ul><li>
<p><a href="Open3.html#method-c-capture2"><code>Open3.capture2</code></a>: Executes the command; returns the string from $stdout.</p>
</li><li>
<p><a href="Open3.html#method-c-capture2e"><code>Open3.capture2e</code></a>: Executes the command; returns the string from merged $stdout and $stderr.</p>
</li><li>
<p><a href="Open3.html#method-c-capture3"><code>Open3.capture3</code></a>: Executes the command; returns strings from $stdout and $stderr.</p>
</li></ul>
</li><li>
<p>Each of these methods executes a single command in a process or subshell, and returns pipes for $stdin, $stdout, and/or $stderr:</p>
<ul><li>
<p><a href="Open3.html#method-c-popen2"><code>Open3.popen2</code></a>: Executes the command; returns pipes for $stdin and $stdout.</p>
</li><li>
<p><a href="Open3.html#method-c-popen2e"><code>Open3.popen2e</code></a>: Executes the command; returns pipes for $stdin and merged $stdout and $stderr.</p>
</li><li>
<p><a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>: Executes the command; returns pipes for $stdin, $stdout, and $stderr.</p>
</li></ul>
</li><li>
<p>Each of these methods executes one or more commands in processes and/or subshells, returns pipes for the first $stdin, the last $stdout, or both:</p>
<ul><li>
<p><a href="Open3.html#method-c-pipeline_r"><code>Open3.pipeline_r</code></a>: Returns a pipe for the last $stdout.</p>
</li><li>
<p><a href="Open3.html#method-c-pipeline_rw"><code>Open3.pipeline_rw</code></a>: Returns pipes for the first $stdin and the last $stdout.</p>
</li><li>
<p><a href="Open3.html#method-c-pipeline_w"><code>Open3.pipeline_w</code></a>: Returns a pipe for the first $stdin.</p>
</li><li>
<p><a href="Open3.html#method-c-pipeline_start"><code>Open3.pipeline_start</code></a>: Does not wait for processes to complete.</p>
</li><li>
<p><a href="Open3.html#method-c-pipeline"><code>Open3.pipeline</code></a>: Waits for processes to complete.</p>
</li></ul>
</li></ul>

<p>Each of the methods above accepts:</p>
<ul><li>
<p>An optional hash of environment variable names and values; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>
</li><li>
<p>A required string argument that is a <code>command_line</code> or <code>exe_path</code>; see <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
</li><li>
<p>An optional hash of execution options; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>
</li></ul>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-capture2">capture2</a>,
              </li>
            
              
              <li>
                <a href="#method-c-capture2e">capture2e</a>,
              </li>
            
              
              <li>
                <a href="#method-c-capture3">capture3</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-pipeline">pipeline</a>,
              </li>
            
              
              <li>
                <a href="#method-c-pipeline_r">pipeline_r</a>,
              </li>
            
              
              <li>
                <a href="#method-c-pipeline_rw">pipeline_rw</a>,
              </li>
            
              
              <li>
                <a href="#method-c-pipeline_start">pipeline_start</a>,
              </li>
            
              
              <li>
                <a href="#method-c-pipeline_w">pipeline_w</a>,
              </li>
            
              
              <li>
                <a href="#method-c-popen2">popen2</a>,
              </li>
            
              
              <li>
                <a href="#method-c-popen2e">popen2e</a>,
              </li>
            
              
              <li>
                <a href="#method-c-popen3">popen3</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;0.2.1&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-capture2">
            
              <b>Open3.capture2([env, ] command_line, options = {}) &rarr; [stdout_s, status]<br />Open3.capture2([env, ] exe_path, *args, options = {}) &rarr; [stdout_s, status]
</b>
            
            <a href="../classes/Open3.html#method-c-capture2" name="method-c-capture2" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as string <code>stdout_s</code> the standard output of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_s, status]</code>:</p>

<pre><code>stdout_s, status = Open3.capture2(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326047 exit 0&gt;]
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <a href="Open3.html#method-c-capture2"><code>Open3.capture2</code></a>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre><code>Open3.capture2(&#39;tee&#39;, stdin_data: &#39;Foo&#39;)

# =&gt; [&quot;Foo&quot;, #&lt;Process::Status: pid 2326087 exit 0&gt;]
</code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.capture2(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) # Shell reserved word.
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326131 exit 0&gt;]
Open3.capture2(&#39;echo&#39;)                         # Built-in.
# =&gt; [&quot;\n&quot;, #&lt;Process::Status: pid 2326139 exit 0&gt;]
Open3.capture2(&#39;date &gt; date.tmp&#39;)              # Contains meta character.
# =&gt; [&quot;&quot;, #&lt;Process::Status: pid 2326174 exit 0&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.capture2(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326183 exit 0&gt;]
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.capture2(&#39;/usr/bin/date&#39;)
# =&gt; [&quot;Fri Sep 29 01:00:39 PM CDT 2023\n&quot;, #&lt;Process::Status: pid 2326222 exit 0&gt;]
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.capture2(&#39;doesnt_exist&#39;) # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.capture2(&#39;echo&#39;, &#39;C #&#39;)
# =&gt; [&quot;C #\n&quot;, #&lt;Process::Status: pid 2326267 exit 0&gt;]
Open3.capture2(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;)
# =&gt; [&quot;hello world\n&quot;, #&lt;Process::Status: pid 2326299 exit 0&gt;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-capture2_source')" id="l_method-c-capture2_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L775" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-capture2_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 775</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capture2</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stdin_data</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:stdin_data</span>)
  <span class="ruby-identifier">binmode</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:binmode</span>)

  <span class="ruby-identifier">popen2</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">o</span>, <span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">i</span>.<span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">o</span>.<span class="ruby-identifier">binmode</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">out_reader</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">o</span>.<span class="ruby-identifier">read</span> }
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">stdin_data</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">stdin_data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:readpartial</span>
          <span class="ruby-constant">IO</span>.<span class="ruby-identifier">copy_stream</span>(<span class="ruby-identifier">stdin_data</span>, <span class="ruby-identifier">i</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">i</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">stdin_data</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">i</span>.<span class="ruby-identifier">close</span>
    [<span class="ruby-identifier">out_reader</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">t</span>.<span class="ruby-identifier">value</span>]
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-capture2e">
            
              <b>Open3.capture2e([env, ] command_line, options = {}) &rarr; [stdout_and_stderr_s, status]<br />Open3.capture2e([env, ] exe_path, *args, options = {}) &rarr; [stdout_and_stderr_s, status]
</b>
            
            <a href="../classes/Open3.html#method-c-capture2e" name="method-c-capture2e" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as string <code>stdout_and_stderr_s</code> the merged standard output and standard error of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_and_stderr_s, status]</code>:</p>

<pre><code>stdout_and_stderr_s, status = Open3.capture2e(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2371692 exit 0&gt;]
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <a href="Open3.html#method-c-capture2e"><code>Open3.capture2e</code></a>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre><code>Open3.capture2e(&#39;tee&#39;, stdin_data: &#39;Foo&#39;)
# =&gt; [&quot;Foo&quot;, #&lt;Process::Status: pid 2371732 exit 0&gt;]
</code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.capture2e(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) # Shell reserved word.
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2371740 exit 0&gt;]
Open3.capture2e(&#39;echo&#39;)                         # Built-in.
# =&gt; [&quot;\n&quot;, #&lt;Process::Status: pid 2371774 exit 0&gt;]
Open3.capture2e(&#39;date &gt; date.tmp&#39;)              # Contains meta character.
# =&gt; [&quot;&quot;, #&lt;Process::Status: pid 2371812 exit 0&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.capture2e(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326183 exit 0&gt;]
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.capture2e(&#39;/usr/bin/date&#39;)
# =&gt; [&quot;Sat Sep 30 09:01:46 AM CDT 2023\n&quot;, #&lt;Process::Status: pid 2371820 exit 0&gt;]
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.capture2e(&#39;doesnt_exist&#39;) # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.capture2e(&#39;echo&#39;, &#39;C #&#39;)
# =&gt; [&quot;C #\n&quot;, #&lt;Process::Status: pid 2371856 exit 0&gt;]
Open3.capture2e(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;)
# =&gt; [&quot;hello world\n&quot;, #&lt;Process::Status: pid 2371894 exit 0&gt;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-capture2e_source')" id="l_method-c-capture2e_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L902" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-capture2e_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 902</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capture2e</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stdin_data</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:stdin_data</span>)
  <span class="ruby-identifier">binmode</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:binmode</span>)

  <span class="ruby-identifier">popen2e</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">oe</span>, <span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">i</span>.<span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">oe</span>.<span class="ruby-identifier">binmode</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">outerr_reader</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">oe</span>.<span class="ruby-identifier">read</span> }
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">stdin_data</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">stdin_data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:readpartial</span>
          <span class="ruby-constant">IO</span>.<span class="ruby-identifier">copy_stream</span>(<span class="ruby-identifier">stdin_data</span>, <span class="ruby-identifier">i</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">i</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">stdin_data</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">i</span>.<span class="ruby-identifier">close</span>
    [<span class="ruby-identifier">outerr_reader</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">t</span>.<span class="ruby-identifier">value</span>]
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-capture3">
            
              <b>Open3.capture3([env, ] command_line, options = {}) &rarr; [stdout_s, stderr_s, status]<br />Open3.capture3([env, ] exe_path, *args, options = {}) &rarr; [stdout_s, stderr_s, status]
</b>
            
            <a href="../classes/Open3.html#method-c-capture3" name="method-c-capture3" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as strings <code>stdout_s</code> and <code>stderr_s</code> the standard output and standard error of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_s, stderr_s, status]</code>:</p>

<pre><code>stdout_s, stderr_s, status = Open3.capture3(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2281954 exit 0&gt;]
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <a href="Open3.html#method-c-capture3"><code>Open3.capture3</code></a>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre><code>Open3.capture3(&#39;tee&#39;, stdin_data: &#39;Foo&#39;)
# =&gt; [&quot;Foo&quot;, &quot;&quot;, #&lt;Process::Status: pid 2319575 exit 0&gt;]
</code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.capture3(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) # Shell reserved word.
# =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282025 exit 0&gt;]
Open3.capture3(&#39;echo&#39;)                         # Built-in.
# =&gt; [&quot;\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282092 exit 0&gt;]
Open3.capture3(&#39;date &gt; date.tmp&#39;)              # Contains meta character.
# =&gt; [&quot;&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282110 exit 0&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.capture3(&#39;echo &quot;Foo&quot;&#39;)
# =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282092 exit 0&gt;]
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.capture3(&#39;/usr/bin/date&#39;)
# =&gt; [&quot;Thu Sep 28 05:03:51 PM CDT 2023\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282300 exit 0&gt;]
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.capture3(&#39;doesnt_exist&#39;) # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.capture3(&#39;echo&#39;, &#39;C #&#39;)
# =&gt; [&quot;C #\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282368 exit 0&gt;]
Open3.capture3(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;)
# =&gt; [&quot;hello world\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282372 exit 0&gt;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-capture3_source')" id="l_method-c-capture3_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L648" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-capture3_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 648</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capture3</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stdin_data</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:stdin_data</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">binmode</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:binmode</span>)

  <span class="ruby-identifier">popen3</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">o</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">i</span>.<span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">o</span>.<span class="ruby-identifier">binmode</span>
      <span class="ruby-identifier">e</span>.<span class="ruby-identifier">binmode</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">out_reader</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">o</span>.<span class="ruby-identifier">read</span> }
    <span class="ruby-identifier">err_reader</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">e</span>.<span class="ruby-identifier">read</span> }
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">stdin_data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:readpartial</span>
        <span class="ruby-constant">IO</span>.<span class="ruby-identifier">copy_stream</span>(<span class="ruby-identifier">stdin_data</span>, <span class="ruby-identifier">i</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">i</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">stdin_data</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">i</span>.<span class="ruby-identifier">close</span>
    [<span class="ruby-identifier">out_reader</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">err_reader</span>.<span class="ruby-identifier">value</span>, <span class="ruby-identifier">t</span>.<span class="ruby-identifier">value</span>]
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-pipeline">
            
              <b>Open3.pipeline([env, ] *cmds, options = {}) &rarr; array_of_statuses
</b>
            
            <a href="../classes/Open3.html#method-c-pipeline" name="method-c-pipeline" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li><li>
<p>Waits for the child processes to exit.</p>
</li><li>
<p>Returns an array of <a href="Process/Status.html"><code>Process::Status</code></a> objects (one for each child).</p>
</li></ul>

<p>Example:</p>

<pre><code>wait_threads = Open3.pipeline(&#39;ls&#39;, &#39;grep R&#39;)
# =&gt; [#&lt;Process::Status: pid 2139200 exit 0&gt;, #&lt;Process::Status: pid 2139202 exit 0&gt;]
</code></pre>

<p>Output:</p>

<pre><code>Rakefile
README.md
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>‘ see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-pipeline_source')" id="l_method-c-pipeline_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L1334" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-pipeline_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 1334</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pipeline</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmds</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [], []) {<span class="ruby-operator">|</span><span class="ruby-identifier">ts</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ts</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:value</span>)
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-pipeline_r">
            
              <b>Open3.pipeline_r([env, ] *cmds, options = {}) &rarr; [last_stdout, wait_threads]
</b>
            
            <a href="../classes/Open3.html#method-c-pipeline_r" name="method-c-pipeline_r" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 2-element array containing:</p>
<ul><li>
<p>The <code>stdout</code> stream of the last child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre><code>last_stdout, wait_threads = Open3.pipeline_r(&#39;ls&#39;, &#39;grep R&#39;)
# =&gt; [#&lt;IO:fd 5&gt;, [#&lt;Process::Waiter:0x000055e8de2f9898 dead&gt;, #&lt;Process::Waiter:0x000055e8de2f94b0 sleep&gt;]]
puts last_stdout.read
wait_threads.each do |wait_thread|
  wait_thread.join
end
</code></pre>

<p>Output:</p>

<pre><code>Rakefile
README.md
</code></pre>

<p>With a block given, calls the block with the <code>stdout</code> stream of the last child process, and an array of the wait processes:</p>

<pre><code>Open3.pipeline_r(&#39;ls&#39;, &#39;grep R&#39;) do |last_stdout, wait_threads|
  puts last_stdout.read
  wait_threads.each do |wait_thread|
    wait_thread.join
  end
end
</code></pre>

<p>Output:</p>

<pre><code>Rakefile
README.md
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-pipeline_r_source')" id="l_method-c-pipeline_r_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L1104" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-pipeline_r_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 1104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pipeline_r</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">out_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:out</span>] = <span class="ruby-identifier">out_w</span>

  <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">out_w</span>], [<span class="ruby-identifier">out_r</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-pipeline_rw">
            
              <b>Open3.pipeline_rw([env, ] *cmds, options = {}) &rarr; [first_stdin, last_stdout, wait_threads]
</b>
            
            <a href="../classes/Open3.html#method-c-pipeline_rw" name="method-c-pipeline_rw" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the first child, from the caller’s <code>stdin</code>, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 3-element array containing:</p>
<ul><li>
<p>The <code>stdin</code> stream of the first child process.</p>
</li><li>
<p>The <code>stdout</code> stream of the last child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre><code>first_stdin, last_stdout, wait_threads = Open3.pipeline_rw(&#39;sort&#39;, &#39;cat -n&#39;)
# =&gt; [#&lt;IO:fd 20&gt;, #&lt;IO:fd 21&gt;, [#&lt;Process::Waiter:0x000055e8de29ab40 sleep&gt;, #&lt;Process::Waiter:0x000055e8de29a690 sleep&gt;]]
first_stdin.puts(&quot;foo\nbar\nbaz&quot;)
first_stdin.close # Send EOF to sort.
puts last_stdout.read
wait_threads.each do |wait_thread|
  wait_thread.join
end
</code></pre>

<p>Output:</p>

<pre><code>1 bar
2 baz
3 foo
</code></pre>

<p>With a block given, calls the block with the <code>stdin</code> stream of the first child, the <code>stdout</code> stream  of the last child, and an array of the wait processes:</p>

<pre><code>Open3.pipeline_rw(&#39;sort&#39;, &#39;cat -n&#39;) do |first_stdin, last_stdout, wait_threads|
  first_stdin.puts &quot;foo\nbar\nbaz&quot;
  first_stdin.close # send EOF to sort.
  puts last_stdout.read
  wait_threads.each do |wait_thread|
    wait_thread.join
  end
end
</code></pre>

<p>Output:</p>

<pre><code>1 bar
2 baz
3 foo
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-pipeline_rw_source')" id="l_method-c-pipeline_rw_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L1014" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-pipeline_rw_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 1014</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pipeline_rw</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">in_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>] = <span class="ruby-identifier">in_r</span>
  <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">out_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:out</span>] = <span class="ruby-identifier">out_w</span>

  <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">out_w</span>], [<span class="ruby-identifier">in_w</span>, <span class="ruby-identifier">out_r</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-pipeline_start">
            
              <b>Open3.pipeline_start([env, ] *cmds, options = {}) &rarr; [wait_threads]
</b>
            
            <a href="../classes/Open3.html#method-c-pipeline_start" name="method-c-pipeline_start" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>.</p>
</li><li>
<p>Does not wait for child processes to exit.</p>
</li></ul>

<p>With no block given, returns an array of the wait threads for all of the child processes.</p>

<p>Example:</p>

<pre><code>wait_threads = Open3.pipeline_start(&#39;ls&#39;, &#39;grep R&#39;)
# =&gt; [#&lt;Process::Waiter:0x000055e8de9d2bb0 run&gt;, #&lt;Process::Waiter:0x000055e8de9d2890 run&gt;]
wait_threads.each do |wait_thread|
  wait_thread.join
end
</code></pre>

<p>Output:</p>

<pre><code>Rakefile
README.md
</code></pre>

<p>With a block given, calls the block with an array of the wait processes:</p>

<pre><code>Open3.pipeline_start(&#39;ls&#39;, &#39;grep R&#39;) do |wait_threads|
  wait_threads.each do |wait_thread|
    wait_thread.join
  end
end
</code></pre>

<p>Output:</p>

<pre><code>Rakefile
README.md
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-pipeline_start_source')" id="l_method-c-pipeline_start_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L1272" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-pipeline_start_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 1272</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pipeline_start</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [], [], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">ts</span>, = <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [], [])
    <span class="ruby-identifier">ts</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-pipeline_w">
            
              <b>Open3.pipeline_w([env, ] *cmds, options = {}) &rarr; [first_stdin, wait_threads]
</b>
            
            <a href="../classes/Open3.html#method-c-pipeline_w" name="method-c-pipeline_w" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the first child, pipes the caller’s <code>stdout</code> to the child’s <code>stdin</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 2-element array containing:</p>
<ul><li>
<p>The <code>stdin</code> stream of the first child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre><code>first_stdin, wait_threads = Open3.pipeline_w(&#39;sort&#39;, &#39;cat -n&#39;)
# =&gt; [#&lt;IO:fd 7&gt;, [#&lt;Process::Waiter:0x000055e8de928278 run&gt;, #&lt;Process::Waiter:0x000055e8de923e80 run&gt;]]
first_stdin.puts(&quot;foo\nbar\nbaz&quot;)
first_stdin.close # Send EOF to sort.
wait_threads.each do |wait_thread|
  wait_thread.join
end
</code></pre>

<p>Output:</p>

<pre><code>1 bar
2 baz
3 foo
</code></pre>

<p>With a block given, calls the block with the <code>stdin</code> stream of the first child process, and an array of the wait processes:</p>

<pre><code>Open3.pipeline_w(&#39;sort&#39;, &#39;cat -n&#39;) do |first_stdin, wait_threads|
  first_stdin.puts(&quot;foo\nbar\nbaz&quot;)
  first_stdin.close # Send EOF to sort.
  wait_threads.each do |wait_thread|
    wait_thread.join
  end
end
</code></pre>

<p>Output:</p>

<pre><code>1 bar
2 baz
3 foo
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <a href="Process.html#module-Process-label-Argument+command_line+or+exe_path">Argument command_line or exe_path</a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-pipeline_w_source')" id="l_method-c-pipeline_w_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L1195" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-pipeline_w_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 1195</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pipeline_w</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmds</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">in_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>] = <span class="ruby-identifier">in_r</span>
  <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">pipeline_run</span>(<span class="ruby-identifier">cmds</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">in_r</span>], [<span class="ruby-identifier">in_w</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-popen2">
            
              <b>Open3.popen2([env, ] command_line, options = {}) &rarr; [stdin, stdout, wait_thread]<br />Open3.popen2([env, ] exe_path, *args, options = {}) &rarr; [stdin, stdout, wait_thread]<br />Open3.popen2([env, ] command_line, options = {}) {|stdin, stdout, wait_thread| ... } &rarr; object<br />Open3.popen2([env, ] exe_path, *args, options = {}) {|stdin, stdout, wait_thread| ... } &rarr; object
</b>
            
            <a href="../classes/Open3.html#method-c-popen2" name="method-c-popen2" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code> and <code>stdout</code>, which are the standard input and standard output streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout, wait_thread]</code>. The caller should close each of the two returned streams.</p>

<pre><code>stdin, stdout, wait_thread = Open3.popen2(&#39;echo&#39;)
# =&gt; [#&lt;IO:fd 6&gt;, #&lt;IO:fd 7&gt;, #&lt;Process::Waiter:0x00007f58d52dbe98 run&gt;]
stdin.close
stdout.close
wait_thread.pid   # =&gt; 2263572
wait_thread.value # =&gt; #&lt;Process::Status: pid 2263572 exit 0&gt;
</code></pre>

<p>With a block given, calls the block with the three variables (two streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre><code>Open3.popen2(&#39;echo&#39;) do |stdin, stdout, wait_thread|
  p stdin
  p stdout
  p wait_thread
  p wait_thread.pid
  p wait_thread.value
end
</code></pre>

<p>Output:</p>

<pre><code>#&lt;IO:fd 6&gt;
#&lt;IO:fd 7&gt;
#&lt;Process::Waiter:0x00007f58d59a34b0 sleep&gt;
2263636
#&lt;Process::Status: pid 2263636 exit 0&gt;
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.popen2(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) {|*args| p args } # Shell reserved word.
Open3.popen2(&#39;echo&#39;) {|*args| p args }                         # Built-in.
Open3.popen2(&#39;date &gt; date.tmp&#39;) {|*args| p args }              # Contains meta character.
</code></pre>

<p>Output (similar for each call above):</p>

<pre><code># =&gt; [#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f7577dfe410 dead&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.popen2(&#39;echo &quot;Foo&quot;&#39;) { |i, o, t| o.gets }
&quot;Foo\n&quot;
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.popen2(&#39;/usr/bin/date&#39;) { |i, o, t| o.gets }
# =&gt; &quot;Thu Sep 28 09:41:06 AM CDT 2023\n&quot;
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.popen2(&#39;doesnt_exist&#39;) { |i, o, t| o.gets } # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.popen2(&#39;echo&#39;, &#39;C #&#39;) { |i, o, t| o.gets }
# =&gt; &quot;C #\n&quot;
Open3.popen2(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;) { |i, o, t| o.gets }
# =&gt; &quot;hello world\n&quot;
</code></pre>

<p>Related:</p>
<ul><li>
<p><a href="Open3.html#method-c-popen2e"><code>Open3.popen2e</code></a>: Makes the standard input and the merge of the standard output and standard error streams of the child process available as separate streams.</p>
</li><li>
<p><a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>: Makes the standard input, standard output, and standard error streams of the child process available as separate streams.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-popen2_source')" id="l_method-c-popen2_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L365" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-popen2_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 365</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">popen2</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">in_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>] = <span class="ruby-identifier">in_r</span>
  <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">out_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:out</span>] = <span class="ruby-identifier">out_w</span>

  <span class="ruby-identifier">popen_run</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">out_w</span>], [<span class="ruby-identifier">in_w</span>, <span class="ruby-identifier">out_r</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-popen2e">
            
              <b>Open3.popen2e([env, ] command_line, options = {}) &rarr; [stdin, stdout_and_stderr, wait_thread]<br />Open3.popen2e([env, ] exe_path, *args, options = {}) &rarr; [stdin, stdout_and_stderr, wait_thread]<br />Open3.popen2e([env, ] command_line, options = {}) {|stdin, stdout_and_stderr, wait_thread| ... } &rarr; object<br />Open3.popen2e([env, ] exe_path, *args, options = {}) {|stdin, stdout_and_stderr, wait_thread| ... } &rarr; object
</b>
            
            <a href="../classes/Open3.html#method-c-popen2e" name="method-c-popen2e" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code>, <code>stdout_and_stderr</code>, which are the standard input and the merge of the standard output and standard error streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout_and_stderr, wait_thread]</code>. The caller should close each of the two returned streams.</p>

<pre><code>stdin, stdout_and_stderr, wait_thread = Open3.popen2e(&#39;echo&#39;)
# =&gt; [#&lt;IO:fd 6&gt;, #&lt;IO:fd 7&gt;, #&lt;Process::Waiter:0x00007f7577da4398 run&gt;]
stdin.close
stdout_and_stderr.close
wait_thread.pid   # =&gt; 2274600
wait_thread.value # =&gt; #&lt;Process::Status: pid 2274600 exit 0&gt;
</code></pre>

<p>With a block given, calls the block with the three variables (two streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre><code>Open3.popen2e(&#39;echo&#39;) do |stdin, stdout_and_stderr, wait_thread|
  p stdin
  p stdout_and_stderr
  p wait_thread
  p wait_thread.pid
  p wait_thread.value
end
</code></pre>

<p>Output:</p>

<pre><code>#&lt;IO:fd 6&gt;
#&lt;IO:fd 7&gt;
#&lt;Process::Waiter:0x00007f75777578c8 sleep&gt;
2274763
#&lt;Process::Status: pid 2274763 exit 0&gt;
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.popen2e(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) {|*args| p args } # Shell reserved word.
Open3.popen2e(&#39;echo&#39;) {|*args| p args }                         # Built-in.
Open3.popen2e(&#39;date &gt; date.tmp&#39;) {|*args| p args }              # Contains meta character.
</code></pre>

<p>Output (similar for each call above):</p>

<pre><code># =&gt; [#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f7577d8a1f0 dead&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.popen2e(&#39;echo &quot;Foo&quot;&#39;) { |i, o_and_e, t| o_and_e.gets }
&quot;Foo\n&quot;
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.popen2e(&#39;/usr/bin/date&#39;) { |i, o_and_e, t| o_and_e.gets }
# =&gt; &quot;Thu Sep 28 01:58:45 PM CDT 2023\n&quot;
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.popen2e(&#39;doesnt_exist&#39;) { |i, o_and_e, t| o_and_e.gets } # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.popen2e(&#39;echo&#39;, &#39;C #&#39;) { |i, o_and_e, t| o_and_e.gets }
# =&gt; &quot;C #\n&quot;
Open3.popen2e(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;) { |i, o_and_e, t| o_and_e.gets }
# =&gt; &quot;hello world\n&quot;
</code></pre>

<p>Related:</p>
<ul><li>
<p><a href="Open3.html#method-c-popen2"><code>Open3.popen2</code></a>: Makes the standard input and standard output streams of the child process available as separate streams, with no access to the standard error stream.</p>
</li><li>
<p><a href="Open3.html#method-c-popen3"><code>Open3.popen3</code></a>: Makes the standard input, standard output, and standard error streams of the child process available as separate streams.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-popen2e_source')" id="l_method-c-popen2e_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L508" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-popen2e_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">popen2e</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">in_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>] = <span class="ruby-identifier">in_r</span>
  <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">out_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[[<span class="ruby-value">:out</span>, <span class="ruby-value">:err</span>]] = <span class="ruby-identifier">out_w</span>

  <span class="ruby-identifier">popen_run</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">out_w</span>], [<span class="ruby-identifier">in_w</span>, <span class="ruby-identifier">out_r</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">ensure</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">in_r</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">out_r</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">out_w</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-popen3">
            
              <b>Open3.popen3([env, ] command_line, options = {}) &rarr; [stdin, stdout, stderr, wait_thread]<br />Open3.popen3([env, ] exe_path, *args, options = {}) &rarr; [stdin, stdout, stderr, wait_thread]<br />Open3.popen3([env, ] command_line, options = {}) {|stdin, stdout, stderr, wait_thread| ... } &rarr; object<br />Open3.popen3([env, ] exe_path, *args, options = {}) {|stdin, stdout, stderr, wait_thread| ... } &rarr; object
</b>
            
            <a href="../classes/Open3.html#method-c-popen3" name="method-c-popen3" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Basically a wrapper for <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code>, <code>stdout</code>, and <code>stderr</code>, which are the standard input, standard output, and standard error streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout, stderr, wait_thread]</code>. The caller should close each of the three returned streams.</p>

<pre><code>stdin, stdout, stderr, wait_thread = Open3.popen3(&#39;echo&#39;)
# =&gt; [#&lt;IO:fd 8&gt;, #&lt;IO:fd 10&gt;, #&lt;IO:fd 12&gt;, #&lt;Process::Waiter:0x00007f58d5428f58 run&gt;]
stdin.close
stdout.close
stderr.close
wait_thread.pid   # =&gt; 2210481
wait_thread.value # =&gt; #&lt;Process::Status: pid 2210481 exit 0&gt;
</code></pre>

<p>With a block given, calls the block with the four variables (three streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre><code>Open3.popen3(&#39;echo&#39;) do |stdin, stdout, stderr, wait_thread|
  p stdin
  p stdout
  p stderr
  p wait_thread
  p wait_thread.pid
  p wait_thread.value
end
</code></pre>

<p>Output:</p>

<pre><code>#&lt;IO:fd 6&gt;
#&lt;IO:fd 7&gt;
#&lt;IO:fd 9&gt;
#&lt;Process::Waiter:0x00007f58d53606e8 sleep&gt;
2211047
#&lt;Process::Status: pid 2211047 exit 0&gt;
</code></pre>

<p>Like <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method has potential security vulnerabilities if called with untrusted input; see <a href="../files/ruby/doc/command_injection_rdoc.html#label-Command+Injection">Command Injection</a>.</p>

<p>Unlike <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Environment">Execution Environment</a>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <a href="Process.html#method-c-spawn"><code>Process.spawn</code></a>; see <a href="Process.html#module-Process-label-Execution+Options">Execution Options</a>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre><code>Open3.popen3(&#39;if true; then echo &quot;Foo&quot;; fi&#39;) {|*args| p args } # Shell reserved word.
Open3.popen3(&#39;echo&#39;) {|*args| p args }                         # Built-in.
Open3.popen3(&#39;date &gt; date.tmp&#39;) {|*args| p args }              # Contains meta character.
</code></pre>

<p>Output (similar for each call above):</p>

<pre><code>[#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f58d52f28c8 dead&gt;]
</code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre><code>Open3.popen3(&#39;echo &quot;Foo&quot;&#39;) { |i, o, e, t| o.gets }
&quot;Foo\n&quot;
</code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre><code>Open3.popen3(&#39;/usr/bin/date&#39;) { |i, o, e, t| o.gets }
# =&gt; &quot;Wed Sep 27 02:56:44 PM CDT 2023\n&quot;
</code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre><code>Open3.popen3(&#39;doesnt_exist&#39;) { |i, o, e, t| o.gets } # Raises Errno::ENOENT
</code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre><code>Open3.popen3(&#39;echo&#39;, &#39;C #&#39;) { |i, o, e, t| o.gets }
# =&gt; &quot;C #\n&quot;
Open3.popen3(&#39;echo&#39;, &#39;hello&#39;, &#39;world&#39;) { |i, o, e, t| o.gets }
# =&gt; &quot;hello world\n&quot;
</code></pre>

<p>Take care to avoid deadlocks. Output streams <code>stdout</code> and <code>stderr</code> have fixed-size buffers, so reading extensively from one but not the other can cause a deadlock when the unread buffer fills. To avoid that, <code>stdout</code> and <code>stderr</code> should be read simultaneously (using threads or <a href="IO.html#method-c-select"><code>IO.select</code></a>).</p>

<p>Related:</p>
<ul><li>
<p><a href="Open3.html#method-c-popen2"><code>Open3.popen2</code></a>: Makes the standard input and standard output streams of the child process available as separate streams, with no access to the standard error stream.</p>
</li><li>
<p><a href="Open3.html#method-c-popen2e"><code>Open3.popen2e</code></a>: Makes the standard input and the merge of the standard output and standard error streams of the child process available as separate streams.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-popen3_source')" id="l_method-c-popen3_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/open3.rb#L218" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-popen3_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/open3.rb, line 218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">popen3</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cmd</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">cmd</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span> = {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">in_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>] = <span class="ruby-identifier">in_r</span>
  <span class="ruby-identifier">in_w</span>.<span class="ruby-identifier">sync</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">out_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:out</span>] = <span class="ruby-identifier">out_w</span>

  <span class="ruby-identifier">err_r</span>, <span class="ruby-identifier">err_w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:err</span>] = <span class="ruby-identifier">err_w</span>

  <span class="ruby-identifier">popen_run</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">opts</span>, [<span class="ruby-identifier">in_r</span>, <span class="ruby-identifier">out_w</span>, <span class="ruby-identifier">err_w</span>], [<span class="ruby-identifier">in_w</span>, <span class="ruby-identifier">out_r</span>, <span class="ruby-identifier">err_r</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
    
  
</div>

    </main>
  </body>
</html>
