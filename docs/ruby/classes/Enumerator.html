<!DOCTYPE html>
<html lang="en">
<head>
    <title>Enumerator</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["Enumerator"]'>


    <meta property="og:title" value="Enumerator">

  
    
    <meta name="description" content="A class which allows both internal and external iteration.  An Enumerator can be created by the following methods.  Object#to_enum  Object#enum_for  Enumerator.">
    <meta property="og:description" content="A class which allows both internal and external iteration.  An Enumerator can be created by the following methods.  Object#to_enum  Object#enum_for  Enumerator.">
  

    <meta name="keywords" content="Enumerator class, new, each, each_with_index, each_with_object, with_index, with_object, next_values, peek_values, next, peek, feed, rewind, inspect, size, +, produce, product">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            Enumerator
            
                <span class="parent">&lt;
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/ruby/enumerator_c.html">ruby/enumerator.c</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>A class which allows both internal and external iteration.</p>

<p>An <a href="Enumerator.html"><code>Enumerator</code></a> can be created by the following methods.</p>
<ul><li>
<p><a href="Object.html#method-i-to_enum"><code>Object#to_enum</code></a></p>
</li><li>
<p><a href="Object.html#method-i-enum_for"><code>Object#enum_for</code></a></p>
</li><li>
<p><a href="Enumerator.html#method-c-new"><code>Enumerator.new</code></a></p>
</li></ul>

<p>Most methods have two forms: a block form where the contents are evaluated for each item in the enumeration, and a non-block form which returns a new <a href="Enumerator.html"><code>Enumerator</code></a> wrapping the iteration.</p>

<pre><code>enumerator = %w(one two three).each
puts enumerator.class # =&gt; Enumerator

enumerator.each_with_object(&quot;foo&quot;) do |item, obj|
  puts &quot;#{obj}: #{item}&quot;
end

# foo: one
# foo: two
# foo: three

enum_with_obj = enumerator.each_with_object(&quot;foo&quot;)
puts enum_with_obj.class # =&gt; Enumerator

enum_with_obj.each do |item, obj|
  puts &quot;#{obj}: #{item}&quot;
end

# foo: one
# foo: two
# foo: three
</code></pre>

<p>This allows you to chain Enumerators together.  For example, you can map a list’s elements to strings containing the index and the element as a string via:</p>

<pre><code>puts %w[foo bar baz].map.with_index { |w, i| &quot;#{i}:#{w}&quot; }
# =&gt; [&quot;0:foo&quot;, &quot;1:bar&quot;, &quot;2:baz&quot;]
</code></pre>

<h2 id="class-Enumerator-label-External+Iteration">External Iteration</h2>

<p>An <a href="Enumerator.html"><code>Enumerator</code></a> can also be used as an external iterator. For example, <a href="Enumerator.html#method-i-next"><code>Enumerator#next</code></a> returns the next value of the iterator or raises <a href="StopIteration.html"><code>StopIteration</code></a> if the <a href="Enumerator.html"><code>Enumerator</code></a> is at the end.</p>

<pre><code>e = [1,2,3].each   # returns an enumerator object.
puts e.next   # =&gt; 1
puts e.next   # =&gt; 2
puts e.next   # =&gt; 3
puts e.next   # raises StopIteration
</code></pre>

<p><code>next</code>, <code>next_values</code>, <code>peek</code>, and <code>peek_values</code> are the only methods which use external iteration (and <a href="Array.html#method-i-zip"><code>Array#zip(Enumerable-not-Array)</code></a> which uses <code>next</code> internally).</p>

<p>These methods do not affect other internal enumeration methods, unless the underlying iteration method itself has side-effect, e.g. <a href="IO.html#method-i-each_line"><code>IO#each_line</code></a>.</p>

<p><a href="FrozenError.html"><code>FrozenError</code></a> will be raised if these methods are called against a frozen enumerator. Since <code>rewind</code> and <code>feed</code> also change state for external iteration, these methods may raise <a href="FrozenError.html"><code>FrozenError</code></a> too.</p>

<p>External iteration differs <strong>significantly</strong> from internal iteration due to using a Fiber:</p>
<ul><li>
<p>The <a href="Fiber.html"><code>Fiber</code></a> adds some overhead compared to internal enumeration.</p>
</li><li>
<p>The stacktrace will only include the stack from the <a href="Enumerator.html"><code>Enumerator</code></a>, not above.</p>
</li><li>
<p>Fiber-local variables are <strong>not</strong> inherited inside the <a href="Enumerator.html"><code>Enumerator</code></a> <a href="Fiber.html"><code>Fiber</code></a>, which instead starts with no Fiber-local variables.</p>
</li><li>
<p><a href="Fiber.html"><code>Fiber</code></a> storage variables <strong>are</strong> inherited and are designed to handle <a href="Enumerator.html"><code>Enumerator</code></a> Fibers. Assigning to a <a href="Fiber.html"><code>Fiber</code></a> storage variable only affects the current <a href="Fiber.html"><code>Fiber</code></a>, so if you want to change state in the caller <a href="Fiber.html"><code>Fiber</code></a> of the <a href="Enumerator.html"><code>Enumerator</code></a> <a href="Fiber.html"><code>Fiber</code></a>, you need to use an extra indirection (e.g., use some object in the <a href="Fiber.html"><code>Fiber</code></a> storage variable and mutate some ivar of it).</p>
</li></ul>

<p>Concretely:</p>

<pre><code>Thread.current[:fiber_local] = 1
Fiber[:storage_var] = 1
e = Enumerator.new do |y|
  p Thread.current[:fiber_local] # for external iteration: nil, for internal iteration: 1
  p Fiber[:storage_var] # =&gt; 1, inherited
  Fiber[:storage_var] += 1
  y &lt;&lt; 42
end

p e.next # =&gt; 42
p Fiber[:storage_var] # =&gt; 1 (it ran in a different Fiber)

e.each { p _1 }
p Fiber[:storage_var] # =&gt; 2 (it ran in the same Fiber/&quot;stack&quot; as the current Fiber)
</code></pre>

<h2 id="class-Enumerator-label-Convert+External+Iteration+to+Internal+Iteration">Convert External Iteration to Internal Iteration</h2>

<p>You can use an external iterator to implement an internal iterator as follows:</p>

<pre><code>def ext_each(e)
  while true
    begin
      vs = e.next_values
    rescue StopIteration
      return $!.result
    end
    y = yield(*vs)
    e.feed y
  end
end

o = Object.new

def o.each
  puts yield
  puts yield(1)
  puts yield(1, 2)
  3
end

# use o.each as an internal iterator directly.
puts o.each {|*x| puts x; [:b, *x] }
# =&gt; [], [:b], [1], [:b, 1], [1, 2], [:b, 1, 2], 3

# convert o.each to an external iterator for
# implementing an internal iterator.
puts ext_each(o.to_enum) {|*x| puts x; [:b, *x] }
# =&gt; [], [:b], [1], [:b, 1], [1, 2], [:b, 1, 2], 3
</code></pre>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/ArithmeticSequence.html">Enumerator::ArithmeticSequence</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Chain.html">Enumerator::Chain</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Generator.html">Enumerator::Generator</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Lazy.html">Enumerator::Lazy</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Producer.html">Enumerator::Producer</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Product.html">Enumerator::Product</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Enumerator/Yielder.html">Enumerator::Yielder</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-2B">+</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-each">each</a>,
              </li>
            
              
              <li>
                <a href="#method-i-each_with_index">each_with_index</a>,
              </li>
            
              
              <li>
                <a href="#method-i-each_with_object">each_with_object</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-feed">feed</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-inspect">inspect</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>,
              </li>
            
              
              <li>
                <a href="#method-i-next">next</a>,
              </li>
            
              
              <li>
                <a href="#method-i-next_values">next_values</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-peek">peek</a>,
              </li>
            
              
              <li>
                <a href="#method-i-peek_values">peek_values</a>,
              </li>
            
              
              <li>
                <a href="#method-c-produce">produce</a>,
              </li>
            
              
              <li>
                <a href="#method-c-product">product</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-rewind">rewind</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-size">size</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>W</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-with_index">with_index</a>,
              </li>
            
              
              <li>
                <a href="#method-i-with_object">with_object</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="Enumerable.html">
              Enumerable
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>Enumerator.new(size = nil) { |yielder| ... }
</b>
            
            <a href="../classes/Enumerator.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new <a href="Enumerator.html"><code>Enumerator</code></a> object, which can be used as an <a href="Enumerable.html"><code>Enumerable</code></a>.</p>

<p>Iteration is defined by the given block, in which a “yielder” object, given as block parameter, can be used to yield a value by calling the <code>yield</code> method (aliased as <code>&lt;&lt;</code>):</p>

<pre><code>fib = Enumerator.new do |y|
  a = b = 1
  loop do
    y &lt;&lt; a
    a, b = b, a + b
  end
end

fib.take(10) # =&gt; [1, 1, 2, 3, 5, 8, 13, 21, 34, 55]
</code></pre>

<p>The optional parameter can be used to specify how to calculate the size in a lazy fashion (see <a href="Enumerator.html#method-i-size"><code>Enumerator#size</code></a>). It can either be a value or a callable object.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
enumerator_initialize(int argc, VALUE *argv, VALUE obj)
{
    VALUE iter = rb_block_proc();
    VALUE recv = generator_init(generator_allocate(rb_cGenerator), iter);
    VALUE arg0 = rb_check_arity(argc, 0, 1) ? argv[0] : Qnil;
    VALUE size = convert_to_feasible_size_value(arg0);

    return enumerator_init(obj, recv, sym_each, 0, 0, 0, size, false);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-produce">
            
              <b>Enumerator.produce(initial = nil) { |prev| block } &rarr; enumerator
</b>
            
            <a href="../classes/Enumerator.html#method-c-produce" name="method-c-produce" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates an infinite enumerator from any block, just called over and over.  The result of the previous iteration is passed to the next one. If <code>initial</code> is provided, it is passed to the first iteration, and becomes the first element of the enumerator; if it is not provided, the first iteration receives <code>nil</code>, and its result becomes the first element of the iterator.</p>

<p>Raising <a href="StopIteration.html"><code>StopIteration</code></a> from the block stops an iteration.</p>

<pre><code>Enumerator.produce(1, &amp;:succ)   # =&gt; enumerator of 1, 2, 3, 4, ....

Enumerator.produce { rand(10) } # =&gt; infinite random number sequence

ancestors = Enumerator.produce(node) { |prev| node = prev.parent or raise StopIteration }
enclosing_section = ancestors.find { |n| n.type == :section }
</code></pre>

<p>Using <a href="Enumerator.html#method-c-produce"><code>::produce</code></a> together with <a href="Enumerable.html"><code>Enumerable</code></a> methods like <a href="Enumerable.html#method-i-detect"><code>Enumerable#detect</code></a>, <a href="Enumerable.html#method-i-slice_after"><code>Enumerable#slice_after</code></a>, <a href="Enumerable.html#method-i-take_while"><code>Enumerable#take_while</code></a> can provide Enumerator-based alternatives for <code>while</code> and <code>until</code> cycles:</p>

<pre><code># Find next Tuesday
require &quot;date&quot;
Enumerator.produce(Date.today, &amp;:succ).detect(&amp;:tuesday?)

# Simple lexer:
require &quot;strscan&quot;
scanner = StringScanner.new(&quot;7+38/6&quot;)
PATTERN = %r{\d+|[-/+*]}
Enumerator.produce { scanner.scan(PATTERN) }.slice_after { scanner.eos? }.first
# =&gt; [&quot;7&quot;, &quot;+&quot;, &quot;38&quot;, &quot;/&quot;, &quot;6&quot;]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-produce_source')" id="l_method-c-produce_source">show</a>
                
              </p>
              <div id="method-c-produce_source" class="dyn-source">
                <pre>static VALUE
enumerator_s_produce(int argc, VALUE *argv, VALUE klass)
{
    VALUE init, producer;

    if (!rb_block_given_p()) rb_raise(rb_eArgError, &quot;no block given&quot;);

    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;init) == 0) {
        init = Qundef;
    }

    producer = producer_init(producer_allocate(rb_cEnumProducer), init, rb_block_proc());

    return rb_enumeratorize_with_size_kw(producer, sym_each, 0, 0, producer_size, RB_NO_KEYWORDS);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-product">
            
              <b>Enumerator.product(*enums) &rarr; enumerator<br />Enumerator.product(*enums) { |elts| ... } &rarr; enumerator
</b>
            
            <a href="../classes/Enumerator.html#method-c-product" name="method-c-product" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generates a new enumerator object that generates a Cartesian product of given enumerable objects.  This is equivalent to <a href="Enumerator/Product.html#method-c-new"><code>Enumerator::Product.new</code></a>.</p>

<pre><code>e = Enumerator.product(1..3, [4, 5])
e.to_a #=&gt; [[1, 4], [1, 5], [2, 4], [2, 5], [3, 4], [3, 5]]
e.size #=&gt; 6
</code></pre>

<p>When a block is given, calls the block with each N-element array generated and returns <code>nil</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-product_source')" id="l_method-c-product_source">show</a>
                
              </p>
              <div id="method-c-product_source" class="dyn-source">
                <pre>static VALUE
enumerator_s_product(int argc, VALUE *argv, VALUE klass)
{
    VALUE enums = Qnil, options = Qnil, block = Qnil;

    rb_scan_args(argc, argv, &quot;*:&amp;&quot;, &amp;enums, &amp;options, &amp;block);

    if (!NIL_P(options) &amp;&amp; !RHASH_EMPTY_P(options)) {
        rb_exc_raise(rb_keyword_error_new(&quot;unknown&quot;, rb_hash_keys(options)));
    }

    VALUE obj = enum_product_initialize(argc, argv, enum_product_allocate(rb_cEnumProduct));

    if (!NIL_P(block)) {
        enum_product_run(obj, block);
        return Qnil;
    }

    return obj;
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-2B">
            
              <b>e + enum &rarr; enumerator
</b>
            
            <a href="../classes/Enumerator.html#method-i-2B" name="method-i-2B" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns an enumerator object generated from this enumerator and a given enumerable.</p>

<pre><code>e = (1..3).each + [4, 5]
e.to_a #=&gt; [1, 2, 3, 4, 5]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-2B_source')" id="l_method-i-2B_source">show</a>
                
              </p>
              <div id="method-i-2B_source" class="dyn-source">
                <pre>static VALUE
enumerator_plus(VALUE obj, VALUE eobj)
{
    return new_enum_chain(rb_ary_new_from_args(2, obj, eobj));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-each">
            
              <b>enum.each { |elm| block }                    &rarr; obj<br />enum.each                                    &rarr; enum<br />enum.each(*appending_args) { |elm| block }   &rarr; obj<br />enum.each(*appending_args)                   &rarr; an_enumerator
</b>
            
            <a href="../classes/Enumerator.html#method-i-each" name="method-i-each" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Iterates over the block according to how this <a href="Enumerator.html"><code>Enumerator</code></a> was constructed. If no block and no arguments are given, returns self.</p>

<h3 id="method-i-each-label-Examples">Examples</h3>

<pre><code>&quot;Hello, world!&quot;.scan(/\w+/)                     #=&gt; [&quot;Hello&quot;, &quot;world&quot;]
&quot;Hello, world!&quot;.to_enum(:scan, /\w+/).to_a      #=&gt; [&quot;Hello&quot;, &quot;world&quot;]
&quot;Hello, world!&quot;.to_enum(:scan).each(/\w+/).to_a #=&gt; [&quot;Hello&quot;, &quot;world&quot;]

obj = Object.new

def obj.each_arg(a, b=:b, *rest)
  yield a
  yield b
  yield rest
  :method_returned
end

enum = obj.to_enum :each_arg, :a, :x

enum.each.to_a                  #=&gt; [:a, :x, []]
enum.each.equal?(enum)          #=&gt; true
enum.each { |elm| elm }         #=&gt; :method_returned

enum.each(:y, :z).to_a          #=&gt; [:a, :x, [:y, :z]]
enum.each(:y, :z).equal?(enum)  #=&gt; false
enum.each(:y, :z) { |elm| elm } #=&gt; :method_returned
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-each_source')" id="l_method-i-each_source">show</a>
                
              </p>
              <div id="method-i-each_source" class="dyn-source">
                <pre>static VALUE
enumerator_each(int argc, VALUE *argv, VALUE obj)
{
    struct enumerator *e = enumerator_ptr(obj);

    if (argc &gt; 0) {
        VALUE args = (e = enumerator_ptr(obj = rb_obj_dup(obj)))-&gt;args;
        if (args) {
#if SIZEOF_INT &lt; SIZEOF_LONG
            /* check int range overflow */
            rb_long2int(RARRAY_LEN(args) + argc);
#endif
            args = rb_ary_dup(args);
            rb_ary_cat(args, argv, argc);
        }
        else {
            args = rb_ary_new4(argc, argv);
        }
        RB_OBJ_WRITE(obj, &amp;e-&gt;args, args);
        e-&gt;size = Qnil;
        e-&gt;size_fn = 0;
    }
    if (!rb_block_given_p()) return obj;

    if (!lazy_precheck(e-&gt;procs)) return Qnil;

    return enumerator_block_call(obj, 0, obj);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-each_with_index">
            
              <b>e.each_with_index {|(*args), idx| ... }<br />e.each_with_index
</b>
            
            <a href="../classes/Enumerator.html#method-i-each_with_index" name="method-i-each_with_index" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Same as <a href="Enumerator.html#method-i-with_index"><code>Enumerator#with_index(0)</code></a>, i.e. there is no starting offset.</p>

<p>If no block is given, a new <a href="Enumerator.html"><code>Enumerator</code></a> is returned that includes the index.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-each_with_index_source')" id="l_method-i-each_with_index_source">show</a>
                
              </p>
              <div id="method-i-each_with_index_source" class="dyn-source">
                <pre>static VALUE
enumerator_each_with_index(VALUE obj)
{
    return enumerator_with_index(0, NULL, obj);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-each_with_object">
            
              <b>e.each_with_object(obj) {|(*args), obj| ... }<br />e.each_with_object(obj)</b>
            
            <a href="../classes/Enumerator.html#method-i-each_with_object" name="method-i-each_with_object" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Iterates the given block for each element with an arbitrary object, <code>obj</code>, and returns <code>obj</code></p>

<p>If no block is given, returns a new <a href="Enumerator.html"><code>Enumerator</code></a>.</p>

<h3 id="method-i-each_with_object-label-Example">Example</h3>

<pre><code>to_three = Enumerator.new do |y|
  3.times do |x|
    y &lt;&lt; x
  end
end

to_three_with_string = to_three.with_object(&quot;foo&quot;)
to_three_with_string.each do |x,string|
  puts &quot;#{string}: #{x}&quot;
end

# =&gt; foo: 0
# =&gt; foo: 1
# =&gt; foo: 2
</code></pre>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Enumerator.html#method-i-with_object">with_object</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-each_with_object_source')" id="l_method-i-each_with_object_source">show</a>
                
              </p>
              <div id="method-i-each_with_object_source" class="dyn-source">
                <pre>static VALUE
enumerator_with_object(VALUE obj, VALUE memo)
{
    RETURN_SIZED_ENUMERATOR(obj, 1, &amp;memo, enumerator_enum_size);
    enumerator_block_call(obj, enumerator_with_object_i, memo);

    return memo;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-feed">
            
              <b>e.feed obj   &rarr; nil
</b>
            
            <a href="../classes/Enumerator.html#method-i-feed" name="method-i-feed" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the value to be returned by the next yield inside <code>e</code>.</p>

<p>If the value is not set, the yield returns nil.</p>

<p>This value is cleared after being yielded.</p>

<pre><code># Array#map passes the array&#39;s elements to &quot;yield&quot; and collects the
# results of &quot;yield&quot; as an array.
# Following example shows that &quot;next&quot; returns the passed elements and
# values passed to &quot;feed&quot; are collected as an array which can be
# obtained by StopIteration#result.
e = [1,2,3].map
p e.next           #=&gt; 1
e.feed &quot;a&quot;
p e.next           #=&gt; 2
e.feed &quot;b&quot;
p e.next           #=&gt; 3
e.feed &quot;c&quot;
begin
  e.next
rescue StopIteration
  p $!.result      #=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]
end

o = Object.new
def o.each
  x = yield         # (2) blocks
  p x               # (5) =&gt; &quot;foo&quot;
  x = yield         # (6) blocks
  p x               # (8) =&gt; nil
  x = yield         # (9) blocks
  p x               # not reached w/o another e.next
end

e = o.to_enum
e.next              # (1)
e.feed &quot;foo&quot;        # (3)
e.next              # (4)
e.next              # (7)
                    # (10)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-feed_source')" id="l_method-i-feed_source">show</a>
                
              </p>
              <div id="method-i-feed_source" class="dyn-source">
                <pre>static VALUE
enumerator_feed(VALUE obj, VALUE v)
{
    struct enumerator *e = enumerator_ptr(obj);

    rb_check_frozen(obj);

    if (!UNDEF_P(e-&gt;feedvalue)) {
        rb_raise(rb_eTypeError, &quot;feed value already set&quot;);
    }
    RB_OBJ_WRITE(obj, &amp;e-&gt;feedvalue, v);

    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-inspect">
            
              <b>e.inspect  &rarr; string
</b>
            
            <a href="../classes/Enumerator.html#method-i-inspect" name="method-i-inspect" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a printable version of <em>e</em>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-inspect_source')" id="l_method-i-inspect_source">show</a>
                
              </p>
              <div id="method-i-inspect_source" class="dyn-source">
                <pre>static VALUE
enumerator_inspect(VALUE obj)
{
    return rb_exec_recursive(inspect_enumerator, obj, 0);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-next">
            
              <b>e.next   &rarr; object
</b>
            
            <a href="../classes/Enumerator.html#method-i-next" name="method-i-next" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the next object in the enumerator, and move the internal position forward.  When the position reached at the end, <a href="StopIteration.html"><code>StopIteration</code></a> is raised.</p>

<h3 id="method-i-next-label-Example">Example</h3>

<pre><code>a = [1,2,3]
e = a.to_enum
p e.next   #=&gt; 1
p e.next   #=&gt; 2
p e.next   #=&gt; 3
p e.next   #raises StopIteration
</code></pre>

<p>See class-level notes about external iterators.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-next_source')" id="l_method-i-next_source">show</a>
                
              </p>
              <div id="method-i-next_source" class="dyn-source">
                <pre>static VALUE
enumerator_next(VALUE obj)
{
    VALUE vs = enumerator_next_values(obj);
    return ary2sv(vs, 0);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-next_values">
            
              <b>e.next_values   &rarr; array
</b>
            
            <a href="../classes/Enumerator.html#method-i-next_values" name="method-i-next_values" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the next object as an array in the enumerator, and move the internal position forward.  When the position reached at the end, <a href="StopIteration.html"><code>StopIteration</code></a> is raised.</p>

<p>See class-level notes about external iterators.</p>

<p>This method can be used to distinguish <code>yield</code> and <code>yield nil</code>.</p>

<h3 id="method-i-next_values-label-Example">Example</h3>

<pre><code>o = Object.new
def o.each
  yield
  yield 1
  yield 1, 2
  yield nil
  yield [1, 2]
end
e = o.to_enum
p e.next_values
p e.next_values
p e.next_values
p e.next_values
p e.next_values
e = o.to_enum
p e.next
p e.next
p e.next
p e.next
p e.next

## yield args       next_values      next
#  yield            []               nil
#  yield 1          [1]              1
#  yield 1, 2       [1, 2]           [1, 2]
#  yield nil        [nil]            nil
#  yield [1, 2]     [[1, 2]]         [1, 2]
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-next_values_source')" id="l_method-i-next_values_source">show</a>
                
              </p>
              <div id="method-i-next_values_source" class="dyn-source">
                <pre>static VALUE
enumerator_next_values(VALUE obj)
{
    struct enumerator *e = enumerator_ptr(obj);
    VALUE vs;

    rb_check_frozen(obj);

    if (!UNDEF_P(e-&gt;lookahead)) {
        vs = e-&gt;lookahead;
        e-&gt;lookahead = Qundef;
        return vs;
    }

    return get_next_values(obj, e);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-peek">
            
              <b>e.peek   &rarr; object
</b>
            
            <a href="../classes/Enumerator.html#method-i-peek" name="method-i-peek" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the next object in the enumerator, but doesn’t move the internal position forward.  If the position is already at the end, <a href="StopIteration.html"><code>StopIteration</code></a> is raised.</p>

<p>See class-level notes about external iterators.</p>

<h3 id="method-i-peek-label-Example">Example</h3>

<pre><code>a = [1,2,3]
e = a.to_enum
p e.next   #=&gt; 1
p e.peek   #=&gt; 2
p e.peek   #=&gt; 2
p e.peek   #=&gt; 2
p e.next   #=&gt; 2
p e.next   #=&gt; 3
p e.peek   #raises StopIteration
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-peek_source')" id="l_method-i-peek_source">show</a>
                
              </p>
              <div id="method-i-peek_source" class="dyn-source">
                <pre>static VALUE
enumerator_peek(VALUE obj)
{
    VALUE vs = enumerator_peek_values(obj);
    return ary2sv(vs, 1);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-peek_values">
            
              <b>e.peek_values   &rarr; array
</b>
            
            <a href="../classes/Enumerator.html#method-i-peek_values" name="method-i-peek_values" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the next object as an array, similar to <a href="Enumerator.html#method-i-next_values"><code>Enumerator#next_values</code></a>, but doesn’t move the internal position forward.  If the position is already at the end, <a href="StopIteration.html"><code>StopIteration</code></a> is raised.</p>

<p>See class-level notes about external iterators.</p>

<h3 id="method-i-peek_values-label-Example">Example</h3>

<pre><code>o = Object.new
def o.each
  yield
  yield 1
  yield 1, 2
end
e = o.to_enum
p e.peek_values    #=&gt; []
e.next
p e.peek_values    #=&gt; [1]
p e.peek_values    #=&gt; [1]
e.next
p e.peek_values    #=&gt; [1, 2]
e.next
p e.peek_values    # raises StopIteration
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-peek_values_source')" id="l_method-i-peek_values_source">show</a>
                
              </p>
              <div id="method-i-peek_values_source" class="dyn-source">
                <pre>static VALUE
enumerator_peek_values_m(VALUE obj)
{
    return rb_ary_dup(enumerator_peek_values(obj));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rewind">
            
              <b>e.rewind   &rarr; e
</b>
            
            <a href="../classes/Enumerator.html#method-i-rewind" name="method-i-rewind" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Rewinds the enumeration sequence to the beginning.</p>

<p>If the enclosed object responds to a “rewind” method, it is called.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-rewind_source')" id="l_method-i-rewind_source">show</a>
                
              </p>
              <div id="method-i-rewind_source" class="dyn-source">
                <pre>static VALUE
enumerator_rewind(VALUE obj)
{
    struct enumerator *e = enumerator_ptr(obj);

    rb_check_frozen(obj);

    rb_check_funcall(e-&gt;obj, id_rewind, 0, 0);

    e-&gt;fib = 0;
    e-&gt;dst = Qnil;
    e-&gt;lookahead = Qundef;
    e-&gt;feedvalue = Qundef;
    e-&gt;stop_exc = Qfalse;
    return obj;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-size">
            
              <b>e.size          &rarr; int, Float::INFINITY or nil
</b>
            
            <a href="../classes/Enumerator.html#method-i-size" name="method-i-size" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the size of the enumerator, or <code>nil</code> if it can’t be calculated lazily.</p>

<pre><code>(1..100).to_a.permutation(4).size # =&gt; 94109400
loop.size # =&gt; Float::INFINITY
(1..100).drop_while.size # =&gt; nil
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-size_source')" id="l_method-i-size_source">show</a>
                
              </p>
              <div id="method-i-size_source" class="dyn-source">
                <pre>static VALUE
enumerator_size(VALUE obj)
{
    struct enumerator *e = enumerator_ptr(obj);
    int argc = 0;
    const VALUE *argv = NULL;
    VALUE size;

    if (e-&gt;procs) {
        struct generator *g = generator_ptr(e-&gt;obj);
        VALUE receiver = rb_check_funcall(g-&gt;obj, id_size, 0, 0);
        long i = 0;

        for (i = 0; i &lt; RARRAY_LEN(e-&gt;procs); i++) {
            VALUE proc = RARRAY_AREF(e-&gt;procs, i);
            struct proc_entry *entry = proc_entry_ptr(proc);
            lazyenum_size_func *size_fn = entry-&gt;fn-&gt;size;
            if (!size_fn) {
                return Qnil;
            }
            receiver = (*size_fn)(proc, receiver);
        }
        return receiver;
    }

    if (e-&gt;size_fn) {
        return (*e-&gt;size_fn)(e-&gt;obj, e-&gt;args, obj);
    }
    if (e-&gt;args) {
        argc = (int)RARRAY_LEN(e-&gt;args);
        argv = RARRAY_CONST_PTR(e-&gt;args);
    }
    size = rb_check_funcall_kw(e-&gt;size, id_call, argc, argv, e-&gt;kw_splat);
    if (!UNDEF_P(size)) return size;
    return e-&gt;size;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-with_index">
            
              <b>e.with_index(offset = 0) {|(*args), idx| ... }<br />e.with_index(offset = 0)
</b>
            
            <a href="../classes/Enumerator.html#method-i-with_index" name="method-i-with_index" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Iterates the given block for each element with an index, which starts from <code>offset</code>.  If no block is given, returns a new <a href="Enumerator.html"><code>Enumerator</code></a> that includes the index, starting from <code>offset</code></p>
<dl class="rdoc-list note-list"><dt><code>offset</code>
<dd>
<p>the starting index to use</p>
</dd></dl>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-with_index_source')" id="l_method-i-with_index_source">show</a>
                
              </p>
              <div id="method-i-with_index_source" class="dyn-source">
                <pre>static VALUE
enumerator_with_index(int argc, VALUE *argv, VALUE obj)
{
    VALUE memo;

    rb_check_arity(argc, 0, 1);
    RETURN_SIZED_ENUMERATOR(obj, argc, argv, enumerator_enum_size);
    memo = (!argc || NIL_P(memo = argv[0])) ? INT2FIX(0) : rb_to_int(memo);
    return enumerator_block_call(obj, enumerator_with_index_i, (VALUE)MEMO_NEW(memo, 0, 0));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-with_object">
            
              <b>e.with_object(obj) {|(*args), obj| ... }<br />e.with_object(obj)</b>
            
            <a href="../classes/Enumerator.html#method-i-with_object" name="method-i-with_object" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Iterates the given block for each element with an arbitrary object, <code>obj</code>, and returns <code>obj</code></p>

<p>If no block is given, returns a new <a href="Enumerator.html"><code>Enumerator</code></a>.</p>

<h3 id="method-i-with_object-label-Example">Example</h3>

<pre><code>to_three = Enumerator.new do |y|
  3.times do |x|
    y &lt;&lt; x
  end
end

to_three_with_string = to_three.with_object(&quot;foo&quot;)
to_three_with_string.each do |x,string|
  puts &quot;#{string}: #{x}&quot;
end

# =&gt; foo: 0
# =&gt; foo: 1
# =&gt; foo: 2
</code></pre>
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Enumerator.html#method-i-each_with_object">each_with_object</a>
            </div>
          

          
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
