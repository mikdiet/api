<!DOCTYPE html>
<html lang="en">
<head>
    <title>OpenSSL::X509::StoreContext</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["OpenSSL", "X509", "StoreContext"]'>


    <meta property="og:title" value="OpenSSL::X509::StoreContext">

  
    
    <meta name="description" content="A StoreContext is used while validating a single certificate and holds the status involved.">
    <meta property="og:description" content="A StoreContext is used while validating a single certificate and holds the status involved.">
  

    <meta name="keywords" content="OpenSSL::X509::StoreContext class, cleanup, new, verify, chain, error, error=, error_string, error_depth, current_cert, current_crl, flags=, purpose=, trust=, time=">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            OpenSSL::X509::StoreContext
            
                <span class="parent">&lt;
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../../files/ruby/ext/openssl/lib/openssl/x509_rb.html">ruby/ext/openssl/lib/openssl/x509.rb</a></li>
            
            <li><a href="../../../files/ruby/ext/openssl/ossl_x509attr_c.html">ruby/ext/openssl/ossl_x509attr.c</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>A <a href="StoreContext.html"><code>StoreContext</code></a> is used while validating a single certificate and holds the status involved.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-chain">chain</a>,
              </li>
            
              
              <li>
                <a href="#method-i-cleanup">cleanup</a>,
              </li>
            
              
              <li>
                <a href="#method-i-current_cert">current_cert</a>,
              </li>
            
              
              <li>
                <a href="#method-i-current_crl">current_crl</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-error">error</a>,
              </li>
            
              
              <li>
                <a href="#method-i-error-3D">error=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-error_depth">error_depth</a>,
              </li>
            
              
              <li>
                <a href="#method-i-error_string">error_string</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-flags-3D">flags=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-purpose-3D">purpose=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-time-3D">time=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-trust-3D">trust=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-verify">verify</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>StoreContext.new(store, cert = nil, untrusted = nil)
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets up a <a href="StoreContext.html"><code>StoreContext</code></a> for a verification of the X.509 certificate <em>cert</em>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE store, cert, chain, t;
    X509_STORE_CTX *ctx;
    X509_STORE *x509st;
    X509 *x509 = NULL;
    STACK_OF(X509) *x509s = NULL;
    int state;

    rb_scan_args(argc, argv, &quot;12&quot;, &amp;store, &amp;cert, &amp;chain);
    GetX509StCtx(self, ctx);
    GetX509Store(store, x509st);
    if (!NIL_P(cert))
        x509 = DupX509CertPtr(cert); /* NEED TO DUP */
    if (!NIL_P(chain)) {
        x509s = ossl_protect_x509_ary2sk(chain, &amp;state);
        if (state) {
            X509_free(x509);
            rb_jump_tag(state);
        }
    }
    if (X509_STORE_CTX_init(ctx, x509st, x509, x509s) != 1){
        X509_free(x509);
        sk_X509_pop_free(x509s, X509_free);
        ossl_raise(eX509StoreError, &quot;X509_STORE_CTX_init&quot;);
    }
    if (!NIL_P(t = rb_iv_get(store, &quot;@time&quot;)))
        ossl_x509stctx_set_time(self, t);
    rb_iv_set(self, &quot;@verify_callback&quot;, rb_iv_get(store, &quot;@verify_callback&quot;));
    rb_iv_set(self, &quot;@cert&quot;, cert);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-chain">
            
              <b>stctx.chain &rarr; nil | Array of X509::Certificate
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-chain" name="method-i-chain" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the verified chain.</p>

<p>See also the man page X509_STORE_CTX_set0_verified_chain(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-chain_source')" id="l_method-i-chain_source">show</a>
                
              </p>
              <div id="method-i-chain_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_chain(VALUE self)
{
    X509_STORE_CTX *ctx;
    const STACK_OF(X509) *chain;

    GetX509StCtx(self, ctx);
    chain = X509_STORE_CTX_get0_chain(ctx);
    if (!chain)
        return Qnil; /* Could be an empty array instead? */
    return ossl_x509_sk2ary(chain);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-cleanup">
            
              <b>cleanup</b>()
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-cleanup" name="method-i-cleanup" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-cleanup_source')" id="l_method-i-cleanup_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/ext/openssl/lib/openssl/x509.rb#L337" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-cleanup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/x509.rb, line 337</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cleanup</span>
  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;(#{caller.first}) OpenSSL::X509::StoreContext#cleanup is deprecated with no replacement&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$VERBOSE</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-current_cert">
            
              <b>stctx.current_cert &rarr; X509::Certificate
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-current_cert" name="method-i-current_cert" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the certificate which caused the error.</p>

<p>See also the man page X509_STORE_CTX_get_current_cert(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-current_cert_source')" id="l_method-i-current_cert_source">show</a>
                
              </p>
              <div id="method-i-current_cert_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_curr_cert(VALUE self)
{
    X509_STORE_CTX *ctx;

    GetX509StCtx(self, ctx);

    return ossl_x509_new(X509_STORE_CTX_get_current_cert(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-current_crl">
            
              <b>stctx.current_crl &rarr; X509::CRL
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-current_crl" name="method-i-current_crl" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the <a href="CRL.html"><code>CRL</code></a> which caused the error.</p>

<p>See also the man page X509_STORE_CTX_get_current_crl(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-current_crl_source')" id="l_method-i-current_crl_source">show</a>
                
              </p>
              <div id="method-i-current_crl_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_curr_crl(VALUE self)
{
    X509_STORE_CTX *ctx;
    X509_CRL *crl;

    GetX509StCtx(self, ctx);
    crl = X509_STORE_CTX_get0_current_crl(ctx);
    if (!crl)
        return Qnil;

    return ossl_x509crl_new(crl);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-error">
            
              <b>stctx.error &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-error" name="method-i-error" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the error code of <em>stctx</em>. This is typically called after <a href="StoreContext.html#method-i-verify"><code>verify</code></a> is done, or from the verification callback set to <a href="Store.html#method-i-verify_callback-3D"><code>OpenSSL::X509::Store#verify_callback=</code></a>.</p>

<p>See also the man page X509_STORE_CTX_get_error(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-error_source')" id="l_method-i-error_source">show</a>
                
              </p>
              <div id="method-i-error_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_err(VALUE self)
{
    X509_STORE_CTX *ctx;

    GetX509StCtx(self, ctx);

    return INT2NUM(X509_STORE_CTX_get_error(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-error-3D">
            
              <b>stctx.error = error_code
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-error-3D" name="method-i-error-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the error code of <em>stctx</em>. This is used by the verification callback set to <a href="Store.html#method-i-verify_callback-3D"><code>OpenSSL::X509::Store#verify_callback=</code></a>.</p>

<p>See also the man page X509_STORE_CTX_set_error(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-error-3D_source')" id="l_method-i-error-3D_source">show</a>
                
              </p>
              <div id="method-i-error-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_set_error(VALUE self, VALUE err)
{
    X509_STORE_CTX *ctx;

    GetX509StCtx(self, ctx);
    X509_STORE_CTX_set_error(ctx, NUM2INT(err));

    return err;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-error_depth">
            
              <b>stctx.error_depth &rarr; Integer
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-error_depth" name="method-i-error_depth" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the depth of the chain. This is used in combination with <a href="StoreContext.html#method-i-error"><code>error</code></a>.</p>

<p>See also the man page X509_STORE_CTX_get_error_depth(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-error_depth_source')" id="l_method-i-error_depth_source">show</a>
                
              </p>
              <div id="method-i-error_depth_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_err_depth(VALUE self)
{
    X509_STORE_CTX *ctx;

    GetX509StCtx(self, ctx);

    return INT2NUM(X509_STORE_CTX_get_error_depth(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-error_string">
            
              <b>stctx.error_string &rarr; String
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-error_string" name="method-i-error_string" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the human readable error string corresponding to the error code retrieved by <a href="StoreContext.html#method-i-error"><code>error</code></a>.</p>

<p>See also the man page X509_verify_cert_error_string(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-error_string_source')" id="l_method-i-error_string_source">show</a>
                
              </p>
              <div id="method-i-error_string_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_get_err_string(VALUE self)
{
    X509_STORE_CTX *ctx;
    long err;

    GetX509StCtx(self, ctx);
    err = X509_STORE_CTX_get_error(ctx);

    return rb_str_new2(X509_verify_cert_error_string(err));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-flags-3D">
            
              <b>stctx.flags = flags
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-flags-3D" name="method-i-flags-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the verification flags to the context. This overrides the default value set by <a href="Store.html#method-i-flags-3D"><code>Store#flags=</code></a>.</p>

<p>See also the man page X509_VERIFY_PARAM_set_flags(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-flags-3D_source')" id="l_method-i-flags-3D_source">show</a>
                
              </p>
              <div id="method-i-flags-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_set_flags(VALUE self, VALUE flags)
{
    X509_STORE_CTX *store;
    long f = NUM2LONG(flags);

    GetX509StCtx(self, store);
    X509_STORE_CTX_set_flags(store, f);

    return flags;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-purpose-3D">
            
              <b>stctx.purpose = purpose
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-purpose-3D" name="method-i-purpose-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the purpose of the context. This overrides the default value set by <a href="Store.html#method-i-purpose-3D"><code>Store#purpose=</code></a>.</p>

<p>See also the man page X509_VERIFY_PARAM_set_purpose(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-purpose-3D_source')" id="l_method-i-purpose-3D_source">show</a>
                
              </p>
              <div id="method-i-purpose-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_set_purpose(VALUE self, VALUE purpose)
{
    X509_STORE_CTX *store;
    int p = NUM2INT(purpose);

    GetX509StCtx(self, store);
    X509_STORE_CTX_set_purpose(store, p);

    return purpose;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-time-3D">
            
              <b>stctx.time = time
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-time-3D" name="method-i-time-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the time used in the verification. If not set, the current time is used.</p>

<p>See also the man page X509_VERIFY_PARAM_set_time(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-time-3D_source')" id="l_method-i-time-3D_source">show</a>
                
              </p>
              <div id="method-i-time-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_set_time(VALUE self, VALUE time)
{
    X509_STORE_CTX *store;
    long t;

    t = NUM2LONG(rb_Integer(time));
    GetX509StCtx(self, store);
    X509_STORE_CTX_set_time(store, 0, t);

    return time;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-trust-3D">
            
              <b>stctx.trust = trust
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-trust-3D" name="method-i-trust-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets the trust settings of the context. This overrides the default value set by <a href="Store.html#method-i-trust-3D"><code>Store#trust=</code></a>.</p>

<p>See also the man page X509_VERIFY_PARAM_set_trust(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-trust-3D_source')" id="l_method-i-trust-3D_source">show</a>
                
              </p>
              <div id="method-i-trust-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_set_trust(VALUE self, VALUE trust)
{
    X509_STORE_CTX *store;
    int t = NUM2INT(trust);

    GetX509StCtx(self, store);
    X509_STORE_CTX_set_trust(store, t);

    return trust;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-verify">
            
              <b>stctx.verify &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/X509/StoreContext.html#method-i-verify" name="method-i-verify" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Performs the certificate verification using the parameters set to <em>stctx</em>.</p>

<p>See also the man page X509_verify_cert(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-verify_source')" id="l_method-i-verify_source">show</a>
                
              </p>
              <div id="method-i-verify_source" class="dyn-source">
                <pre>static VALUE
ossl_x509stctx_verify(VALUE self)
{
    X509_STORE_CTX *ctx;

    GetX509StCtx(self, ctx);
    VALUE cb = rb_iv_get(self, &quot;@verify_callback&quot;);
    X509_STORE_CTX_set_ex_data(ctx, stctx_ex_verify_cb_idx, (void *)cb);

    switch (X509_verify_cert(ctx)) {
      case 1:
        return Qtrue;
      case 0:
        ossl_clear_error();
        return Qfalse;
      default:
        ossl_raise(eX509CertError, &quot;X509_verify_cert&quot;);
    }
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
