<!DOCTYPE html>
<html lang="en">
<head>
    <title>OpenSSL::PKey::DH</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["OpenSSL", "PKey", "DH"]'>


    <meta property="og:title" value="OpenSSL::PKey::DH">

  
    
    <meta name="description" content="An implementation of the Diffie-Hellman key exchange protocol based on discrete logarithms in finite fields, the same basis that DSA is built on.">
    <meta property="og:description" content="An implementation of the Diffie-Hellman key exchange protocol based on discrete logarithms in finite fields, the same basis that DSA is built on.">
  

    <meta name="keywords" content="OpenSSL::PKey::DH class, public_key, compute_key, generate_key!, generate, new, initialize_copy, public?, private?, export, to_der, params_ok?, set_pqg, set_key, params, to_pem, to_s">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            OpenSSL::PKey::DH
            
                <span class="parent">&lt;
                    
                    <a href="PKey.html">OpenSSL::PKey::PKey</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../../files/ruby/ext/openssl/lib/openssl/pkey_rb.html">ruby/ext/openssl/lib/openssl/pkey.rb</a></li>
            
            <li><a href="../../../files/ruby/ext/openssl/ossl_pkey_c.html">ruby/ext/openssl/ossl_pkey.c</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>An implementation of the Diffie-Hellman key exchange protocol based on discrete logarithms in finite fields, the same basis that <a href="DSA.html"><code>DSA</code></a> is built on.</p>

<h3 id="class-OpenSSL::PKey::DH-label-Accessor+methods+for+the+Diffie-Hellman+parameters">Accessor methods for the Diffie-Hellman parameters</h3>
<dl class="rdoc-list note-list"><dt><a href="../../Kernel.html#method-i-p"><code>DH#p</code></a>
<dd>
<p>The prime (an <a href="../BN.html"><code>OpenSSL::BN</code></a>) of the Diffie-Hellman parameters.</p>
</dd><dt>DH#g
<dd>
<p>The generator (an <a href="../BN.html"><code>OpenSSL::BN</code></a>) g of the Diffie-Hellman parameters.</p>
</dd><dt>DH#pub_key
<dd>
<p>The per-session public key (an <a href="../BN.html"><code>OpenSSL::BN</code></a>) matching the private key. This needs to be passed to <a href="DH.html#method-i-compute_key"><code>DH#compute_key</code></a>.</p>
</dd><dt>DH#priv_key
<dd>
<p>The per-session private key, an <a href="../BN.html"><code>OpenSSL::BN</code></a>.</p>
</dd></dl>

<h3 id="class-OpenSSL::PKey::DH-label-Example+of+a+key+exchange">Example of a key exchange</h3>

<pre><code># you may send the parameters (der) and own public key (pub1) publicly
# to the participating party
dh1 = OpenSSL::PKey::DH.new(2048)
der = dh1.to_der
pub1 = dh1.pub_key

# the other party generates its per-session key pair
dhparams = OpenSSL::PKey::DH.new(der)
dh2 = OpenSSL::PKey.generate_key(dhparams)
pub2 = dh2.pub_key

symm_key1 = dh1.compute_key(pub2)
symm_key2 = dh2.compute_key(pub1)
puts symm_key1 == symm_key2 # =&gt; true
</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-compute_key">compute_key</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-export">export</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-generate">generate</a>,
              </li>
            
              
              <li>
                <a href="#method-i-generate_key-21">generate_key!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-initialize_copy">initialize_copy</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-params">params</a>,
              </li>
            
              
              <li>
                <a href="#method-i-params_ok-3F">params_ok?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-private-3F">private?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-public-3F">public?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-public_key">public_key</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-set_key">set_key</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_pqg">set_pqg</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-to_der">to_der</a>,
              </li>
            
              
              <li>
                <a href="#method-i-to_pem">to_pem</a>,
              </li>
            
              
              <li>
                <a href="#method-i-to_s">to_s</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  
    <!-- Includes -->
    <div class="sectiontitle">Included Modules</div>
    <ul>
      
        <li>
          
            <a href="../Marshal.html">
              OpenSSL::Marshal
            </a>
          
        </li>
      
    </ul>
  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-generate">
            
              <b>DH.generate(size, generator = 2) &rarr; dh
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-c-generate" name="method-c-generate" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new <a href="DH.html"><code>DH</code></a> instance from scratch by generating random parameters and a key pair.</p>

<p>See also <a href="../PKey.html#method-c-generate_parameters"><code>OpenSSL::PKey.generate_parameters</code></a> and <a href="../PKey.html#method-c-generate_key"><code>OpenSSL::PKey.generate_key</code></a>.</p>
<dl class="rdoc-list note-list"><dt><code>size</code>
<dd>
<p>The desired key size in bits.</p>
</dd><dt><code>generator</code>
<dd>
<p>The generator.</p>
</dd></dl>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-generate_source')" id="l_method-c-generate_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/ext/openssl/lib/openssl/pkey.rb#L118" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-generate_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/pkey.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate</span>(<span class="ruby-identifier">size</span>, <span class="ruby-identifier">generator</span> = <span class="ruby-value">2</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>)
  <span class="ruby-identifier">dhparams</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span>.<span class="ruby-identifier">generate_parameters</span>(<span class="ruby-string">&quot;DH&quot;</span>, {
    <span class="ruby-string">&quot;dh_paramgen_prime_len&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">size</span>,
    <span class="ruby-string">&quot;dh_paramgen_generator&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">generator</span>,
  }, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blk</span>)
  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span>.<span class="ruby-identifier">generate_key</span>(<span class="ruby-identifier">dhparams</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>DH.new &rarr; dh<br />DH.new(string) &rarr; dh<br />DH.new(size [, generator]) &rarr; dh
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new instance of <a href="DH.html"><code>OpenSSL::PKey::DH</code></a>.</p>

<p>If called without arguments, an empty instance without any parameter or key components is created. Use <a href="DH.html#method-i-set_pqg"><code>set_pqg</code></a> to manually set the parameters afterwards (and optionally <a href="DH.html#method-i-set_key"><code>set_key</code></a> to set private and public key components).</p>

<p>If a <a href="../../String.html"><code>String</code></a> is given, tries to parse it as a DER- or PEM- encoded parameters. See also <a href="../PKey.html#method-c-read"><code>OpenSSL::PKey.read</code></a> which can parse keys of any kinds.</p>

<p>The <a href="DH.html#method-c-new"><code>DH.new</code></a>(size [, generator]) form is an alias of <a href="DH.html#method-c-generate"><code>DH.generate</code></a>.</p>
<dl class="rdoc-list note-list"><dt><code>string</code>
<dd>
<p>A <a href="../../String.html"><code>String</code></a> that contains the DER or PEM encoded key.</p>
</dd><dt><code>size</code>
<dd>
<p>See <a href="DH.html#method-c-generate"><code>DH.generate</code></a>.</p>
</dd><dt><code>generator</code>
<dd>
<p>See <a href="DH.html#method-c-generate"><code>DH.generate</code></a>.</p>
</dd></dl>

<p>Examples:</p>

<pre><code># Creating an instance from scratch
# Note that this is deprecated and will not work on OpenSSL 3.0 or later.
dh = OpenSSL::PKey::DH.new
dh.set_pqg(bn_p, nil, bn_g)

# Generating a parameters and a key pair
dh = OpenSSL::PKey::DH.new(2048) # An alias of OpenSSL::PKey::DH.generate(2048)

# Reading DH parameters
dh_params = OpenSSL::PKey::DH.new(File.read(&#39;parameters.pem&#39;)) # loads parameters only
dh = OpenSSL::PKey.generate_key(dh_params) # generates a key pair
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_initialize(int argc, VALUE *argv, VALUE self)
{
    EVP_PKEY *pkey;
    int type;
    DH *dh;
    BIO *in = NULL;
    VALUE arg;

    TypedData_Get_Struct(self, EVP_PKEY, &amp;ossl_evp_pkey_type, pkey);
    if (pkey)
        rb_raise(rb_eTypeError, &quot;pkey already initialized&quot;);

    /* The DH.new(size, generator) form is handled by lib/openssl/pkey.rb */
    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg) == 0) {
        dh = DH_new();
        if (!dh)
            ossl_raise(eDHError, &quot;DH_new&quot;);
        goto legacy;
    }

    arg = ossl_to_der_if_possible(arg);
    in = ossl_obj2bio(&amp;arg);

    /*
     * On OpenSSL &lt;= 1.1.1 and current versions of LibreSSL, the generic
     * routine does not support DER-encoded parameters
     */
    dh = d2i_DHparams_bio(in, NULL);
    if (dh)
        goto legacy;
    OSSL_BIO_reset(in);

    pkey = ossl_pkey_read_generic(in, Qnil);
    BIO_free(in);
    if (!pkey)
        ossl_raise(eDHError, &quot;could not parse pkey&quot;);

    type = EVP_PKEY_base_id(pkey);
    if (type != EVP_PKEY_DH) {
        EVP_PKEY_free(pkey);
        rb_raise(eDHError, &quot;incorrect pkey type: %s&quot;, OBJ_nid2sn(type));
    }
    RTYPEDDATA_DATA(self) = pkey;
    return self;

  legacy:
    BIO_free(in);
    pkey = EVP_PKEY_new();
    if (!pkey || EVP_PKEY_assign_DH(pkey, dh) != 1) {
        EVP_PKEY_free(pkey);
        DH_free(dh);
        ossl_raise(eDHError, &quot;EVP_PKEY_assign_DH&quot;);
    }
    RTYPEDDATA_DATA(self) = pkey;
    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-compute_key">
            
              <b>dh.compute_key(pub_bn) &rarr; string
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-compute_key" name="method-i-compute_key" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns a <a href="../../String.html"><code>String</code></a> containing a shared secret computed from the other party’s public value.</p>

<p>This method is provided for backwards compatibility, and calls <a href="PKey.html#method-i-derive"><code>derive</code></a> internally.</p>

<h3 id="method-i-compute_key-label-Parameters">Parameters</h3>
<ul><li>
<p><em>pub_bn</em> is a <a href="../BN.html"><code>OpenSSL::BN</code></a>, <strong>not</strong> the <a href="DH.html"><code>DH</code></a> instance returned by <a href="DH.html#method-i-public_key"><code>DH#public_key</code></a> as that contains the <a href="DH.html"><code>DH</code></a> parameters only.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-compute_key_source')" id="l_method-i-compute_key_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/ext/openssl/lib/openssl/pkey.rb#L49" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-compute_key_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/pkey.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compute_key</span>(<span class="ruby-identifier">pub_bn</span>)
  <span class="ruby-comment"># FIXME: This is constructing an X.509 SubjectPublicKeyInfo and is very</span>
  <span class="ruby-comment"># inefficient</span>
  <span class="ruby-identifier">obj</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Sequence</span>([
    <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Sequence</span>([
      <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">ObjectId</span>(<span class="ruby-string">&quot;dhKeyAgreement&quot;</span>),
      <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Sequence</span>([
        <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">p</span>),
        <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">g</span>),
      ]),
    ]),
    <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">BitString</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">ASN1</span>.<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">pub_bn</span>).<span class="ruby-identifier">to_der</span>),
  ])
  <span class="ruby-identifier">derive</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_der</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-export">
            
              <b>dh.export &rarr; aString</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-export" name="method-i-export" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Serializes the <a href="DH.html"><code>DH</code></a> parameters to a PEM-encoding.</p>

<p>Note that any existing per-session public/private keys will <strong>not</strong> get encoded, just the Diffie-Hellman parameters will be encoded.</p>

<p>PEM-encoded parameters will look like:</p>

<pre><code>-----BEGIN DH PARAMETERS-----
[...]
-----END DH PARAMETERS-----
</code></pre>

<p>See also <a href="PKey.html#method-i-public_to_pem"><code>public_to_pem</code></a> (X.509 SubjectPublicKeyInfo) and <a href="PKey.html#method-i-private_to_pem"><code>private_to_pem</code></a> (PKCS #8 PrivateKeyInfo or EncryptedPrivateKeyInfo) for serialization with the private or public key components.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="DH.html#method-i-to_pem">to_pem</a>, <a href="DH.html#method-i-to_s">to_s</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-export_source')" id="l_method-i-export_source">show</a>
                
              </p>
              <div id="method-i-export_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_export(VALUE self)
{
    OSSL_3_const DH *dh;
    BIO *out;
    VALUE str;

    GetDH(self, dh);
    if (!(out = BIO_new(BIO_s_mem()))) {
        ossl_raise(eDHError, NULL);
    }
    if (!PEM_write_bio_DHparams(out, dh)) {
        BIO_free(out);
        ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-generate_key-21">
            
              <b>dh.generate_key! &rarr; self
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-generate_key-21" name="method-i-generate_key-21" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generates a private and public key unless a private key already exists. If this <a href="DH.html"><code>DH</code></a> instance was generated from public DH parameters (e.g. by encoding the result of <a href="DH.html#method-i-public_key"><code>DH#public_key</code></a>), then this method needs to be called first in order to generate the per-session keys before performing the actual key exchange.</p>

<p><strong>Deprecated in version 3.0</strong>. This method is incompatible with <a href="../../OpenSSL.html"><code>OpenSSL</code></a> 3.0.0 or later.</p>

<p>See also <a href="../PKey.html#method-c-generate_key"><code>OpenSSL::PKey.generate_key</code></a>.</p>

<p>Example:</p>

<pre><code># DEPRECATED USAGE: This will not work on OpenSSL 3.0 or later
dh0 = OpenSSL::PKey::DH.new(2048)
dh = dh0.public_key # #public_key only copies the DH parameters (contrary to the name)
dh.generate_key!
puts dh.private? # =&gt; true
puts dh0.pub_key == dh.pub_key #=&gt; false

# With OpenSSL::PKey.generate_key
dh0 = OpenSSL::PKey::DH.new(2048)
dh = OpenSSL::PKey.generate_key(dh0)
puts dh0.pub_key == dh.pub_key #=&gt; false
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-generate_key-21_source')" id="l_method-i-generate_key-21_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/ext/openssl/lib/openssl/pkey.rb#L91" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-generate_key-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/pkey.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">generate_key!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">OPENSSL_VERSION_NUMBER</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0x30000000</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">DHError</span>, <span class="ruby-string">&quot;OpenSSL::PKey::DH is immutable on OpenSSL 3.0; &quot;</span> \
    <span class="ruby-string">&quot;use OpenSSL::PKey.generate_key instead&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">priv_key</span>
    <span class="ruby-identifier">tmp</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span>.<span class="ruby-identifier">generate_key</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-identifier">set_key</span>(<span class="ruby-identifier">tmp</span>.<span class="ruby-identifier">pub_key</span>, <span class="ruby-identifier">tmp</span>.<span class="ruby-identifier">priv_key</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-initialize_copy">
            
              <b>initialize_copy</b>(p1)
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-initialize_copy" name="method-i-initialize_copy" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-initialize_copy_source')" id="l_method-i-initialize_copy_source">show</a>
                
              </p>
              <div id="method-i-initialize_copy_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_initialize_copy(VALUE self, VALUE other)
{
    EVP_PKEY *pkey;
    DH *dh, *dh_other;
    const BIGNUM *pub, *priv;

    TypedData_Get_Struct(self, EVP_PKEY, &amp;ossl_evp_pkey_type, pkey);
    if (pkey)
        rb_raise(rb_eTypeError, &quot;pkey already initialized&quot;);
    GetDH(other, dh_other);

    dh = DHparams_dup(dh_other);
    if (!dh)
        ossl_raise(eDHError, &quot;DHparams_dup&quot;);

    DH_get0_key(dh_other, &amp;pub, &amp;priv);
    if (pub) {
        BIGNUM *pub2 = BN_dup(pub);
        BIGNUM *priv2 = BN_dup(priv);

        if (!pub2 || (priv &amp;&amp; !priv2)) {
            BN_clear_free(pub2);
            BN_clear_free(priv2);
            ossl_raise(eDHError, &quot;BN_dup&quot;);
        }
        DH_set0_key(dh, pub2, priv2);
    }

    pkey = EVP_PKEY_new();
    if (!pkey || EVP_PKEY_assign_DH(pkey, dh) != 1) {
        EVP_PKEY_free(pkey);
        DH_free(dh);
        ossl_raise(eDHError, &quot;EVP_PKEY_assign_DH&quot;);
    }
    RTYPEDDATA_DATA(self) = pkey;
    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-params">
            
              <b>dh.params &rarr; hash
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-params" name="method-i-params" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Stores all parameters of key to the hash INSECURE: PRIVATE INFORMATIONS CAN LEAK OUT!!! Don’t use :-)) (I’s up to you)</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-params_source')" id="l_method-i-params_source">show</a>
                
              </p>
              <div id="method-i-params_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_get_params(VALUE self)
{
    OSSL_3_const DH *dh;
    VALUE hash;
    const BIGNUM *p, *q, *g, *pub_key, *priv_key;

    GetDH(self, dh);
    DH_get0_pqg(dh, &amp;p, &amp;q, &amp;g);
    DH_get0_key(dh, &amp;pub_key, &amp;priv_key);

    hash = rb_hash_new();
    rb_hash_aset(hash, rb_str_new2(&quot;p&quot;), ossl_bn_new(p));
    rb_hash_aset(hash, rb_str_new2(&quot;q&quot;), ossl_bn_new(q));
    rb_hash_aset(hash, rb_str_new2(&quot;g&quot;), ossl_bn_new(g));
    rb_hash_aset(hash, rb_str_new2(&quot;pub_key&quot;), ossl_bn_new(pub_key));
    rb_hash_aset(hash, rb_str_new2(&quot;priv_key&quot;), ossl_bn_new(priv_key));

    return hash;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-params_ok-3F">
            
              <b>dh.params_ok? &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-params_ok-3F" name="method-i-params_ok-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Validates the Diffie-Hellman parameters associated with this instance. It checks whether a safe prime and a suitable generator are used. If this is not the case, <code>false</code> is returned.</p>

<p>See also the man page EVP_PKEY_param_check(3).</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-params_ok-3F_source')" id="l_method-i-params_ok-3F_source">show</a>
                
              </p>
              <div id="method-i-params_ok-3F_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_check_params(VALUE self)
{
    int ret;
#ifdef HAVE_EVP_PKEY_CHECK
    EVP_PKEY *pkey;
    EVP_PKEY_CTX *pctx;

    GetPKey(self, pkey);
    pctx = EVP_PKEY_CTX_new(pkey, /* engine */NULL);
    if (!pctx)
        ossl_raise(eDHError, &quot;EVP_PKEY_CTX_new&quot;);
    ret = EVP_PKEY_param_check(pctx);
    EVP_PKEY_CTX_free(pctx);
#else
    DH *dh;
    int codes;

    GetDH(self, dh);
    ret = DH_check(dh, &amp;codes) == 1 &amp;&amp; codes == 0;
#endif

    if (ret == 1)
        return Qtrue;
    else {
        /* DH_check_ex() will put error entry on failure */
        ossl_clear_error();
        return Qfalse;
    }
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-private-3F">
            
              <b>dh.private? &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-private-3F" name="method-i-private-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Indicates whether this <a href="DH.html"><code>DH</code></a> instance has a private key associated with it or not. The private key may be retrieved with DH#priv_key.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-private-3F_source')" id="l_method-i-private-3F_source">show</a>
                
              </p>
              <div id="method-i-private-3F_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_is_private(VALUE self)
{
    OSSL_3_const DH *dh;
    const BIGNUM *bn;

    GetDH(self, dh);
    DH_get0_key(dh, NULL, &amp;bn);

#if !defined(OPENSSL_NO_ENGINE)
    return (bn || DH_get0_engine((DH *)dh)) ? Qtrue : Qfalse;
#else
    return bn ? Qtrue : Qfalse;
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-public-3F">
            
              <b>dh.public? &rarr; true | false
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-public-3F" name="method-i-public-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Indicates whether this <a href="DH.html"><code>DH</code></a> instance has a public key associated with it or not. The public key may be retrieved with DH#pub_key.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-public-3F_source')" id="l_method-i-public-3F_source">show</a>
                
              </p>
              <div id="method-i-public-3F_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_is_public(VALUE self)
{
    OSSL_3_const DH *dh;
    const BIGNUM *bn;

    GetDH(self, dh);
    DH_get0_key(dh, &amp;bn, NULL);

    return bn ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-public_key">
            
              <b>dh.public_key &rarr; dhnew
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-public_key" name="method-i-public_key" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns a new <a href="DH.html"><code>DH</code></a> instance that carries just the DH parameters.</p>

<p>Contrary to the method name, the returned <a href="DH.html"><code>DH</code></a> object contains only parameters and not the public key.</p>

<p>This method is provided for backwards compatibility. In most cases, there is no need to call this method.</p>

<p>For the purpose of re-generating the key pair while keeping the parameters, check <a href="../PKey.html#method-c-generate_key"><code>OpenSSL::PKey.generate_key</code></a>.</p>

<p>Example:</p>

<pre><code># OpenSSL::PKey::DH.generate by default generates a random key pair
dh1 = OpenSSL::PKey::DH.generate(2048)
p dh1.priv_key #=&gt; #&lt;OpenSSL::BN 1288347...&gt;
dhcopy = dh1.public_key
p dhcopy.priv_key #=&gt; nil
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-public_key_source')" id="l_method-i-public_key_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/ext/openssl/lib/openssl/pkey.rb#L33" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-public_key_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/pkey.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">public_key</span>
  <span class="ruby-constant">DH</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">to_der</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_key">
            
              <b>dh.set_key(pub_key, priv_key) &rarr; self
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-set_key" name="method-i-set_key" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets <em>pub_key</em> and <em>priv_key</em> for the <a href="DH.html"><code>DH</code></a> instance. <em>priv_key</em> may be <code>nil</code>.</p>
            </div>
          

          

          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-set_pqg">
            
              <b>dh.set_pqg(p, q, g) &rarr; self
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-set_pqg" name="method-i-set_pqg" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Sets <em>p</em>, <em>q</em>, <em>g</em> to the <a href="DH.html"><code>DH</code></a> instance.</p>
            </div>
          

          

          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_der">
            
              <b>dh.to_der &rarr; aString
</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-to_der" name="method-i-to_der" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Serializes the <a href="DH.html"><code>DH</code></a> parameters to a DER-encoding</p>

<p>Note that any existing per-session public/private keys will <strong>not</strong> get encoded, just the Diffie-Hellman parameters will be encoded.</p>

<p>See also <a href="PKey.html#method-i-public_to_der"><code>public_to_der</code></a> (X.509 SubjectPublicKeyInfo) and <a href="PKey.html#method-i-private_to_der"><code>private_to_der</code></a> (PKCS #8 PrivateKeyInfo or EncryptedPrivateKeyInfo) for serialization with the private or public key components.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-to_der_source')" id="l_method-i-to_der_source">show</a>
                
              </p>
              <div id="method-i-to_der_source" class="dyn-source">
                <pre>static VALUE
ossl_dh_to_der(VALUE self)
{
    OSSL_3_const DH *dh;
    unsigned char *p;
    long len;
    VALUE str;

    GetDH(self, dh);
    if((len = i2d_DHparams(dh, NULL)) &lt;= 0)
        ossl_raise(eDHError, NULL);
    str = rb_str_new(0, len);
    p = (unsigned char *)RSTRING_PTR(str);
    if(i2d_DHparams(dh, &amp;p) &lt; 0)
        ossl_raise(eDHError, NULL);
    ossl_str_adjust(str, p);

    return str;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_pem">
            
              <b>dh.to_pem &rarr; aString</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-to_pem" name="method-i-to_pem" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Serializes the <a href="DH.html"><code>DH</code></a> parameters to a PEM-encoding.</p>

<p>Note that any existing per-session public/private keys will <strong>not</strong> get encoded, just the Diffie-Hellman parameters will be encoded.</p>

<p>PEM-encoded parameters will look like:</p>

<pre><code>-----BEGIN DH PARAMETERS-----
[...]
-----END DH PARAMETERS-----
</code></pre>

<p>See also <a href="PKey.html#method-i-public_to_pem"><code>public_to_pem</code></a> (X.509 SubjectPublicKeyInfo) and <a href="PKey.html#method-i-private_to_pem"><code>private_to_pem</code></a> (PKCS #8 PrivateKeyInfo or EncryptedPrivateKeyInfo) for serialization with the private or public key components.</p>
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="DH.html#method-i-export">export</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-to_s">
            
              <b>dh.to_s &rarr; aString</b>
            
            <a href="../../../classes/OpenSSL/PKey/DH.html#method-i-to_s" name="method-i-to_s" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Serializes the <a href="DH.html"><code>DH</code></a> parameters to a PEM-encoding.</p>

<p>Note that any existing per-session public/private keys will <strong>not</strong> get encoded, just the Diffie-Hellman parameters will be encoded.</p>

<p>PEM-encoded parameters will look like:</p>

<pre><code>-----BEGIN DH PARAMETERS-----
[...]
-----END DH PARAMETERS-----
</code></pre>

<p>See also <a href="PKey.html#method-i-public_to_pem"><code>public_to_pem</code></a> (X.509 SubjectPublicKeyInfo) and <a href="PKey.html#method-i-private_to_pem"><code>private_to_pem</code></a> (PKCS #8 PrivateKeyInfo or EncryptedPrivateKeyInfo) for serialization with the private or public key components.</p>
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="DH.html#method-i-export">export</a>
            </div>
          

          
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
