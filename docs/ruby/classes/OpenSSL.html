<!DOCTYPE html>
<html lang="en">
<head>
    <title>OpenSSL</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["OpenSSL"]'>


    <meta property="og:title" value="OpenSSL">

  
    
    <meta name="description" content="OpenSSL provides SSL, TLS and general purpose cryptography.  It wraps the OpenSSL library.">
    <meta property="og:description" content="OpenSSL provides SSL, TLS and general purpose cryptography.  It wraps the OpenSSL library.">
  

    <meta name="keywords" content="OpenSSL class, secure_compare, Digest, fixed_length_secure_compare, fips_mode, fips_mode=, debug, debug=, errors">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Module</span>
            OpenSSL
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl_rb.html">ruby/ext/openssl/lib/openssl.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/bn_rb.html">ruby/ext/openssl/lib/openssl/bn.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/buffering_rb.html">ruby/ext/openssl/lib/openssl/buffering.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/cipher_rb.html">ruby/ext/openssl/lib/openssl/cipher.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/digest_rb.html">ruby/ext/openssl/lib/openssl/digest.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/hmac_rb.html">ruby/ext/openssl/lib/openssl/hmac.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/marshal_rb.html">ruby/ext/openssl/lib/openssl/marshal.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/pkcs5_rb.html">ruby/ext/openssl/lib/openssl/pkcs5.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/pkey_rb.html">ruby/ext/openssl/lib/openssl/pkey.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/ssl_rb.html">ruby/ext/openssl/lib/openssl/ssl.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/version_rb.html">ruby/ext/openssl/lib/openssl/version.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/lib/openssl/x509_rb.html">ruby/ext/openssl/lib/openssl/x509.rb</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_c.html">ruby/ext/openssl/ossl.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_asn1_c.html">ruby/ext/openssl/ossl_asn1.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_bn_c.html">ruby/ext/openssl/ossl_bn.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_cipher_c.html">ruby/ext/openssl/ossl_cipher.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_config_c.html">ruby/ext/openssl/ossl_config.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_digest_c.html">ruby/ext/openssl/ossl_digest.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_engine_c.html">ruby/ext/openssl/ossl_engine.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_hmac_c.html">ruby/ext/openssl/ossl_hmac.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_kdf_c.html">ruby/ext/openssl/ossl_kdf.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_ns_spki_c.html">ruby/ext/openssl/ossl_ns_spki.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_ocsp_c.html">ruby/ext/openssl/ossl_ocsp.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_pkcs12_c.html">ruby/ext/openssl/ossl_pkcs12.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_pkcs7_c.html">ruby/ext/openssl/ossl_pkcs7.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_pkey_c.html">ruby/ext/openssl/ossl_pkey.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_rand_c.html">ruby/ext/openssl/ossl_rand.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_ssl_c.html">ruby/ext/openssl/ossl_ssl.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_ssl_session_c.html">ruby/ext/openssl/ossl_ssl_session.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_ts_c.html">ruby/ext/openssl/ossl_ts.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509_c.html">ruby/ext/openssl/ossl_x509.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509attr_c.html">ruby/ext/openssl/ossl_x509attr.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509cert_c.html">ruby/ext/openssl/ossl_x509cert.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509crl_c.html">ruby/ext/openssl/ossl_x509crl.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509ext_c.html">ruby/ext/openssl/ossl_x509ext.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509name_c.html">ruby/ext/openssl/ossl_x509name.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509req_c.html">ruby/ext/openssl/ossl_x509req.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509revoked_c.html">ruby/ext/openssl/ossl_x509revoked.c</a></li>
            
            <li><a href="../files/ruby/ext/openssl/ossl_x509store_c.html">ruby/ext/openssl/ossl_x509store.c</a></li>
            
            <li><a href="../files/ruby/lib/drb/ssl_rb.html">ruby/lib/drb/ssl.rb</a></li>
            
            <li><a href="../files/ruby/lib/net/http_rb.html">ruby/lib/net/http.rb</a></li>
            
            <li><a href="../files/ruby/lib/open-uri_rb.html">ruby/lib/open-uri.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/commands/cert_command_rb.html">ruby/lib/rubygems/commands/cert_command.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/request_rb.html">ruby/lib/rubygems/request.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/s3_uri_signer_rb.html">ruby/lib/rubygems/s3_uri_signer.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/security_rb.html">ruby/lib/rubygems/security.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/security/policy_rb.html">ruby/lib/rubygems/security/policy.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/security/signer_rb.html">ruby/lib/rubygems/security/signer.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/security/trust_dir_rb.html">ruby/lib/rubygems/security/trust_dir.rb</a></li>
            
            <li><a href="../files/ruby/lib/rubygems/source/git_rb.html">ruby/lib/rubygems/source/git.rb</a></li>
            
            <li><a href="../files/ruby/lib/securerandom_rb.html">ruby/lib/securerandom.rb</a></li>
            
            <li><a href="../files/ruby/lib/un_rb.html">ruby/lib/un.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="OpenSSL.html"><code>OpenSSL</code></a> provides <a href="OpenSSL/SSL.html"><code>SSL</code></a>, TLS and general purpose cryptography.  It wraps the <a href="https://www.openssl.org/">OpenSSL</a> library.</p>

<h1 id="module-OpenSSL-label-Examples">Examples</h1>

<p>All examples assume you have loaded <a href="OpenSSL.html"><code>OpenSSL</code></a> with:</p>

<pre><code>require &#39;openssl&#39;
</code></pre>

<p>These examples build atop each other.  For example the key created in the next is used in throughout these examples.</p>

<h2 id="module-OpenSSL-label-Keys">Keys</h2>

<h3 id="module-OpenSSL-label-Creating+a+Key">Creating a Key</h3>

<p>This example creates a 2048 bit RSA keypair and writes it to the current directory.</p>

<pre><code>key = OpenSSL::PKey::RSA.new 2048

File.write &#39;private_key.pem&#39;, key.private_to_pem
File.write &#39;public_key.pem&#39;, key.public_to_pem
</code></pre>

<h3 id="module-OpenSSL-label-Exporting+a+Key">Exporting a Key</h3>

<p>Keys saved to disk without encryption are not secure as anyone who gets ahold of the key may use it unless it is encrypted.  In order to securely export a key you may export it with a password.</p>

<pre><code>cipher = OpenSSL::Cipher.new &#39;aes-256-cbc&#39;
password = &#39;my secure password goes here&#39;

key_secure = key.private_to_pem cipher, password

File.write &#39;private.secure.pem&#39;, key_secure
</code></pre>

<p><a href="OpenSSL/Cipher.html#method-c-ciphers"><code>OpenSSL::Cipher.ciphers</code></a> returns a list of available ciphers.</p>

<h3 id="module-OpenSSL-label-Loading+a+Key">Loading a Key</h3>

<p>A key can also be loaded from a file.</p>

<pre><code>key2 = OpenSSL::PKey.read File.read &#39;private_key.pem&#39;
key2.public? # =&gt; true
key2.private? # =&gt; true
</code></pre>

<p>or</p>

<pre><code>key3 = OpenSSL::PKey.read File.read &#39;public_key.pem&#39;
key3.public? # =&gt; true
key3.private? # =&gt; false
</code></pre>

<h3 id="module-OpenSSL-label-Loading+an+Encrypted+Key">Loading an Encrypted Key</h3>

<p><a href="OpenSSL.html"><code>OpenSSL</code></a> will prompt you for your password when loading an encrypted key. If you will not be able to type in the password you may provide it when loading the key:</p>

<pre><code>key4_pem = File.read &#39;private.secure.pem&#39;
password = &#39;my secure password goes here&#39;
key4 = OpenSSL::PKey.read key4_pem, password
</code></pre>

<h2 id="module-OpenSSL-label-RSA+Encryption">RSA Encryption</h2>

<p>RSA provides encryption and decryption using the public and private keys. You can use a variety of padding methods depending upon the intended use of encrypted data.</p>

<h3 id="module-OpenSSL-label-Encryption+-26+Decryption">Encryption &amp; Decryption</h3>

<p>Asymmetric public/private key encryption is slow and victim to attack in cases where it is used without padding or directly to encrypt larger chunks of data. Typical use cases for RSA encryption involve “wrapping” a symmetric key with the public key of the recipient who would “unwrap” that symmetric key again using their private key. The following illustrates a simplified example of such a key transport scheme. It shouldn’t be used in practice, though, standardized protocols should always be preferred.</p>

<pre><code>wrapped_key = key.public_encrypt key
</code></pre>

<p>A symmetric key encrypted with the public key can only be decrypted with the corresponding private key of the recipient.</p>

<pre><code>original_key = key.private_decrypt wrapped_key
</code></pre>

<p>By default PKCS#1 padding will be used, but it is also possible to use other forms of padding, see <a href="OpenSSL/PKey/RSA.html"><code>PKey::RSA</code></a> for further details.</p>

<h3 id="module-OpenSSL-label-Signatures">Signatures</h3>

<p>Using “private_encrypt” to encrypt some data with the private key is equivalent to applying a digital signature to the data. A verifying party may validate the signature by comparing the result of decrypting the signature with “public_decrypt” to the original data. However, <a href="OpenSSL/PKey.html"><code>OpenSSL::PKey</code></a> already has methods “sign” and “verify” that handle digital signatures in a standardized way - “private_encrypt” and “public_decrypt” shouldn’t be used in practice.</p>

<p>To sign a document, a cryptographically secure hash of the document is computed first, which is then signed using the private key.</p>

<pre><code>signature = key.sign &#39;SHA256&#39;, document
</code></pre>

<p>To validate the signature, again a hash of the document is computed and the signature is decrypted using the public key. The result is then compared to the hash just computed, if they are equal the signature was valid.</p>

<pre><code>if key.verify &#39;SHA256&#39;, signature, document
  puts &#39;Valid&#39;
else
  puts &#39;Invalid&#39;
end
</code></pre>

<h2 id="module-OpenSSL-label-PBKDF2+Password-based+Encryption">PBKDF2 Password-based Encryption</h2>

<p>If supported by the underlying <a href="OpenSSL.html"><code>OpenSSL</code></a> version used, Password-based Encryption should use the features of <a href="OpenSSL/PKCS5.html"><code>PKCS5</code></a>. If not supported or if required by legacy applications, the older, less secure methods specified in RFC 2898 are also supported (see below).</p>

<p><a href="OpenSSL/PKCS5.html"><code>PKCS5</code></a> supports PBKDF2 as it was specified in PKCS#5 <a href="http://www.rsa.com/rsalabs/node.asp?id=2127">v2.0</a>. It still uses a password, a salt, and additionally a number of iterations that will slow the key derivation process down. The slower this is, the more work it requires being able to brute-force the resulting key.</p>

<h3 id="module-OpenSSL-label-Encryption">Encryption</h3>

<p>The strategy is to first instantiate a <a href="OpenSSL/Cipher.html"><code>Cipher</code></a> for encryption, and then to generate a random IV plus a key derived from the password using PBKDF2. PKCS #5 v2.0 recommends at least 8 bytes for the salt, the number of iterations largely depends on the hardware being used.</p>

<pre><code>cipher = OpenSSL::Cipher.new &#39;aes-256-cbc&#39;
cipher.encrypt
iv = cipher.random_iv

pwd = &#39;some hopefully not to easily guessable password&#39;
salt = OpenSSL::Random.random_bytes 16
iter = 20000
key_len = cipher.key_len
digest = OpenSSL::Digest.new(&#39;SHA256&#39;)

key = OpenSSL::PKCS5.pbkdf2_hmac(pwd, salt, iter, key_len, digest)
cipher.key = key

Now encrypt the data:

encrypted = cipher.update document
encrypted &lt;&lt; cipher.final
</code></pre>

<h3 id="module-OpenSSL-label-Decryption">Decryption</h3>

<p>Use the same steps as before to derive the symmetric AES key, this time setting the <a href="OpenSSL/Cipher.html"><code>Cipher</code></a> up for decryption.</p>

<pre><code>cipher = OpenSSL::Cipher.new &#39;aes-256-cbc&#39;
cipher.decrypt
cipher.iv = iv # the one generated with #random_iv

pwd = &#39;some hopefully not to easily guessable password&#39;
salt = ... # the one generated above
iter = 20000
key_len = cipher.key_len
digest = OpenSSL::Digest.new(&#39;SHA256&#39;)

key = OpenSSL::PKCS5.pbkdf2_hmac(pwd, salt, iter, key_len, digest)
cipher.key = key

Now decrypt the data:

decrypted = cipher.update encrypted
decrypted &lt;&lt; cipher.final
</code></pre>

<h2 id="module-OpenSSL-label-X509+Certificates"><a href="OpenSSL/X509.html"><code>X509</code></a> Certificates</h2>

<h3 id="module-OpenSSL-label-Creating+a+Certificate">Creating a Certificate</h3>

<p>This example creates a self-signed certificate using an RSA key and a SHA1 signature.</p>

<pre><code>key = OpenSSL::PKey::RSA.new 2048
name = OpenSSL::X509::Name.parse &#39;/CN=nobody/DC=example&#39;

cert = OpenSSL::X509::Certificate.new
cert.version = 2
cert.serial = 0
cert.not_before = Time.now
cert.not_after = Time.now + 3600

cert.public_key = key.public_key
cert.subject = name
</code></pre>

<h3 id="module-OpenSSL-label-Certificate+Extensions">Certificate Extensions</h3>

<p>You can add extensions to the certificate with OpenSSL::SSL::ExtensionFactory to indicate the purpose of the certificate.</p>

<pre><code>extension_factory = OpenSSL::X509::ExtensionFactory.new nil, cert

cert.add_extension \
  extension_factory.create_extension(&#39;basicConstraints&#39;, &#39;CA:FALSE&#39;, true)

cert.add_extension \
  extension_factory.create_extension(
    &#39;keyUsage&#39;, &#39;keyEncipherment,dataEncipherment,digitalSignature&#39;)

cert.add_extension \
  extension_factory.create_extension(&#39;subjectKeyIdentifier&#39;, &#39;hash&#39;)
</code></pre>

<p>The list of supported extensions (and in some cases their possible values) can be derived from the “objects.h” file in the <a href="OpenSSL.html"><code>OpenSSL</code></a> source code.</p>

<h3 id="module-OpenSSL-label-Signing+a+Certificate">Signing a Certificate</h3>

<p>To sign a certificate set the issuer and use <a href="OpenSSL/X509/Certificate.html#method-i-sign"><code>OpenSSL::X509::Certificate#sign</code></a> with a digest algorithm.  This creates a self-signed cert because we’re using the same name and key to sign the certificate as was used to create the certificate.</p>

<pre><code>cert.issuer = name
cert.sign key, OpenSSL::Digest.new(&#39;SHA1&#39;)

open &#39;certificate.pem&#39;, &#39;w&#39; do |io| io.write cert.to_pem end
</code></pre>

<h3 id="module-OpenSSL-label-Loading+a+Certificate">Loading a Certificate</h3>

<p>Like a key, a cert can also be loaded from a file.</p>

<pre><code>cert2 = OpenSSL::X509::Certificate.new File.read &#39;certificate.pem&#39;
</code></pre>

<h3 id="module-OpenSSL-label-Verifying+a+Certificate">Verifying a Certificate</h3>

<p>Certificate#verify will return true when a certificate was signed with the given public key.</p>

<pre><code>raise &#39;certificate can not be verified&#39; unless cert2.verify key
</code></pre>

<h2 id="module-OpenSSL-label-Certificate+Authority">Certificate Authority</h2>

<p>A certificate authority (CA) is a trusted third party that allows you to verify the ownership of unknown certificates.  The CA issues key signatures that indicate it trusts the user of that key.  A user encountering the key can verify the signature by using the CA’s public key.</p>

<h3 id="module-OpenSSL-label-CA+Key">CA Key</h3>

<p>CA keys are valuable, so we encrypt and save it to disk and make sure it is not readable by other users.</p>

<pre><code>ca_key = OpenSSL::PKey::RSA.new 2048
password = &#39;my secure password goes here&#39;

cipher = &#39;aes-256-cbc&#39;

open &#39;ca_key.pem&#39;, &#39;w&#39;, 0400 do |io|
  io.write ca_key.private_to_pem(cipher, password)
end
</code></pre>

<h3 id="module-OpenSSL-label-CA+Certificate">CA Certificate</h3>

<p>A CA certificate is created the same way we created a certificate above, but with different extensions.</p>

<pre><code>ca_name = OpenSSL::X509::Name.parse &#39;/CN=ca/DC=example&#39;

ca_cert = OpenSSL::X509::Certificate.new
ca_cert.serial = 0
ca_cert.version = 2
ca_cert.not_before = Time.now
ca_cert.not_after = Time.now + 86400

ca_cert.public_key = ca_key.public_key
ca_cert.subject = ca_name
ca_cert.issuer = ca_name

extension_factory = OpenSSL::X509::ExtensionFactory.new
extension_factory.subject_certificate = ca_cert
extension_factory.issuer_certificate = ca_cert

ca_cert.add_extension \
  extension_factory.create_extension(&#39;subjectKeyIdentifier&#39;, &#39;hash&#39;)
</code></pre>

<p>This extension indicates the CA’s key may be used as a CA.</p>

<pre><code>ca_cert.add_extension \
  extension_factory.create_extension(&#39;basicConstraints&#39;, &#39;CA:TRUE&#39;, true)
</code></pre>

<p>This extension indicates the CA’s key may be used to verify signatures on both certificates and certificate revocations.</p>

<pre><code>ca_cert.add_extension \
  extension_factory.create_extension(
    &#39;keyUsage&#39;, &#39;cRLSign,keyCertSign&#39;, true)
</code></pre>

<p>Root CA certificates are self-signed.</p>

<pre><code>ca_cert.sign ca_key, OpenSSL::Digest.new(&#39;SHA1&#39;)
</code></pre>

<p>The CA certificate is saved to disk so it may be distributed to all the users of the keys this CA will sign.</p>

<pre><code>open &#39;ca_cert.pem&#39;, &#39;w&#39; do |io|
  io.write ca_cert.to_pem
end
</code></pre>

<h3 id="module-OpenSSL-label-Certificate+Signing+Request">Certificate Signing Request</h3>

<p>The CA signs keys through a Certificate Signing Request (CSR).  The CSR contains the information necessary to identify the key.</p>

<pre><code>csr = OpenSSL::X509::Request.new
csr.version = 0
csr.subject = name
csr.public_key = key.public_key
csr.sign key, OpenSSL::Digest.new(&#39;SHA1&#39;)
</code></pre>

<p>A CSR is saved to disk and sent to the CA for signing.</p>

<pre><code>open &#39;csr.pem&#39;, &#39;w&#39; do |io|
  io.write csr.to_pem
end
</code></pre>

<h3 id="module-OpenSSL-label-Creating+a+Certificate+from+a+CSR">Creating a Certificate from a CSR</h3>

<p>Upon receiving a CSR the CA will verify it before signing it.  A minimal verification would be to check the CSR’s signature.</p>

<pre><code>csr = OpenSSL::X509::Request.new File.read &#39;csr.pem&#39;

raise &#39;CSR can not be verified&#39; unless csr.verify csr.public_key
</code></pre>

<p>After verification a certificate is created, marked for various usages, signed with the CA key and returned to the requester.</p>

<pre><code>csr_cert = OpenSSL::X509::Certificate.new
csr_cert.serial = 0
csr_cert.version = 2
csr_cert.not_before = Time.now
csr_cert.not_after = Time.now + 600

csr_cert.subject = csr.subject
csr_cert.public_key = csr.public_key
csr_cert.issuer = ca_cert.subject

extension_factory = OpenSSL::X509::ExtensionFactory.new
extension_factory.subject_certificate = csr_cert
extension_factory.issuer_certificate = ca_cert

csr_cert.add_extension \
  extension_factory.create_extension(&#39;basicConstraints&#39;, &#39;CA:FALSE&#39;)

csr_cert.add_extension \
  extension_factory.create_extension(
    &#39;keyUsage&#39;, &#39;keyEncipherment,dataEncipherment,digitalSignature&#39;)

csr_cert.add_extension \
  extension_factory.create_extension(&#39;subjectKeyIdentifier&#39;, &#39;hash&#39;)

csr_cert.sign ca_key, OpenSSL::Digest.new(&#39;SHA1&#39;)

open &#39;csr_cert.pem&#39;, &#39;w&#39; do |io|
  io.write csr_cert.to_pem
end
</code></pre>

<h2 id="module-OpenSSL-label-SSL+and+TLS+Connections"><a href="OpenSSL/SSL.html"><code>SSL</code></a> and TLS Connections</h2>

<p>Using our created key and certificate we can create an <a href="OpenSSL/SSL.html"><code>SSL</code></a> or TLS connection. An SSLContext is used to set up an <a href="OpenSSL/SSL.html"><code>SSL</code></a> session.</p>

<pre><code>context = OpenSSL::SSL::SSLContext.new
</code></pre>

<h3 id="module-OpenSSL-label-SSL+Server"><a href="OpenSSL/SSL.html"><code>SSL</code></a> Server</h3>

<p>An <a href="OpenSSL/SSL.html"><code>SSL</code></a> server requires the certificate and private key to communicate securely with its clients:</p>

<pre><code>context.cert = cert
context.key = key
</code></pre>

<p>Then create an SSLServer with a TCP server socket and the context.  Use the SSLServer like an ordinary TCP server.</p>

<pre><code>require &#39;socket&#39;

tcp_server = TCPServer.new 5000
ssl_server = OpenSSL::SSL::SSLServer.new tcp_server, context

loop do
  ssl_connection = ssl_server.accept

  data = ssl_connection.gets

  response = &quot;I got #{data.dump}&quot;
  puts response

  ssl_connection.puts &quot;I got #{data.dump}&quot;
  ssl_connection.close
end
</code></pre>

<h3 id="module-OpenSSL-label-SSL+client"><a href="OpenSSL/SSL.html"><code>SSL</code></a> client</h3>

<p>An <a href="OpenSSL/SSL.html"><code>SSL</code></a> client is created with a TCP socket and the context. SSLSocket#connect must be called to initiate the <a href="OpenSSL/SSL.html"><code>SSL</code></a> handshake and start encryption.  A key and certificate are not required for the client socket.</p>

<p>Note that SSLSocket#close doesn’t close the underlying socket by default. <a href="Set.html"><code>Set</code></a> SSLSocket#sync_close to true if you want.</p>

<pre><code>require &#39;socket&#39;

tcp_socket = TCPSocket.new &#39;localhost&#39;, 5000
ssl_client = OpenSSL::SSL::SSLSocket.new tcp_socket, context
ssl_client.sync_close = true
ssl_client.connect

ssl_client.puts &quot;hello server!&quot;
puts ssl_client.gets

ssl_client.close # shutdown the TLS connection and close tcp_socket
</code></pre>

<h3 id="module-OpenSSL-label-Peer+Verification">Peer Verification</h3>

<p>An unverified <a href="OpenSSL/SSL.html"><code>SSL</code></a> connection does not provide much security.  For enhanced security the client or server can verify the certificate of its peer.</p>

<p>The client can be modified to verify the server’s certificate against the certificate authority’s certificate:</p>

<pre><code>context.ca_file = &#39;ca_cert.pem&#39;
context.verify_mode = OpenSSL::SSL::VERIFY_PEER

require &#39;socket&#39;

tcp_socket = TCPSocket.new &#39;localhost&#39;, 5000
ssl_client = OpenSSL::SSL::SSLSocket.new tcp_socket, context
ssl_client.connect

ssl_client.puts &quot;hello server!&quot;
puts ssl_client.gets
</code></pre>

<p>If the server certificate is invalid or <code>context.ca_file</code> is not set when verifying peers an <a href="OpenSSL/SSL/SSLError.html"><code>OpenSSL::SSL::SSLError</code></a> will be raised.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/ASN1.html">OpenSSL::ASN1</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/Buffering.html">OpenSSL::Buffering</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/KDF.html">OpenSSL::KDF</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/Marshal.html">OpenSSL::Marshal</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/Netscape.html">OpenSSL::Netscape</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/OCSP.html">OpenSSL::OCSP</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/PKCS5.html">OpenSSL::PKCS5</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/PKey.html">OpenSSL::PKey</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/Random.html">OpenSSL::Random</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/SSL.html">OpenSSL::SSL</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/Timestamp.html">OpenSSL::Timestamp</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="OpenSSL/X509.html">OpenSSL::X509</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/BN.html">OpenSSL::BN</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/BNError.html">OpenSSL::BNError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/Cipher.html">OpenSSL::Cipher</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/Config.html">OpenSSL::Config</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/ConfigError.html">OpenSSL::ConfigError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/Digest.html">OpenSSL::Digest</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/Engine.html">OpenSSL::Engine</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/HMAC.html">OpenSSL::HMAC</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/HMACError.html">OpenSSL::HMACError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/OpenSSLError.html">OpenSSL::OpenSSLError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/PKCS12.html">OpenSSL::PKCS12</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="OpenSSL/PKCS7.html">OpenSSL::PKCS7</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-Digest">Digest</a>,
              </li>
            
              
              <li>
                <a href="#method-c-debug">debug</a>,
              </li>
            
              
              <li>
                <a href="#method-c-debug-3D">debug=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-errors">errors</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-fips_mode">fips_mode</a>,
              </li>
            
              
              <li>
                <a href="#method-c-fips_mode-3D">fips_mode=</a>,
              </li>
            
              
              <li>
                <a href="#method-c-fixed_length_secure_compare">fixed_length_secure_compare</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-secure_compare">secure_compare</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">LIBRESSL_VERSION_NUMBER</td>
            <td>=</td>
            <td class="attr-value">INT2NUM(LIBRESSL_VERSION_NUMBER)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Version number of LibreSSL the ruby <a href="OpenSSL.html"><code>OpenSSL</code></a> extension was built with (base 16). The format is <code>0xMNNFF00f (major minor fix 00 status)</code>. This constant is only defined in LibreSSL cases.</p>

<p>See also the man page <a href="OpenSSL.html#LIBRESSL_VERSION_NUMBER"><code>LIBRESSL_VERSION_NUMBER</code></a>(3).</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OPENSSL_FIPS</td>
            <td>=</td>
            <td class="attr-value">/* OpenSSL 3 is FIPS-capable even when it is installed without fips option */
#if OSSL_OPENSSL_PREREQ(3, 0, 0)
                    Qtrue
#elif defined(OPENSSL_FIPS)
                    Qtrue
#else
                    Qfalse
#endif</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Boolean indicating whether <a href="OpenSSL.html"><code>OpenSSL</code></a> is FIPS-capable or not</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OPENSSL_LIBRARY_VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(OpenSSL_version(OPENSSL_VERSION))</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OPENSSL_VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(OPENSSL_VERSION_TEXT)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Version of <a href="OpenSSL.html"><code>OpenSSL</code></a> the ruby <a href="OpenSSL.html"><code>OpenSSL</code></a> extension was built with</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">OPENSSL_VERSION_NUMBER</td>
            <td>=</td>
            <td class="attr-value">INT2NUM(OPENSSL_VERSION_NUMBER)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Version number of <a href="OpenSSL.html"><code>OpenSSL</code></a> the ruby <a href="OpenSSL.html"><code>OpenSSL</code></a> extension was built with (base 16). The formats are below.</p>
<dl class="rdoc-list label-list"><dt><a href="OpenSSL.html"><code>OpenSSL</code></a> 3
<dd>
<p><code>0xMNN00PP0 (major minor 00 patch 0)</code></p>
</dd><dt><a href="OpenSSL.html"><code>OpenSSL</code></a> before 3
<dd>
<p><code>0xMNNFFPPS (major minor fix patch status)</code></p>
</dd><dt>LibreSSL
<dd>
<p><code>0x20000000 (fixed value)</code></p>
</dd></dl>

<p>See also the man page <a href="OpenSSL.html#OPENSSL_VERSION_NUMBER"><code>OPENSSL_VERSION_NUMBER</code></a>(3).</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;3.2.0&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-Digest">
            
              <b>Digest</b>(name)
            
            <a href="../classes/OpenSSL.html#method-c-Digest" name="method-c-Digest" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns a <a href="OpenSSL/Digest.html"><code>Digest</code></a> subclass by <em>name</em></p>

<pre><code>require &#39;openssl&#39;

OpenSSL::Digest(&quot;MD5&quot;)
# =&gt; OpenSSL::Digest::MD5

Digest(&quot;Foo&quot;)
# =&gt; NameError: wrong constant name Foo
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-Digest_source')" id="l_method-c-Digest_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/ext/openssl/lib/openssl/digest.rb#L63" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-Digest_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl/digest.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">Digest</span>(<span class="ruby-identifier ruby-title">name</span>)
  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-debug">
            
              <b>OpenSSL.debug &rarr; true | false</b>
            
            <a href="../classes/OpenSSL.html#method-c-debug" name="method-c-debug" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-debug_source')" id="l_method-c-debug_source">show</a>
                
              </p>
              <div id="method-c-debug_source" class="dyn-source">
                <pre>static VALUE
ossl_debug_get(VALUE self)
{
    return dOSSL;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-debug-3D">
            
              <b>OpenSSL.debug = boolean &rarr; boolean
</b>
            
            <a href="../classes/OpenSSL.html#method-c-debug-3D" name="method-c-debug-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Turns on or off debug mode. With debug mode, all errors added to the <a href="OpenSSL.html"><code>OpenSSL</code></a> error queue will be printed to stderr.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-debug-3D_source')" id="l_method-c-debug-3D_source">show</a>
                
              </p>
              <div id="method-c-debug-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_debug_set(VALUE self, VALUE val)
{
    dOSSL = RTEST(val) ? Qtrue : Qfalse;

    return val;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-errors">
            
              <b>OpenSSL.errors &rarr; [String...]
</b>
            
            <a href="../classes/OpenSSL.html#method-c-errors" name="method-c-errors" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>See any remaining errors held in queue.</p>

<p>Any errors you see here are probably due to a bug in Ruby’s <a href="OpenSSL.html"><code>OpenSSL</code></a> implementation.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-errors_source')" id="l_method-c-errors_source">show</a>
                
              </p>
              <div id="method-c-errors_source" class="dyn-source">
                <pre>VALUE
ossl_get_errors(VALUE _)
{
    VALUE ary;
    long e;

    ary = rb_ary_new();
    while ((e = ERR_get_error()) != 0){
        rb_ary_push(ary, rb_str_new2(ERR_error_string(e, NULL)));
    }

    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-fips_mode">
            
              <b>OpenSSL.fips_mode &rarr; true | false</b>
            
            <a href="../classes/OpenSSL.html#method-c-fips_mode" name="method-c-fips_mode" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-fips_mode_source')" id="l_method-c-fips_mode_source">show</a>
                
              </p>
              <div id="method-c-fips_mode_source" class="dyn-source">
                <pre>static VALUE
ossl_fips_mode_get(VALUE self)
{

#if OSSL_OPENSSL_PREREQ(3, 0, 0)
    VALUE enabled;
    enabled = EVP_default_properties_is_fips_enabled(NULL) ? Qtrue : Qfalse;
    return enabled;
#elif defined(OPENSSL_FIPS)
    VALUE enabled;
    enabled = FIPS_mode() ? Qtrue : Qfalse;
    return enabled;
#else
    return Qfalse;
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-fips_mode-3D">
            
              <b>OpenSSL.fips_mode = boolean &rarr; boolean
</b>
            
            <a href="../classes/OpenSSL.html#method-c-fips_mode-3D" name="method-c-fips_mode-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Turns FIPS mode on or off. Turning on FIPS mode will obviously only have an effect for FIPS-capable installations of the <a href="OpenSSL.html"><code>OpenSSL</code></a> library. Trying to do so otherwise will result in an error.</p>

<h3 id="method-c-fips_mode-3D-label-Examples">Examples</h3>

<pre><code>OpenSSL.fips_mode = true   # turn FIPS mode on
OpenSSL.fips_mode = false  # and off again
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-fips_mode-3D_source')" id="l_method-c-fips_mode-3D_source">show</a>
                
              </p>
              <div id="method-c-fips_mode-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_fips_mode_set(VALUE self, VALUE enabled)
{
#if OSSL_OPENSSL_PREREQ(3, 0, 0)
    if (RTEST(enabled)) {
        if (!EVP_default_properties_enable_fips(NULL, 1)) {
            ossl_raise(eOSSLError, &quot;Turning on FIPS mode failed&quot;);
        }
    } else {
        if (!EVP_default_properties_enable_fips(NULL, 0)) {
            ossl_raise(eOSSLError, &quot;Turning off FIPS mode failed&quot;);
        }
    }
    return enabled;
#elif defined(OPENSSL_FIPS)
    if (RTEST(enabled)) {
        int mode = FIPS_mode();
        if(!mode &amp;&amp; !FIPS_mode_set(1)) /* turning on twice leads to an error */
            ossl_raise(eOSSLError, &quot;Turning on FIPS mode failed&quot;);
    } else {
        if(!FIPS_mode_set(0)) /* turning off twice is OK */
            ossl_raise(eOSSLError, &quot;Turning off FIPS mode failed&quot;);
    }
    return enabled;
#else
    if (RTEST(enabled))
        ossl_raise(eOSSLError, &quot;This version of OpenSSL does not support FIPS mode&quot;);
    return enabled;
#endif
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-fixed_length_secure_compare">
            
              <b>OpenSSL.fixed_length_secure_compare(string, string) &rarr; boolean
</b>
            
            <a href="../classes/OpenSSL.html#method-c-fixed_length_secure_compare" name="method-c-fixed_length_secure_compare" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Constant time memory comparison for fixed length strings, such as results of <a href="OpenSSL/HMAC.html"><code>HMAC</code></a> calculations.</p>

<p>Returns <code>true</code> if the strings are identical, <code>false</code> if they are of the same length but not identical. If the length is different, <code>ArgumentError</code> is raised.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-fixed_length_secure_compare_source')" id="l_method-c-fixed_length_secure_compare_source">show</a>
                
              </p>
              <div id="method-c-fixed_length_secure_compare_source" class="dyn-source">
                <pre>static VALUE
ossl_crypto_fixed_length_secure_compare(VALUE dummy, VALUE str1, VALUE str2)
{
    const unsigned char *p1 = (const unsigned char *)StringValuePtr(str1);
    const unsigned char *p2 = (const unsigned char *)StringValuePtr(str2);
    long len1 = RSTRING_LEN(str1);
    long len2 = RSTRING_LEN(str2);

    if (len1 != len2) {
        ossl_raise(rb_eArgError, &quot;inputs must be of equal length&quot;);
    }

    switch (CRYPTO_memcmp(p1, p2, len1)) {
        case 0: return Qtrue;
        default: return Qfalse;
    }
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-secure_compare">
            
              <b>OpenSSL.secure_compare(string, string) &rarr; boolean
</b>
            
            <a href="../classes/OpenSSL.html#method-c-secure_compare" name="method-c-secure_compare" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Constant time memory comparison. Inputs are hashed using SHA-256 to mask the length of the secret. Returns <code>true</code> if the strings are identical, <code>false</code> otherwise.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-secure_compare_source')" id="l_method-c-secure_compare_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/ext/openssl/lib/openssl.rb#L32" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-secure_compare_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/ext/openssl/lib/openssl.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">secure_compare</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
  <span class="ruby-identifier">hashed_a</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-string">&#39;SHA256&#39;</span>, <span class="ruby-identifier">a</span>)
  <span class="ruby-identifier">hashed_b</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-string">&#39;SHA256&#39;</span>, <span class="ruby-identifier">b</span>)
  <span class="ruby-constant">OpenSSL</span>.<span class="ruby-identifier">fixed_length_secure_compare</span>(<span class="ruby-identifier">hashed_a</span>, <span class="ruby-identifier">hashed_b</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
    
  
</div>

    </main>
  </body>
</html>
