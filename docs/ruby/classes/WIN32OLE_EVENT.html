<!DOCTYPE html>
<html lang="en">
<head>
    <title>WIN32OLE_EVENT</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["WIN32OLE_EVENT"]'>


    <meta property="og:title" value="WIN32OLE_EVENT">

  
    
    <meta name="description" content="WIN32OLE_EVENT objects controls OLE event.">
    <meta property="og:description" content="WIN32OLE_EVENT objects controls OLE event.">
  

    <meta name="keywords" content="WIN32OLE_EVENT class, message_loop, new, on_event, on_event_with_outargs, off_event, unadvise, handler=, handler">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            WIN32OLE_EVENT
            
                <span class="parent">&lt;
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/ruby/ext/win32ole/win32ole_event_c.html">ruby/ext/win32ole/win32ole_event.c</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><code>WIN32OLE_EVENT</code> objects controls OLE event.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-handler">handler</a>,
              </li>
            
              
              <li>
                <a href="#method-i-handler-3D">handler=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-message_loop">message_loop</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-off_event">off_event</a>,
              </li>
            
              
              <li>
                <a href="#method-i-on_event">on_event</a>,
              </li>
            
              
              <li>
                <a href="#method-i-on_event_with_outargs">on_event_with_outargs</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-unadvise">unadvise</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-message_loop">
            
              <b>WIN32OLE_EVENT.message_loop
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-c-message_loop" name="method-c-message_loop" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Translates and dispatches Windows message.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-message_loop_source')" id="l_method-c-message_loop_source">show</a>
                
              </p>
              <div id="method-c-message_loop_source" class="dyn-source">
                <pre>static VALUE
fev_s_msg_loop(VALUE klass)
{
    ole_msg_loop();
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>WIN32OLE_EVENT.new(ole, event) #=> WIN32OLE_EVENT object.
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns OLE event object. The first argument specifies <a href="WIN32OLE.html"><code>WIN32OLE</code></a> object. The second argument specifies OLE event name.</p>

<pre><code>ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie, &#39;DWebBrowserEvents&#39;)
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
fev_initialize(int argc, VALUE *argv, VALUE self)
{
    ev_advise(argc, argv, self);
    evs_push(self);
    rb_ivar_set(self, id_events, rb_ary_new());
    fev_set_handler(self, Qnil);
    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-handler">
            
              <b>WIN32OLE_EVENT#handler
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-handler" name="method-i-handler" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>returns handler object.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-handler_source')" id="l_method-i-handler_source">show</a>
                
              </p>
              <div id="method-i-handler_source" class="dyn-source">
                <pre>static VALUE
fev_get_handler(VALUE self)
{
    return rb_ivar_get(self, rb_intern(&quot;handler&quot;));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-handler-3D">
            
              <b>WIN32OLE_EVENT#handler=
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-handler-3D" name="method-i-handler-3D" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>sets event handler object. If handler object has onXXX method according to XXX event, then onXXX method is called when XXX event occurs.</p>

<p>If handler object has method_missing and there is no method according to the event, then method_missing called and 1-st argument is event name.</p>

<p>If handler object has onXXX method and there is block defined by <a href="WIN32OLE_EVENT.html#method-i-on_event"><code>WIN32OLE_EVENT#on_event</code></a>(‘XXX’){}, then block is executed but handler object method is not called when XXX event occurs.</p>

<pre><code>class Handler
  def onStatusTextChange(text)
    puts &quot;StatusTextChanged&quot;
  end
  def onPropertyChange(prop)
    puts &quot;PropertyChanged&quot;
  end
  def method_missing(ev, *arg)
    puts &quot;other event #{ev}&quot;
  end
end

handler = Handler.new
ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie)
ev.on_event(&quot;StatusTextChange&quot;) {|*args|
  puts &quot;this block executed.&quot;
  puts &quot;handler.onStatusTextChange method is not called.&quot;
}
ev.handler = handler
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-handler-3D_source')" id="l_method-i-handler-3D_source">show</a>
                
              </p>
              <div id="method-i-handler-3D_source" class="dyn-source">
                <pre>static VALUE
fev_set_handler(VALUE self, VALUE val)
{
    return rb_ivar_set(self, rb_intern(&quot;handler&quot;), val);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-off_event">
            
              <b>WIN32OLE_EVENT#off_event([event])
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-off_event" name="method-i-off_event" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>removes the callback of event.</p>

<pre><code>ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie)
ev.on_event(&#39;BeforeNavigate2&#39;) {|*args|
  args.last[6] = true
}
  ...
ev.off_event(&#39;BeforeNavigate2&#39;)
  ...
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-off_event_source')" id="l_method-i-off_event_source">show</a>
                
              </p>
              <div id="method-i-off_event_source" class="dyn-source">
                <pre>static VALUE
fev_off_event(int argc, VALUE *argv, VALUE self)
{
    VALUE event = Qnil;
    VALUE events;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;event);
    if(!NIL_P(event)) {
        if(!RB_TYPE_P(event, T_STRING) &amp;&amp; !RB_TYPE_P(event, T_SYMBOL)) {
            rb_raise(rb_eTypeError, &quot;wrong argument type (expected String or Symbol)&quot;);
        }
        if (RB_TYPE_P(event, T_SYMBOL)) {
            event = rb_sym2str(event);
        }
    }
    events = rb_ivar_get(self, id_events);
    if (NIL_P(events)) {
        return Qnil;
    }
    ole_delete_event(events, event);
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-on_event">
            
              <b>WIN32OLE_EVENT#on_event([event]){...}
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-on_event" name="method-i-on_event" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Defines the callback event. If argument is omitted, this method defines the callback of all events. If you want to modify reference argument in callback, return hash in callback. If you want to return value to OLE server as result of callback use ‘return’ or :return.</p>

<pre><code>ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie)
ev.on_event(&quot;NavigateComplete&quot;) {|url| puts url}
ev.on_event() {|ev, *args| puts &quot;#{ev} fired&quot;}

ev.on_event(&quot;BeforeNavigate2&quot;) {|*args|
  ...
  # set true to BeforeNavigate reference argument `Cancel&#39;.
  # Cancel is 7-th argument of BeforeNavigate,
  # so you can use 6 as key of hash instead of &#39;Cancel&#39;.
  # The argument is counted from 0.
  # The hash key of 0 means first argument.)
  {:Cancel =&gt; true}  # or {&#39;Cancel&#39; =&gt; true} or {6 =&gt; true}
}

ev.on_event(...) {|*args|
  {:return =&gt; 1, :xxx =&gt; yyy}
}
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-on_event_source')" id="l_method-i-on_event_source">show</a>
                
              </p>
              <div id="method-i-on_event_source" class="dyn-source">
                <pre>static VALUE
fev_on_event(int argc, VALUE *argv, VALUE self)
{
    return ev_on_event(argc, argv, self, Qfalse);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-on_event_with_outargs">
            
              <b>WIN32OLE_EVENT#on_event_with_outargs([event]){...}
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-on_event_with_outargs" name="method-i-on_event_with_outargs" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Defines the callback of event. If you want modify argument in callback, you could use this method instead of <a href="WIN32OLE_EVENT.html#method-i-on_event"><code>WIN32OLE_EVENT#on_event</code></a>.</p>

<pre><code>ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie)
ev.on_event_with_outargs(&#39;BeforeNavigate2&#39;) {|*args|
  args.last[6] = true
}
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-on_event_with_outargs_source')" id="l_method-i-on_event_with_outargs_source">show</a>
                
              </p>
              <div id="method-i-on_event_with_outargs_source" class="dyn-source">
                <pre>static VALUE
fev_on_event_with_outargs(int argc, VALUE *argv, VALUE self)
{
    return ev_on_event(argc, argv, self, Qtrue);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-unadvise">
            
              <b>WIN32OLE_EVENT#unadvise &rarr; nil
</b>
            
            <a href="../classes/WIN32OLE_EVENT.html#method-i-unadvise" name="method-i-unadvise" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>disconnects OLE server. If this method called, then the <a href="WIN32OLE_EVENT.html"><code>WIN32OLE_EVENT</code></a> object does not receive the OLE server event any more. This method is trial implementation.</p>

<pre><code>ie = WIN32OLE.new(&#39;InternetExplorer.Application&#39;)
ev = WIN32OLE_EVENT.new(ie)
ev.on_event() {...}
   ...
ev.unadvise
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-unadvise_source')" id="l_method-i-unadvise_source">show</a>
                
              </p>
              <div id="method-i-unadvise_source" class="dyn-source">
                <pre>static VALUE
fev_unadvise(VALUE self)
{
    struct oleeventdata *poleev;
    TypedData_Get_Struct(self, struct oleeventdata, &amp;oleevent_datatype, poleev);
    if (poleev-&gt;pConnectionPoint) {
        ole_msg_loop();
        evs_delete(poleev-&gt;event_id);
        poleev-&gt;pConnectionPoint-&gt;lpVtbl-&gt;Unadvise(poleev-&gt;pConnectionPoint, poleev-&gt;dwCookie);
        OLE_RELEASE(poleev-&gt;pConnectionPoint);
        poleev-&gt;pConnectionPoint = NULL;
    }
    OLE_FREE(poleev-&gt;pDispatch);
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
