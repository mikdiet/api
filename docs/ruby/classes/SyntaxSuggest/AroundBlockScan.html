<!DOCTYPE html>
<html lang="en">
<head>
    <title>SyntaxSuggest::AroundBlockScan</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["SyntaxSuggest", "AroundBlockScan"]'>


    <meta property="og:title" value="SyntaxSuggest::AroundBlockScan">

  
    
    <meta name="description" content="This class is useful for exploring contents before and after a block  It searches above and below the passed in block to match for whatever criteria you give it:  Example:  def dog         # 1   puts .">
    <meta property="og:description" content="This class is useful for exploring contents before and after a block  It searches above and below the passed in block to match for whatever criteria you give it:  Example:  def dog         # 1   puts .">
  

    <meta name="keywords" content="SyntaxSuggest::AroundBlockScan class, new, force_add_hidden, force_add_empty, stop_after_kw, scan_while, lookahead_balance_one_line, scan_neighbors_not_empty, scan_adjacent_indent, code_block, lines, inspect">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            SyntaxSuggest::AroundBlockScan
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../files/ruby/lib/syntax_suggest/around_block_scan_rb.html">ruby/lib/syntax_suggest/around_block_scan.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>This class is useful for exploring contents before and after a block</p>

<p>It searches above and below the passed in block to match for whatever criteria you give it:</p>

<p>Example:</p>

<pre><code>def dog         # 1
  puts &quot;bark&quot;   # 2
  puts &quot;bark&quot;   # 3
end             # 4

scan = AroundBlockScan.new(
  code_lines: code_lines
  block: CodeBlock.new(lines: code_lines[1])
)

scan.scan_while { true }

puts scan.before_index # =&gt; 0
puts scan.after_index  # =&gt; 3
</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-code_block">code_block</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-force_add_empty">force_add_empty</a>,
              </li>
            
              
              <li>
                <a href="#method-i-force_add_hidden">force_add_hidden</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-inspect">inspect</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-lines">lines</a>,
              </li>
            
              
              <li>
                <a href="#method-i-lookahead_balance_one_line">lookahead_balance_one_line</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-scan_adjacent_indent">scan_adjacent_indent</a>,
              </li>
            
              
              <li>
                <a href="#method-i-scan_neighbors_not_empty">scan_neighbors_not_empty</a>,
              </li>
            
              
              <li>
                <a href="#method-i-scan_while">scan_while</a>,
              </li>
            
              
              <li>
                <a href="#method-i-stop_after_kw">stop_after_kw</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>new</b>(code_lines:, block:)
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L30" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-value">code_lines:</span>, <span class="ruby-value">block:</span>)
  <span class="ruby-ivar">@code_lines</span> = <span class="ruby-identifier">code_lines</span>
  <span class="ruby-ivar">@orig_indent</span> = <span class="ruby-identifier">block</span>.<span class="ruby-identifier">current_indent</span>

  <span class="ruby-ivar">@stop_after_kw</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@force_add_empty</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@force_add_hidden</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@target_indent</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@scanner</span> = <span class="ruby-constant">ScanHistory</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">code_lines:</span> <span class="ruby-identifier">code_lines</span>, <span class="ruby-value">block:</span> <span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-code_block">
            
              <b>code_block</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-code_block" name="method-i-code_block" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Return the currently matched lines as a ‘CodeBlock`</p>

<p>When a ‘CodeBlock` is created it will gather metadata about itself, so this is not a free conversion. Avoid allocating more CodeBlock’s than needed</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-code_block_source')" id="l_method-i-code_block_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L217" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-code_block_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">code_block</span>
  <span class="ruby-constant">CodeBlock</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">lines:</span> <span class="ruby-identifier">lines</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-force_add_empty">
            
              <b>force_add_empty</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-force_add_empty" name="method-i-force_add_empty" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>When using this flag, ‘scan_while` will bypass the block it’s given and always add a line that responds truthy to ‘CodeLine#empty?`</p>

<p>Empty lines contain no code, only whitespace such as leading spaces a newline.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-force_add_empty_source')" id="l_method-i-force_add_empty_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L60" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-force_add_empty_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">force_add_empty</span>
  <span class="ruby-ivar">@force_add_empty</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-force_add_hidden">
            
              <b>force_add_hidden</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-force_add_hidden" name="method-i-force_add_hidden" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>When using this flag, ‘scan_while` will bypass the block it’s given and always add a line that responds truthy to ‘CodeLine#hidden?`</p>

<p>Lines are hidden when they’ve been evaluated by the parser as part of a block and found to contain valid code.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-force_add_hidden_source')" id="l_method-i-force_add_hidden_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L49" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-force_add_hidden_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">force_add_hidden</span>
  <span class="ruby-ivar">@force_add_hidden</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-inspect">
            
              <b>inspect</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-inspect" name="method-i-inspect" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Managable rspec errors</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-inspect_source')" id="l_method-i-inspect_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L228" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-inspect_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inspect</span>
  <span class="ruby-node">&quot;#&lt;#{self.class}:0x0000123843lol &gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-lines">
            
              <b>lines</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-lines" name="method-i-lines" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the lines matched by the current scan as an array of CodeLines</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-lines_source')" id="l_method-i-lines_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L223" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-lines_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lines</span>
  <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">lines</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-lookahead_balance_one_line">
            
              <b>lookahead_balance_one_line</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-lookahead_balance_one_line" name="method-i-lookahead_balance_one_line" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Scanning is intentionally conservative because we have no way of rolling back an agressive block (at this time)</p>

<p>If a block was stopped for some trivial reason, (like an empty line) but the next line would have caused it to be balanced then we can check that condition and grab just one more line either up or down.</p>

<p>For example, below if we’re scanning up, line 2 might cause the scanning to stop. This is because empty lines might denote logical breaks where the user intended to chunk code which is a good place to stop and check validity. Unfortunately it also means we might have a “dangling” keyword or end.</p>

<pre><code>1 def bark
2
3 end
</code></pre>

<p>If lines 2 and 3 are in the block, then when this method is run it would see it is unbalanced, but that acquiring line 1 would make it balanced, so that’s what it does.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-lookahead_balance_one_line_source')" id="l_method-i-lookahead_balance_one_line_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L141" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-lookahead_balance_one_line_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lookahead_balance_one_line</span>
  <span class="ruby-identifier">kw_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">end_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">kw_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">is_kw?</span>
    <span class="ruby-identifier">end_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">is_end?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">kw_count</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">end_count</span> <span class="ruby-comment"># nothing to balance</span>

  <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">commit_if_changed</span> <span class="ruby-comment"># Rollback point if we don&#39;t find anything to optimize</span>

  <span class="ruby-comment"># Try to eat up empty lines</span>
  <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(
    <span class="ruby-value">up:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-identifier">line</span>.<span class="ruby-identifier">hidden?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span> },
    <span class="ruby-value">down:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-identifier">line</span>.<span class="ruby-identifier">hidden?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span> }
  )

  <span class="ruby-comment"># More ends than keywords, check if we can balance expanding up</span>
  <span class="ruby-identifier">next_up</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">next_up</span>
  <span class="ruby-identifier">next_down</span> = <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">next_down</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">end_count</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">kw_count</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">next_up</span>&amp;.<span class="ruby-identifier">is_kw?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">next_up</span>.<span class="ruby-identifier">indent</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@target_indent</span>
      <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(
        <span class="ruby-value">up:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">next_up</span> },
        <span class="ruby-value">down:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-keyword">false</span> }
      )
      <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">commit_if_changed</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">-1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">next_down</span>&amp;.<span class="ruby-identifier">is_end?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">next_down</span>.<span class="ruby-identifier">indent</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@target_indent</span>
      <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(
        <span class="ruby-value">up:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-keyword">false</span> },
        <span class="ruby-value">down:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>) { <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">next_down</span> }
      )
      <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">commit_if_changed</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Rollback any uncommitted changes</span>
  <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">stash_changes</span>

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-scan_adjacent_indent">
            
              <b>scan_adjacent_indent</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-scan_adjacent_indent" name="method-i-scan_adjacent_indent" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Scan blocks based on indentation of next line above/below block</p>

<p>Determines indentaion of the next line above/below the current block.</p>

<p>Normally this is called when a block has expanded to capture all “neighbors” at the same (or greater) indentation and needs to expand out. For example the ‘def/end` lines surrounding a method.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-scan_adjacent_indent_source')" id="l_method-i-scan_adjacent_indent_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L200" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-scan_adjacent_indent_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan_adjacent_indent</span>
  <span class="ruby-identifier">before_after_indent</span> = []

  <span class="ruby-identifier">before_after_indent</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">next_up</span>&amp;.<span class="ruby-identifier">indent</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)
  <span class="ruby-identifier">before_after_indent</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">next_down</span>&amp;.<span class="ruby-identifier">indent</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)

  <span class="ruby-ivar">@target_indent</span> = <span class="ruby-identifier">before_after_indent</span>.<span class="ruby-identifier">min</span>
  <span class="ruby-identifier">scan_while</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">not_empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">indent</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@target_indent</span> }

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-scan_neighbors_not_empty">
            
              <b>scan_neighbors_not_empty</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-scan_neighbors_not_empty" name="method-i-scan_neighbors_not_empty" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Finds code lines at the same or greater indentation and adds them to the block</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-scan_neighbors_not_empty_source')" id="l_method-i-scan_neighbors_not_empty_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L188" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-scan_neighbors_not_empty_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 188</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan_neighbors_not_empty</span>
  <span class="ruby-ivar">@target_indent</span> = <span class="ruby-ivar">@orig_indent</span>
  <span class="ruby-identifier">scan_while</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">not_empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">indent</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@target_indent</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-scan_while">
            
              <b>scan_while</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-scan_while" name="method-i-scan_while" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Main work method</p>

<p>The <a href="AroundBlockScan.html#method-i-scan_while"><code>scan_while</code></a> method takes a block that yields lines above and below the block. If the yield returns true, the @before_index or @after_index are modified to include the matched line.</p>

<p>In addition to yielding individual lines, the internals of this object give a mini DSL to handle common situations such as stopping if we’ve found a keyword/end mis-match in one direction or the other.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-scan_while_source')" id="l_method-i-scan_while_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L88" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-scan_while_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan_while</span>
  <span class="ruby-identifier">stop_next_up</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">stop_next_down</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-ivar">@scanner</span>.<span class="ruby-identifier">scan</span>(
    <span class="ruby-value">up:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">kw_count</span>, <span class="ruby-identifier">end_count</span>) {
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stop_next_up</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@force_add_hidden</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">hidden?</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@force_add_empty</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span>

      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@stop_after_kw</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">kw_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_count</span>
        <span class="ruby-identifier">stop_next_up</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">line</span>
    },
    <span class="ruby-value">down:</span> <span class="ruby-operator">-&gt;</span>(<span class="ruby-identifier">line</span>, <span class="ruby-identifier">kw_count</span>, <span class="ruby-identifier">end_count</span>) {
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stop_next_down</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@force_add_hidden</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">hidden?</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@force_add_empty</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span>

      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@stop_after_kw</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">kw_count</span>
        <span class="ruby-identifier">stop_next_down</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">line</span>
    }
  )

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-stop_after_kw">
            
              <b>stop_after_kw</b>()
            
            <a href="../../classes/SyntaxSuggest/AroundBlockScan.html#method-i-stop_after_kw" name="method-i-stop_after_kw" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Tells ‘scan_while` to look for mismatched keyword/end-s</p>

<p>When scanning up, if we see more keywords then end-s it will stop. This might happen when scanning outside of a method body. the first scan line up would be a keyword and this setting would trigger a stop.</p>

<p>When scanning down, stop if there are more end-s than keywords.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-stop_after_kw_source')" id="l_method-i-stop_after_kw_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/syntax_suggest/around_block_scan.rb#L73" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-stop_after_kw_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/syntax_suggest/around_block_scan.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">stop_after_kw</span>
  <span class="ruby-ivar">@stop_after_kw</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
