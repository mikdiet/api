<!DOCTYPE html>
<html lang="en">
<head>
    <title>Random::Formatter</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["Random", "Formatter"]'>


    <meta property="og:title" value="Random::Formatter">

  
    
    <meta name="description" content="Random number formatter.  Formats generated random numbers in many manners.">
    <meta property="og:description" content="Random number formatter.  Formats generated random numbers in many manners.">
  

    <meta name="keywords" content="Random::Formatter class, random_bytes, hex, base64, urlsafe_base64, uuid, uuid_v4, uuid_v7, alphanumeric, random_number, rand">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Module</span>
            Random::Formatter
            
        </h2>
        <ul class="files">
            
            <li><a href="../../files/ruby/lib/random/formatter_rb.html">ruby/lib/random/formatter.rb</a></li>
            
            <li><a href="../../files/ruby/random_c.html">ruby/random.c</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="module-Random::Formatter-label-Random+number+formatter.">Random number formatter.</h2>

<p>Formats generated random numbers in many manners. When <code>&#39;random/formatter&#39;</code> is required, several methods are added to empty core module <code>Random::Formatter</code>, making them available as Random’s instance and module methods.</p>

<p>Standard library <a href="../SecureRandom.html"><code>SecureRandom</code></a> is also extended with the module, and the methods described below are available as a module methods in it.</p>

<h3 id="module-Random::Formatter-label-Examples">Examples</h3>

<p>Generate random hexadecimal strings:</p>

<pre><code>require &#39;random/formatter&#39;

prng = Random.new
prng.hex(10) #=&gt; &quot;52750b30ffbc7de3b362&quot;
prng.hex(10) #=&gt; &quot;92b15d6c8dc4beb5f559&quot;
prng.hex(13) #=&gt; &quot;39b290146bea6ce975c37cfc23&quot;
# or just
Random.hex #=&gt; &quot;1aed0c631e41be7f77365415541052ee&quot;
</code></pre>

<p>Generate random base64 strings:</p>

<pre><code>prng.base64(10) #=&gt; &quot;EcmTPZwWRAozdA==&quot;
prng.base64(10) #=&gt; &quot;KO1nIU+p9DKxGg==&quot;
prng.base64(12) #=&gt; &quot;7kJSM/MzBJI+75j8&quot;
Random.base64(4) #=&gt; &quot;bsQ3fQ==&quot;
</code></pre>

<p>Generate random binary strings:</p>

<pre><code>prng.random_bytes(10) #=&gt; &quot;\016\t{\370g\310pbr\301&quot;
prng.random_bytes(10) #=&gt; &quot;\323U\030TO\234\357\020\a\337&quot;
Random.random_bytes(6) #=&gt; &quot;\xA1\xE6Lr\xC43&quot;
</code></pre>

<p>Generate alphanumeric strings:</p>

<pre><code>prng.alphanumeric(10) #=&gt; &quot;S8baxMJnPl&quot;
prng.alphanumeric(10) #=&gt; &quot;aOxAg8BAJe&quot;
Random.alphanumeric #=&gt; &quot;TmP9OsJHJLtaZYhP&quot;
</code></pre>

<p>Generate UUIDs:</p>

<pre><code>prng.uuid #=&gt; &quot;2d931510-d99f-494a-8c67-87feb05e1594&quot;
prng.uuid #=&gt; &quot;bad85eb9-0713-4da7-8d36-07a8e4b00eab&quot;
Random.uuid #=&gt; &quot;f14e0271-de96-45cc-8911-8910292a42cd&quot;
</code></pre>

<p>All methods are available in the standard library <a href="../SecureRandom.html"><code>SecureRandom</code></a>, too:</p>

<pre><code>SecureRandom.hex #=&gt; &quot;05b45376a30c67238eb93b16499e50cf&quot;
</code></pre>

<p>Generate a random number in the given range as <a href="../Random.html"><code>Random</code></a> does</p>

<pre><code>prng.random_number       #=&gt; 0.5816771641321361
prng.random_number(1000) #=&gt; 485
prng.random_number(1..6) #=&gt; 3
prng.rand                #=&gt; 0.5816771641321361
prng.rand(1000)          #=&gt; 485
prng.rand(1..6)          #=&gt; 3
</code></pre>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-alphanumeric">alphanumeric</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-base64">base64</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-hex">hex</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-rand">rand</a>,
              </li>
            
              
              <li>
                <a href="#method-i-random_bytes">random_bytes</a>,
              </li>
            
              
              <li>
                <a href="#method-i-random_number">random_number</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-urlsafe_base64">urlsafe_base64</a>,
              </li>
            
              
              <li>
                <a href="#method-i-uuid">uuid</a>,
              </li>
            
              
              <li>
                <a href="#method-i-uuid_v4">uuid_v4</a>,
              </li>
            
              
              <li>
                <a href="#method-i-uuid_v7">uuid_v7</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">ALPHANUMERIC</td>
            <td>=</td>
            <td class="attr-value">[*&#39;A&#39;..&#39;Z&#39;, *&#39;a&#39;..&#39;z&#39;, *&#39;0&#39;..&#39;9&#39;]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>The default character list for <a href="Formatter.html#method-i-alphanumeric"><code>alphanumeric</code></a>.</p></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-alphanumeric">
            
              <b>alphanumeric</b>(n = nil, chars: ALPHANUMERIC)
            
            <a href="../../classes/Random/Formatter.html#method-i-alphanumeric" name="method-i-alphanumeric" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random alphanumeric string.</p>

<p>The argument <em>n</em> specifies the length, in characters, of the alphanumeric string to be generated. The argument <em>chars</em> specifies the character list which the result is consist of.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain A-Z, a-z and 0-9, unless <em>chars</em> is specified.</p>

<pre><code>require &#39;random/formatter&#39;

Random.alphanumeric     #=&gt; &quot;2BuBuLf3WfSKyQbR&quot;
# or
prng = Random.new
prng.alphanumeric(10) #=&gt; &quot;i6K93NdqiH&quot;

Random.alphanumeric(4, chars: [*&quot;0&quot;..&quot;9&quot;]) #=&gt; &quot;2952&quot;
# or
prng = Random.new
prng.alphanumeric(10, chars: [*&quot;!&quot;..&quot;/&quot;]) #=&gt; &quot;,.,++%/&#39;&#39;.&quot;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-alphanumeric_source')" id="l_method-i-alphanumeric_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L368" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-alphanumeric_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 368</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">alphanumeric</span>(<span class="ruby-identifier">n</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-value">chars:</span> <span class="ruby-constant">ALPHANUMERIC</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-value">16</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">choose</span>(<span class="ruby-identifier">chars</span>, <span class="ruby-identifier">n</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-base64">
            
              <b>base64</b>(n=nil)
            
            <a href="../../classes/Random/Formatter.html#method-i-base64" name="method-i-base64" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random base64 string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the result string is about 4/3 of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain A-Z, a-z, 0-9, “+”, “/” and “=”.</p>

<pre><code>require &#39;random/formatter&#39;

Random.base64 #=&gt; &quot;/2BuBuLf3+WfSKyQbRcc/A==&quot;
# or
prng = Random.new
prng.base64 #=&gt; &quot;6BbW0pxO0YENxn38HMUbcQ==&quot;
</code></pre>

<p>See RFC 3548 for the definition of base64.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-base64_source')" id="l_method-i-base64_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L114" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-base64_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">base64</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword">nil</span>)
  [<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;m0&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-hex">
            
              <b>hex</b>(n=nil)
            
            <a href="../../classes/Random/Formatter.html#method-i-hex" name="method-i-hex" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random hexadecimal string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the resulting hexadecimal string is twice of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain 0-9 and a-f.</p>

<pre><code>require &#39;random/formatter&#39;

Random.hex #=&gt; &quot;eb693ec8252cd630102fd0d0fb7c3485&quot;
# or
prng = Random.new
prng.hex #=&gt; &quot;91dc3bfb4de5b11d029d376634589b61&quot;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-hex_source')" id="l_method-i-hex_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L92" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-hex_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">hex</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>).<span class="ruby-identifier">unpack1</span>(<span class="ruby-string">&quot;H*&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-rand">
            
              <b>prng.rand                 &rarr; float<br />prng.rand(max)            &rarr; number<br />prng.rand(range)          &rarr; number</b>
            
            <a href="../../classes/Random/Formatter.html#method-i-rand" name="method-i-rand" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generates formatted random number from raw random bytes. See <a href="../Random.html#method-i-rand"><code>Random#rand</code></a>.</p>
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Formatter.html#method-i-random_number">random_number</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-random_bytes">
            
              <b>random_bytes</b>(n=nil)
            
            <a href="../../classes/Random/Formatter.html#method-i-random_bytes" name="method-i-random_bytes" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random binary string.</p>

<p>The argument <em>n</em> specifies the length of the result string.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in future.</p>

<p>The result may contain any byte: “x00” - “xff”.</p>

<pre><code>require &#39;random/formatter&#39;

Random.random_bytes #=&gt; &quot;\xD8\\\xE0\xF4\r\xB2\xFC*WM\xFF\x83\x18\xF45\xB6&quot;
# or
prng = Random.new
prng.random_bytes #=&gt; &quot;m\xDC\xFC/\a\x00Uf\xB2\xB2P\xBD\xFF6S\x97&quot;
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-random_bytes_source')" id="l_method-i-random_bytes_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L71" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-random_bytes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">random_bytes</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">n</span> = <span class="ruby-identifier">n</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_int</span> <span class="ruby-operator">:</span> <span class="ruby-value">16</span>
  <span class="ruby-identifier">gen_random</span>(<span class="ruby-identifier">n</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-random_number">
            
              <b>random_number</b>(*args)
            
            <a href="../../classes/Random/Formatter.html#method-i-random_number" name="method-i-random_number" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generates formatted random number from raw random bytes. See <a href="../Random.html#method-i-rand"><code>Random#rand</code></a>.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Formatter.html#method-i-rand">rand</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-random_number_source')" id="l_method-i-random_number_source">show</a>
                
              </p>
              <div id="method-i-random_number_source" class="dyn-source">
                <pre>static VALUE
rand_random_number(int argc, VALUE *argv, VALUE obj)
{
    rb_random_t *rnd = try_get_rnd(obj);
    VALUE v = rand_random(argc, argv, obj, rnd);
    if (NIL_P(v)) v = rand_random(0, 0, obj, rnd);
    else if (!v) invalid_argument(argv[0]);
    return v;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-urlsafe_base64">
            
              <b>urlsafe_base64</b>(n=nil, padding=false)
            
            <a href="../../classes/Random/Formatter.html#method-i-urlsafe_base64" name="method-i-urlsafe_base64" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random URL-safe base64 string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the result string is about 4/3 of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The boolean argument <em>padding</em> specifies the padding. If it is false or nil, padding is not generated. Otherwise padding is generated. By default, padding is not generated because “=” may be used as a URL delimiter.</p>

<p>The result may contain A-Z, a-z, 0-9, “-” and “_”. “=” is also used if <em>padding</em> is true.</p>

<pre><code>require &#39;random/formatter&#39;

Random.urlsafe_base64 #=&gt; &quot;b4GOKm4pOYU_-BOXcrUGDg&quot;
# or
prng = Random.new
prng.urlsafe_base64 #=&gt; &quot;UZLdOkzop70Ddx-IJR0ABg&quot;

prng.urlsafe_base64(nil, true) #=&gt; &quot;i0XQ-7gglIsHGV2_BNPrdQ==&quot;
prng.urlsafe_base64(nil, true) #=&gt; &quot;-M8rLhr7JEpJlqFGUMmOxg==&quot;
</code></pre>

<p>See RFC 3548 for the definition of URL-safe base64.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-urlsafe_base64_source')" id="l_method-i-urlsafe_base64_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L145" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-urlsafe_base64_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">urlsafe_base64</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">padding</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">s</span> = [<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;m0&quot;</span>)
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">tr!</span>(<span class="ruby-string">&quot;+/&quot;</span>, <span class="ruby-string">&quot;-_&quot;</span>)
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">delete!</span>(<span class="ruby-string">&quot;=&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">padding</span>
  <span class="ruby-identifier">s</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-uuid">
            
              <b>uuid</b>()
            
            <a href="../../classes/Random/Formatter.html#method-i-uuid" name="method-i-uuid" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random v4 UUID (Universally Unique IDentifier).</p>

<pre><code>require &#39;random/formatter&#39;

Random.uuid #=&gt; &quot;2d931510-d99f-494a-8c67-87feb05e1594&quot;
Random.uuid #=&gt; &quot;bad85eb9-0713-4da7-8d36-07a8e4b00eab&quot;
# or
prng = Random.new
prng.uuid #=&gt; &quot;62936e70-1815-439b-bf89-8492855a7e6b&quot;
</code></pre>

<p>The version 4 UUID is purely random (except the version). It doesn’t contain meaningful information such as MAC addresses, timestamps, etc.</p>

<p>The result contains 122 random bits (15.25 random bytes).</p>

<p>See <a href="https://datatracker.ietf.org/doc/html/rfc4122">RFC4122</a> for details of UUID.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Formatter.html#method-i-uuid_v4">uuid_v4</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-uuid_source')" id="l_method-i-uuid_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L169" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-uuid_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">uuid</span>
  <span class="ruby-identifier">ary</span> = <span class="ruby-identifier">random_bytes</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;NnnnnN&quot;</span>)
  <span class="ruby-identifier">ary</span>[<span class="ruby-value">2</span>] = (<span class="ruby-identifier">ary</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0fff</span>) <span class="ruby-operator">|</span> <span class="ruby-value">0x4000</span>
  <span class="ruby-identifier">ary</span>[<span class="ruby-value">3</span>] = (<span class="ruby-identifier">ary</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x3fff</span>) <span class="ruby-operator">|</span> <span class="ruby-value">0x8000</span>
  <span class="ruby-string">&quot;%08x-%04x-%04x-%04x-%04x%08x&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ary</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-uuid_v4">
            
              <b>uuid_v4</b>()
            
            <a href="../../classes/Random/Formatter.html#method-i-uuid_v4" name="method-i-uuid_v4" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Formatter.html#method-i-uuid">uuid</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-uuid_v7">
            
              <b>uuid_v7</b>(extra_timestamp_bits: 0)
            
            <a href="../../classes/Random/Formatter.html#method-i-uuid_v7" name="method-i-uuid_v7" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Generate a random v7 UUID (Universally Unique IDentifier).</p>

<pre><code>require &#39;random/formatter&#39;

Random.uuid_v7 # =&gt; &quot;0188d4c3-1311-7f96-85c7-242a7aa58f1e&quot;
Random.uuid_v7 # =&gt; &quot;0188d4c3-16fe-744f-86af-38fa04c62bb5&quot;
Random.uuid_v7 # =&gt; &quot;0188d4c3-1af8-764f-b049-c204ce0afa23&quot;
Random.uuid_v7 # =&gt; &quot;0188d4c3-1e74-7085-b14f-ef6415dc6f31&quot;
#                    |&lt;--sorted--&gt;| |&lt;----- random ----&gt;|

# or
prng = Random.new
prng.uuid_v7 # =&gt; &quot;0188ca51-5e72-7950-a11d-def7ff977c98&quot;
</code></pre>

<p>The version 7 UUID starts with the least significant 48 bits of a 64 bit Unix timestamp (milliseconds since the epoch) and fills the remaining bits with random data, excluding the version and variant bits.</p>

<p>This allows version 7 UUIDs to be sorted by creation time.  <a href="../Time.html"><code>Time</code></a> ordered UUIDs can be used for better database index locality of newly inserted records, which may have a significant performance benefit compared to random data inserts.</p>

<p>The result contains 74 random bits (9.25 random bytes).</p>

<p>Note that this method cannot be made reproducable because its output includes not only random bits but also timestamp.</p>

<p>See <a href="https://datatracker.ietf.org/doc/draft-ietf-uuidrev-rfc4122bis/">draft-ietf-uuidrev-rfc4122bis</a> for details of UUIDv7.</p>

<h4 id="method-i-uuid_v7-label-Monotonicity">Monotonicity</h4>

<p>UUIDv7 has millisecond precision by default, so multiple UUIDs created within the same millisecond are not issued in monotonically increasing order.  To create UUIDs that are time-ordered with sub-millisecond precision, up to 12 bits of additional timestamp may added with <code>extra_timestamp_bits</code>.  The extra timestamp precision comes at the expense of random bits.  Setting <code>extra_timestamp_bits: 12</code> provides ~244ns of precision, but only 62 random bits (7.75 random bytes).</p>

<pre><code>prng = Random.new
Array.new(4) { prng.uuid_v7(extra_timestamp_bits: 12) }
# =&gt;
[&quot;0188d4c7-13da-74f9-8b53-22a786ffdd5a&quot;,
 &quot;0188d4c7-13da-753b-83a5-7fb9b2afaeea&quot;,
 &quot;0188d4c7-13da-754a-88ea-ac0baeedd8db&quot;,
 &quot;0188d4c7-13da-7557-83e1-7cad9cda0d8d&quot;]
# |&lt;--- sorted ---&gt;| |&lt;-- random ---&gt;|

Array.new(4) { prng.uuid_v7(extra_timestamp_bits: 8) }
# =&gt;
[&quot;0188d4c7-3333-7a95-850a-de6edb858f7e&quot;,
 &quot;0188d4c7-3333-7ae8-842e-bc3a8b7d0cf9&quot;,  # &lt;- out of order
 &quot;0188d4c7-3333-7ae2-995a-9f135dc44ead&quot;,  # &lt;- out of order
 &quot;0188d4c7-3333-7af9-87c3-8f612edac82e&quot;]
# |&lt;--- sorted --&gt;||&lt;---- random ---&gt;|
</code></pre>

<p>Any rollbacks of the system clock will break monotonicity.  UUIDv7 is based on UTC, which excludes leap seconds and can rollback the clock.  To avoid this, the system clock can synchronize with an NTP server configured to use a “leap smear” approach.  NTP or PTP will also be needed to synchronize across distributed nodes.</p>

<p>Counters and other mechanisms for stronger guarantees of monotonicity are not implemented.  Applications with stricter requirements should follow <a href="https://www.ietf.org/archive/id/draft-ietf-uuidrev-rfc4122bis-07.html#monotonicity_counters">Section 6.2</a> of the specification.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-uuid_v7_source')" id="l_method-i-uuid_v7_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/lib/random/formatter.rb#L247" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-uuid_v7_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/random/formatter.rb, line 247</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">uuid_v7</span>(<span class="ruby-value">extra_timestamp_bits:</span> <span class="ruby-value">0</span>)
  <span class="ruby-keyword">case</span> (<span class="ruby-identifier">extra_timestamp_bits</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">extra_timestamp_bits</span>))
  <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-comment"># min timestamp precision</span>
    <span class="ruby-identifier">ms</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">clock_gettime</span>(<span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">CLOCK_REALTIME</span>, <span class="ruby-value">:millisecond</span>)
    <span class="ruby-identifier">rand</span> = <span class="ruby-identifier">random_bytes</span>(<span class="ruby-value">10</span>)
    <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0f</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x70</span>) <span class="ruby-comment"># version</span>
    <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-value">2</span>, <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x3f</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>) <span class="ruby-comment"># variant</span>
    <span class="ruby-string">&quot;%08x-%04x-%s&quot;</span> <span class="ruby-operator">%</span> [
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_ffff_ffff_0000</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">16</span>,
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_0000_0000_ffff</span>),
      <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;H4H4H12&quot;</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;-&quot;</span>)
    ]

  <span class="ruby-keyword">when</span> <span class="ruby-value">12</span> <span class="ruby-comment"># max timestamp precision</span>
    <span class="ruby-identifier">ms</span>, <span class="ruby-identifier">ns</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">clock_gettime</span>(<span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">CLOCK_REALTIME</span>, <span class="ruby-value">:nanosecond</span>)
      .<span class="ruby-identifier">divmod</span>(<span class="ruby-value">1_000_000</span>)
    <span class="ruby-identifier">extra_bits</span> = <span class="ruby-identifier">ns</span> <span class="ruby-operator">*</span> <span class="ruby-value">4096</span> <span class="ruby-operator">/</span> <span class="ruby-value">1_000_000</span>
    <span class="ruby-identifier">rand</span> = <span class="ruby-identifier">random_bytes</span>(<span class="ruby-value">8</span>)
    <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-value">0</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x3f</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>) <span class="ruby-comment"># variant</span>
    <span class="ruby-string">&quot;%08x-%04x-7%03x-%s&quot;</span> <span class="ruby-operator">%</span> [
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_ffff_ffff_0000</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">16</span>,
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_0000_0000_ffff</span>),
      <span class="ruby-identifier">extra_bits</span>,
      <span class="ruby-identifier">rand</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;H4H12&quot;</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;-&quot;</span>)
    ]

  <span class="ruby-keyword">when</span> (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">12</span>) <span class="ruby-comment"># the generic version is slower than the special cases above</span>
    <span class="ruby-identifier">rand_a</span>, <span class="ruby-identifier">rand_b1</span>, <span class="ruby-identifier">rand_b2</span>, <span class="ruby-identifier">rand_b3</span> = <span class="ruby-identifier">random_bytes</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;nnnN&quot;</span>)
    <span class="ruby-identifier">rand_mask_bits</span> = <span class="ruby-value">12</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">extra_timestamp_bits</span>
    <span class="ruby-identifier">ms</span>, <span class="ruby-identifier">ns</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">clock_gettime</span>(<span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">CLOCK_REALTIME</span>, <span class="ruby-value">:nanosecond</span>)
      .<span class="ruby-identifier">divmod</span>(<span class="ruby-value">1_000_000</span>)
    <span class="ruby-string">&quot;%08x-%04x-%04x-%04x-%04x%08x&quot;</span> <span class="ruby-operator">%</span> [
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_ffff_ffff_0000</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">16</span>,
      (<span class="ruby-identifier">ms</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000_0000_0000_ffff</span>),
      <span class="ruby-value">0x7000</span> <span class="ruby-operator">|</span>
        ((<span class="ruby-identifier">ns</span> <span class="ruby-operator">*</span> (<span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">extra_timestamp_bits</span>) <span class="ruby-operator">/</span> <span class="ruby-value">1_000_000</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rand_mask_bits</span>) <span class="ruby-operator">|</span>
        <span class="ruby-identifier">rand_a</span> <span class="ruby-operator">&amp;</span> ((<span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rand_mask_bits</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>),
      <span class="ruby-value">0x8000</span> <span class="ruby-operator">|</span> (<span class="ruby-identifier">rand_b1</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x3fff</span>),
      <span class="ruby-identifier">rand_b2</span>,
      <span class="ruby-identifier">rand_b3</span>
    ]

  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;extra_timestamp_bits must be in 0..12&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
