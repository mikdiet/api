<!DOCTYPE html>
<html lang="en">
<head>
    <title>Tempfile</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["Tempfile"]'>


    <meta property="og:title" value="Tempfile">

  
    
    <meta name="description" content="A utility class for managing temporary files. When you create a Tempfile object, it will create a temporary file with a unique filename.">
    <meta property="og:description" content="A utility class for managing temporary files. When you create a Tempfile object, it will create a temporary file with a unique filename.">
  

    <meta name="keywords" content="Tempfile class, new, initialize_dup, initialize_clone, open, close, close!, unlink, delete, path, size, length, open, create">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            Tempfile
            
                <span class="parent">&lt;
                    
                    DelegateClass(File)
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../files/ruby/lib/tempfile_rb.html">ruby/lib/tempfile.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>A utility class for managing temporary files. When you create a <a href="Tempfile.html"><code>Tempfile</code></a> object, it will create a temporary file with a unique filename. A <a href="Tempfile.html"><code>Tempfile</code></a> objects behaves just like a <a href="File.html"><code>File</code></a> object, and you can perform all the usual file operations on it: reading data, writing data, changing its permissions, etc. So although this class does not explicitly document all instance methods supported by <a href="File.html"><code>File</code></a>, you can in fact call any <a href="File.html"><code>File</code></a> instance method on a <a href="Tempfile.html"><code>Tempfile</code></a> object.</p>

<h2 id="class-Tempfile-label-Synopsis">Synopsis</h2>

<pre><code>require &#39;tempfile&#39;

file = Tempfile.new(&#39;foo&#39;)
file.path      # =&gt; A unique filename in the OS&#39;s temp directory,
               #    e.g.: &quot;/tmp/foo.24722.0&quot;
               #    This filename contains &#39;foo&#39; in its basename.
file.write(&quot;hello world&quot;)
file.rewind
file.read      # =&gt; &quot;hello world&quot;
file.close
file.unlink    # deletes the temp file
</code></pre>

<h2 id="class-Tempfile-label-Good+practices">Good practices</h2>

<h3 id="class-Tempfile-label-Explicit+close">Explicit close</h3>

<p>When a <a href="Tempfile.html"><code>Tempfile</code></a> object is garbage collected, or when the Ruby interpreter exits, its associated temporary file is automatically deleted. This means that it’s unnecessary to explicitly delete a <a href="Tempfile.html"><code>Tempfile</code></a> after use, though it’s a good practice to do so: not explicitly deleting unused Tempfiles can potentially leave behind a large number of temp files on the filesystem until they’re garbage collected. The existence of these temp files can make it harder to determine a new <a href="Tempfile.html"><code>Tempfile</code></a> filename.</p>

<p>Therefore, one should always call <a href="Tempfile.html#method-i-unlink"><code>unlink</code></a> or close in an ensure block, like this:</p>

<pre><code>file = Tempfile.new(&#39;foo&#39;)
begin
   # ...do something with file...
ensure
   file.close
   file.unlink   # deletes the temp file
end
</code></pre>

<p><a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a> { … } exists for this purpose and is more convenient to use. Note that <a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a> returns a <a href="File.html"><code>File</code></a> instance instead of a <a href="Tempfile.html"><code>Tempfile</code></a>, which also avoids the overhead and complications of delegation.</p>

<pre><code>Tempfile.create(&#39;foo&#39;) do |file|
   # ...do something with file...
end
</code></pre>

<h3 id="class-Tempfile-label-Unlink+after+creation">Unlink after creation</h3>

<p>On POSIX systems, it’s possible to unlink a file right after creating it, and before closing it. This removes the filesystem entry without closing the file handle, so it ensures that only the processes that already had the file handle open can access the file’s contents. It’s strongly recommended that you do this if you do not want any other processes to be able to read from or write to the <a href="Tempfile.html"><code>Tempfile</code></a>, and you do not need to know the Tempfile’s filename either.</p>

<p>For example, a practical use case for unlink-after-creation would be this: you need a large byte buffer that’s too large to comfortably fit in RAM, e.g. when you’re writing a web server and you want to buffer the client’s file upload data.</p>

<p>Please refer to <a href="Tempfile.html#method-i-unlink"><code>unlink</code></a> for more information and a code example.</p>

<h2 id="class-Tempfile-label-Minor+notes">Minor notes</h2>

<p>Tempfile’s filename picking method is both thread-safe and inter-process-safe: it guarantees that no other threads or processes will pick the same filename.</p>

<p><a href="Tempfile.html"><code>Tempfile</code></a> itself however may not be entirely thread-safe. If you access the same <a href="Tempfile.html"><code>Tempfile</code></a> object from multiple threads then you should protect it with a mutex.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-close">close</a>,
              </li>
            
              
              <li>
                <a href="#method-i-close-21">close!</a>,
              </li>
            
              
              <li>
                <a href="#method-c-create">create</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-delete">delete</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-initialize_clone">initialize_clone</a>,
              </li>
            
              
              <li>
                <a href="#method-i-initialize_dup">initialize_dup</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-length">length</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>O</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-open">open</a>,
              </li>
            
              
              <li>
                <a href="#method-i-open">open</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-path">path</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-size">size</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-unlink">unlink</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <h2 class="sectiontitle">Constants</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">&quot;0.2.1&quot;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-create">
            
              <b>create</b>(basename=&quot;&quot;, tmpdir=nil, mode: 0, **options)
            
            <a href="../classes/Tempfile.html#method-c-create" name="method-c-create" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a file in the underlying file system; returns a new File object based on that file.</p>

<p>With no block given and no arguments, creates and returns file whose:</p>
<ul><li>
<p><a href="Class.html"><code>Class</code></a> is <a href="File.html"><code>File</code></a> (not Tempfile).</p>
</li><li>
<p>Directory is the system temporary directory (system-dependent).</p>
</li><li>
<p>Generated filename is unique in that directory.</p>
</li><li>
<p>Permissions are <code>0600</code>; see <a href="File.html#class-File-label-File+Permissions">File Permissions</a>.</p>
</li><li>
<p>Mode is <code>&#39;w+&#39;</code> (read/write mode, positioned at the end).</p>
</li></ul>

<p>With no block, the file is not removed automatically, and so should be explicitly removed.</p>

<p>Example:</p>

<pre><code>f = Tempfile.create     # =&gt; #&lt;File:/tmp/20220505-9795-17ky6f6&gt;
f.class                 # =&gt; File
f.path                  # =&gt; &quot;/tmp/20220505-9795-17ky6f6&quot;
f.stat.mode.to_s(8)     # =&gt; &quot;100600&quot;
File.exist?(f.path)     # =&gt; true
File.unlink(f.path)
File.exist?(f.path)     # =&gt; false
</code></pre>

<p>Argument <code>basename</code>, if given, may be one of:</p>
<ul><li>
<p>A string: the generated filename begins with <code>basename</code>:</p>

<pre><code>Tempfile.create(&#39;foo&#39;) # =&gt; #&lt;File:/tmp/foo20220505-9795-1gok8l9&gt;
</code></pre>
</li><li>
<p>An array of two strings <code>[prefix, suffix]</code>: the generated filename begins with <code>prefix</code> and ends with <code>suffix</code>:</p>

<pre><code>Tempfile.create(%w/foo .jpg/) # =&gt; #&lt;File:/tmp/foo20220505-17839-tnjchh.jpg&gt;
</code></pre>
</li></ul>

<p>With arguments <code>basename</code> and <code>tmpdir</code>, the file is created in directory <code>tmpdir</code>:</p>

<pre><code>Tempfile.create(&#39;foo&#39;, &#39;.&#39;) # =&gt; #&lt;File:./foo20220505-9795-1emu6g8&gt;
</code></pre>

<p>Keyword arguments <code>mode</code> and <code>options</code> are passed directly to method <a href="File.html#method-c-open"><code>File.open</code></a>:</p>
<ul><li>
<p>The value given with <code>mode</code> must be an integer, and may be expressed as the logical OR of constants defined in <a href="File/File/Constants.html"><code>File::Constants</code></a>.</p>
</li><li>
<p>For <code>options</code>, see <a href="IO.html#class-IO-label-Open+Options">Open Options</a>.</p>
</li></ul>

<p>With a block given, creates the file as above, passes it to the block, and returns the block’s value; before the return, the file object is closed and the underlying file is removed:</p>

<pre><code>Tempfile.create {|file| file.path } # =&gt; &quot;/tmp/20220505-9795-rkists&quot;
</code></pre>

<p>Related: <a href="Tempfile.html#method-c-new"><code>Tempfile.new</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-create_source')" id="l_method-c-create_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L438" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-create_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 438</span>
<span class="ruby-keyword">def</span> <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier ruby-title">create</span>(<span class="ruby-identifier">basename</span>=<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">tmpdir</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-value">mode:</span> <span class="ruby-value">0</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">tmpfile</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Dir</span><span class="ruby-operator">::</span><span class="ruby-constant">Tmpname</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">basename</span>, <span class="ruby-identifier">tmpdir</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tmpname</span>, <span class="ruby-identifier">n</span>, <span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">mode</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">RDWR</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCL</span>
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:perm</span>] = <span class="ruby-value">0600</span>
    <span class="ruby-identifier">tmpfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tmpname</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">opts</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">tmpfile</span>
    <span class="ruby-keyword">ensure</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">closed?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">identical?</span>(<span class="ruby-identifier">tmpfile</span>, <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span>)
          <span class="ruby-identifier">unlinked</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">close</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">unlinked</span>
        <span class="ruby-keyword">begin</span>
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tmpfile</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>new</b>(basename=&quot;&quot;, tmpdir=nil, mode: 0, **options)
            
            <a href="../classes/Tempfile.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a file in the underlying file system; returns a new Tempfile object based on that file.</p>

<p>If possible, consider instead using <a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a>, which:</p>
<ul><li>
<p>Avoids the performance cost of delegation, incurred when <a href="Tempfile.html#method-c-new"><code>Tempfile.new</code></a> calls its superclass <code>DelegateClass(File)</code>.</p>
</li><li>
<p>Does not rely on a finalizer to close and unlink the file, which can be unreliable.</p>
</li></ul>

<p>Creates and returns file whose:</p>
<ul><li>
<p><a href="Class.html"><code>Class</code></a> is Tempfile (not File, as in <a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a>).</p>
</li><li>
<p>Directory is the system temporary directory (system-dependent).</p>
</li><li>
<p>Generated filename is unique in that directory.</p>
</li><li>
<p>Permissions are <code>0600</code>; see <a href="File.html#class-File-label-File+Permissions">File Permissions</a>.</p>
</li><li>
<p>Mode is <code>&#39;w+&#39;</code> (read/write mode, positioned at the end).</p>
</li></ul>

<p>The underlying file is removed when the Tempfile object dies and is reclaimed by the garbage collector.</p>

<p>Example:</p>

<pre><code>f = Tempfile.new # =&gt; #&lt;Tempfile:/tmp/20220505-17839-1s0kt30&gt;
f.class               # =&gt; Tempfile
f.path                # =&gt; &quot;/tmp/20220505-17839-1s0kt30&quot;
f.stat.mode.to_s(8)   # =&gt; &quot;100600&quot;
File.exist?(f.path)   # =&gt; true
File.unlink(f.path)   #
File.exist?(f.path)   # =&gt; false
</code></pre>

<p>Argument <code>basename</code>, if given, may be one of:</p>
<ul><li>
<p>A string: the generated filename begins with <code>basename</code>:</p>

<pre><code>Tempfile.new(&#39;foo&#39;) # =&gt; #&lt;Tempfile:/tmp/foo20220505-17839-1whk2f&gt;
</code></pre>
</li><li>
<p>An array of two strings <code>[prefix, suffix]</code>: the generated filename begins with <code>prefix</code> and ends with <code>suffix</code>:</p>

<pre><code>Tempfile.new(%w/foo .jpg/) # =&gt; #&lt;Tempfile:/tmp/foo20220505-17839-58xtfi.jpg&gt;
</code></pre>
</li></ul>

<p>With arguments <code>basename</code> and <code>tmpdir</code>, the file is created in directory <code>tmpdir</code>:</p>

<pre><code>Tempfile.new(&#39;foo&#39;, &#39;.&#39;) # =&gt; #&lt;Tempfile:./foo20220505-17839-xfstr8&gt;
</code></pre>

<p>Keyword arguments <code>mode</code> and <code>options</code> are passed directly to method <a href="File.html#method-c-open"><code>File.open</code></a>:</p>
<ul><li>
<p>The value given with <code>mode</code> must be an integer, and may be expressed as the logical OR of constants defined in <a href="File/File/Constants.html"><code>File::Constants</code></a>.</p>
</li><li>
<p>For <code>options</code>, see <a href="IO.html#class-IO-label-Open+Options">Open Options</a>.</p>
</li></ul>

<p>Related: <a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L150" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">basename</span>=<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">tmpdir</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-value">mode:</span> <span class="ruby-value">0</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;Tempfile.new doesn&#39;t call the given block.&quot;</span>, <span class="ruby-value">uplevel:</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-ivar">@unlinked</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">mode</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">RDWR</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCL</span>
  <span class="ruby-ivar">@finalizer_obj</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">tmpfile</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-operator">::</span><span class="ruby-constant">Dir</span><span class="ruby-operator">::</span><span class="ruby-constant">Tmpname</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">basename</span>, <span class="ruby-identifier">tmpdir</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">options</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tmpname</span>, <span class="ruby-identifier">n</span>, <span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:perm</span>] = <span class="ruby-value">0600</span>
    <span class="ruby-identifier">tmpfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tmpname</span>, <span class="ruby-ivar">@mode</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">opts</span>)
    <span class="ruby-ivar">@opts</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">freeze</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-ivar">@finalizer_obj</span>, <span class="ruby-constant">Remover</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span>))
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword">self</span>, <span class="ruby-constant">Closer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">tmpfile</span>))

  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">tmpfile</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
      <h2 class="sectiontitle">Class Protected methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-open">
            
              <b>open</b>(*args, **kw)
            
            <a href="../classes/Tempfile.html#method-c-open" name="method-c-open" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Creates a new <a href="Tempfile.html"><code>Tempfile</code></a>.</p>

<p>This method is not recommended and exists mostly for backward compatibility. Please use <a href="Tempfile.html#method-c-create"><code>Tempfile.create</code></a> instead, which avoids the cost of delegation, does not rely on a finalizer, and also unlinks the file when given a block.</p>

<p><a href="Tempfile.html#method-c-open"><code>Tempfile.open</code></a> is still appropriate if you need the <a href="Tempfile.html"><code>Tempfile</code></a> to be unlinked by a finalizer and you cannot explicitly know where in the program the <a href="Tempfile.html"><code>Tempfile</code></a> can be unlinked safely.</p>

<p>If no block is given, this is a synonym for <a href="Tempfile.html#method-c-new"><code>Tempfile.new</code></a>.</p>

<p>If a block is given, then a <a href="Tempfile.html"><code>Tempfile</code></a> object will be constructed, and the block is run with the <a href="Tempfile.html"><code>Tempfile</code></a> object as argument. The <a href="Tempfile.html"><code>Tempfile</code></a> object will be automatically closed after the block terminates. However, the file will <strong>not</strong> be unlinked and needs to be manually unlinked with <a href="Tempfile.html#method-i-close-21"><code>Tempfile#close!</code></a> or <a href="Tempfile.html#method-i-unlink"><code>Tempfile#unlink</code></a>. The finalizer will try to unlink but should not be relied upon as it can keep the file on the disk much longer than intended. For instance, on CRuby, finalizers can be delayed due to conservative stack scanning and references left in unused memory.</p>

<p>The call returns the value of the block.</p>

<p>In any case, all arguments (<code>*args</code>) will be passed to <a href="Tempfile.html#method-c-new"><code>Tempfile.new</code></a>.</p>

<pre><code>Tempfile.open(&#39;foo&#39;, &#39;/home/temp&#39;) do |f|
   # ... do something with f ...
end

# Equivalent:
f = Tempfile.open(&#39;foo&#39;, &#39;/home/temp&#39;)
begin
   # ... do something with f ...
ensure
   f.close
end
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-open_source')" id="l_method-c-open_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L366" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-open_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">open</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">kw</span>)
  <span class="ruby-identifier">tempfile</span> = <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">kw</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">tempfile</span>)
    <span class="ruby-keyword">ensure</span>
      <span class="ruby-identifier">tempfile</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">tempfile</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-close">
            
              <b>close</b>(unlink_now=false)
            
            <a href="../classes/Tempfile.html#method-i-close" name="method-i-close" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Closes the file. If <code>unlink_now</code> is true, then the file will be unlinked (deleted) after closing. Of course, you can choose to later call <a href="Tempfile.html#method-i-unlink"><code>unlink</code></a> if you do not unlink it now.</p>

<p>If you don’t explicitly unlink the temporary file, the removal will be delayed until the object is finalized.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-close_source')" id="l_method-i-close_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L208" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-close_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">close</span>(<span class="ruby-identifier">unlink_now</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">_close</span>
  <span class="ruby-identifier">unlink</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">unlink_now</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-close-21">
            
              <b>close!</b>()
            
            <a href="../classes/Tempfile.html#method-i-close-21" name="method-i-close-21" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Closes and unlinks (deletes) the file. Has the same effect as called <code>close(true)</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-close-21_source')" id="l_method-i-close-21_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L215" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-close-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">close!</span>
  <span class="ruby-identifier">close</span>(<span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-delete">
            
              <b>delete</b>()
            
            <a href="../classes/Tempfile.html#method-i-delete" name="method-i-delete" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Tempfile.html#method-i-unlink">unlink</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-initialize_clone">
            
              <b>initialize_clone</b>(other)
            
            <a href="../classes/Tempfile.html#method-i-initialize_clone" name="method-i-initialize_clone" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-initialize_clone_source')" id="l_method-i-initialize_clone_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L174" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-initialize_clone_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize_clone</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-identifier">initialize_copy_iv</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword">self</span>, <span class="ruby-constant">Closer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">__getobj__</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-initialize_dup">
            
              <b>initialize_dup</b>(other)
            
            <a href="../classes/Tempfile.html#method-i-initialize_dup" name="method-i-initialize_dup" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-initialize_dup_source')" id="l_method-i-initialize_dup_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L168" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-initialize_dup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize_dup</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-identifier">initialize_copy_iv</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">other</span>)
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword">self</span>, <span class="ruby-constant">Closer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">__getobj__</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-length">
            
              <b>length</b>()
            
            <a href="../classes/Tempfile.html#method-i-length" name="method-i-length" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="Tempfile.html#method-i-size">size</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-open">
            
              <b>open</b>()
            
            <a href="../classes/Tempfile.html#method-i-open" name="method-i-open" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Opens or reopens the file with mode “r+”.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-open_source')" id="l_method-i-open_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L188" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-open_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 188</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">open</span>
  <span class="ruby-identifier">_close</span>
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">undefine_finalizer</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-identifier">mode</span> = <span class="ruby-ivar">@mode</span> <span class="ruby-operator">&amp;</span> <span class="ruby-operator">~</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">CREAT</span><span class="ruby-operator">|</span><span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCL</span>)
  <span class="ruby-identifier">__setobj__</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-operator">**</span><span class="ruby-ivar">@opts</span>))
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword">self</span>, <span class="ruby-constant">Closer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">__getobj__</span>))
  <span class="ruby-identifier">__getobj__</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-path">
            
              <b>path</b>()
            
            <a href="../classes/Tempfile.html#method-i-path" name="method-i-path" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the full path name of the temporary file. This will be nil if <a href="Tempfile.html#method-i-unlink"><code>unlink</code></a> has been called.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-path_source')" id="l_method-i-path_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L268" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-path_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">path</span>
  <span class="ruby-ivar">@unlinked</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-size">
            
              <b>size</b>()
            
            <a href="../classes/Tempfile.html#method-i-size" name="method-i-size" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns the size of the temporary file.  As a side effect, the <a href="IO.html"><code>IO</code></a> buffer is flushed before determining the size.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Tempfile.html#method-i-length">length</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-size_source')" id="l_method-i-size_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L274" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 274</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">size</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">closed?</span>
    <span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">size</span> <span class="ruby-comment"># File#size calls rb_io_flush_raw()</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-unlink">
            
              <b>unlink</b>()
            
            <a href="../classes/Tempfile.html#method-i-unlink" name="method-i-unlink" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Unlinks (deletes) the file from the filesystem. One should always unlink the file after using it, as is explained in the “Explicit close” good practice section in the <a href="Tempfile.html"><code>Tempfile</code></a> overview:</p>

<pre><code>file = Tempfile.new(&#39;foo&#39;)
begin
   # ...do something with file...
ensure
   file.close
   file.unlink   # deletes the temp file
end
</code></pre>

<h3 id="method-i-unlink-label-Unlink-before-close">Unlink-before-close</h3>

<p>On POSIX systems it’s possible to unlink a file before closing it. This practice is explained in detail in the <a href="Tempfile.html"><code>Tempfile</code></a> overview (section “Unlink after creation”); please refer there for more information.</p>

<p>However, unlink-before-close may not be supported on non-POSIX operating systems. Microsoft Windows is the most notable case: unlinking a non-closed file will result in an error, which this method will silently ignore. If you want to practice unlink-before-close whenever possible, then you should write code like this:</p>

<pre><code>file = Tempfile.new(&#39;foo&#39;)
file.unlink   # On Windows this silently fails.
begin
   # ... do something with file ...
ensure
   file.close!   # Closes the file handle. If the file wasn&#39;t unlinked
                 # because #unlink failed, then this method will attempt
                 # to do so again.
end
</code></pre>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="Tempfile.html#method-i-delete">delete</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-unlink_source')" id="l_method-i-unlink_source">show</a>
                
                  | <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/lib/tempfile.rb#L252" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-unlink_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/lib/tempfile.rb, line 252</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unlink</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@unlinked</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">__getobj__</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span>
    <span class="ruby-comment"># may not be able to unlink on Windows; just ignore</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">undefine_finalizer</span>(<span class="ruby-ivar">@finalizer_obj</span>)
  <span class="ruby-ivar">@unlinked</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
