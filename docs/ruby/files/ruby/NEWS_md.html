<!DOCTYPE html>
<html lang="en">
<head>
    <title>NEWS.md</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='[]'>

</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            NEWS.md
        </h2>
        <ul class="files">
            
            <li>
                ruby/NEWS.md
                
                    <a href="https://github.com/ruby/ruby/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/NEWS.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2024-05-24 23:57:53 +0300</li>
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="label-NEWS+for+Ruby+3.3.0"><a href="NEWS_md.html">NEWS</a> for Ruby 3.3.0</h1>

<p>This document is a list of user-visible feature changes since the <strong>3.2.0</strong> release, except for bug fixes.</p>

<p>Note that each entry is kept to a minimum, see links for details.</p>

<h2 id="label-Command+line+options">Command line options</h2>
<ul><li>
<p>A new <code>performance</code> warning category was introduced.  They are not displayed by default even in verbose mode.  Turn them on with <code>-W:performance</code> or <code>Warning[:performance] = true</code>. [<a href="https://bugs.ruby-lang.org/issues/19538">Feature #19538</a>]</p>
</li><li>
<p>A new <code>RUBY_CRASH_REPORT</code> environment variable was introduced to allow  redirecting Ruby crash reports to a file or sub command. See the <code>BUG REPORT ENVIRONMENT</code>  section of the ruby manpage for further details. [<a href="https://bugs.ruby-lang.org/issues/19790">Feature #19790</a>]</p>
</li></ul>

<h2 id="label-Core+classes+updates">Core classes updates</h2>

<p>Note: Weâ€™re only listing outstanding class updates.</p>
<ul><li>
<p><a href="../../classes/Array.html"><code>Array</code></a></p>
<ul><li>
<p><a href="../../classes/Array.html#method-i-pack"><code>Array#pack</code></a> now raises <a href="../../classes/ArgumentError.html"><code>ArgumentError</code></a> for unknown directives. [<a href="https://bugs.ruby-lang.org/issues/19150">Bug #19150</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Dir.html"><code>Dir</code></a></p>
<ul><li>
<p><a href="../../classes/Dir.html#method-c-for_fd"><code>Dir.for_fd</code></a> added for returning a <a href="../../classes/Dir.html"><code>Dir</code></a> object for the directory specified  by the provided directory file descriptor. [<a href="https://bugs.ruby-lang.org/issues/19347">Feature #19347</a>]</p>
</li><li>
<p><a href="../../classes/Dir.html#method-c-fchdir"><code>Dir.fchdir</code></a> added for changing the directory to the directory specified  by the provided directory file descriptor. [<a href="https://bugs.ruby-lang.org/issues/19347">Feature #19347</a>]</p>
</li><li>
<p><a href="../../classes/Dir.html#method-i-chdir"><code>Dir#chdir</code></a> added for changing the directory to the directory specified by  the provided <code>Dir</code> object. [<a href="https://bugs.ruby-lang.org/issues/19347">Feature #19347</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Encoding.html"><code>Encoding</code></a></p>
<ul><li>
<p><code>Encoding#replicate</code> has been removed, it was already deprecated. [<a href="https://bugs.ruby-lang.org/issues/18949">Feature #18949</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Fiber.html"><code>Fiber</code></a></p>
<ul><li>
<p>Introduce <a href="../../classes/Fiber.html#method-i-kill"><code>Fiber#kill</code></a>. [<a href="https://bugs.ruby-lang.org/issues/595">Bug #595</a>]</p>

<pre><code>fiber = Fiber.new do
  while true
    puts &quot;Yielding...&quot;
    Fiber.yield
  end
ensure
  puts &quot;Exiting...&quot;
end

fiber.resume
# Yielding...
fiber.kill
# Exiting...
</code></pre>
</li></ul>
</li><li>
<p><a href="../../classes/MatchData.html"><code>MatchData</code></a></p>
<ul><li>
<p><a href="../../classes/MatchData.html#method-i-named_captures"><code>MatchData#named_captures</code></a> now accepts optional <code>symbolize_names</code>  keyword. [<a href="https://bugs.ruby-lang.org/issues/19591">Feature #19591</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Module.html"><code>Module</code></a></p>
<ul><li>
<p><a href="../../classes/Module.html#method-i-set_temporary_name"><code>Module#set_temporary_name</code></a> added for setting a temporary name for a  module. [<a href="https://bugs.ruby-lang.org/issues/19521">Feature #19521</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/ObjectSpace/WeakKeyMap.html"><code>ObjectSpace::WeakKeyMap</code></a></p>
<ul><li>
<p>New core class to build collections with weak references.  The class use equality semantic to lookup keys like a regular hash,  but it doesn't hold strong references on the keys. [<a href="https://bugs.ruby-lang.org/issues/18498">Feature #18498</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/ObjectSpace/WeakMap.html"><code>ObjectSpace::WeakMap</code></a></p>
<ul><li>
<p><a href="../../classes/ObjectSpace/WeakMap.html#method-i-delete"><code>ObjectSpace::WeakMap#delete</code></a> was added to eagerly clear weak map  entries. [<a href="https://bugs.ruby-lang.org/issues/19561">Feature #19561</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Proc.html"><code>Proc</code></a></p>
<ul><li>
<p>Now <a href="../../classes/Object.html#method-i-dup"><code>Proc#dup</code></a> and <a href="../../classes/Kernel.html#method-i-clone"><code>Proc#clone</code></a> call <code>#initialize_dup</code> and <code>#initialize_clone</code>  hooks respectively. [<a href="https://bugs.ruby-lang.org/issues/19362">Feature #19362</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Process.html"><code>Process</code></a></p>
<ul><li>
<p>New <a href="../../classes/Process.html#method-c-warmup"><code>Process.warmup</code></a> method that notify the Ruby virtual machine that the boot sequence is finished,  and that now is a good time to optimize the application. This is useful  for long-running applications. The actual optimizations performed are entirely  implementation-specific and may change in the future without notice. [<a href="https://bugs.ruby-lang.org/issues/18885">Feature #18885</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Process/Status.html"><code>Process::Status</code></a></p>
<ul><li>
<p><a href="../../classes/Process/Status.html"><code>Process::Status</code></a>#&amp; and <a href="../../classes/Process/Status.html#method-i-3E-3E"><code>Process::Status#&gt;&gt;</code></a> are deprecated. [<a href="https://bugs.ruby-lang.org/issues/19868">Bug #19868</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Range.html"><code>Range</code></a></p>
<ul><li>
<p><a href="../../classes/Range.html#method-i-reverse_each"><code>Range#reverse_each</code></a> can now process beginless ranges with an <a href="../../classes/Integer.html"><code>Integer</code></a> endpoint. [<a href="https://bugs.ruby-lang.org/issues/18515">Feature #18515</a>]</p>
</li><li>
<p><a href="../../classes/Range.html#method-i-reverse_each"><code>Range#reverse_each</code></a> now raises <a href="../../classes/TypeError.html"><code>TypeError</code></a> for endless ranges. [<a href="https://bugs.ruby-lang.org/issues/18551">Feature #18551</a>]</p>
</li><li>
<p><a href="../../classes/Range.html#method-i-overlap-3F"><code>Range#overlap?</code></a> added for checking if two ranges overlap. [<a href="https://bugs.ruby-lang.org/issues/19839">Feature #19839</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Refinement.html"><code>Refinement</code></a></p>
<ul><li>
<p>Add Refinement#target as an alternative of Refinement#refined_class.  Refinement#refined_class is deprecated and will be removed in Ruby  3.4. [<a href="https://bugs.ruby-lang.org/issues/19714">Feature #19714</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Regexp.html"><code>Regexp</code></a></p>
<ul><li>
<p>The cache-based optimization now supports lookarounds and atomic groupings. That is, match  for <a href="../../classes/Regexp.html"><code>Regexp</code></a> containing these extensions can now also be performed in linear time to the length  of the input string. However, these cannot contain captures and cannot be nested. [<a href="https://bugs.ruby-lang.org/issues/19725">Feature #19725</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/String.html"><code>String</code></a></p>
<ul><li>
<p><a href="../../classes/String.html#method-i-unpack"><code>String#unpack</code></a> now raises <a href="../../classes/ArgumentError.html"><code>ArgumentError</code></a> for unknown directives. [<a href="https://bugs.ruby-lang.org/issues/19150">Bug #19150</a>]</p>
</li><li>
<p><a href="../../classes/String.html#method-i-bytesplice"><code>String#bytesplice</code></a> now accepts new arguments index/length or range of the  source string to be copied. [<a href="https://bugs.ruby-lang.org/issues/19314">Feature #19314</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Thread/Queue.html"><code>Thread::Queue</code></a></p>
<ul><li>
<p><a href="../../classes/Thread/Queue.html#method-i-freeze"><code>Thread::Queue#freeze</code></a> now raises <a href="../../classes/TypeError.html"><code>TypeError</code></a>. [<a href="https://bugs.ruby-lang.org/issues/17146">Bug #17146</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Thread/SizedQueue.html"><code>Thread::SizedQueue</code></a></p>
<ul><li>
<p><a href="../../classes/Thread/SizedQueue.html#method-i-freeze"><code>Thread::SizedQueue#freeze</code></a> now raises <a href="../../classes/TypeError.html"><code>TypeError</code></a>. [<a href="https://bugs.ruby-lang.org/issues/17146">Bug #17146</a>]</p>
</li></ul>
</li><li>
<p><a href="../../classes/Time.html"><code>Time</code></a></p>
<ul><li>
<p><a href="../../classes/Time.html#method-c-new"><code>Time.new</code></a> with a string argument became stricter. [<a href="https://bugs.ruby-lang.org/issues/19293">Bug #19293</a>]</p>

<pre><code>Time.new(&#39;2023-12-20&#39;)
#  no time information (ArgumentError)
</code></pre>
</li></ul>
</li><li>
<p><a href="../../classes/TracePoint.html"><code>TracePoint</code></a></p>
<ul><li>
<p><a href="../../classes/TracePoint.html"><code>TracePoint</code></a> supports <code>rescue</code> event. When the raised exception was rescued,  the <a href="../../classes/TracePoint.html"><code>TracePoint</code></a> will fire the hook. <code>rescue</code> event only supports Ruby-level  <code>rescue</code>. [<a href="https://bugs.ruby-lang.org/issues/19572">Feature #19572</a>]</p>
</li></ul>
</li></ul>

<h2 id="label-Stdlib+updates">Stdlib updates</h2>
<ul><li>
<p>RubyGems and <a href="../../classes/Bundler.html"><code>Bundler</code></a> warn if users do <code>require</code> the following gems without adding them to Gemfile or gemspec.  This is because they will become the bundled gems in the future version of Ruby. This warning is suppressed  if you use bootsnap gem. We recommend to run your application with <code>DISABLE_BOOTSNAP=1</code> environmental variable  at least once. This is limitation of this version.  [<a href="https://bugs.ruby-lang.org/issues/19351">Feature #19351</a>] [<a href="https://bugs.ruby-lang.org/issues/19776">Feature #19776</a>] [<a href="https://bugs.ruby-lang.org/issues/19843">Feature #19843</a>]</p>
<ul><li>
<p>abbrev</p>
</li><li>
<p>base64</p>
</li><li>
<p>bigdecimal</p>
</li><li>
<p>csv</p>
</li><li>
<p>drb</p>
</li><li>
<p>getoptlong</p>
</li><li>
<p>mutex_m</p>
</li><li>
<p>nkf</p>
</li><li>
<p>observer</p>
</li><li>
<p>racc</p>
</li><li>
<p>resolv-replace</p>
</li><li>
<p>rinda</p>
</li><li>
<p>syslog</p>
</li><li>
<p>abbrev</p>
</li><li>
<p>base64</p>
</li><li>
<p>bigdecimal</p>
</li><li>
<p>csv</p>
</li><li>
<p>drb</p>
</li><li>
<p>getoptlong</p>
</li><li>
<p>mutex_m</p>
</li><li>
<p>nkf</p>
</li><li>
<p>observer</p>
</li><li>
<p>racc</p>
</li><li>
<p>resolv-replace</p>
</li><li>
<p>rinda</p>
</li><li>
<p>syslog</p>
</li></ul>
</li><li>
<p><a href="../../classes/BasicSocket.html#method-i-recv"><code>Socket#recv</code></a> and <a href="../../classes/BasicSocket.html#method-i-recv_nonblock"><code>Socket#recv_nonblock</code></a> returns <code>nil</code> instead of an empty string on closed  connections. <a href="../../classes/BasicSocket.html#method-i-recvmsg"><code>Socket#recvmsg</code></a> and <a href="../../classes/BasicSocket.html#method-i-recvmsg_nonblock"><code>Socket#recvmsg_nonblock</code></a> returns <code>nil</code> instead of an empty packet on closed  connections. [<a href="https://bugs.ruby-lang.org/issues/19012">Bug #19012</a>]</p>
</li><li>
<p>Name resolution such as <a href="../../classes/Socket.html#method-c-getaddrinfo"><code>Socket.getaddrinfo</code></a>, <a href="../../classes/Socket.html#method-c-getnameinfo"><code>Socket.getnameinfo</code></a>, <a href="../../classes/Addrinfo.html#method-c-getaddrinfo"><code>Addrinfo.getaddrinfo</code></a>, etc.  can now be interrupted. [<a href="https://bugs.ruby-lang.org/issues/19965">Feature #19965</a>]</p>
</li><li>
<p><a href="../../classes/Random/Formatter.html#method-i-alphanumeric"><code>Random::Formatter#alphanumeric</code></a> is extended to accept optional <code>chars</code>  keyword argument. [<a href="https://bugs.ruby-lang.org/issues/18183">Feature #18183</a>]</p>
</li></ul>

<p>The following default gem is added.</p>
<ul><li>
<p>prism 0.19.0</p>
</li></ul>

<p>The following default gems are updated.</p>
<ul><li>
<p>RubyGems 3.5.3</p>
</li><li>
<p>abbrev 0.1.2</p>
</li><li>
<p>base64 0.2.0</p>
</li><li>
<p>benchmark 0.3.0</p>
</li><li>
<p>bigdecimal 3.1.5</p>
</li><li>
<p>bundler 2.5.3</p>
</li><li>
<p>cgi 0.4.1</p>
</li><li>
<p>csv 3.2.8</p>
</li><li>
<p>date 3.3.4</p>
</li><li>
<p>delegate 0.3.1</p>
</li><li>
<p>drb 2.2.0</p>
</li><li>
<p>english 0.8.0</p>
</li><li>
<p>erb 4.0.3</p>
</li><li>
<p>error_highlight 0.6.0</p>
</li><li>
<p>etc 1.4.3</p>
</li><li>
<p>fcntl 1.1.0</p>
</li><li>
<p>fiddle 1.1.2</p>
</li><li>
<p>fileutils 1.7.2</p>
</li><li>
<p>find 0.2.0</p>
</li><li>
<p>getoptlong 0.2.1</p>
</li><li>
<p>io-console 0.7.1</p>
</li><li>
<p>io-nonblock 0.3.0</p>
</li><li>
<p>io-wait 0.3.1</p>
</li><li>
<p>ipaddr 1.2.6</p>
</li><li>
<p>irb 1.11.0</p>
</li><li>
<p>json 2.7.1</p>
</li><li>
<p>logger 1.6.0</p>
</li><li>
<p>mutex_m 0.2.0</p>
</li><li>
<p>net-http 0.4.0</p>
</li><li>
<p>net-protocol 0.2.2</p>
</li><li>
<p>nkf 0.1.3</p>
</li><li>
<p>observer 0.1.2</p>
</li><li>
<p>open-uri 0.4.1</p>
</li><li>
<p>open3 0.2.1</p>
</li><li>
<p>openssl 3.2.0</p>
</li><li>
<p>optparse 0.4.0</p>
</li><li>
<p>ostruct 0.6.0</p>
</li><li>
<p>pathname 0.3.0</p>
</li><li>
<p>pp 0.5.0</p>
</li><li>
<p>prettyprint 0.2.0</p>
</li><li>
<p>pstore 0.1.3</p>
</li><li>
<p>psych 5.1.2</p>
</li><li>
<p>rdoc 6.6.2</p>
</li><li>
<p>readline 0.0.4</p>
</li><li>
<p>reline 0.4.1</p>
</li><li>
<p>resolv 0.3.0</p>
</li><li>
<p>rinda 0.2.0</p>
</li><li>
<p>securerandom 0.3.1</p>
</li><li>
<p>set 1.1.0</p>
</li><li>
<p>shellwords 0.2.0</p>
</li><li>
<p>singleton 0.2.0</p>
</li><li>
<p>stringio 3.1.0</p>
</li><li>
<p>strscan 3.0.7</p>
</li><li>
<p>syntax_suggest 2.0.0</p>
</li><li>
<p>syslog 0.1.2</p>
</li><li>
<p>tempfile 0.2.1</p>
</li><li>
<p>time 0.3.0</p>
</li><li>
<p>timeout 0.4.1</p>
</li><li>
<p>tmpdir 0.2.0</p>
</li><li>
<p>tsort 0.2.0</p>
</li><li>
<p>un 0.3.0</p>
</li><li>
<p>uri 0.13.0</p>
</li><li>
<p>weakref 0.1.3</p>
</li><li>
<p>win32ole 1.8.10</p>
</li><li>
<p>yaml 0.3.0</p>
</li><li>
<p>zlib 3.1.0</p>
</li></ul>

<p>The following bundled gem is promoted from default gems.</p>
<ul><li>
<p>racc 1.7.3</p>
</li></ul>

<p>The following bundled gems are updated.</p>
<ul><li>
<p>minitest 5.20.0</p>
</li><li>
<p>rake 13.1.0</p>
</li><li>
<p>test-unit 3.6.1</p>
</li><li>
<p>rexml 3.2.6</p>
</li><li>
<p>rss 0.3.0</p>
</li><li>
<p>net-ftp 0.3.3</p>
</li><li>
<p>net-imap 0.4.9</p>
</li><li>
<p>net-smtp 0.4.0</p>
</li><li>
<p>rbs 3.4.0</p>
</li><li>
<p>typeprof 0.21.9</p>
</li><li>
<p>debug 1.9.1</p>
</li></ul>

<p>See GitHub releases like <a href="https://github.com/ruby/logger/releases">Logger</a> or changelog for details of the default gems or bundled gems.</p>

<h3 id="label-Prism"><a href="../../classes/Prism.html"><code>Prism</code></a></h3>
<ul><li>
<p>Introduced <a href="https://github.com/ruby/prism">the Prism parser</a> as a default gem</p>
<ul><li>
<p><a href="../../classes/Prism.html"><code>Prism</code></a> is a portable, error tolerant, and maintainable recursive descent parser for the Ruby language</p>
</li></ul>
</li><li>
<p><a href="../../classes/Prism.html"><code>Prism</code></a> is production ready and actively maintained, you can use it in place of <a href="../../classes/Ripper.html"><code>Ripper</code></a></p>
<ul><li>
<p>There is <a href="https://ruby.github.io/prism/">extensive documentation</a> on how to use <a href="../../classes/Prism.html"><code>Prism</code></a></p>
</li><li>
<p><a href="../../classes/Prism.html"><code>Prism</code></a> is both a C library that will be used internally by CRuby and a Ruby gem that can be used by any tooling which needs to parse Ruby code</p>
</li><li>
<p>Notable methods in the <a href="../../classes/Prism.html"><code>Prism</code></a> API are:</p>
<ul><li>
<p><code>Prism.parse(source)</code> which returns the AST as part of a parse result object</p>
</li><li>
<p><code>Prism.parse_comments(source)</code> which returns the comments</p>
</li><li>
<p><code>Prism.parse_success?(source)</code> which returns true if there are no errors</p>
</li></ul>
</li></ul>
</li><li>
<p>You can make pull requests or issues directly on <a href="https://github.com/ruby/prism">the Prism repository</a> if you are interested in contributing</p>
</li><li>
<p>You can now use <code>ruby --parser=prism</code> or <code>RUBYOPT=&quot;--parser=prism&quot;</code> to experiment with the <a href="../../classes/Prism.html"><code>Prism</code></a> compiler. Please note that this flag is for debugging only.</p>
</li></ul>

<h2 id="label-Compatibility+issues">Compatibility issues</h2>
<ul><li>
<p>Subprocess creation/forking via the following file open methods is deprecated. [<a href="https://bugs.ruby-lang.org/issues/19630">Feature #19630</a>]</p>
<ul><li>
<p><a href="../../classes/Kernel.html#method-i-open"><code>Kernel#open</code></a></p>
</li><li>
<p><a href="../../classes/URI.html#method-c-open"><code>URI.open</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-binread"><code>IO.binread</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-foreach"><code>IO.foreach</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-readlines"><code>IO.readlines</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-read"><code>IO.read</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-write"><code>IO.write</code></a></p>
</li><li>
<p><a href="../../classes/Kernel.html#method-i-open"><code>Kernel#open</code></a></p>
</li><li>
<p><a href="../../classes/URI.html#method-c-open"><code>URI.open</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-binread"><code>IO.binread</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-foreach"><code>IO.foreach</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-readlines"><code>IO.readlines</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-read"><code>IO.read</code></a></p>
</li><li>
<p><a href="../../classes/IO.html#method-c-write"><code>IO.write</code></a></p>
</li></ul>
</li><li>
<p>When given a non-lambda, non-literal block, <a href="../../classes/Kernel.html#method-i-lambda"><code>Kernel#lambda</code></a> with now raises  <a href="../../classes/ArgumentError.html"><code>ArgumentError</code></a> instead of returning it unmodified. These usages have been  issuing warnings under the <code>Warning[:deprecated]</code> category since Ruby 3.0.0.  [<a href="https://bugs.ruby-lang.org/issues/19777">Feature #19777</a>]</p>
</li><li>
<p>The <code>RUBY_GC_HEAP_INIT_SLOTS</code> environment variable has been deprecated and  removed. Environment variables <code>RUBY_GC_HEAP_%d_INIT_SLOTS</code> should be  used instead. [<a href="https://bugs.ruby-lang.org/issues/19785">Feature #19785</a>]</p>
</li><li>
<p><code>it</code> calls without arguments in a block with no ordinary parameters are  deprecated. <code>it</code> will be a reference to the first block parameter in Ruby 3.4.  [<a href="https://bugs.ruby-lang.org/issues/18980">Feature #18980</a>]</p>
</li><li>
<p>Error message for <a href="../../classes/NoMethodError.html"><code>NoMethodError</code></a> have changed to not use the target object's <code>#inspect</code>  for efficiency, and says "instance of ClassName" instead. [<a href="https://bugs.ruby-lang.org/issues/18285">Feature #18285</a>]</p>

<pre><code>([1] * 100).nonexisting
# undefined method `nonexisting&#39; for an instance of Array (NoMethodError)
</code></pre>
</li><li>
<p>Now anonymous parameters forwarding is disallowed inside a block  that uses anonymous parameters. [<a href="https://bugs.ruby-lang.org/issues/19370">Feature #19370</a>]</p>
</li></ul>

<h2 id="label-Stdlib+compatibility+issues">Stdlib compatibility issues</h2>
<ul><li>
<p><code>racc</code> is promoted to bundled gems.</p>
<ul><li>
<p>You need to add <code>racc</code> to your <code>Gemfile</code> if you use <code>racc</code> under bundler environment.</p>
</li></ul>
</li><li>
<p><code>ext/readline</code> is retired</p>
<ul><li>
<p>We have <code>reline</code> that is pure Ruby implementation compatible with <code>ext/readline</code> API.  We rely on <code>reline</code> in the future. If you need to use <code>ext/readline</code>, you can install  <code>ext/readline</code> via rubygems.org with <code>gem install readline-ext</code>.</p>
</li><li>
<p>We no longer need to install libraries like <code>libreadline</code> or <code>libedit</code>.</p>
</li></ul>
</li></ul>

<h2 id="label-C+API+updates">C API updates</h2>
<ul><li>
<p><code>rb_postponed_job</code> updates</p>
</li><li>
<p>New APIs and deprecated APIs (see comments for details)</p>
<ul><li>
<p>added: <code>rb_postponed_job_preregister()</code></p>
</li><li>
<p>added: <code>rb_postponed_job_trigger()</code></p>
</li><li>
<p>deprecated: <code>rb_postponed_job_register()</code> (and semantic change. see below)</p>
</li><li>
<p>deprecated: <code>rb_postponed_job_register_one()</code></p>
</li><li>
<p>added: <code>rb_postponed_job_preregister()</code></p>
</li><li>
<p>added: <code>rb_postponed_job_trigger()</code></p>
</li><li>
<p>deprecated: <code>rb_postponed_job_register()</code> (and semantic change. see below)</p>
</li><li>
<p>deprecated: <code>rb_postponed_job_register_one()</code></p>
</li></ul>
</li><li>
<p>The postponed job APIs have been changed to address some rare crashes. To solve the issue, we introduced new two APIs and deprecated current APIs. The semantics of these functions have also changed slightly; <code>rb_postponed_job_register</code> now behaves like the <code>once</code> variant in that multiple calls with the same <code>func</code> might be coalesced into a single execution of the <code>func</code> [<a href="https://bugs.ruby-lang.org/issues/20057">Feature #20057</a>]</p>
</li><li>
<p>Some updates for internal thread event hook APIs</p>
</li><li>
<p><code>rb_internal_thread_event_data_t</code> with a target Ruby thread (VALUE) and callback functions (<code>rb_internal_thread_event_callback</code>) receive it. <a href="https://github.com/ruby/ruby/pull/8885">github.com/ruby/ruby/pull/8885</a></p>
</li><li>
<p>The following functions are introduced to manipulate Ruby thread local data from internal thread event hook APIs (they are introduced since Ruby 3.2). <a href="https://github.com/ruby/ruby/pull/8936">github.com/ruby/ruby/pull/8936</a></p>
<ul><li>
<p><code>rb_internal_thread_specific_key_create()</code></p>
</li><li>
<p><code>rb_internal_thread_specific_get()</code></p>
</li><li>
<p><code>rb_internal_thread_specific_set()</code></p>
</li></ul>
</li><li>
<p><code>rb_profile_thread_frames()</code> is introduced to get a frames from  a specific thread.  [<a href="https://bugs.ruby-lang.org/issues/10602">Feature #10602</a>]</p>
</li><li>
<p><code>rb_data_define()</code> is introduced to define <code>Data</code>. [<a href="https://bugs.ruby-lang.org/issues/19757">Feature #19757</a>]</p>
</li><li>
<p><code>rb_ext_resolve_symbol()</code> is introduced to search a function from  extension libraries. [<a href="https://bugs.ruby-lang.org/issues/20005">Feature #20005</a>]</p>
</li><li>
<p><a href="../../classes/IO.html"><code>IO</code></a> related updates:</p>
</li><li>
<p>The details of <code>rb_io_t</code> will be hidden and deprecated attributes are added for each members. [<a href="https://bugs.ruby-lang.org/issues/19057">Feature #19057</a>]</p>
</li><li>
<p><code>rb_io_path(VALUE io)</code> is introduced to get a path of <code>io</code>.</p>
</li><li>
<p><code>rb_io_closed_p(VALUE io)</code> to get opening or closing of <code>io</code>.</p>
</li><li>
<p><code>rb_io_mode(VALUE io)</code> to get the mode of <code>io</code>.</p>
</li><li>
<p><code>rb_io_open_descriptor()</code> is introduced to make an <a href="../../classes/IO.html"><code>IO</code></a> object from a file descriptor.</p>
</li></ul>

<h2 id="label-Implementation+improvements">Implementation improvements</h2>

<h3 id="label-Parser">Parser</h3>
<ul><li>
<p>Replace Bison with <a href="https://github.com/ruby/lrama">Lrama LALR parser generator</a>.  No need to install Bison to build Ruby from source code anymore.  We will no longer suffer bison compatibility issues and we can use new features by just implementing it to Lrama. [<a href="https://bugs.ruby-lang.org/issues/19637">Feature #19637</a>]</p>
</li><li>
<p>See <a href="https://rubykaigi.org/2023/presentations/spikeolaf.html">The future vision of Ruby Parser</a> for detail.</p>
</li><li>
<p>Lrama internal parser is a LR parser generated by Racc for maintainability.</p>
</li><li>
<p>Parameterizing Rules <code>(?, *, +)</code> are supported, it will be used in Ruby parse.y.</p>
</li></ul>

<h3 id="label-GC+-2F+Memory+management"><a href="../../classes/GC.html"><code>GC</code></a> / Memory management</h3>
<ul><li>
<p>Major performance improvements over Ruby 3.2</p>
<ul><li>
<p>Young objects referenced by old objects are no longer immediately  promoted to the old generation. This significantly reduces the frequency of  major <a href="../../classes/GC.html"><code>GC</code></a> collections. [<a href="https://bugs.ruby-lang.org/issues/19678">Feature #19678</a>]</p>
</li><li>
<p>A new <code>REMEMBERED_WB_UNPROTECTED_OBJECTS_LIMIT_RATIO</code> tuning variable was  introduced to control the number of unprotected objects cause a major <a href="../../classes/GC.html"><code>GC</code></a>  collection to trigger. The default is set to <code>0.01</code> (1%). This significantly  reduces the frequency of major <a href="../../classes/GC.html"><code>GC</code></a> collection. [<a href="https://bugs.ruby-lang.org/issues/19571">Feature #19571</a>]</p>
</li><li>
<p>Write Barriers were implemented for many core types that were missing them,  notably <code>Time</code>, <code>Enumerator</code>, <code>MatchData</code>, <code>Method</code>, <code>File::Stat</code>, <code>BigDecimal</code>  and several others. This significantly reduces minor <a href="../../classes/GC.html"><code>GC</code></a> collection time and major  <a href="../../classes/GC.html"><code>GC</code></a> collection frequency.</p>
</li><li>
<p>Most core classes are now using Variable Width Allocation, notably <code>Hash</code>, <code>Time</code>,  <code>Thread::Backtrace</code>, <code>Thread::Backtrace::Location</code>, <code>File::Stat</code>, <code>Method</code>.  This makes these classes faster to allocate and free, use less memory and reduce  heap fragmentation.</p>
</li></ul>
</li><li>
<p><code>defined?(@ivar)</code> is optimized with <a href="../../classes/Object.html"><code>Object</code></a> Shapes.</p>
</li></ul>

<h3 id="label-YJIT">YJIT</h3>
<ul><li>
<p>Major performance improvements over Ruby 3.2</p>
</li><li>
<p>Support for splat and rest arguments has been improved.</p>
</li><li>
<p>Registers are allocated for stack operations of the virtual machine.</p>
</li><li>
<p>More calls with optional arguments are compiled. <a href="../../classes/Exception.html"><code>Exception</code></a> handlers are also compiled.</p>
</li><li>
<p>Unsupported call types and megamorphic call sites no longer exit to the interpreter.</p>
</li><li>
<p>Basic methods like Rails <code>#blank?</code> and {specialized <code>#present?</code><a href="https://github.com/rails/rails/pull/49909">}</a> are inlined.</p>
</li><li>
<p><code>Integer#*</code>, <code>Integer#!=</code>, <code>String#!=</code>, <code>String#getbyte</code>, <code>Kernel#block_given?</code>, <code>Kernel#is_a?</code>, <code>Kernel#instance_of?</code>, and <code>Module#===</code> are specially optimized.</p>
</li><li>
<p>Compilation speed is now slightly faster than Ruby 3.2.</p>
</li><li>
<p>Now more than 3x faster than the interpreter on Optcarrot!</p>
</li><li>
<p>Significantly improved memory usage over Ruby 3.2</p>
<ul><li>
<p>Metadata for compiled code uses a lot less memory.</p>
</li><li>
<p><code>--yjit-call-threshold</code> is automatically raised from 30 to 120  when the application has more than 40,000 ISEQs.</p>
</li><li>
<p><code>--yjit-cold-threshold</code> is added to skip compiling cold ISEQs.</p>
</li><li>
<p>More compact code is generated on Arm64.</p>
</li></ul>
</li><li>
<p>Code <a href="../../classes/GC.html"><code>GC</code></a> is now disabled by default</p>
</li><li>
<p><code>--yjit-exec-mem-size</code> is treated as a hard limit where compilation of new code stops.</p>
</li><li>
<p>No sudden drops in performance due to code <a href="../../classes/GC.html"><code>GC</code></a>. Better copy-on-write behavior on servers reforking with <a href="https://github.com/shopify/pitchfork">Pitchfork</a>.</p>
</li><li>
<p>You can still enable code <a href="../../classes/GC.html"><code>GC</code></a> if desired with <code>--yjit-code-gc</code></p>
</li><li>
<p>Add <code>RubyVM::YJIT.enable</code> that can enable YJIT at run-time</p>
</li><li>
<p>You can start YJIT without modifying command-line arguments or environment variables. Rails 7.2 will <a href="https://github.com/rails/rails/pull/49947">enable YJIT by default</a> using this method.</p>
</li><li>
<p>This can also be used to enable YJIT only once your application is done booting. <code>--yjit-disable</code> can be used if you want to use other YJIT options while disabling YJIT at boot.</p>
</li><li>
<p>More YJIT stats are available by default</p>
</li><li>
<p><code>yjit_alloc_size</code> and several more metadata-related stats are now available by default.</p>
</li><li>
<p><code>ratio_in_yjit</code> stat produced by <code>--yjit-stats</code> is now available in release builds, a special stats or dev build is no longer required to access most stats.</p>
</li><li>
<p>Add more profiling capabilities</p>
</li><li>
<p><code>--yjit-perf</code> is added to facilitate profiling with Linux perf.</p>
</li><li>
<p><code>--yjit-trace-exits</code> now supports sampling with <code>--yjit-trace-exits-sample-rate=N</code></p>
</li><li>
<p>More thorough testing and multiple bug fixes</p>
</li><li>
<p><code>--yjit-stats=quiet</code> is added to avoid printing stats on exit.</p>
</li></ul>

<h3 id="label-MJIT">MJIT</h3>
<ul><li>
<p>MJIT is removed.</p>
<ul><li>
<p><code>--disable-jit-support</code> is removed. Consider using <code>--disable-yjit --disable-rjit</code> instead.</p>
</li></ul>
</li></ul>

<h3 id="label-RJIT">RJIT</h3>
<ul><li>
<p>Introduced a pure-Ruby JIT compiler RJIT.</p>
<ul><li>
<p>RJIT supports only x86_64 architecture on Unix platforms.</p>
</li><li>
<p>Unlike MJIT, it doesnâ€™t require a C compiler at runtime.</p>
</li></ul>
</li><li>
<p>RJIT exists only for experimental purposes.</p>
<ul><li>
<p>You should keep using YJIT in production.</p>
</li></ul>
</li></ul>

<h3 id="label-M-3AN+Thread+scheduler">M:N <a href="../../classes/Thread.html"><code>Thread</code></a> scheduler</h3>
<ul><li>
<p>M:N <a href="../../classes/Thread.html"><code>Thread</code></a> scheduler is introduced. [<a href="https://bugs.ruby-lang.org/issues/19842">Feature #19842</a>]</p>
<ul><li>
<p>Background: Ruby 1.8 and before, M:1 thread scheduler (M Ruby threads  with 1 native thread. Called as User level threads or Green threads)  is used. Ruby 1.9 and later, 1:1 thread scheduler (1 Ruby thread with  1 native thread). M:1 threads takes lower resources compare with 1:1  threads because it needs only 1 native threads. However it is difficult  to support context switching for all of blocking operation so 1:1  threads are employed from Ruby 1.9. M:N thread scheduler uses N native  threads for M Ruby threads (N is small number in general). It doesnâ€™t  need same number of native threads as Ruby threads (similar to the M:1  thread scheduler). Also our M:N threads supports blocking operations  well same as 1:1 threads. See the ticket for more details.  Our M:N thread scheduler refers on the goroutine scheduler in the  Go language.</p>
</li><li>
<p>In a ractor, only 1 thread can run in a same time because of  implementation. Therefore, applications that use only one <a href="../../classes/Ractor.html"><code>Ractor</code></a>  (most applications) M:N thread scheduler works as M:1 thread scheduler  with further extension from Ruby 1.8.</p>
</li><li>
<p>M:N thread scheduler can introduce incompatibility for C-extensions,  so it is disabled by default on the main Ractors.  <code>RUBY_MN_THREADS=1</code> environment variable will enable it.  On non-main Ractors, M:N thread scheduler is enabled (and can not  disable it now).</p>
</li><li>
<p><code>N</code> (the number of native threads) can be specified with <code>RUBY_MAX_CPU</code>  environment variable. The default is 8.  Note that more than <code>N</code> native threads are used to support many kind of  blocking operations.</p>
</li></ul>
</li></ul>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </main>
  </body>
</html>
