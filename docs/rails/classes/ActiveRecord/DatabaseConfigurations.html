<!DOCTYPE html>
<html lang="en">
<head>
    <title>ActiveRecord::DatabaseConfigurations</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='["ActiveRecord", "DatabaseConfigurations"]'>


    <meta property="og:title" value="ActiveRecord::DatabaseConfigurations">

  
    
    <meta name="description" content="Active Record Database Configurations  ActiveRecord::DatabaseConfigurations returns an array of DatabaseConfig objects that are constructed from the application’s database configuration hash or URL st.">
    <meta property="og:description" content="Active Record Database Configurations  ActiveRecord::DatabaseConfigurations returns an array of DatabaseConfig objects that are constructed from the application’s database configuration hash or URL st.">
  

    <meta name="keywords" content="ActiveRecord::DatabaseConfigurations class, register_db_config_handler, new, configs_for, find_db_config, empty?, blank?">
</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            <span class="type">Class</span>
            ActiveRecord::DatabaseConfigurations
            
                <span class="parent">&lt;
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h2>
        <ul class="files">
            
            <li><a href="../../files/rails/activerecord/lib/active_record/database_configurations_rb.html">rails/activerecord/lib/active_record/database_configurations.rb</a></li>
            
            <li><a href="../../files/rails/activerecord/lib/active_record/database_configurations/connection_url_resolver_rb.html">rails/activerecord/lib/active_record/database_configurations/connection_url_resolver.rb</a></li>
            
            <li><a href="../../files/rails/activerecord/lib/active_record/database_configurations/database_config_rb.html">rails/activerecord/lib/active_record/database_configurations/database_config.rb</a></li>
            
            <li><a href="../../files/rails/activerecord/lib/active_record/database_configurations/hash_config_rb.html">rails/activerecord/lib/active_record/database_configurations/hash_config.rb</a></li>
            
            <li><a href="../../files/rails/activerecord/lib/active_record/database_configurations/url_config_rb.html">rails/activerecord/lib/active_record/database_configurations/url_config.rb</a></li>
            
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h1 id="class-ActiveRecord::DatabaseConfigurations-label-Active+Record+Database+Configurations">Active Record Database Configurations</h1>

<p><code>ActiveRecord::DatabaseConfigurations</code> returns an array of <code>DatabaseConfig</code> objects that are constructed from the application’s database configuration hash or URL string.</p>

<p>The array of <code>DatabaseConfig</code> objects in an application default to either a <a href="DatabaseConfigurations/HashConfig.html"><code>HashConfig</code></a> or <a href="DatabaseConfigurations/UrlConfig.html"><code>UrlConfig</code></a>. You can retrieve your application’s config by using <a href="Core.html#method-c-configurations"><code>ActiveRecord::Base.configurations</code></a>.</p>

<p>If you register a custom handler, objects will be created according to the conditions of the handler. See <a href="DatabaseConfigurations.html#method-c-register_db_config_handler"><code>::register_db_config_handler</code></a> for more on registering custom handlers.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="DatabaseConfigurations/HashConfig.html">ActiveRecord::DatabaseConfigurations::HashConfig</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="DatabaseConfigurations/InvalidConfigurationError.html">ActiveRecord::DatabaseConfigurations::InvalidConfigurationError</a>
        </li>
      
        <li>
          <span class="type">CLASS</span>
          <a href="DatabaseConfigurations/UrlConfig.html">ActiveRecord::DatabaseConfigurations::UrlConfig</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-blank-3F">blank?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-configs_for">configs_for</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-empty-3F">empty?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-find_db_config">find_db_config</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-register_db_config_handler">register_db_config_handler</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    
      <!-- Section attributes -->
      <h2 class="sectiontitle">Attributes</h2>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>configurations</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <h2 class="sectiontitle">Class Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-c-new">
            
              <b>new</b>(configurations = {})
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/activerecord/lib/active_record/database_configurations.rb#L73" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activerecord/lib/active_record/database_configurations.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">configurations</span> = {})
  <span class="ruby-ivar">@configurations</span> = <span class="ruby-identifier">build_configs</span>(<span class="ruby-identifier">configurations</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-c-register_db_config_handler">
            
              <b>register_db_config_handler</b>(&amp;block)
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-c-register_db_config_handler" name="method-c-register_db_config_handler" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Allows an application to register a custom handler for database configuration objects. This is useful for creating a custom handler that responds to methods your application needs but Active Record doesn’t implement. For example if you are using Vitess, you may want your Vitess configurations to respond to ‘sharded?`. To implement this define the following in an initializer:</p>

<pre><code>ActiveRecord::DatabaseConfigurations.register_db_config_handler do |env_name, name, url, config|
  next unless config.key?(:vitess)
  VitessConfig.new(env_name, name, config)
end
</code></pre>

<p>Note: applications must handle the condition in which custom config should be created in your handler registration otherwise all objects will use the custom handler.</p>

<p>Then define your <code>VitessConfig</code> to respond to the methods your application needs. It is recommended that you inherit from one of the existing database config classes to avoid having to reimplement all methods. Custom config handlers should only implement methods Active Record does not.</p>

<pre><code>class VitessConfig &lt; ActiveRecord::DatabaseConfigurations::UrlConfig
  def sharded?
    configuration_hash.fetch(&quot;sharded&quot;, false)
  end
end
</code></pre>

<p>For configs that have a <code>:vitess</code> key, a <code>VitessConfig</code> object will be created instead of a <code>UrlConfig</code>.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-c-register_db_config_handler_source')" id="l_method-c-register_db_config_handler_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/activerecord/lib/active_record/database_configurations.rb#L61" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-c-register_db_config_handler_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activerecord/lib/active_record/database_configurations.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">register_db_config_handler</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">db_config_handlers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
      <h2 class="sectiontitle">Instance Public methods</h2>
      
        <div class="method">
          <h3 class="title method-title" id="method-i-blank-3F">
            
              <b>blank?</b>()
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-i-blank-3F" name="method-i-blank-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              
            </div>
          

          

          
            <div class="aka">
              Alias for: <a href="DatabaseConfigurations.html#method-i-empty-3F">empty?</a>
            </div>
          

          
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-configs_for">
            
              <b>configs_for</b>(env_name: nil, name: nil, config_key: nil, include_hidden: false)
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-i-configs_for" name="method-i-configs_for" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Collects the configs for the environment and optionally the specification name passed in. To include replica configurations pass <code>include_hidden: true</code>.</p>

<p>If a name is provided a single <code>DatabaseConfig</code> object will be returned, otherwise an array of <code>DatabaseConfig</code> objects will be returned that corresponds with the environment and type requested.</p>

<h4 id="method-i-configs_for-label-Options">Options</h4>
<ul><li>
<p><code>env_name:</code> The environment name. Defaults to <code>nil</code> which will collect configs for all environments.</p>
</li><li>
<p><code>name:</code> The db config name (i.e. primary, animals, etc.). Defaults to <code>nil</code>. If no <code>env_name</code> is specified the config for the default env and the passed <code>name</code> will be returned.</p>
</li><li>
<p><code>config_key:</code> Selects configs that contain a particular key in the configuration hash. Useful for selecting configs that use a custom db config handler or finding configs with hashes that contain a particular key.</p>
</li><li>
<p><code>include_hidden:</code> Determines whether to include replicas and configurations hidden by <code>database_tasks: false</code> in the returned list. Most of the time we’re only iterating over the primary connections (i.e. migrations don’t need to run for the write and read connection). Defaults to <code>false</code>.</p>
</li></ul>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-configs_for_source')" id="l_method-i-configs_for_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/activerecord/lib/active_record/database_configurations.rb#L98" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-configs_for_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activerecord/lib/active_record/database_configurations.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configs_for</span>(<span class="ruby-value">env_name:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">name:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">config_key:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">include_hidden:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">env_name</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">default_env</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">configs</span> = <span class="ruby-identifier">env_with_configs</span>(<span class="ruby-identifier">env_name</span>)

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">include_hidden</span>
    <span class="ruby-identifier">configs</span> = <span class="ruby-identifier">configs</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_config</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">database_tasks?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">config_key</span>
    <span class="ruby-identifier">configs</span> = <span class="ruby-identifier">configs</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_config</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">configuration_hash</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">config_key</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">configs</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_config</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">configs</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-empty-3F">
            
              <b>empty?</b>()
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-i-empty-3F" name="method-i-empty-3F" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Checks if the application’s configurations are empty.</p>
            </div>
          

          
            <div class="aka">
              Also aliased as: <a href="DatabaseConfigurations.html#method-i-blank-3F">blank?</a>
            </div>
          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-empty-3F_source')" id="l_method-i-empty-3F_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/activerecord/lib/active_record/database_configurations.rb#L150" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-empty-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activerecord/lib/active_record/database_configurations.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">empty?</span>
  <span class="ruby-identifier">configurations</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <h3 class="title method-title" id="method-i-find_db_config">
            
              <b>find_db_config</b>(env)
            
            <a href="../../classes/ActiveRecord/DatabaseConfigurations.html#method-i-find_db_config" name="method-i-find_db_config" class="permalink">Link</a>
          </h3>

          
            <div class="description">
              <p>Returns a single <code>DatabaseConfig</code> object based on the requested environment.</p>

<p>If the application has multiple databases <code>find_db_config</code> will return the first <code>DatabaseConfig</code> for the environment.</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-find_db_config_source')" id="l_method-i-find_db_config_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/activerecord/lib/active_record/database_configurations.rb#L127" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-find_db_config_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activerecord/lib/active_record/database_configurations.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_db_config</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">configurations</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_config</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">for_current_env?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">env_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">env</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">env</span>)
  <span class="ruby-keyword">end</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">configurations</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">db_config</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">db_config</span>.<span class="ruby-identifier">env_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">env</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </main>
  </body>
</html>
