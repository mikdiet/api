<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='[]'>

</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            CHANGELOG.md
        </h2>
        <ul class="files">
            
            <li>
                rails/actionpack/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/49dc0a12f185d791f1826396035b54cf3fb1771e/actionpack/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2024-06-28 01:29:16 +0300</li>
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+7.1.3.4+-28June+04-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.3.4 (June 04, 2024)</h2>
<ul><li>
<p>Include the HTTP Permissions-Policy on non-HTML Content-Types [CVE-2024-28103]</p>
</li></ul>

<h2 id="label-Rails+7.1.3.3+-28May+16-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.3.3 (May 16, 2024)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.1.3.2+-28February+21-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.3.2 (February 21, 2024)</h2>
<ul><li>
<p>Fix <code>raise_on_missing_translations</code> not working correctly with the <code>translate</code> method in controllers after the patch for CVE-2024-26143.</p>
</li></ul>

<h2 id="label-Rails+7.1.3.1+-28February+21-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.3.1 (February 21, 2024)</h2>
<ul><li>
<p>Fix possible XSS vulnerability with the <code>translate</code> method in controllers</p>

<p>CVE-2024-26143</p>
</li><li>
<p>Fix ReDoS in Accept header parsing</p>

<p>CVE-2024-26142</p>
</li></ul>

<h2 id="label-Rails+7.1.3+-28January+16-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.3 (January 16, 2024)</h2>
<ul><li>
<p>Fix including <code>Rails.application.routes.url_helpers</code> directly in an <code>ActiveSupport::Concern.</code></p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Fix system tests when using a Chrome binary that has been downloaded by Selenium.</p>

<p><em>Jonathan Hefner</em></p>
</li></ul>

<h2 id="label-Rails+7.1.2+-28November+10-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.2 (November 10, 2023)</h2>
<ul><li>
<p>Fix a race condition that could cause a <code>Text file busy - chromedriver</code> error with parallel system tests</p>

<p><em>Matt Brictson</em></p>
</li><li>
<p>Fix <code>StrongParameters#extract_value</code> to include blank values</p>

<p>Otherwise composite parameters may not be parsed correctly when one of the component is blank.</p>

<p><em>fatkodima</em>, <em>Yasha Krasnou</em>, <em>Matthias Eiglsperger</em></p>
</li><li>
<p>Add <code>racc</code> as a dependency since it will become a bundled gem in Ruby 3.4.0</p>

<p><em>Hartley McGuire</em></p>
</li><li>
<p>Support handling Enumerator for non-buffered responses.</p>

<p><em>Zachary Scott</em></p>
</li></ul>

<h2 id="label-Rails+7.1.1+-28October+11-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.1 (October 11, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.1.0+-28October+05-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.0 (October 05, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.1.0.rc2+-28October+01-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.0.rc2 (October 01, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.1.0.rc1+-28September+27-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.0.rc1 (September 27, 2023)</h2>
<ul><li>
<p>Add support for <code>#deep_merge</code> and <code>#deep_merge!</code> to <code>ActionController::Parameters</code>.</p>

<p><em>Sean Doyle</em></p>
</li></ul>

<h2 id="label-Rails+7.1.0.beta1+-28September+13-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.0.beta1 (September 13, 2023)</h2>
<ul><li>
<p><code>AbstractController::Translation.raise_on_missing_translations</code> removed</p>

<p>This was a private API, and has been removed in favour of a more broadly applicable <code>config.i18n.raise_on_missing_translations</code>. See the upgrading guide for more information.</p>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Add <code>ActionController::Parameters#extract_value</code> method to allow extracting serialized values from params</p>

<pre><code>params = ActionController::Parameters.new(id: &quot;1_123&quot;, tags: &quot;ruby,rails&quot;)
params.extract_value(:id) # =&gt; [&quot;1&quot;, &quot;123&quot;]
params.extract_value(:tags, delimiter: &quot;,&quot;) # =&gt; [&quot;ruby&quot;, &quot;rails&quot;]
</code></pre>

<p><em>Nikita Vasilevsky</em></p>
</li><li>
<p>Parse JSON <code>response.parsed_body</code> with <code>ActiveSupport::HashWithIndifferentAccess</code></p>

<p>Integrate with Minitest's new <code>assert_pattern</code> by parsing the JSON contents of <code>response.parsed_body</code> with <code>ActiveSupport::HashWithIndifferentAccess</code>, so that it's pattern-matching compatible.</p>

<p><em>Sean Doyle</em></p>
</li><li>
<p>Add support for Playwright as a driver for system tests.</p>

<p><em>Yuki Nishijima</em></p>
</li><li>
<p>Fix <code>HostAuthorization</code> potentially displaying the value of the X_FORWARDED_HOST header when the HTTP_HOST header is being blocked.</p>

<p><em>Hartley McGuire</em>, <em>Daniel Schlosser</em></p>
</li><li>
<p>Rename <code>fixture_file_upload</code> method to <code>file_fixture_upload</code></p>

<p>Declare an alias to preserve the backwards compatibility of <code>fixture_file_upload</code></p>

<p><em>Sean Doyle</em></p>
</li><li>
<p><code>ActionDispatch::SystemTesting::TestHelpers::ScreenshotHelper</code> saves the screenshot path in test metadata on failure.</p>

<p><em>Matija Čupić</em></p>
</li><li>
<p><code>config.dom_testing_default_html_version</code> controls the HTML parser used by <code>ActionDispatch::Assertions#html_document</code>.</p>

<p>The <a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1 default configuration opts into the HTML5 parser when it is supported, to better represent what the DOM would be in a browser user agent. Previously this test helper always used Nokogiri's HTML4 parser.</p>

<p><em>Mike Dalessio</em></p>
</li><li>
<p>The <code>with_routing</code> helper can now be called at the class level. When called at the class level, the routes will be setup before each test, and reset after every test. For example:</p>

<pre><code>class RoutingTest &lt; ActionController::TestCase
  with_routing do |routes|
    routes.draw do
      resources :articles
      resources :authors
    end
  end

  def test_articles_route
    assert_routing(&quot;/articles&quot;, controller: &quot;articles&quot;, action: &quot;index&quot;)
  end

   def test_authors_route
    assert_routing(&quot;/authors&quot;, controller: &quot;authors&quot;, action: &quot;index&quot;)
  end
end
</code></pre>

<p><em>Andrew Novoselac</em></p>
</li><li>
<p>The <code>Mime::Type</code> now supports handling types with parameters and correctly handles quotes. When parsing the accept header, the parameters before the q-parameter are kept and if a matching mime-type exists it is used. To keep the current functionality, a fallback is created to look for the media-type without the parameters.</p>

<p>This change allows for custom MIME-types that are more complex like <code>application/vnd.api+json; profile=&quot;https://jsonapi.org/profiles/ethanresnick/cursor-pagination/&quot; ext=&quot;https://jsonapi.org/ext/atomic&quot;</code> for the <a href="https://jsonapi.org/">JSON API</a>.</p>

<p><em>Nicolas Erni</em></p>
</li><li>
<p>The url_for helpers now support a new option called <code>path_params</code>. This is very useful in situations where you only want to add a required param that is part of the route's URL but for other route not append an extraneous query param.</p>

<p>Given the following router...</p>

<pre><code>Rails.application.routes.draw do
  scope &quot;:account_id&quot; do
    get &quot;dashboard&quot; =&gt; &quot;pages#dashboard&quot;, as: :dashboard
    get &quot;search/:term&quot; =&gt; &quot;search#search&quot;, as: :search
  end
  delete &quot;signout&quot; =&gt; &quot;sessions#destroy&quot;, as: :signout
end
</code></pre>

<p>And given the following <code>ApplicationController</code></p>

<pre><code>class ApplicationController &lt; ActionController::Base
  def default_url_options
    { path_params: { account_id: &quot;foo&quot; } }
  end
end
</code></pre>

<p>The standard url_for helper and friends will now behave as follows:</p>

<pre><code>dashboard_path # =&gt; /foo/dashboard
dashboard_path(account_id: &quot;bar&quot;) # =&gt; /bar/dashboard

signout_path # =&gt; /signout
signout_path(account_id: &quot;bar&quot;) # =&gt; /signout?account_id=bar
signout_path(account_id: &quot;bar&quot;, path_params: { account_id: &quot;baz&quot; }) # =&gt; /signout?account_id=bar
search_path(&quot;quin&quot;) # =&gt; /foo/search/quin
</code></pre>

<p><em>Jason Meller, Jeremy Beker</em></p>
</li><li>
<p>Change <code>action_dispatch.show_exceptions</code> to one of <code>:all</code>, <code>:rescuable</code>, or <code>:none</code>. <code>:all</code> and <code>:none</code> behave the same as the previous <code>true</code> and <code>false</code> respectively. The new <code>:rescuable</code> option will only show exceptions that can be rescued (e.g. <code>ActiveRecord::RecordNotFound</code>). <code>:rescuable</code> is now the default for the test environment.</p>

<p><em>Jon Dufresne</em></p>
</li><li>
<p><code>config.action_dispatch.cookies_serializer</code> now accepts <code>:message_pack</code> and <code>:message_pack_allow_marshal</code> as serializers. These serializers require the {<code>msgpack</code> gem}[https://rubygems.org/gems/msgpack] (&gt;= 1.7.0).</p>

<p>The Message Pack format can provide improved performance and smaller payload sizes. It also supports roundtripping some Ruby types that are not supported by JSON. For example:</p>

<p>"'ruby  <a href=":foo">cookies.encrypted</a> = [{ a: 1 }, { b: 2 }.with_indifferent_access, 1.to_d, <a href="../../../classes/Time.html#method-c-at"><code>Time.at</code></a>(0, 123)]</p>

<p># BEFORE with config.action_dispatch.cookies_serializer = :json  <a href=":foo">cookies.encrypted</a>  # =&gt; [{"a"=&gt;1}, {"b"=&gt;2}, "1.0", "1969-12-31T18:00:00.000-06:00"]  <a href=":foo">cookies.encrypted</a>.map(&amp;:class)  # =&gt; [Hash, <a href="../../../classes/Hash.html"><code>Hash</code></a>, <a href="../../../classes/String.html"><code>String</code></a>, String]</p>

<p># AFTER with config.action_dispatch.cookies_serializer = :message_pack  <a href=":foo">cookies.encrypted</a>  # =&gt; [{:a=&gt;1}, {"b"=&gt;2}, 0.1e1, 1969-12-31 18:00:00.000123 -0600]  <a href=":foo">cookies.encrypted</a>.map(&amp;:class)  # =&gt; [Hash, <a href="../../../classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a>, <a href="../../../classes/BigDecimal.html"><code>BigDecimal</code></a>, Time]  "'</p>

<p>The <code>:message_pack</code> serializer can fall back to deserializing with <code>ActiveSupport::JSON</code> when necessary, and the <code>:message_pack_allow_marshal</code> serializer can fall back to deserializing with <code>Marshal</code> as well as <code>ActiveSupport::JSON</code>. Additionally, the <code>:marshal</code>, <code>:json</code>, and <code>:json_allow_marshal</code> (AKA <code>:hybrid</code>) serializers can now fall back to deserializing with <code>ActiveSupport::MessagePack</code> when necessary. These behaviors ensure old cookies can still be read so that migration is easier.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Remove leading dot from domains on cookies set with <code>domain: :all</code>, to meet RFC6265 requirements</p>

<p><em>Gareth Adams</em></p>
</li><li>
<p>Include source location in routes extended view.</p>

<pre><code>$ bin/rails routes --expanded

...
--[ Route 14 ]----------
Prefix            | new_gist
Verb              | GET
URI               | /gist(.:format)
Controller#Action | gists/gists#new
Source Location   | config/routes/gist.rb:3
</code></pre>

<p><em>Luan Vieira, John Hawthorn and Daniel Colson</em></p>
</li><li>
<p>Add <code>without</code> as an alias of <code>except</code> on <code>ActiveController::Parameters</code>.</p>

<p><em>Hidde-Jan Jongsma</em></p>
</li><li>
<p>Expand search field on <code>rails/info/routes</code> to also search <strong>route name</strong>, <strong>http verb</strong> and <strong>controller#action</strong>.</p>

<p><em>Jason Kotchoff</em></p>
</li><li>
<p>Remove deprecated <code>poltergeist</code> and <code>webkit</code> (capybara-webkit) driver registration for system testing.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Remove deprecated ability to assign a single value to <code>config.action_dispatch.trusted_proxies</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Deprecate <code>config.action_dispatch.return_only_request_media_type_on_content_type</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Remove deprecated behavior on <code>Request#content_type</code>.</p>

<p><em>Rafael Mendonça França</em></p>
</li><li>
<p>Change <code>ActionController::Instrumentation</code> to pass <code>filtered_path</code> instead of <code>fullpath</code> in the event payload to filter sensitive query params</p>

<pre><code>get &quot;/posts?password=test&quot;
request.fullpath         # =&gt; &quot;/posts?password=test&quot;
request.filtered_path    # =&gt; &quot;/posts?password=[FILTERED]&quot;
</code></pre>

<p><em>Ritikesh G</em></p>
</li><li>
<p>Deprecate <code>AbstractController::Helpers::MissingHelperError</code></p>

<p><em>Hartley McGuire</em></p>
</li><li>
<p>Change <code>ActionDispatch::Testing::TestResponse#parsed_body</code> to parse HTML as a Nokogiri document</p>

<pre><code>get &quot;/posts&quot;
response.content_type         # =&gt; &quot;text/html; charset=utf-8&quot;
response.parsed_body.class    # =&gt; Nokogiri::HTML5::Document
response.parsed_body.to_html  # =&gt; &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n...&quot;
</code></pre>

<p><em>Sean Doyle</em></p>
</li><li>
<p>Deprecate <code>ActionDispatch::IllegalStateError</code>.</p>

<p><em>Samuel Williams</em></p>
</li><li>
<p>Add HTTP::Request#route_uri_pattern that returns URI pattern of matched route.</p>

<p><em>Joel Hawksley</em>, <em>Kate Higa</em></p>
</li><li>
<p>Add <code>ActionDispatch::AssumeSSL</code> middleware that can be turned on via <code>config.assume_ssl</code>. It makes the application believe that all requests are arriving over SSL. This is useful when proxying through a load balancer that terminates SSL, the forwarded request will appear as though its HTTP instead of HTTPS to the application. This makes redirects and cookie security target HTTP instead of HTTPS. This middleware makes the server assume that the proxy already terminated SSL, and that the request really is HTTPS.</p>

<p><em>DHH</em></p>
</li><li>
<p>Only use HostAuthorization middleware if <code>config.hosts</code> is not empty</p>

<p><em>Hartley McGuire</em></p>
</li><li>
<p>Allow raising an error when a callback's only/unless symbols aren't existing methods.</p>

<p>When <code>before_action :callback, only: :action_name</code> is declared on a controller that doesn't respond to <code>action_name</code>, raise an exception at request time. This is a safety measure to ensure that typos or forgetfulness don't prevent a crucial callback from being run when it should.</p>

<p>For new applications, raising an error for undefined actions is turned on by default. If you do not want to opt-in to this behavior set <code>config.action_controller.raise_on_missing_callback_actions</code> to <code>false</code> in your application configuration. See #43487 for more details.</p>

<p><em>Jess Bees</em></p>
</li><li>
<p>Allow cookie <a href=":domain">options</a> to accept a proc to set the cookie domain on a more flexible per-request basis</p>

<p><em>RobL</em></p>
</li><li>
<p>When a host is not specified for an <code>ActionController::Renderer</code>'s env, the host and related options will now be derived from the routes' <code>default_url_options</code> and <code>ActionDispatch::Http::URL.secure_protocol</code>.</p>

<p>This means that for an application with a configuration like:</p>

<p><code>ruby   Rails.application.default_url_options = { host: &quot;rubyonrails.org&quot; }   Rails.application.config.force_ssl = true </code></p>

<p>rendering a URL like:</p>

<p><code>ruby   ApplicationController.renderer.render inline: &quot;&lt;%= blog_url %&gt;&quot; </code></p>

<p>will now return <code>&quot;https://rubyonrails.org/blog&quot;</code> instead of <code>&quot;http://example.org/blog&quot;</code>.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Add details of cookie name and size to <code>CookieOverflow</code> exception.</p>

<p><em>Andy Waite</em></p>
</li><li>
<p>Don't double log the <code>controller</code>, <code>action</code>, or <code>namespaced_controller</code> when using <code>ActiveRecord::QueryLog</code></p>

<p>Previously if you set <code>config.active_record.query_log_tags</code> to an array that included <code>:controller</code>, <code>:namespaced_controller</code>, or <code>:action</code>, that item would get logged twice. This bug has been fixed.</p>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Add the following permissions policy directives: <code>hid</code>, <code>idle-detection</code>, <code>screen-wake-lock</code>, <code>serial</code>, <code>sync-xhr</code>, <code>web-share</code>.</p>

<p><em>Guillaume Cabanel</em></p>
</li><li>
<p>The <code>speaker</code>, <code>vibrate</code>, and <code>vr</code> permissions policy directives are now deprecated.</p>

<p>There is no browser support for these directives, and no plan for browser support in the future. You can just remove these directives from your application.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Added the <code>:status</code> option to <code>assert_redirected_to</code> to specify the precise HTTP status of the redirect. Defaults to <code>:redirect</code> for backwards compatibility.</p>

<p><em>Jon Dufresne</em></p>
</li><li>
<p>Rescue <code>JSON::ParserError</code> in Cookies JSON deserializer to discards marshal dumps:</p>

<p>Without this change, if <code>action_dispatch.cookies_serializer</code> is set to <code>:json</code> and the app tries to read a <code>:marshal</code> serialized cookie, it would error out which wouldn't clear the cookie and force app users to manually clear it in their browser.</p>

<p>(See #45127 for original bug discussion)</p>

<p><em>Nathan Bardoux</em></p>
</li><li>
<p>Add <code>HTTP_REFERER</code> when following redirects on integration tests</p>

<p>This makes <code>follow_redirect!</code> a closer simulation of what happens in a real browser</p>

<p><em>Felipe Sateler</em></p>
</li><li>
<p>Added <code>exclude?</code> method to <code>ActionController::Parameters</code>.</p>

<p><em>Ian Neubert</em></p>
</li><li>
<p>Rescue <code>EOFError</code> exception from <code>rack</code> on a multipart request.</p>

<p><em>Nikita Vasilevsky</em></p>
</li><li>
<p>Log redirects from routes the same way as redirects from controllers.</p>

<p><em>Dennis Paagman</em></p>
</li><li>
<p>Prevent <code>ActionDispatch::ServerTiming</code> from overwriting existing values in <code>Server-Timing</code>. Previously, if another middleware down the chain set <code>Server-Timing</code> header, it would overwritten by <code>ActionDispatch::ServerTiming</code>.</p>

<p><em>Jakub Malinowski</em></p>
</li><li>
<p>Allow opting out of the <code>SameSite</code> cookie attribute when setting a cookie.</p>

<p>You can opt out of <code>SameSite</code> by passing <code>same_site: nil</code>.</p>

<p><code>cookies[:foo] = { value: &quot;bar&quot;, same_site: nil }</code></p>

<p>Previously, this incorrectly set the <code>SameSite</code> attribute to the value of the <code>cookies_same_site_protection</code> setting.</p>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Allow using <code>helper_method</code>s in <code>content_security_policy</code> and <code>permissions_policy</code></p>

<p>Previously you could access basic helpers (defined in helper modules), but not helper methods defined using <code>helper_method</code>. Now you can use either.</p>

<pre><code>content_security_policy do |p|
  p.default_src &quot;https://example.com&quot;
  p.script_src &quot;https://example.com&quot; if helpers.script_csp?
end
</code></pre>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Reimplement <code>ActionController::Parameters#has_value?</code> and <code>#value?</code> to avoid parameters and hashes comparison.</p>

<p>Deprecated equality between parameters and hashes is going to be removed in <a href="../../../classes/Rails.html"><code>Rails</code></a> 7.2. The new implementation takes care of conversions.</p>

<p><em>Seva Stefkin</em></p>
</li><li>
<p>Allow only <a href="../../../classes/String.html"><code>String</code></a> and <a href="../../../classes/Symbol.html"><code>Symbol</code></a> keys in <code>ActionController::Parameters</code>. Raise <code>ActionController::InvalidParameterKey</code> when initializing Parameters with keys that aren't strings or symbols.</p>

<p><em>Seva Stefkin</em></p>
</li><li>
<p>Add the ability to use custom logic for storing and retrieving CSRF tokens.</p>

<p>By default, the token will be stored in the session. Custom classes can be defined to specify arbitrary behavior, but the ability to store them in encrypted cookies is built in.</p>

<p><em>Andrew Kowpak</em></p>
</li><li>
<p>Make <a href="../../../classes/ActionController/Parameters.html#method-i-values"><code>ActionController::Parameters#values</code></a> cast nested hashes into parameters.</p>

<p><em>Gannon McGibbon</em></p>
</li><li>
<p>Introduce <code>html:</code> and <code>screenshot:</code> kwargs for system test screenshot helper</p>

<p>Use these as an alternative to the already-available environment variables.</p>

<p>For example, this will display a screenshot in iTerm, save the HTML, and output its path.</p>

<pre><code>take_screenshot(html: true, screenshot: &quot;inline&quot;)
</code></pre>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Allow <code>ActionController::Parameters#to_h</code> to receive a block.</p>

<p><em>Bob Farrell</em></p>
</li><li>
<p>Allow relative redirects when <code>raise_on_open_redirects</code> is enabled</p>

<p><em>Tom Hughes</em></p>
</li><li>
<p>Allow Content Security Policy DSL to generate for API responses.</p>

<p><em>Tim Wade</em></p>
</li><li>
<p>Fix <code>authenticate_with_http_basic</code> to allow for missing password.</p>

<p>Before <a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0 it was possible to handle basic authentication with only a username.</p>

<pre><code>authenticate_with_http_basic do |token, _|
  ApiClient.authenticate(token)
end
</code></pre>

<p>This ability is restored.</p>

<p><em>Jean Boussier</em></p>
</li><li>
<p>Fix <code>content_security_policy</code> returning invalid directives.</p>

<p>Directives such as <code>self</code>, <code>unsafe-eval</code> and few others were not single quoted when the directive was the result of calling a lambda returning an array.</p>

<pre><code>content_security_policy do |policy|
  policy.frame_ancestors lambda { [:self, &quot;https://example.com&quot;] }
end
</code></pre>

<p>With this fix the policy generated from above will now be valid.</p>

<p><em>Edouard Chin</em></p>
</li><li>
<p>Fix <code>skip_forgery_protection</code> to run without raising an error if forgery protection has not been enabled / <code>verify_authenticity_token</code> is not a defined callback.</p>

<p>This fix prevents the <a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0 Welcome Page (<code>/</code>) from raising an <code>ArgumentError</code> if <code>default_protect_from_forgery</code> is false.</p>

<p><em>Brad Trick</em></p>
</li><li>
<p>Make <code>redirect_to</code> return an empty response body.</p>

<p>Application controllers that wish to add a response body after calling <code>redirect_to</code> can continue to do so.</p>

<p><em>Jon Dufresne</em></p>
</li><li>
<p>Use non-capturing group for subdomain matching in <code>ActionDispatch::HostAuthorization</code></p>

<p>Since we do nothing with the captured subdomain group, we can use a non-capturing group instead.</p>

<p><em>Sam Bostock</em></p>
</li><li>
<p>Fix <code>ActionController::Live</code> to copy the IsolatedExecutionState in the ephemeral thread.</p>

<p>Since its inception <code>ActionController::Live</code> has been copying thread local variables to keep things such as <code>CurrentAttributes</code> set from middlewares working in the controller action.</p>

<p>With the introduction of <code>IsolatedExecutionState</code> in 7.0, some of that global state was lost in <code>ActionController::Live</code> controllers.</p>

<p><em>Jean Boussier</em></p>
</li><li>
<p>Fix setting <code>trailing_slash: true</code> in route definition.</p>

<pre><code>get &#39;/test&#39; =&gt; &quot;test#index&quot;, as: :test, trailing_slash: true

test_path() # =&gt; &quot;/test/&quot;
</code></pre>

<p><em>Jean Boussier</em></p>
</li><li>
<p>Make <code>Session#merge!</code> stringify keys.</p>

<p>Previously <code>Session#update</code> would, but <code>merge!</code> wouldn't.</p>

<p><em>Drew Bragg</em></p>
</li><li>
<p>Add <code>:unsafe_hashes</code> mapping for <code>content_security_policy</code></p>

<pre><code># Before
policy.script_src  :strict_dynamic, &quot;&#39;unsafe-hashes&#39;&quot;, &quot;&#39;sha256-rRMdkshZyJlCmDX27XnL7g3zXaxv7ei6Sg+yt4R3svU=&#39;&quot;

# After
policy.script_src  :strict_dynamic, :unsafe_hashes, &quot;&#39;sha256-rRMdkshZyJlCmDX27XnL7g3zXaxv7ei6Sg+yt4R3svU=&#39;&quot;
</code></pre>

<p><em>Igor Morozov</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/7-0-stable/actionpack/CHANGELOG.md">7-0-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </main>
  </body>
</html>
