<!DOCTYPE html>
<html lang="en">
<head>
    <title>CHANGELOG.md</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/panel.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/main.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<link rel="stylesheet" href="/css/github.css" type="text/css" media="screen" data-turbolinks-track="reload" />
<script src="/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/main.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/highlight.pack.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/turbolinks.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/search_index.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searcher.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/panel/tree.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>
<script src="/js/searchdoc.js" type="text/javascript" charset="utf-8" data-turbolinks-track="reload"></script>

<meta name="data-rel-prefix" content="/">
<meta name="data-tree-keys" content='[]'>

</head>

<body>
    <a class="sr-only sr-only-focusable" href="#content" data-turbolinks="false">Skip to Content</a>
    <a class="sr-only sr-only-focusable" href="#search" data-turbolinks="false">Skip to Search</a>

    <input type="checkbox" id="hamburger" class="panel_checkbox">
<label class="panel_mobile_button" for="hamburger"><span></span> Menu</label>
<nav class="panel panel_tree" id="panel" data-turbolinks-permanent>
  <div class="header">
    <input type="text" placeholder="Search (/) for a class, method, ..." autosave="searchdoc" results="10" id="search" autocomplete="off" tabindex="-1" />
    <label class="panel_mobile_button_close" for="hamburger"><span></span> Close</label>
  </div>
  <div class="tree">
    <ul>
    </ul>
  </div>
  <div class="result">
    <ul>
    </ul>
  </div>
  <a href="links.html" id="links">index</a>
</nav>


    <div class="banner">
        
        <h2>
            CHANGELOG.md
        </h2>
        <ul class="files">
            
            <li>
                rails/activestorage/CHANGELOG.md
                
                    <a href="https://github.com/rails/rails/blob/7b55c452b7d9a295d148ff882e0197cd139a9f8f/activestorage/CHANGELOG.md" target="_blank" class="github_url">on GitHub</a>
                
            </li>
            <li>Last modified: 2024-05-24 23:57:11 +0300</li>
        </ul>
    </div>

    <main id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<h2 id="label-Rails+7.0.8.3+-28May+17-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.8.3 (May 17, 2024)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.8.2+-28May+16-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.8.2 (May 16, 2024)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.8.1+-28February+21-2C+2024-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.8.1 (February 21, 2024)</h2>
<ul><li>
<p>Disables the session in <code>ActiveStorage::Blobs::ProxyController</code> and <code>ActiveStorage::Representations::ProxyController</code> in order to allow caching by default in some CDNs as CloudFlare</p>

<p>Fixes #44136</p>

<p><em>Bruno Prieto</em></p>
</li></ul>

<h2 id="label-Rails+7.0.8+-28September+09-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.8 (September 09, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.7.2+-28August+22-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.7.2 (August 22, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.7.1+-28August+22-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.7.1 (August 22, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.7+-28August+09-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.7 (August 09, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.6+-28June+29-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.6 (June 29, 2023)</h2>
<ul><li>
<p>Fix retrieving rotation value from FFmpeg on version 5.0+.</p>

<p>In FFmpeg version 5.0+ the rotation value has been removed from tags. Instead the value can be found in side_data_list. Along with this update it's possible to have values of -90, -270 to denote the video has been rotated.</p>

<p><em>Haroon Ahmed</em></p>
</li></ul>

<h2 id="label-Rails+7.0.5.1+-28June+26-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.5.1 (June 26, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.5+-28May+24-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.5 (May 24, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.4.3+-28March+13-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.4.3 (March 13, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.4.2+-28January+24-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.4.2 (January 24, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.4.1+-28January+17-2C+2023-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.4.1 (January 17, 2023)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.4+-28September+09-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.4 (September 09, 2022)</h2>
<ul><li>
<p>Fixes proxy downloads of files over 5MiB</p>

<p>Previously, trying to view and/or download files larger than 5mb stored in services like S3 via proxy mode could return corrupted files at around 5.2mb or cause random halts in the download. Now, <code>ActiveStorage::Blobs::ProxyController</code> correctly handles streaming these larger files from the service to the client without any issues.</p>

<p>Fixes #44679</p>

<p><em>Felipe Raul</em></p>
</li></ul>

<h2 id="label-Rails+7.0.3.1+-28July+12-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.3.1 (July 12, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.3+-28May+09-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.3 (May 09, 2022)</h2>
<ul><li>
<p>Don't stream responses in redirect mode</p>

<p>Previously, both redirect mode and proxy mode streamed their responses which caused a new thread to be created, and could end up leaking connections in the connection pool. But since redirect mode doesn't actually send any data, it doesn't need to be streamed.</p>

<p><em>Luke Lau</em></p>
</li></ul>

<h2 id="label-Rails+7.0.2.4+-28April+26-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.2.4 (April 26, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.2.3+-28March+08-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.2.3 (March 08, 2022)</h2>
<ul><li>
<p>Added image transformation validation via configurable allow-list.</p>

<p>Variant now offers a configurable allow-list for transformation methods in addition to a configurable deny-list for arguments.</p>

<p>[CVE-2022-21831]</p>
</li></ul>

<h2 id="label-Rails+7.0.2.2+-28February+11-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.2.2 (February 11, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.2.1+-28February+11-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.2.1 (February 11, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.2+-28February+08-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.2 (February 08, 2022)</h2>
<ul><li>
<p>Revert the ability to pass <code>service_name</code> param to <code>DirectUploadsController</code> which was introduced in 7.0.0.</p>

<p>That change caused a lot of problems to upgrade <a href="../../../classes/Rails.html"><code>Rails</code></a> applications so we decided to remove it while in work in a more backwards compatible implementation.</p>

<p><em>Gannon McGibbon</em></p>
</li><li>
<p>Allow applications to opt out of precompiling Active Storage JavaScript assets.</p>

<p><em>jlestavel</em></p>
</li></ul>

<h2 id="label-Rails+7.0.1+-28January+06-2C+2022-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.1 (January 06, 2022)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.0+-28December+15-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0 (December 15, 2021)</h2>
<ul><li>
<p>Support transforming empty-ish <code>has_many_attached</code> value into <code>[]</code> (e.g. <code>[&quot;&quot;]</code>).</p>

<pre><code>@user.highlights = [&quot;&quot;]
@user.highlights # =&gt; []
</code></pre>

<p><em>Sean Doyle</em></p>
</li></ul>

<h2 id="label-Rails+7.0.0.rc3+-28December+14-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0.rc3 (December 14, 2021)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.0.rc2+-28December+14-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0.rc2 (December 14, 2021)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.0.rc1+-28December+06-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0.rc1 (December 06, 2021)</h2>
<ul><li>
<p><code>Add ActiveStorage::Blob.compose</code> to concatenate multiple blobs.</p>

<p><em>Gannon McGibbon</em></p>
</li><li>
<p>Setting custom metadata on blobs are now persisted to remote storage.</p>

<p><em>joshuamsager</em></p>
</li><li>
<p>Support direct uploads to multiple services.</p>

<p><em>Dmitry Tsepelev</em></p>
</li><li>
<p>Invalid default content types are deprecated</p>

<p>Blobs created with content_type <code>image/jpg</code>, <code>image/pjpeg</code>, <code>image/bmp</code>, <code>text/javascript</code> will now produce a deprecation warning, since these are not valid content types.</p>

<p>These content types will be removed from the defaults in <a href="../../../classes/Rails.html"><code>Rails</code></a> 7.1.</p>

<p>You can set <code>config.active_storage.silence_invalid_content_types_warning = true</code> to dismiss the warning.</p>

<p><em>Alex Ghiculescu</em></p>
</li></ul>

<h2 id="label-Rails+7.0.0.alpha2+-28September+15-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0.alpha2 (September 15, 2021)</h2>
<ul><li>
<p>No changes.</p>
</li></ul>

<h2 id="label-Rails+7.0.0.alpha1+-28September+15-2C+2021-29"><a href="../../../classes/Rails.html"><code>Rails</code></a> 7.0.0.alpha1 (September 15, 2021)</h2>
<ul><li>
<p>Emit Active Support instrumentation events from Active Storage analyzers.</p>

<p>Fixes #42930</p>

<p><em>Shouichi Kamiya</em></p>
</li><li>
<p>Add support for byte range requests</p>

<p><em>Tom Prats</em></p>
</li><li>
<p>Attachments can be deleted after their association is no longer defined.</p>

<p>Fixes #42514</p>

<p><em>Don Sisco</em></p>
</li><li>
<p>Make <code>vips</code> the default variant processor for new apps.</p>

<p>See the upgrade guide for instructions on converting from <code>mini_magick</code> to <code>vips</code>. <code>mini_magick</code> is not deprecated, existing apps can keep using it.</p>

<p><em>Breno Gazzola</em></p>
</li><li>
<p>Deprecate <code>ActiveStorage::Current.host</code> in favor of <code>ActiveStorage::Current.url_options</code> which accepts a host, protocol and port.</p>

<p><em>Santiago Bartesaghi</em></p>
</li><li>
<p>Allow using <a href="https://cloud.google.com/storage/docs/access-control/signed-urls">IAM</a> when signing URLs with GCS.</p>

<pre><code>gcs:
  service: GCS
  ...
  iam: true
</code></pre>

<p><em>RRethy</em></p>
</li><li>
<p>OpenSSL constants are now used for <a href="../../../classes/Digest.html"><code>Digest</code></a> computations.</p>

<p><em>Dirkjan Bussink</em></p>
</li><li>
<p>Deprecate <code>config.active_storage.replace_on_assign_to_many</code>. Future versions of <a href="../../../classes/Rails.html"><code>Rails</code></a> will behave the same way as when the config is set to <code>true</code>.</p>

<p><em>Santiago Bartesaghi</em></p>
</li><li>
<p>Remove deprecated methods: <code>build_after_upload</code>, <code>create_after_upload!</code> in favor of <code>create_and_upload!</code>, and <code>service_url</code> in favor of <code>url</code>.</p>

<p><em>Santiago Bartesaghi</em></p>
</li><li>
<p>Add support of <code>strict_loading_by_default</code> to <code>ActiveStorage::Representations</code> controllers.</p>

<p><em>Anton Topchii</em>, <em>Andrew White</em></p>
</li><li>
<p>Allow to detach an attachment when record is not persisted.</p>

<p><em>Jacopo Beschi</em></p>
</li><li>
<p>Use libvips instead of ImageMagick to analyze images when <code>active_storage.variant_processor = vips</code>.</p>

<p><em>Breno Gazzola</em></p>
</li><li>
<p>Add metadata value for presence of video channel in video blobs.</p>

<p>The <code>metadata</code> attribute of video blobs has a new boolean key named <code>video</code> that is set to <code>true</code> if the file has an video channel and <code>false</code> if it doesn't.</p>

<p><em>Breno Gazzola</em></p>
</li><li>
<p>Deprecate usage of <code>purge</code> and <code>purge_later</code> from the association extension.</p>

<p><em>Jacopo Beschi</em></p>
</li><li>
<p>Passing extra parameters in <code>ActiveStorage::Blob#url</code> to S3 Client.</p>

<p>This allows calls of <code>ActiveStorage::Blob#url</code> to have more interaction with the S3 Presigner, enabling, amongst other options, custom S3 domain URL Generation.</p>

<pre><code>blob = ActiveStorage::Blob.last

blob.url # =&gt; https://&lt;bucket-name&gt;.s3.&lt;region&gt;.amazonaws.com/&lt;key&gt;
blob.url(virtual_host: true) # =&gt; # =&gt; https://&lt;bucket-name&gt;/&lt;key&gt;
</code></pre>

<p><em>josegomezr</em></p>
</li><li>
<p>Allow setting a <code>Cache-Control</code> on files uploaded to GCS.</p>

<pre><code>gcs:
  service: GCS
  ...
  cache_control: &quot;public, max-age=3600&quot;
</code></pre>

<p><em>maleblond</em></p>
</li><li>
<p>The parameters sent to <code>ffmpeg</code> for generating a video preview image are now configurable under <code>config.active_storage.video_preview_arguments</code>.</p>

<p><em>Brendon Muir</em></p>
</li><li>
<p>The ActiveStorage video previewer will now use scene change detection to generate better preview images (rather than the previous default of using the first frame of the video). This change requires FFmpeg v3.4+.</p>

<p><em>Jonathan Hefner</em></p>
</li><li>
<p>Add support for ActiveStorage expiring URLs.</p>

<pre><code>rails_blob_path(user.avatar, disposition: &quot;attachment&quot;, expires_in: 30.minutes)

&lt;%= image_tag rails_blob_path(user.avatar.variant(resize: &quot;100x100&quot;), expires_in: 30.minutes) %&gt;
</code></pre>

<p>If you want to set default expiration time for ActiveStorage URLs throughout your application, set <code>config.active_storage.urls_expire_in</code>.</p>

<p><em>aki77</em></p>
</li><li>
<p>Allow to purge an attachment when record is not persisted for <code>has_many_attached</code>.</p>

<p><em>Jacopo Beschi</em></p>
</li><li>
<p>Add <code>with_all_variant_records</code> method to eager load all variant records on an attachment at once. <code>with_attached_image</code> scope now eager loads variant records if using variant tracking.</p>

<p><em>Alex Ghiculescu</em></p>
</li><li>
<p>Add metadata value for presence of audio channel in video blobs.</p>

<p>The <code>metadata</code> attribute of video blobs has a new boolean key named <code>audio</code> that is set to <code>true</code> if the file has an audio channel and <code>false</code> if it doesn't.</p>

<p><em>Breno Gazzola</em></p>
</li><li>
<p>Adds analyzer for audio files.</p>

<p><em>Breno Gazzola</em></p>
</li><li>
<p>Respect Active Record's primary_key_type in Active Storage migrations.</p>

<p><em>fatkodima</em></p>
</li><li>
<p>Allow <code>expires_in</code> for ActiveStorage signed ids.</p>

<p><em>aki77</em></p>
</li><li>
<p>Allow to purge an attachment when record is not persisted for <code>has_one_attached</code>.</p>

<p><em>Jacopo Beschi</em></p>
</li><li>
<p>Add a load hook called <code>active_storage_variant_record</code> (providing <code>ActiveStorage::VariantRecord</code>) to allow for overriding aspects of the <code>ActiveStorage::VariantRecord</code> class. This makes <code>ActiveStorage::VariantRecord</code> consistent with <code>ActiveStorage::Blob</code> and <code>ActiveStorage::Attachment</code> that already have load hooks.</p>

<p><em>Brendon Muir</em></p>
</li><li>
<p><code>ActiveStorage::PreviewError</code> is raised when a previewer is unable to generate a preview image.</p>

<p><em>Alex Robbin</em></p>
</li><li>
<p>Add <code>ActiveStorage::Streaming</code> module that can be included in a controller to get access to <code>#send_blob_stream</code>, which wraps the new <code>ActionController::Base#send_stream</code> method to stream a blob from cloud storage:</p>

<pre><code>class MyPublicBlobsController &lt; ApplicationController
  include ActiveStorage::SetBlob, ActiveStorage::Streaming

  def show
    http_cache_forever(public: true) do
      send_blob_stream @blob, disposition: params[:disposition]
    end
  end
end
</code></pre>

<p><em>DHH</em></p>
</li><li>
<p>Add ability to use pre-defined variants.</p>

<pre><code>class User &lt; ActiveRecord::Base
  has_one_attached :avatar do |attachable|
    attachable.variant :thumb, resize: &quot;100x100&quot;
    attachable.variant :medium, resize: &quot;300x300&quot;, monochrome: true
  end
end

class Gallery &lt; ActiveRecord::Base
  has_many_attached :photos do |attachable|
    attachable.variant :thumb, resize: &quot;100x100&quot;
    attachable.variant :medium, resize: &quot;300x300&quot;, monochrome: true
  end
end

&lt;%= image_tag user.avatar.variant(:thumb) %&gt;
</code></pre>

<p><em>fatkodima</em></p>
</li><li>
<p>After setting <code>config.active_storage.resolve_model_to_route = :rails_storage_proxy</code> <code>rails_blob_path</code> and <code>rails_representation_path</code> will generate proxy URLs by default.</p>

<p><em>Ali Ismayilov</em></p>
</li><li>
<p>Declare <code>ActiveStorage::FixtureSet</code> and <code>ActiveStorage::FixtureSet.blob</code> to improve fixture integration.</p>

<p><em>Sean Doyle</em></p>
</li></ul>

<p>Please check <a href="https://github.com/rails/rails/blob/6-1-stable/activestorage/CHANGELOG.md">6-1-stable</a> for previous changes.</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
    
    
    
  
</div>

    </main>
  </body>
</html>
